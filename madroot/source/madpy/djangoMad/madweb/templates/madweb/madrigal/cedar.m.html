{% load static %}

<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>madrigal.cedar API documentation</title>
    <meta name="description" content="cedar is the module that allows the creation and editing of Cedar files.

With Madrigal 3.0, this mo..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
  <link href="/static/madrigal.css" rel="stylesheet" type="text/css" />
<style type="text/css">
	html body {
		background-color: {{bg_color}};
	}
</style>
</head>
<body>
<table width="100%" border="1" cellpadding="0" cellspacing="2" class="navigation">
  <tr>
    <td width="5%"><a href="admin.m.html"><img src="/static/previous.png" alt="previous" width="32" height="32" /></a></td>
    <td width="5%"><a href="index.html"><img src="/static/up.png" alt="up" width="32" height="32" /></a></td>
    <td width="5%"><a href="data.m.html"><img src="/static/next.png" alt="next" width="32" height="32" /></a></td>
    <td width="54%">madrigal.cedar</td>
    <td width="13%"><a href="../madContents.html">Doc home </a></td>
    <td width="18%"><a href="/">Madrigal home</a></td>
  </tr>
</table>
<div class='online-navigation'>
<b class="navlabel">Previous:</b>
<a class="sectref" href="admin.m.html">madrigal.admin </A>
<b class="navlabel">&nbsp;&nbsp;Up:</b>
<a class="sectref" href="index.html">Internal Madrigal Python API</A>
<b class="navlabel">&nbsp;&nbsp;Next:</b>
<a class="sectref" href="data.m.html">madrigal.data </A></div>
<hr/>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#madrigal.cedar.assumed">assumed</a></li>
    <li class="mono"><a href="#madrigal.cedar.knownbad">knownbad</a></li>
    <li class="mono"><a href="#madrigal.cedar.missing">missing</a></li>
    <li class="mono"><a href="#madrigal.cedar.timeParms">timeParms</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#madrigal.cedar.compareParms">compareParms</a></li>
    <li class="mono"><a href="#madrigal.cedar.getLowerCaseList">getLowerCaseList</a></li>
    <li class="mono"><a href="#madrigal.cedar.listRecords">listRecords</a></li>
    <li class="mono"><a href="#madrigal.cedar.parseArraySplittingParms">parseArraySplittingParms</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#madrigal.cedar.CatalogHeaderCreator">CatalogHeaderCreator</a></span>
        
          
  <ul>
    <li class="mono"><a href="#madrigal.cedar.CatalogHeaderCreator.__init__">__init__</a></li>
    <li class="mono"><a href="#madrigal.cedar.CatalogHeaderCreator.createCatalog">createCatalog</a></li>
    <li class="mono"><a href="#madrigal.cedar.CatalogHeaderCreator.createHeader">createHeader</a></li>
    <li class="mono"><a href="#madrigal.cedar.CatalogHeaderCreator.write">write</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#madrigal.cedar.CedarParameter">CedarParameter</a></span>
        
          
  <ul>
    <li class="mono"><a href="#madrigal.cedar.CedarParameter.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#madrigal.cedar.MadrigalCatalogRecord">MadrigalCatalogRecord</a></span>
        
          
  <ul>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.__init__">__init__</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.cmpDataRec">cmpDataRec</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.getEndTimeList">getEndTimeList</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.getKinst">getKinst</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.getLines">getLines</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.getModexp">getModexp</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.getModexpDesc">getModexpDesc</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.getStartTimeList">getStartTimeList</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.getText">getText</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.getTextLineCount">getTextLineCount</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.getType">getType</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.setKinst">setKinst</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.setModexp">setModexp</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.setModexpDesc">setModexpDesc</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.setText">setText</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCatalogRecord.setTimeLists">setTimeLists</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#madrigal.cedar.MadrigalCedarFile">MadrigalCedarFile</a></span>
        
          
  <ul>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.__init__">__init__</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.append">append</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.close">close</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.count">count</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.createCatalogTimeSection">createCatalogTimeSection</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.createHeaderTimeSection">createHeaderTimeSection</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.dump">dump</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.get1DParms">get1DParms</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.get2DParms">get2DParms</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getArraySplitParms">getArraySplitParms</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getDType">getDType</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getEarliestDT">getEarliestDT</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getIndSpatialParms">getIndSpatialParms</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getKindatList">getKindatList</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getKinstList">getKinstList</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getLatestDT">getLatestDT</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getMaxMinValues">getMaxMinValues</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getParmDim">getParmDim</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getRecDType">getRecDType</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getRecIndexList">getRecIndexList</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getRecordset">getRecordset</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getStatus">getStatus</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.getStringFormat">getStringFormat</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.hasArray">hasArray</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.index">index</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.insert">insert</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.loadNextRecords">loadNextRecords</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.parmIsInt">parmIsInt</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.parmIsString">parmIsString</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.pop">pop</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.refreshSummary">refreshSummary</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.remove">remove</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.reverse">reverse</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.setDType">setDType</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.setStatus">setStatus</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.sort">sort</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.updateMinMaxParmDict">updateMinMaxParmDict</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.write">write</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.writeExperimentNotes">writeExperimentNotes</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalCedarFile.writeText">writeText</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#madrigal.cedar.MadrigalDataRecord">MadrigalDataRecord</a></span>
        
          
  <ul>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.__init__">__init__</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.add1D">add1D</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.add2D">add2D</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.addParm">addParm</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.cmpDataRec">cmpDataRec</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.delete1D">delete1D</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.delete2DParm">delete2DParm</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.delete2DRows">delete2DRows</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.get1D">get1D</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.get1DParms">get1DParms</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.get2D">get2D</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.get2DParms">get2DParms</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getDType">getDType</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getDataset">getDataset</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getEndDatetime">getEndDatetime</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getEndTimeList">getEndTimeList</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getHeaderKodLines">getHeaderKodLines</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getInd2DParms">getInd2DParms</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getKindat">getKindat</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getKinst">getKinst</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getNrow">getNrow</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getParmDim">getParmDim</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getRecDType">getRecDType</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getRecno">getRecno</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getRecordset">getRecordset</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getRow">getRow</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getStartDatetime">getStartDatetime</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getStartTimeList">getStartTimeList</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getStrLen">getStrLen</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.getType">getType</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.parmIsInt">parmIsInt</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.parmIsString">parmIsString</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.set1D">set1D</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.set2D">set2D</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.set2DParmValues">set2DParmValues</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.setEndTimeList">setEndTimeList</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.setKindat">setKindat</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.setKinst">setKinst</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.setRecno">setRecno</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.setRow">setRow</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalDataRecord.setStartTimeList">setStartTimeList</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#madrigal.cedar.MadrigalHeaderRecord">MadrigalHeaderRecord</a></span>
        
          
  <ul>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.__init__">__init__</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.cmpDataRec">cmpDataRec</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.getEndTimeList">getEndTimeList</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.getJpar">getJpar</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.getKindat">getKindat</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.getKinst">getKinst</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.getLines">getLines</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.getMpar">getMpar</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.getStartTimeList">getStartTimeList</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.getText">getText</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.getTextLineCount">getTextLineCount</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.getType">getType</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.setJpar">setJpar</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.setKindat">setKindat</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.setKinst">setKinst</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.setMpar">setMpar</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.setText">setText</a></li>
    <li class="mono"><a href="#madrigal.cedar.MadrigalHeaderRecord.setTimeLists">setTimeLists</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#madrigal.cedar.convertToNetCDF4">convertToNetCDF4</a></span>
        
          
  <ul>
    <li class="mono"><a href="#madrigal.cedar.convertToNetCDF4.__init__">__init__</a></li>
    <li class="mono"><a href="#madrigal.cedar.convertToNetCDF4.getCatalogText">getCatalogText</a></li>
    <li class="mono"><a href="#madrigal.cedar.convertToNetCDF4.getHeaderText">getHeaderText</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#madrigal.cedar.convertToText">convertToText</a></span>
        
          
  <ul>
    <li class="mono"><a href="#madrigal.cedar.convertToText.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#madrigal.cedar.mergeCedarFiles">mergeCedarFiles</a></span>
        
          
  <ul>
    <li class="mono"><a href="#madrigal.cedar.mergeCedarFiles.__init__">__init__</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">madrigal.cedar</span> module</h1>
  <p>cedar is the module that allows the creation and editing of Cedar files.</p>
<p>With Madrigal 3.0, this module was rewritten to work with the power of the hdf5 I/O library.  Editing a file
now never needs to load the file into memory.  Instead, only the slice needing modification is read in.</p>
<p>Any input file must now be an Hdf5 one.  However, this module can output a file in any format.</p>
<p>The underlying data structure is a h5py dataset object, which is read from the hdf5 file under the group "Data" and the
dataset name "Table Layout".  Data not yet written in may also be stored in a numpy recarray with the
same dtype.</p>
<p>With Madrigal 2.X, this module abstracts away many of the details of the Cedar file format, which may change in the future,
and instead simply follows the Cedar data model (Prolog-1d parms-2d parms).  For example, all values are accessed and set via doubles, so
users do not need to deal with scale factors, "additional increment" parameters, etc.  The old Cedar file format had
limited dynamic range, so for now an exception is raised if any value would violate this limited range.  Furthermore,
the Cedar data model defines time in the prolog.  Unfortunately, time may also be set in the data itself, leading
to the possibility of inconsistent data.  This module will issue warnings in that case.</p>
<p>With Madrigal 3.0, this module  is built on top of the h5py hdf5 interface</p>
<p>$Id: cedar.py 7243 2020-10-09 20:32:58Z brideout $</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar" class="source">
    <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;cedar is the module that allows the creation and editing of Cedar files.</span>

<span class="sd">With Madrigal 3.0, this module was rewritten to work with the power of the hdf5 I/O library.  Editing a file</span>
<span class="sd">now never needs to load the file into memory.  Instead, only the slice needing modification is read in.</span>

<span class="sd">Any input file must now be an Hdf5 one.  However, this module can output a file in any format.</span>

<span class="sd">The underlying data structure is a h5py dataset object, which is read from the hdf5 file under the group &quot;Data&quot; and the</span>
<span class="sd">dataset name &quot;Table Layout&quot;.  Data not yet written in may also be stored in a numpy recarray with the</span>
<span class="sd">same dtype.</span>

<span class="sd">With Madrigal 2.X, this module abstracts away many of the details of the Cedar file format, which may change in the future,</span>
<span class="sd">and instead simply follows the Cedar data model (Prolog-1d parms-2d parms).  For example, all values are accessed and set via doubles, so</span>
<span class="sd">users do not need to deal with scale factors, &quot;additional increment&quot; parameters, etc.  The old Cedar file format had</span>
<span class="sd">limited dynamic range, so for now an exception is raised if any value would violate this limited range.  Furthermore,</span>
<span class="sd">the Cedar data model defines time in the prolog.  Unfortunately, time may also be set in the data itself, leading</span>
<span class="sd">to the possibility of inconsistent data.  This module will issue warnings in that case.</span>

<span class="sd">With Madrigal 3.0, this module  is built on top of the h5py hdf5 interface</span>

<span class="sd">$Id: cedar.py 7243 2020-10-09 20:32:58Z brideout $</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># standard python imports</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">array</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">collections</span>

<span class="c1"># third party imports</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">numpy.lib.recfunctions</span>
<span class="kn">import</span> <span class="nn">netCDF4</span>
<span class="kn">import</span> <span class="nn">h5py</span>

<span class="c1"># Millstone imports</span>
<span class="kn">import</span> <span class="nn">madrigal.metadata</span>
<span class="kn">import</span> <span class="nn">madrigal.data</span>
<span class="kn">import</span> <span class="nn">madrigal.admin</span>

<span class="c1"># cedar special values</span>
<span class="n">missing</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
<span class="n">assumed</span>  <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="n">knownbad</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span>
<span class="n">timeParms</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># any Cedar parameter below this number is a time parameter that conflicts with prolog</span>

<span class="k">def</span> <span class="nf">getLowerCaseList</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getLowerCaseList returns a new list that is all lowercase given an input list</span>
<span class="sd">    that may have upper case strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">parseArraySplittingParms</span><span class="p">(</span><span class="n">hdf5Filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parseArraySplittingParms returns a (possibly empty) list of parameter mnemonic used to split</span>
<span class="sd">        the array layout for a Madrigal Hdf5 file</span>
<span class="sd">        </span>
<span class="sd">        Input: hdf5Filename - Madrigal Hdf5 filename</span>
<span class="sd">        </span>
<span class="sd">        Raise IOError if not a valid Madrigal Hdf5 file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">hdf5Filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Hdf5 file </span><span class="si">%s</span><span class="s1"> does not have required top level Data group&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hdf5Filename</span><span class="p">))</span>
            <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="s1">&#39;Array Layout&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataGroup</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span> <span class="c1"># no array layout in this file</span>
            <span class="n">arrGroup</span> <span class="o">=</span> <span class="n">dataGroup</span><span class="p">[</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">arrGroup</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Array with&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">items</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">subitems</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                            <span class="n">parm</span> <span class="o">=</span> <span class="n">subitems</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                            <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
                            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
            
        <span class="c1"># None found</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
    
    
<span class="k">def</span> <span class="nf">listRecords</span><span class="p">(</span><span class="n">hdf5Filename</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">addedLinkFormat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;listRecords outputs a summary of records in the hdf5Filename.  Is lower memory footprint than</span>
<span class="sd">    loading full file into memory, then calling loadNextRecords.  However, if the file is already fully</span>
<span class="sd">    in memory, than classing the MadrigalCedarFile method loadNextRecords is faster.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">        hdf5Filename - input Madrigal hdf5 file to use</span>
<span class="sd">        newFilename - name of new file to create and write to.  If None, the default, write to stdout</span>
<span class="sd">        addedLinkFormat - if not None, add link to end of each record with value addedLinkFormat % (recno).</span>
<span class="sd">            If None (the default) no added link.  Must contain one and only one integer format to be</span>
<span class="sd">            filled in by recno.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">madParmObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalParameters</span><span class="p">()</span>
    <span class="n">madDataObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalFile</span><span class="p">(</span><span class="n">hdf5Filename</span><span class="p">)</span>
    
    <span class="n">formatStr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%6i</span><span class="s1">: </span><span class="si">%s</span><span class="s1">   </span><span class="si">%s</span><span class="s1">&#39;</span>
    <span class="n">headerStr</span> <span class="o">=</span> <span class="s1">&#39; record    start_time            end_time&#39;</span>
    <span class="n">parms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kinstList</span> <span class="o">=</span> <span class="n">madDataObj</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;        </span><span class="si">%i</span><span class="s1">&#39;</span>
        <span class="n">headerStr</span> <span class="o">+=</span> <span class="s1">&#39;             kinst&#39;</span>
        <span class="n">parms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;kinst&#39;</span><span class="p">)</span>
    <span class="n">kindatList</span> <span class="o">=</span> <span class="n">madDataObj</span><span class="o">.</span><span class="n">getKindatList</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;        </span><span class="si">%i</span><span class="s1">&#39;</span>
        <span class="n">headerStr</span> <span class="o">+=</span> <span class="s1">&#39;          kindat&#39;</span>
        <span class="n">parms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;kindat&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="n">addedLinkFormat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;   &#39;</span> <span class="o">+</span> <span class="n">addedLinkFormat</span>
        <span class="n">headerStr</span> <span class="o">+=</span> <span class="s1">&#39;    record_plot&#39;</span>
    <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">headerStr</span><span class="p">)</span>
    
    <span class="c1"># read in data from file</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">hdf5Filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fi</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Table Layout&#39;</span><span class="p">]</span>
        <span class="n">recno</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span>
        <span class="n">ut1_unix</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
        <span class="n">ut2_unix</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;kinst&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
            <span class="n">kinst</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;kindat&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
            <span class="n">kindat</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">]</span>
        
        <span class="n">max_recno</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">recno</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_recno</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">recno</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="n">this_ut1_unix</span> <span class="o">=</span> <span class="n">ut1_unix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">this_ut2_unix</span> <span class="o">=</span> <span class="n">ut2_unix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;kinst&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">this_kinst</span> <span class="o">=</span> <span class="n">kinst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;kindat&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">this_kindat</span> <span class="o">=</span> <span class="n">kindat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">this_ut1_unix</span><span class="p">)</span>
            <span class="n">sDTStr</span> <span class="o">=</span> <span class="n">sDT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">this_ut2_unix</span><span class="p">)</span>
            <span class="n">eDTStr</span> <span class="o">=</span> <span class="n">eDT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
            
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">sDTStr</span><span class="p">,</span> <span class="n">eDTStr</span><span class="p">]</span> 
            <span class="k">if</span> <span class="s1">&#39;kinst&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_kinst</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;kindat&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_kindat</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">addedLinkFormat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span>
                
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">formatStr</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            
    <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    

<span class="k">class</span> <span class="nc">MadrigalCedarFile</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;MadrigalCedarFile is an object that allows the creation and editing of Cedar files.</span>

<span class="sd">    This class emulates a python list, and so users may treat it just like a python list.  The</span>
<span class="sd">    restriction enforced is that all items in the list must be either MadrigalCatalogRecords,</span>
<span class="sd">    MadrigalHeaderRecords, or MadrigalDataRecords (all also defined in the madrigal.cedar module).</span>
<span class="sd">    Each of these three classes supports the method getType(), which returns &#39;catalog&#39;, &#39;header&#39;,</span>
<span class="sd">    and &#39;data&#39;, respectively.</span>
<span class="sd">    </span>
<span class="sd">    There are two programming patterns to choice from when using this module.  For smaller input or output files,</span>
<span class="sd">    read in files using the default maxRecords=None, so that the entire file is read into memory.  Output files</span>
<span class="sd">    using write for hdf5 or netCDF4 output, or writeText with the default append=False for text files.  This</span>
<span class="sd">    will be somewhat faster than using the larger file pattern below.</span>
<span class="sd">    </span>
<span class="sd">    For larger files, init the reading with maxRecords = some value, and then read in the rest using loadNextRecords.</span>
<span class="sd">    Write hdf5 file with a series of dumps, and then close with close(). Write text files using writeText with append</span>
<span class="sd">    = True.  Write large netCDF4 files by first creating a large Hdf5 file as above, and then use convertToNetCDF4</span>
<span class="sd">    to create the large netCDF4 file. This approach is somewhat slower, but has a limited memory footprint.</span>
<span class="sd"> </span>

<span class="sd">    Usage example::</span>

<span class="sd">        # the following example inserts a catalog record at the beginning of an existing file</span>

<span class="sd">        import madrigal.cedar.MadrigalCedarFile, time</span>
<span class="sd">    </span>
<span class="sd">        cedarObj = madrigal.cedar.MadrigalCedarFile(&#39;/opt/madrigal/experiments/1998/mlh/20jan98/mil980120g.003.hdf5&#39;)</span>

<span class="sd">        startTime = time.mktime((1998,1,20,0,0,0,0,0,0)) - time.timezone</span>

<span class="sd">        endTime = time.mktime((1998,1,21,23,59,59,0,0,0)) - time.timezone</span>

<span class="sd">        # catLines is a list of 80 character lines to be included in catalog record</span>

<span class="sd">        catObj = madrigal.cedar.MadrigalCatalogRecord(31, 1000, 1998,1,20,0,0,0,0,</span>
<span class="sd">                                                      1998,1,21,23,59,59,99, catLines)</span>

<span class="sd">        cedarObj.insert(0, catObj)</span>

<span class="sd">        cedarObj.write()</span>


<span class="sd">    Non-standard Python modules used: None</span>


<span class="sd">    Change history:</span>
<span class="sd">    </span>
<span class="sd">    Major rewrite in Jan 2013 as moved to Hdf5 and Madrigal 3.0</span>

<span class="sd">    Written by &quot;Bill Rideout&quot;:mailto:wrideout@haystack.mit.edu  April. 6, 2005</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># cedar special values</span>
    <span class="n">missing</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">missing_int</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
    <span class="n">requiredFields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;sec&#39;</span><span class="p">,</span> <span class="s1">&#39;recno&#39;</span><span class="p">,</span> <span class="s1">&#39;kindat&#39;</span><span class="p">,</span> <span class="s1">&#39;kinst&#39;</span><span class="p">,</span> 
                          <span class="s1">&#39;ut1_unix&#39;</span><span class="p">,</span> <span class="s1">&#39;ut2_unix&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullFilename</span><span class="p">,</span>
		 <span class="n">createFlag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">startDatetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">endDatetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">maxRecords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">recDset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">arraySplitParms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">skipArray</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__init__ initializes MadrigalCedarFile by reading in existing file, if any.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            fullFilename - either the existing Cedar file in Hdf5 format,</span>
<span class="sd">                           or a file to be created. May also be None if this</span>
<span class="sd">                           data is simply derived parameters that be written to stdout.</span>

<span class="sd">            createFlag - tells whether this is a file to be created.  If False and</span>
<span class="sd">                         fullFilename cannot be read, an error is raised.  If True and</span>
<span class="sd">                         fullFilename already exists, or fullFilename cannot be created,</span>
<span class="sd">                         an error is raised.</span>
<span class="sd">                         </span>
<span class="sd">            startDatetime - if not None (the default), reject all input records where</span>
<span class="sd">                  record end time &lt; startDatetime (datetime.datetime object).</span>
<span class="sd">                  Ignored if createFlag == True</span>
<span class="sd">    </span>
<span class="sd">            endDatetime - if not None (the default), reject all input records where</span>
<span class="sd">                  record start time &gt; endDatetime (datetime.datetime object)</span>
<span class="sd">                  Ignored if createFlag == True</span>
<span class="sd">                  </span>
<span class="sd">            maxRecords - the maximum number of records to read into memory</span>
<span class="sd">                    Ignored if createFlag == True</span>
<span class="sd">                    </span>
<span class="sd">            recDset - a numpy recarray with column names the names of all parameters, starting</span>
<span class="sd">                with requiredFields.  Values are 1 for 1D (all the required parms are 1D), 2 for</span>
<span class="sd">                dependent 2D, and 3 for independent spatial 2D parameters.  If None, self._recDset</span>
<span class="sd">                not set until first data record appended.</span>
<span class="sd">                </span>
<span class="sd">            arraySplitParms - if None (the default), read in arraySplitParms from the exiting file.</span>
<span class="sd">                Otherwise set self._arraySplitParms to arraySplitParms, which is a list of 1D or 2D parms</span>
<span class="sd">                where each unique set of value of the parms in this list will be used to split the full</span>
<span class="sd">                data into separate arrays in Hdf5 or netCDF4 files.  For example arraySplitParms=[&#39;beamid&#39;]</span>
<span class="sd">                would split the data into separate arrays for each beamid. If None and new file is being</span>
<span class="sd">                created, no array splitting (self._arraySplitParms = []).</span>
<span class="sd">                </span>
<span class="sd">            skipArray - if False and any 2D parms, create array layout (the default).  If True, skip array</span>
<span class="sd">                layout (typically used when there are too many ind parm value combinations - generally not recommended).</span>
<span class="sd">            </span>
<span class="sd">	        </span>
<span class="sd">        Affects: populates self._privList if file exists.  self._privList is the underlying</span>
<span class="sd">            list of MadrigalDataRecords, MadrigalCatalogRecords, and MadrigalHeaderRecords.</span>
<span class="sd">            Also populates:</span>
<span class="sd">                self._tableDType - the numpy dtype to use to build the table layout  </span>
<span class="sd">                self._nextRecord - the index of the next record to read from the input file. Not used if</span>
<span class="sd">                    createFlag = True</span>
<span class="sd">                    (The following are the input arguments described above)</span>
<span class="sd">                self._fullFilename</span>
<span class="sd">                self._createFlag</span>
<span class="sd">                self._startDatetime</span>
<span class="sd">                self._endDatetime</span>
<span class="sd">                self._maxRecords</span>
<span class="sd">                self._totalDataRecords - number of data records appended (may differ from len(self._privList)</span>
<span class="sd">                    if dump called).</span>
<span class="sd">                self._minMaxParmDict - a dictionary with key = parm mnems, value = tuple of</span>
<span class="sd">                    min, max values (may be nan)</span>
<span class="sd">                self._arrDict - a dictionary with key = list of array split parm values found in file,</span>
<span class="sd">                    (&#39;&#39; if no spliting), and values = dict of key = &#39;ut1_unix&#39; and ind 2d parm names (excluding</span>
<span class="sd">                    array splitting parms, if also ind 2D parm), and values</span>
<span class="sd">                    = python set of all unique values.  Populated only if createFlag=True. Used to create</span>
<span class="sd">                    Array Layout</span>
<span class="sd">                self._recIndexList - a list of (startIndex, endIndex) for each data record added.  Used to slice out</span>
<span class="sd">                    data records from Table Layout</span>
<span class="sd">                self._num2DSplit - Number of arraySplitParms that are 2D</span>
<span class="sd">                self._closed - a boolean used to determine if the file being created was already closed</span>
<span class="sd">                </span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">        </span>
<span class="sd">        Returns: void</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span> <span class="o">=</span> <span class="n">fullFilename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_startDatetime</span> <span class="o">=</span> <span class="n">startDatetime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endDatetime</span> <span class="o">=</span> <span class="n">endDatetime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxRecords</span> <span class="o">=</span> <span class="n">maxRecords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_totalDataRecords</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set to the dtype of Table Layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set when first data record appended</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set when first data record appended</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set when first data record appended</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="n">arraySplitParms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skipArray</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">skipArray</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">createFlag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># no need to close file only being read</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;.hdf&#39;</span><span class="p">)</span>
        
        <span class="c1"># keep track of earliest and latest record times</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># summary info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># a list of all kinsts integers in file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># a list of all kindats integers in file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span> <span class="c1"># can be externally set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used to check that partial writes via dump are consistent</span>

        <span class="k">if</span> <span class="n">createFlag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;in MadrigalCedarFile, createFlag must be either True or False&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_createFlag</span> <span class="o">=</span> <span class="n">createFlag</span>

        <span class="k">if</span> <span class="n">createFlag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;in MadrigalCedarFile, fullFilename </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fullFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;MadrigalCedarFile can only read in CEDAR Hdf5 files, not </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fullFilename</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">createFlag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fullFilename</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># then this data will never be persisted - only written to stdout</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;in MadrigalCedarFile, fullFilename </span><span class="si">%s</span><span class="s1"> already exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;in MadrigalCedarFile, fullFilename </span><span class="si">%s</span><span class="s1"> cannot be created&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fullFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;All Madrigal files must end with hdf5 extension, &lt;</span><span class="si">%s</span><span class="s1">&gt; does not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="p">[]</span>
                
        <span class="c1"># create needed Madrigal objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madDBObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalDB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalInstrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDBObj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDBObj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalKindat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDBObj</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set to bool when first record added</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">recDset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">=</span> <span class="n">recDset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">createFlag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maxRecords</span><span class="p">)</span>
        
                
        
    <span class="k">def</span> <span class="nf">loadNextRecords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numRecords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">removeExisting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;loadNextRecords loads a maximum of numRecords.  Returns tuple of the the number of records loaded, and boolean of whether complete.</span>
<span class="sd">        May be less than numRecords if not enough records in the input file.  Returns 0 if no records left.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            numRecords - number of records to try to load.  If None, load all remaining records</span>
<span class="sd">            </span>
<span class="sd">            removeExisting - if True (the default), remove existing records before loading new</span>
<span class="sd">                ones.  If False, append new records to existing records.</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            </span>
<span class="sd">                tuple of the the number of records loaded, and boolean of whether complete. </span>
<span class="sd">                May be less than numRecords if not enough records.  </span>
<span class="sd">                </span>
<span class="sd">        Raises error if file opened with createFlag = True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createFlag</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Cannot call loadNextRecords when creating a new MadrigalCedarFile&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">removeExisting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="n">isComplete</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="n">hdfFile</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">tableDset</span> <span class="o">=</span> <span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">][</span><span class="s2">&quot;Table Layout&quot;</span><span class="p">]</span>
        <span class="n">metadataGroup</span> <span class="o">=</span> <span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">]</span>
        <span class="n">recDset</span> <span class="o">=</span> <span class="n">metadataGroup</span><span class="p">[</span><span class="s2">&quot;_record_layout&quot;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">=</span> <span class="n">recDset</span><span class="p">[()]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">!=</span> <span class="n">recDset</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;recDset in first record &lt;</span><span class="si">%s</span><span class="s1">&gt; does not match expected recDset &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> \
                    <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">recDset</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verifyFormat</span><span class="p">(</span><span class="n">tableDset</span><span class="p">,</span> <span class="n">recDset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="o">=</span> <span class="n">tableDset</span><span class="o">.</span><span class="n">dtype</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">][</span><span class="s1">&#39;Experiment Parameters&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getKinstList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getKindatList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getArraySplitParms</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;Experiment Notes&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_appendCatalogRecs</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">][</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_appendHeaderRecs</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">][</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">])</span>
            
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parmObjList</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">)</span> <span class="c1"># used for performance in load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parmObjList</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="c1"># get indices for each record</span>
        <span class="n">recLoaded</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">recTested</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;recnoArr&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recnoArr</span> <span class="o">=</span> <span class="n">tableDset</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span>
        <span class="c1"># read all the records in at once for performance</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numRecords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recnoArr</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">+</span> <span class="n">numRecords</span><span class="p">]))</span>
            <span class="n">tableIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableIndices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fullTableSlice</span> <span class="o">=</span> <span class="n">tableDset</span><span class="p">[</span><span class="n">tableIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">tableIndices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">fullRecnoArr</span> <span class="o">=</span> <span class="n">fullTableSlice</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fullTableSlice</span> <span class="o">=</span> <span class="n">tableDset</span>
            <span class="n">fullRecnoArr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recnoArr</span>
            
        <span class="k">while</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">numRecords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableIndices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">isComplete</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">numRecords</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">recTested</span> <span class="o">&gt;=</span> <span class="n">numRecords</span><span class="p">:</span>
                    <span class="k">break</span>
                
            <span class="c1"># get slices of tableDset and recDset to create next MadrigalDataRecord</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">fullRecnoArr</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
            <span class="n">tableIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableIndices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">isComplete</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="n">tableSlice</span> <span class="o">=</span> <span class="n">fullTableSlice</span><span class="p">[</span><span class="n">tableIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">tableIndices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tableIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">tableIndices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="n">firstRow</span> <span class="o">=</span> <span class="n">tableSlice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">startDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">])</span>
            <span class="n">stopDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">])</span>
                
            <span class="k">if</span> <span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">])</span>
            
            <span class="c1"># find earliest and latest times</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="n">startDT</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="n">stopDT</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">startDT</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="n">startDT</span>
                <span class="k">if</span> <span class="n">stopDT</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="n">stopDT</span>
                    
            <span class="n">recTested</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># increment here because the next step may reject it</span>
            
            <span class="c1"># check if datetime filter should be applied</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startDatetime</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endDatetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startDatetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">stopDT</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startDatetime</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endDatetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">startDT</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endDatetime</span><span class="p">:</span>
                        <span class="n">isComplete</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">indParmList</span> <span class="o">=</span> <span class="n">metadataGroup</span><span class="p">[</span><span class="s1">&#39;Independent Spatial Parameters&#39;</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span>
                    <span class="n">indParms</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">indParms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">indParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span>
                
                    
            <span class="n">newMadDataRec</span> <span class="o">=</span> <span class="n">MadrigalDataRecord</span><span class="p">(</span><span class="n">madInstObj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="p">,</span> <span class="n">madParmObj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="p">,</span>
                                               <span class="n">dataset</span><span class="o">=</span><span class="n">tableSlice</span><span class="p">,</span> <span class="n">recordSet</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">,</span> 
                                               <span class="n">parmObjList</span><span class="o">=</span><span class="n">parmObjList</span><span class="p">,</span> <span class="n">ind2DList</span><span class="o">=</span><span class="n">indParms</span><span class="p">)</span>
            

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="n">newMadDataRec</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="n">newMadDataRec</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="n">newMadDataRec</span><span class="o">.</span><span class="n">getInd2DParms</span><span class="p">()</span>
                <span class="n">parmObjList</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">)</span> <span class="c1"># used for performance in load</span>
                <span class="c1"># set self._num2DSplit</span>
                <span class="n">twoDSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">mnemonic</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">])</span>
                <span class="n">arraySplitSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDSet</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">arraySplitSet</span><span class="p">))</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newMadDataRec</span><span class="p">)</span>
            <span class="n">recLoaded</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="n">hdfFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="c1"># update minmax</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totalDataRecords</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateMinMaxParmDict</span><span class="p">()</span>
        
        <span class="k">return</span><span class="p">((</span><span class="n">recLoaded</span><span class="p">,</span> <span class="n">isComplete</span><span class="p">))</span>
            
            


    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">arraySplittingParms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skipArrayLayout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;write persists a MadrigalCedarFile to file.</span>
<span class="sd">        </span>
<span class="sd">        Note:  There are two ways to write to a MadrigalCedarFile.  Either this method (write) is called after all the</span>
<span class="sd">        records have been appended to the MadrigalCedarFile, or dump is called after a certain number of records are appended,</span>
<span class="sd">        and then at the end dump is called a final time if there were any records not yet dumped, followed by close.</span>
<span class="sd">        The __del__ method will automatically call close if needed, and print a warning that the user should add it to</span>
<span class="sd">        their code.</span>
<span class="sd">        </span>
<span class="sd">        write has the advantage of being simplier, but has the disadvantage for larger files of keeping all those records</span>
<span class="sd">        in memory.  dump/close has the advantage of significantly reducing the memory footprint, but is somewhat more complex.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            format - a format to save the file in.  For now, the allowed values are </span>
<span class="sd">            &#39;hdf5&#39; and &#39;netCDF4&#39;.  Defaults to &#39;hdf5&#39;. Use writeText method to get text output.</span>

<span class="sd">            newFilename - a filename to save to.  Defaults to self._fullFilename passed into initializer if not given.</span>

<span class="sd">            refreshCatHeadTimes - if True (the default), update start and and times in the catalog and header</span>
<span class="sd">                records to represent the times in the data.  If False, use existing times in those records.</span>
<span class="sd">                </span>
<span class="sd">            skipArrayLayout - if True, do not include Array Layout even if there are independent spatial</span>
<span class="sd">                parameters.  If False (the default) write Array Layout if there are independent spatial</span>
<span class="sd">                parameters and format = &#39;hdf5&#39;</span>
<span class="sd">                </span>
<span class="sd">            arraySplittingParms - a list of parameters as mnemonics used to split</span>
<span class="sd">                arrays into subarrays.  For example, beamcode would split data with separate beamcodes</span>
<span class="sd">                into separate arrays. The number of separate arrays will be up to the product of the number of </span>
<span class="sd">                unique values found for each parameter, with the restriction that combinations with no records will</span>
<span class="sd">                not create a separate array. If default None passed in, then set to self._arraySplitParms, </span>
<span class="sd">                set when CEDAR file read in.</span>
<span class="sd">                </span>
<span class="sd">            overwrite - if False (the default) do not overwrite existing file.  If True, overwrite file is it already exists.</span>
<span class="sd">                </span>
<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: writes a MadrigalCedarFile to file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot call write method after calling dump method&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">newFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span>
            
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal format &lt;</span><span class="si">%s</span><span class="s1">&gt; - must be hdf5 or netCDF4&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;newFilename &lt;</span><span class="si">%s</span><span class="s1">&gt; already exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newFilename</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">=</span> <span class="nb">format</span>
        
        <span class="k">if</span> <span class="n">arraySplittingParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arraySplittingParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span>
        <span class="k">if</span> <span class="n">arraySplittingParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arraySplittingParms</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">newFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;filename must end with </span><span class="si">%s</span><span class="s1">, &lt;</span><span class="si">%s</span><span class="s1">&gt; does not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">),</span> <span class="n">newFilename</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># we need to make sure this file is closed and then deleted if an error</span>
                <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used if next line fails</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Metadata</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Data</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_createArrayLayout</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">arraySplittingParms</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># on any error, close and delete file, then reraise error</span>
                <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newFilename</span><span class="p">)</span>
                <span class="k">raise</span>
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">==</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># we need to make sure this file is closed and then deleted if an error</span>
                <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used if next line fails</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_writeNetCDF4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">arraySplittingParms</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># on any error, close and delete file, then reraise error</span>
                <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newFilename</span><span class="p">)</span>
                <span class="k">raise</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># write ends with closed file</span>
            




    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dump appends all the present records in MadrigalCedarFile to file, and removes present data records from MadrigalCedarFile.</span>

<span class="sd">        Can be used to append records to a file. Catalog and header records are maintaained.</span>
<span class="sd">        </span>
<span class="sd">        Typically close is called after all calls to dump. The __del__ method will automatically call </span>
<span class="sd">        close if needed, and print a warning that the user should add it to their code.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            format - a format to save the file in.  The format argument only exists for backwards</span>
<span class="sd">                compatibility - only hdf5 is allowed.  IOError raised is any other argument given.</span>
<span class="sd">                </span>
<span class="sd">            newFilename - a filename to save to.  Defaults to self._fullFilename passed into initializer if not given.</span>
<span class="sd">                </span>
<span class="sd">            parmIndexDict - used only for dumping netCDF4</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: writes a MadrigalCedarFile to file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">!=</span> <span class="nb">format</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Previous dump format was </span><span class="si">%s</span><span class="s1">, cannot now use </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">format</span><span class="p">)))</span>

        <span class="k">if</span> <span class="nb">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Format must be hdf5 for dump, not </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">format</span><span class="p">)))</span>
        
        <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">newFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># first write - run checks, and create all possible metadata and data</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;newFilename &lt;</span><span class="si">%s</span><span class="s1">&gt; already exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newFilename</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">newFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;.nc&#39;</span><span class="p">])):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;filename must end with </span><span class="si">%s</span><span class="s1">, &lt;</span><span class="si">%s</span><span class="s1">&gt; does not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;.nc&#39;</span><span class="p">])),</span> <span class="n">newFilename</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">newFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;filename must end with </span><span class="si">%s</span><span class="s1">, &lt;</span><span class="si">%s</span><span class="s1">&gt; does not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">,</span> <span class="n">newFilename</span><span class="p">))</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># nothing to dump</span>
            <span class="k">return</span>
        
        
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
        
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># we need to make sure this file is closed and then deleted if an error</span>
                <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used if next line fails</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasArray</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Cannot call dump for hdf5 after write or close&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Data</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># on any error, close and delete file, then reraise error</span>
                <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newFilename</span><span class="p">)</span>
                <span class="k">raise</span>
            
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Cannot dump netCDF4 files with arraySplitParms - write to Hdf5 and then convert&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># first write</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_firstDumpNetCDF4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_appendNetCDF4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
                

        <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">=</span> <span class="nb">format</span>
        
        <span class="c1"># dump data records out of memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="o">=</span> <span class="p">[</span><span class="n">rec</span> <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">]</span>
        
        
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;close closes an open MadrigalCedarFile.  It calls _writeHdf5Metadata and _addArray if ind parms.</span>
<span class="sd">        </span>
<span class="sd">        Most be called directly when dump used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span><span class="p">:</span>
            <span class="c1"># nothing to do</span>
            <span class="k">return</span>
        
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Metadata</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skipArray</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_addArrayDump</span><span class="p">()</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">True</span>
        
        
        
    <span class="k">def</span> <span class="nf">writeText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="n">showHeaders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">selectParms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">filterList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">assumed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">knownbad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">firstWrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;writeText writes text to new filename</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            newFilename - name of new file to create and write to.  If None, the default, write to stdout</span>
<span class="sd">            </span>
<span class="sd">            summary - type of summary line to print at top.  Allowed values are:</span>
<span class="sd">                &#39;plain&#39; - text only mnemonic names, but only if not showHeaders</span>
<span class="sd">                &#39;html&#39; - mnemonic names wrapped in standard javascript code to allow descriptive popups</span>
<span class="sd">                &#39;summary&#39; - print overview of file and filters used. Also text only mnemonic names, </span>
<span class="sd">                    but only if not showHeaders</span>
<span class="sd">                None - no summary line</span>
<span class="sd">                </span>
<span class="sd">            showHeaders - if True, print header in format for each record.  If False, the default,</span>
<span class="sd">                do not.</span>
<span class="sd">                </span>
<span class="sd">            selectParms - If None, simply print all parms that are in the file.  If a list</span>
<span class="sd">                of parm mnemonics, print only those parms in the order specified.</span>
<span class="sd">                </span>
<span class="sd">            filterList - a list of madrigal.derivation.MadrigalFilter objects to be described in the </span>
<span class="sd">                summary.  Default is None, in which case not described in summary.  Ignored if summary</span>
<span class="sd">                is not &#39;summary&#39;</span>
<span class="sd">                </span>
<span class="sd">            missing, assumed, knownbad - how to print Cedar special values.  Default is None for</span>
<span class="sd">                all, so that value printed in value in numpy table as per spec.</span>
<span class="sd">                </span>
<span class="sd">            append - if True, open newFilename in append mode, and dump records after writing.  If False, </span>
<span class="sd">                open in write mode. Used to allow writing in conjuction with loadNextRecords.</span>
<span class="sd">                </span>
<span class="sd">            firstWrite - True if this is the first group of records added, and append mode is True.</span>
<span class="sd">                Used to know whether to write summary lines.  If False and append is True, no summary</span>
<span class="sd">                lines are added; if True and append is True, summary lines are added.  If append is not </span>
<span class="sd">                True, this argument ignored.</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># constants </span>
        <span class="n">_underscore</span> <span class="o">=</span> <span class="mi">95</span> <span class="c1"># used to indicate missing character</span>
        
        <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
            
        <span class="k">if</span> <span class="n">summary</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal summary value &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">summary</span><span class="p">)))</span>
        
        <span class="c1"># cache information needed to replace special values if needed</span>
        <span class="c1"># helps performance when replacing</span>
        <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
            <span class="n">missing_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
            <span class="n">missing_search</span> <span class="o">=</span> <span class="s1">&#39;\ &#39;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">missing_len</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;nan&#39;</span>
            <span class="k">if</span> <span class="n">missing_len</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">missing</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">missing_len</span><span class="p">)</span> <span class="o">+</span> <span class="n">missing</span>
        <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">assumed</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">assumed</span><span class="p">)</span>
            <span class="n">assumed_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assumed</span><span class="p">)</span>
            <span class="n">assumed_search</span> <span class="o">=</span> <span class="s1">&#39;\ &#39;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">assumed_len</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;inf&#39;</span>
            <span class="k">if</span> <span class="n">assumed_len</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">assumed</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">assumed_len</span><span class="p">)</span> <span class="o">+</span> <span class="n">assumed</span>
        <span class="k">if</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">knownbad</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">knownbad</span><span class="p">)</span>
            <span class="n">knownbad_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">knownbad</span><span class="p">)</span>
            <span class="n">knownbad_search</span> <span class="o">=</span> <span class="s1">&#39;\ &#39;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">knownbad_len</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-inf&#39;</span>
            <span class="k">if</span> <span class="n">knownbad_len</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">knownbad</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="n">knownbad_len</span><span class="p">)</span> <span class="o">+</span> <span class="n">knownbad</span>
            
        <span class="c1"># create format string and header strings</span>
        <span class="n">formatStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">parmStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">selectParms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="o">.</span><span class="n">names</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmFormat</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># first handle float formats</span>
                <span class="n">dataWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">format</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)])</span>
                <span class="c1"># make sure width is big enough for special values</span>
                <span class="n">newDataWidth</span> <span class="o">=</span> <span class="n">dataWidth</span>
                <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">newDataWidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">newDataWidth</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">newDataWidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">newDataWidth</span><span class="p">,</span> <span class="n">dataWidth</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">assumed</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">newDataWidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">newDataWidth</span><span class="p">,</span> <span class="n">dataWidth</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">knownbad</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">newDataWidth</span> <span class="o">&gt;</span> <span class="n">dataWidth</span><span class="p">:</span>
                    <span class="c1"># we need to expand format</span>
                    <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%%%i%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newDataWidth</span><span class="p">,</span> <span class="nb">format</span><span class="p">[</span><span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):])</span>
                    <span class="n">dataWidth</span> <span class="o">=</span> <span class="n">newDataWidth</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="c1"># now handle integer or string formats - assumed to never be error values</span>
                <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c1"># we need to insert a length</span>
                        <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%%%i</span><span class="s1">i&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmWidth</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">dataWidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmWidth</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dataWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">format</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">dataWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">format</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmWidth</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span> <span class="n">dataWidth</span><span class="p">)</span>
            <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span><span class="p">)</span>
            <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">-</span><span class="n">dataWidth</span><span class="p">))</span> <span class="c1"># sets spacing between numbers</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># need to truncate name</span>
                <span class="k">if</span> <span class="n">summary</span> <span class="o">!=</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                    <span class="n">parmStr</span> <span class="o">+=</span> <span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parmStr</span> <span class="o">+=</span> <span class="s2">&quot;&lt;a href=JavaScript:popup(&#39;</span><span class="si">%s</span><span class="s2">&#39;) title=&#39;</span><span class="si">%s</span><span class="s2">, units=</span><span class="si">%s</span><span class="s2">&#39;&gt;</span><span class="si">%s</span><span class="s2">&lt;/a&gt;&amp;nbsp;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                                                                                     <span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># pad evenly on both sides</span>
                <span class="n">firstHalfSpace</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">width</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">secHalfSpace</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">width</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span> <span class="o">-</span> <span class="n">firstHalfSpace</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">summary</span> <span class="o">!=</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                    <span class="n">parmStr</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">firstHalfSpace</span> <span class="o">+</span> <span class="n">parm</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">secHalfSpace</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parmStr</span> <span class="o">+=</span> <span class="s1">&#39;&amp;nbsp;&#39;</span> <span class="o">*</span> <span class="n">firstHalfSpace</span> 
                    <span class="n">parmStr</span> <span class="o">+=</span> <span class="s2">&quot;&lt;a href=JavaScript:popup(&#39;</span><span class="si">%s</span><span class="s2">&#39;) title=&#39;</span><span class="si">%s</span><span class="s2">, units=</span><span class="si">%s</span><span class="s2">&#39;&gt;</span><span class="si">%s</span><span class="s2">&lt;/a&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                                                               <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                                                                               <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                                                                               <span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                    <span class="n">parmStr</span> <span class="o">+=</span> <span class="s1">&#39;&amp;nbsp;&#39;</span> <span class="o">*</span> <span class="n">secHalfSpace</span>
                    
        <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">firstHeaderPrinted</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># state variable for adding extra space between lines</span>
        
        <span class="k">if</span> <span class="n">summary</span> <span class="o">==</span> <span class="s1">&#39;summary&#39;</span><span class="p">:</span> 
            <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span> <span class="ow">or</span> <span class="p">(</span><span class="n">append</span> <span class="ow">and</span> <span class="n">firstWrite</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_printSummary</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">filterList</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">summary</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">showHeaders</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span> <span class="ow">or</span> <span class="p">(</span><span class="n">append</span> <span class="ow">and</span> <span class="n">firstWrite</span><span class="p">):</span>
                <span class="c1"># print single header at top</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parmStr</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">summary</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;br&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># nothing more to write</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span>
        
        <span class="c1"># see if only 1D parms are selected, which implies printing only a single line per record</span>
        <span class="n">is1D</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#make sure its a lowercase list</span>
            <span class="n">selectParms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">selectParms</span><span class="p">)</span>
            <span class="n">selectParms</span> <span class="o">=</span> <span class="n">getLowerCaseList</span><span class="p">(</span><span class="n">selectParms</span><span class="p">)</span>
            <span class="c1"># see if only 1D parameters are being printed, so that we should only print the first row</span>
            <span class="n">is1D</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">recordset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRecordset</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">selectParms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">recordset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">is1D</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
                
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="k">if</span> <span class="n">showHeaders</span><span class="p">:</span>
                <span class="n">kinst</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
                <span class="n">instDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentName</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
                <span class="n">sDT</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
                <span class="n">sDTStr</span> <span class="o">=</span> <span class="n">sDT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H%M:%S&#39;</span><span class="p">)</span>
                <span class="n">eDT</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
                <span class="n">eDTStr</span> <span class="o">=</span> <span class="n">eDT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M:%S&#39;</span><span class="p">)</span>
                <span class="n">headerStr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">instDesc</span><span class="p">,</span> <span class="n">sDTStr</span><span class="p">,</span> <span class="n">eDTStr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">firstHeaderPrinted</span> <span class="ow">or</span> <span class="n">summary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">headerStr</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">headerStr</span><span class="p">))</span>
                    <span class="n">firstHeaderPrinted</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parmStr</span><span class="p">))</span>
                
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getDataset</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">recnoSet</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># used to see if we are at a new record</span>
                <span class="n">dataset_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">selectParms</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dataset_view</span> <span class="o">=</span> <span class="n">dataset</span>
                
            <span class="c1"># modify special values if required</span>
            <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dataset_view</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="c1"># set all -1 values to inf</span>
                            <span class="n">assumedIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dataset_view</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assumedIndices</span><span class="p">):</span>
                                <span class="n">dataset_view</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">assumedIndices</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">Inf</span>
                        <span class="k">if</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="c1"># set all -2 values to ninf</span>
                            <span class="n">knownbadIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dataset_view</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">knownbadIndices</span><span class="p">):</span>
                                <span class="n">dataset_view</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">knownbadIndices</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">NINF</span>
                            
            <span class="n">lastRecno</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_view</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">thisRecno</span> <span class="o">=</span> <span class="n">recnoSet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">is1D</span> <span class="ow">and</span> <span class="p">(</span><span class="n">thisRecno</span> <span class="o">==</span> <span class="n">lastRecno</span><span class="p">):</span>
                        <span class="k">continue</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dataset_view</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">formatStr</span> <span class="o">%</span> <span class="n">data</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1"># something bad happened - give up and just convert data to a string</span>
                    <span class="n">textList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
                    <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textList</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="c1"># modify special values if required</span>
                <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">missing_search</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">knownbad_search</span><span class="p">,</span> <span class="n">knownbad</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">assumed_search</span><span class="p">,</span> <span class="n">assumed</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">summary</span> <span class="o">!=</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;nbsp;&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">summary</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;br&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">lastRecno</span> <span class="o">=</span> <span class="n">thisRecno</span>
                    
        <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
            <span class="c1"># remove all records</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="o">=</span> <span class="p">[]</span>
            
        
        
    <span class="k">def</span> <span class="nf">getDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getDType returns the dtype of the table array in this file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">setDType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setDType sets the dtype of the table array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="o">=</span> <span class="n">dtype</span>
        
        
    <span class="k">def</span> <span class="nf">getRecDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRecDType returns the dtype of _record_layout</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">getRecordset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRecordset returns the recordset array from the first data record.</span>
<span class="sd">        </span>
<span class="sd">        Raises IOError if None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;self._recDset is None&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">get1DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get1DParms returns a list of mnemonics of 1D parms</span>
<span class="sd">        in file.  May be empty if none. </span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if self._oneDList is None, since parameters unknown</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;get1DParms cannot be called before any data records added to this file&#39;</span><span class="p">)</span>
        
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">get2DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get2DParms returns a list of mnemonics of dependent 2D parms</span>
<span class="sd">        in file.  May be empty if none. </span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if self._twoDList is None, since parameters unknown</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;get2DParms cannot be called before any data records added to this file&#39;</span><span class="p">)</span>
        
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
        
        
        
    <span class="k">def</span> <span class="nf">getIndSpatialParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getIndSpatialParms returns a list of mnemonics of independent spatial parameters</span>
<span class="sd">        in file.  May be empty if none. </span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if self._ind2DList is None, since parameters unknown</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;getIndSpatialParms cannot be called before any data records added to this file&#39;</span><span class="p">)</span>
        
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">getArraySplitParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getArraySplitParms returns a list of mnemonics of parameters used to split array.  May be empty or None. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getParmDim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getParmDim returns the dimension (1,2, or 3 for independent spatial parms) of input parm</span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if no data records yet.</span>
<span class="sd">        Raise KeyError if that parameter not found in file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;getParmDim cannot be called before any data records added to this file&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># do ind 2D next since they are in both lists</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in data&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        
        
    <span class="k">def</span> <span class="nf">getStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStatus returns the status string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">setStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setStatus sets the status string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">getEarliestDT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getEarliestDT returns the earliest datetime found in file, or None if no data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getLatestDT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getLatestDT returns the latest datetime found in file, or None if no data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getKinstList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKinstList returns the list of kinst integers in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getKindatList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKindatList returns the list of kindat integers in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">getRecIndexList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRecIndexList returns a list of record indexes into Table Layout</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">parmIsInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parmIsInt returns True if this parm (mnemonic) is integer type, False if not</span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if parm not in record. or table dtype not yet set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot call parmIsInt until a data record is added&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">typeStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">typeStr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">parmIsString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parmIsString returns True if this parm (mnemonic) is string type, False if not</span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if parm not in record. or table dtype not yet set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot call parmIsInt until a data record is added&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">typeStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">typeStr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">getStringFormat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStringFormat returns string format string.  Raises error if not string type,</span>
<span class="sd">        or parm not in record. or table dtype not yet set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> not a string, cannot call getStringFormat&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()]))</span>
        
        
    <span class="k">def</span> <span class="nf">hasArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;hasArray returns True in f[&#39;Data&#39;][&#39;Array Layout&#39;] exists, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;Data&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="s1">&#39;Array Layout&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getMaxMinValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mnemonic</span><span class="p">,</span> <span class="n">verifyValid</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getMaxMinValues returns a tuple of (minimum value, maximum value) of the value</span>
<span class="sd">        of parm in this file.  If verifyValid is True, then only lines with valid 2D data</span>
<span class="sd">        are included.  If no valid values, returns (NaN, NaN). Also updates self._minMaxParmDict</span>
<span class="sd">        </span>
<span class="sd">        Raise IOError if parm not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        
        <span class="c1"># for string data, always return (Nan, Nan)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span>
            <span class="k">return</span><span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">))</span>
        
        <span class="c1"># create a merged dataset</span>
        <span class="n">datasetList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">datasetList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;No data records in file&#39;</span><span class="p">)</span>
        
        <span class="n">merged_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verifyValid</span><span class="p">:</span>
            <span class="c1"># veru simple - just jusr numpy methods</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">))</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="n">minValue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">maxValue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">orgMin</span><span class="p">,</span> <span class="n">orgMax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">minValue</span><span class="p">,</span> <span class="n">orgMin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxValue</span><span class="p">,</span> <span class="n">orgMax</span><span class="p">)]</span>
            <span class="k">return</span><span class="p">((</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">))</span>
        
        <span class="c1"># we need to find the minimum and maximum for only valid data</span>
        <span class="c1"># first sort by parm so we just need to walk until we find a valid row starting at the top and bottom</span>
        <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">])</span>
        
        <span class="c1"># find min</span>
        <span class="n">minValue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_indices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">twoDParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">twoDParm</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                    <span class="k">continue</span>
                <span class="c1"># make sure its not a special error value</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span> <span class="ow">and</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">twoDParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># minimum found</span>
                <span class="n">minValue</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">minValue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            
        <span class="c1"># find max</span>
        <span class="n">maxValue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">sorted_indices</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">twoDParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">twoDParm</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                    <span class="k">continue</span>
                <span class="c1"># make sure its not a special error value</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span> <span class="ow">and</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">twoDParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># minimum found</span>
                <span class="n">maxValue</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">maxValue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
                
        <span class="k">if</span> <span class="n">minValue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">minValue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">maxValue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maxValue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
            
        <span class="k">if</span> <span class="n">parm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orgMin</span><span class="p">,</span> <span class="n">orgMax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">minValue</span><span class="p">,</span> <span class="n">orgMin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxValue</span><span class="p">,</span> <span class="n">orgMax</span><span class="p">)]</span>
            
        <span class="k">return</span><span class="p">((</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">))</span>
    
    
    <span class="k">def</span> <span class="nf">refreshSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;refreshSummary rebuilds the recarray self._experimentParameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span>
        <span class="n">kinstCodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kinstNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">():</span>
            <span class="n">kinstCodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">)))</span>
            <span class="n">kinstNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentName</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">))))</span>
        <span class="n">instrumentCodes</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kinstCodes</span><span class="p">)</span>
        <span class="n">instrumentName</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kinstNames</span><span class="p">)</span>
        
        <span class="n">categoryStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getCategory</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="n">piStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getContactName</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="n">piEmailStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getContactEmail</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        
        <span class="n">startDateStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UT&#39;</span><span class="p">)</span>
        <span class="n">endDateStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UT&#39;</span><span class="p">)</span>
        
        <span class="n">cedarFileName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">))</span>

        <span class="n">statusDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>
        <span class="n">instLat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="n">instLon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="n">instAlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getAltitude</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        
        <span class="c1"># create kindat description based on all kindats</span>
        <span class="n">kindatList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getKindatList</span><span class="p">()</span>
        <span class="n">kindatDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">kindatListStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">kindatDesc</span> <span class="o">=</span> <span class="s1">&#39;This experiment has </span><span class="si">%i</span><span class="s1"> kinds of data.  They are:&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kindatList</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kindat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kindatList</span><span class="p">):</span>
                <span class="n">thisKindatDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="o">.</span><span class="n">getKindatDescription</span><span class="p">(</span><span class="n">kindat</span><span class="p">,</span> <span class="n">inst</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">thisKindatDesc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;kindat </span><span class="si">%i</span><span class="s1"> undefined - please add to typeTab.txt&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kindat</span><span class="p">))</span>
                <span class="n">thisKindatDesc</span> <span class="o">=</span> <span class="n">thisKindatDesc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">kindatDesc</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%i</span><span class="s1">) </span><span class="si">%s</span><span class="s1"> (code </span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">thisKindatDesc</span><span class="p">,</span> <span class="n">kindat</span><span class="p">)</span>
                <span class="n">kindatListStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kindat</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">kindatDesc</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span>
                    <span class="n">kindatListStr</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kindatDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="o">.</span><span class="n">getKindatDescription</span><span class="p">(</span><span class="n">kindatList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inst</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kindatDesc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;kindat for </span><span class="si">%s</span><span class="s1"> undefined - please add to typeTab.txt&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">kindatList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inst</span><span class="p">))))</span>
            <span class="n">kindatDesc</span> <span class="o">=</span> <span class="n">kindatDesc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">kindatListStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kindatList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            
        <span class="c1"># create an expSummary numpy recarray  </span>
        <span class="n">summArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="mi">14</span><span class="p">,),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="p">),</span>
                                                <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="p">)])</span>
        
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument code(s)&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;kind of data file&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;kindat code(s)&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;start time&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;end time&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Cedar file name&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;status description&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument latitude&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument longitude&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument altitude&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument category&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument PI&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument PI email&#39;</span>
                      
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">instrumentName</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">instrumentCodes</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">kindatDesc</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">kindatListStr</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">startDateStr</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">endDateStr</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">cedarFileName</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">statusDesc</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instLat</span><span class="p">)</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instLon</span><span class="p">)</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instAlt</span><span class="p">)</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">categoryStr</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">piStr</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">piEmailStr</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="o">=</span> <span class="n">summArr</span>

        
        
    <span class="k">def</span> <span class="nf">createCatalogTimeSection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;createCatalogTimeSection will return all the lines in the catalog record that</span>
<span class="sd">        describe the start and end time of the data records.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Returns:  a tuple with three items 1) a string in the format of the time section of a</span>
<span class="sd">        catalog record, 2) earliest datetime, 3) latest datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span>
        <span class="n">latestEndTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span>

        <span class="n">sy</span> <span class="o">=</span> <span class="s1">&#39;IBYRE       </span><span class="si">%4s</span><span class="s1"> Beginning year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="s1">&#39;IBDTE       </span><span class="si">%4s</span><span class="s1"> Beginning month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                              <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="s1">&#39;IBHME       </span><span class="si">%4s</span><span class="s1"> Beginning UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                   <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;IBCSE       </span><span class="si">%4s</span><span class="s1"> Beginning centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>
        
        <span class="n">ey</span> <span class="o">=</span> <span class="s1">&#39;IEYRE       </span><span class="si">%4s</span><span class="s1"> Ending year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;IEDTE       </span><span class="si">%4s</span><span class="s1"> Ending month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                           <span class="n">latestEndTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">eh</span> <span class="o">=</span> <span class="s1">&#39;IEHME       </span><span class="si">%4s</span><span class="s1"> Ending UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                <span class="n">latestEndTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">latestEndTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">es</span> <span class="o">=</span> <span class="s1">&#39;IECSE       </span><span class="si">%4s</span><span class="s1"> Ending centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>

        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sy</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ss</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ey</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ey</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ed</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ed</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">eh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">eh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">es</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>

        <span class="k">return</span><span class="p">((</span><span class="n">retStr</span><span class="p">,</span> <span class="n">earliestStartTime</span><span class="p">,</span> <span class="n">latestEndTime</span><span class="p">))</span>
    
    
    <span class="k">def</span> <span class="nf">createHeaderTimeSection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataRecList</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;createHeaderTimeSection will return all the lines in the header record that</span>
<span class="sd">        describe the start and end time of the data records.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            dataRecList - if given, examine only those MadrigalDataRecords in dataRecList.</span>
<span class="sd">                          If None (the default), examine all MadrigalDataRecords in this</span>
<span class="sd">                          MadrigalCedarFile</span>

<span class="sd">        Returns:  a tuple with three items 1) a string in the format of the time section of a</span>
<span class="sd">        header record, 2) earliest datetime, 3) latest datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dataRecList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span>
            <span class="n">latestEndTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">latestEndTime</span> <span class="o">=</span> <span class="kc">None</span>
    
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">dataRecList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
    
                <span class="c1">#earliest time</span>
                <span class="n">thisTime</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">earliestStartTime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="n">thisTime</span>
                <span class="k">if</span> <span class="n">earliestStartTime</span> <span class="o">&gt;</span> <span class="n">thisTime</span><span class="p">:</span>
                    <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="n">thisTime</span>
    
                <span class="c1">#latest time</span>
                <span class="n">thisTime</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">latestEndTime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">latestEndTime</span> <span class="o">=</span> <span class="n">thisTime</span>
                <span class="k">if</span> <span class="n">latestEndTime</span> <span class="o">&lt;</span> <span class="n">thisTime</span><span class="p">:</span>
                    <span class="n">latestEndTime</span> <span class="o">=</span> <span class="n">thisTime</span>
                

        <span class="n">sy</span> <span class="o">=</span> <span class="s1">&#39;IBYRT               </span><span class="si">%4s</span><span class="s1"> Beginning year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="s1">&#39;IBDTT               </span><span class="si">%4s</span><span class="s1"> Beginning month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                              <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="s1">&#39;IBHMT               </span><span class="si">%4s</span><span class="s1"> Beginning UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                   <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;IBCST               </span><span class="si">%4s</span><span class="s1"> Beginning centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>
        
        <span class="n">ey</span> <span class="o">=</span> <span class="s1">&#39;IEYRT               </span><span class="si">%4s</span><span class="s1"> Ending year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;IEDTT               </span><span class="si">%4s</span><span class="s1"> Ending month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                           <span class="n">latestEndTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">eh</span> <span class="o">=</span> <span class="s1">&#39;IEHMT               </span><span class="si">%4s</span><span class="s1"> Ending UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                <span class="n">latestEndTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">latestEndTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">es</span> <span class="o">=</span> <span class="s1">&#39;IECST               </span><span class="si">%4s</span><span class="s1"> Ending centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>

        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sy</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ss</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ey</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ey</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ed</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ed</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">eh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">eh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">es</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>

        <span class="k">return</span><span class="p">((</span><span class="n">retStr</span><span class="p">,</span> <span class="n">earliestStartTime</span><span class="p">,</span> <span class="n">latestEndTime</span><span class="p">))</span>
    
    
    <span class="k">def</span> <span class="nf">updateMinMaxParmDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;updateMinMaxParmDict updates self._minMaxParmDict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getMaxMinValues</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">_writeHdf5Metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_writeHdf5Metadata is responsible for writing Metadata group in Hdf5 file</span>
<span class="sd">        </span>
<span class="sd">        Can be called multiple times, but will only write &quot;Experiment Notes&quot; if any catalog or header</span>
<span class="sd">        records found</span>
<span class="sd">        </span>
<span class="sd">        Inputs: </span>
<span class="sd">        </span>
<span class="sd">            f - the open h5py.File object</span>
<span class="sd">            </span>
<span class="sd">            refreshCatHeadTimes - if True, update start and and times in the catalog and header</span>
<span class="sd">                records to represent the times in the data.  If False, use existing times in those records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Metadata&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c1"># metadata tables that are only updated once</span>
            <span class="n">metadataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Metadata&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addDataParametersTable</span><span class="p">(</span><span class="n">metadataGroup</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refreshSummary</span><span class="p">()</span>
            <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Experiment Parameters&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">)</span>
            
            <span class="c1"># create Independent Spatial Parameters recordset</span>
            <span class="n">indParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
            <span class="n">indParmDesc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">longestDescStr</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">longestMnemStr</span><span class="p">:</span>
                    <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                <span class="n">indParmDesc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">indParm</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmDesc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">longestDescStr</span><span class="p">:</span>
                    <span class="n">longestDescStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmDesc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">indSpatialArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">),),</span>
                                         <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestMnemStr</span><span class="p">)),</span>
                                                  <span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestDescStr</span><span class="p">))])</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indParmList</span><span class="p">):</span>
                <span class="n">indSpatialArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indParm</span>
                <span class="n">indSpatialArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indParmDesc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Independent Spatial Parameters&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">indSpatialArr</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metadataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_writeRecordLayout</span><span class="p">(</span><span class="n">metadataGroup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeExperimentNotes</span><span class="p">(</span><span class="n">metadataGroup</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="p">)</span>
        
        
        
    <span class="k">def</span> <span class="nf">_addArrayDump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_addArrayDump adds Array Layout to an Hdf5 file created by dump.  </span>

<span class="sd">        Inputs: None </span>
<span class="sd">                </span>
<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: adds &quot;Array Layout&quot; group to f[&#39;Data&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">!=</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can only call _addArrayDump for Hdf5 files written using dump&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_createArrayLayout2</span><span class="p">()</span>
        
        <span class="c1"># try to gzip 2d array data</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">)</span>
        <span class="c1"># tmp file name to use to run h5repack</span>
        <span class="n">tmpFile</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;_tmp&#39;</span> <span class="o">+</span> <span class="n">file_extension</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;h5repack -i </span><span class="si">%s</span><span class="s1"> -o </span><span class="si">%s</span><span class="s1"> --filter=</span><span class="se">\&quot;</span><span class="s1">Data/Array Layout</span><span class="se">\&quot;</span><span class="s1">:GZIP=4&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">,</span> <span class="n">tmpFile</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span>
        
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">)</span>
        
    
    
    
    <span class="k">def</span> <span class="nf">_writeHdf5Data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_writeHdf5Data is responsible for writing Data group in Hdf5 file</span>
<span class="sd">        </span>
<span class="sd">        Input: f - the open h5py.File object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">tableName</span> <span class="o">=</span> <span class="s1">&#39;Table Layout&#39;</span>
        
        <span class="c1"># create a merged dataset</span>
        <span class="n">datasetList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">datasetList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nrows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">nrows</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;No data records in file&#39;</span><span class="p">)</span>
        
        <span class="n">merged_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s2">&quot;Data&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">dataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">dataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">tableName</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">merged_dataset</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">,</span> <span class="n">maxshape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,),</span>
                                            <span class="n">chunks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># append</span>
            <span class="n">dataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">]</span>
            <span class="n">added_len</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">dataGroup</span><span class="p">[</span><span class="n">tableName</span><span class="p">]</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">dset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">added_len</span><span class="p">,))</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">write_direct</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">s_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">added_len</span><span class="p">:])</span>
        
        <span class="k">del</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">_createArrayLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">arraySplittingParms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createArrayLayout will append an Array Layout to the open Hdf5 file f</span>
<span class="sd">        </span>
<span class="sd">        arraySplittingParms - a list of parameters as mnemonics used to split</span>
<span class="sd">            arrays into subarrays.  For example, beamcode would split data with separate beamcodes</span>
<span class="sd">            into separate arrays. The number of separate arrays will be up to the product of the number of </span>
<span class="sd">            unique values found for each parameter, with the restriction that combinations with no records will</span>
<span class="sd">            not create a separate array.</span>
<span class="sd">        </span>
<span class="sd">        IOError raised if Array Layout already exists - this can only be called once</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skipArray</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1"># get info from recarrays that already exist</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Table Layout&#39;</span><span class="p">]</span>
        <span class="n">recLayout</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;_record_layout&#39;</span><span class="p">]</span>
        <span class="n">metadataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span>
        
        <span class="c1"># inputs</span>
        <span class="n">indParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="s2">&quot;Array Layout&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Array Layout already created - this can only be created once.&#39;</span><span class="p">)</span>
        
        <span class="c1"># add &quot;Parameters Used to Split Array Data&quot; to Metadata</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">arrSplitParmDesc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">longestDescStr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">arrSplitParm</span> <span class="ow">in</span> <span class="n">arraySplittingParms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">longestMnemStr</span><span class="p">:</span>
                    <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">)</span>
                <span class="n">arrSplitParmDesc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParmDesc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">longestDescStr</span><span class="p">:</span>
                    <span class="n">longestDescStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParmDesc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">arrSplitArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">),),</span>
                                         <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestMnemStr</span><span class="p">)),</span>
                                                  <span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestDescStr</span><span class="p">))])</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arrSplitParm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">):</span>
                <span class="n">arrSplitArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrSplitParm</span>
                <span class="n">arrSplitArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrSplitParmDesc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Parameters Used to Split Array Data&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">arrSplitArr</span><span class="p">)</span>
            

        <span class="n">arrGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Array Layout&quot;</span><span class="p">)</span>
        
        <span class="n">arraySplittingList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of lists of all existing values for each array splitting parm</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">arraySplittingParms</span><span class="p">:</span>
            <span class="n">arraySplittingList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]))</span>
        
        <span class="n">tableSubsets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">arraySplittingList</span><span class="p">):</span>
            <span class="n">tableSubsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_TableSubset</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">,</span> <span class="n">combo</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">tableSubset</span> <span class="ow">in</span> <span class="n">tableSubsets</span><span class="p">:</span>
            <span class="n">uniqueIndValueDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">])</span>
            <span class="n">unique_times</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">])</span>
            <span class="n">group_name</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">getGroupName</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">group_name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">arrGroup</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">getGroupName</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">arrGroup</span> <span class="c1"># no splitting, so no subgroup needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addLayoutDescription</span><span class="p">(</span><span class="n">thisGroup</span><span class="p">)</span>
            <span class="n">ts_dset</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">unique_times</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">])</span>
                
            <span class="c1"># one D parm arrays</span>
            <span class="n">oneDGroup</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addDataParametersTable</span><span class="p">(</span><span class="n">oneDGroup</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">dset</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">oneDIndices</span><span class="p">]</span>
                    <span class="n">oneDGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dset</span><span class="p">)</span>
                    
            <span class="c1"># two D parm arrays</span>
            <span class="n">twoDGroup</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addDataParametersTable</span><span class="p">(</span><span class="n">twoDGroup</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            
            <span class="c1"># get shape of 2D data (number of dimensions dynamic)</span>
            <span class="n">twoDShape</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
            <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">))</span>
            
            <span class="n">dsetDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = parm, value 2D dataset</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_int</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing</span>
                    
            <span class="c1"># precalculate the indices</span>
            <span class="c1"># time index</span>
            <span class="n">time_indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">)),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">)):</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">unique_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">times</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span>
                <span class="n">time_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            
            <span class="c1"># ind parm indexes</span>
            <span class="n">indParmIndexDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">)),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">])):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">values</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span>
                    <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                
            <span class="c1"># concatenate</span>
            <span class="n">tableIndex</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tableIndex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tableIndex</span> <span class="o">=</span> <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tableIndex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tableIndex</span><span class="p">,</span> <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">tableIndex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tableIndex</span><span class="p">,</span> <span class="n">time_indices</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>   
                    
            <span class="c1"># set 2D parms</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not handle more than 3 independent spatial parms - there are </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)))</span>
                        
            <span class="c1"># write the datasets out</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">twoDGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">],</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>
                    
                    
                    
    <span class="k">def</span> <span class="nf">_createArrayLayout2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createArrayLayout2 will append an Array Layout to the Hdf5 file.  Called after dump.</span>
<span class="sd">        </span>
<span class="sd">        IOError raised if Array Layout already exists - this can only be called once</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="c1"># get info from recarrays that already exist</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Table Layout&#39;</span><span class="p">]</span>
        <span class="n">recLayout</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;_record_layout&#39;</span><span class="p">]</span>
        <span class="n">metadataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span>
        
        <span class="c1"># inputs</span>
        <span class="n">indParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="s2">&quot;Array Layout&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Array Layout already created - this can only be created once.&#39;</span><span class="p">)</span>
        
        <span class="c1"># update metadata now that file finished</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Metadata</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skipArray</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span>
        
        <span class="c1"># now that self._arrDict is competely filled out, create a similar dict, except that</span>
        <span class="c1"># all sets are replaced by ordered python arrays</span>
        <span class="n">total_allowed_records</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># make sure all ind parameters declared by checking that the product</span>
                                  <span class="c1"># of all the ind parm value lengths time the number of times is equal</span>
                                  <span class="c1"># to or greater than the number of total records</span>
        <span class="n">arrDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">total_ind_parm_lens</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">thisDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">thisDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">thisSet</span> <span class="o">=</span> <span class="n">thisDict</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span>
                <span class="c1"># convert to ordered numpy array</span>
                <span class="n">thisList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">thisSet</span><span class="p">)</span>
                <span class="n">thisList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">total_ind_parm_lens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisList</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">key2</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thisList</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">key2</span><span class="p">):</span>
                    <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">key2</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thisList</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">strLen</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thisList</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                
            <span class="c1"># add the max number of records for this group</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">total_ind_parm_lens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">total_ind_parm_lens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">tmp</span> <span class="o">*=</span> <span class="n">v</span>
            <span class="n">total_allowed_records</span> <span class="o">+=</span> <span class="n">tmp</span>
            
            <span class="c1"># protect against too many ind parm combinations (too sparse an array)</span>
            <span class="n">total_ind_combos</span> <span class="o">=</span> <span class="n">total_ind_parm_lens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">total_ind_parm_lens</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                <span class="n">total_ind_combos</span> <span class="o">*=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">total_ind_combos</span> <span class="o">&gt;</span> <span class="mi">1000000</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;Skipping array creation since </span><span class="si">%i</span><span class="s1"> independent parm combinations would create too big an array&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total_ind_combos</span><span class="p">)))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">return</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">total_allowed_records</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Found </span><span class="si">%i</span><span class="s1"> lines in table, but values of times and ind parms </span><span class="si">%s</span><span class="s1"> allow maximum of </span><span class="si">%i</span><span class="s1"> values in file </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">indParmList</span><span class="p">),</span> <span class="n">total_allowed_records</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">))</span>
        
        <span class="c1"># add &quot;Parameters Used to Split Array Data&quot; to Metadata</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">arrSplitParmDesc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">longestDescStr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">arrSplitParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">longestMnemStr</span><span class="p">:</span>
                    <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">)</span>
                <span class="n">arrSplitParmDesc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParmDesc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">longestDescStr</span><span class="p">:</span>
                    <span class="n">longestDescStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParmDesc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">arrSplitArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">),),</span>
                                         <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestMnemStr</span><span class="p">)),</span>
                                                  <span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestDescStr</span><span class="p">))])</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arrSplitParm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">):</span>
                <span class="n">arrSplitArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrSplitParm</span>
                <span class="n">arrSplitArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrSplitParmDesc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Parameters Used to Split Array Data&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">arrSplitArr</span><span class="p">)</span>
            

        <span class="n">arrGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Array Layout&quot;</span><span class="p">)</span>
        
        <span class="c1"># stage 1 - write all needed tables with nan values</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">arrDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">groupName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getGroupName</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">arrGroup</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">groupName</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">arrGroup</span> <span class="c1"># no subgroups needed</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">_addLayoutDescription</span><span class="p">(</span><span class="n">thisGroup</span><span class="p">)</span>
                
            <span class="sd">&quot;&quot;&quot;thisDict is dict of key = &#39;ut1_unix&#39; and ind 2d parm names (possibly minus arraySplitParms), values</span>
<span class="sd">                = ordered numpy array of all unique values&quot;&quot;&quot;</span>
            <span class="n">thisDict</span> <span class="o">=</span> <span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> 
                                      
            <span class="n">unique_times</span> <span class="o">=</span> <span class="n">thisDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
            
            <span class="n">ts_dset</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">unique_times</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                    <span class="c1"># not needed</span>
                    <span class="k">continue</span>
                <span class="n">dataset</span> <span class="o">=</span> <span class="n">thisDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataset</span><span class="p">)</span>
                
            <span class="c1"># one D parm arrays</span>
            <span class="n">oneDGroup</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addDataParametersTable</span><span class="p">(</span><span class="n">oneDGroup</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                        <span class="n">dset</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">((</span><span class="nb">str</span><span class="p">,</span> <span class="n">strLen</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                        <span class="n">dset</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">oneDGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dset</span><span class="p">)</span>
            
            <span class="c1"># two D parm arrays</span>
            <span class="n">twoDGroup</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addDataParametersTable</span><span class="p">(</span><span class="n">twoDGroup</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            
            <span class="c1"># get shape of 2D data (number of dimensions dynamic)</span>
            <span class="n">twoDShape</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                    <span class="c1"># not needed</span>
                    <span class="k">continue</span>
                <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
            <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                        <span class="n">dset</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">((</span><span class="nb">str</span><span class="p">,</span> <span class="n">strLen</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                        <span class="n">dset</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">twoDGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dset</span><span class="p">)</span>
                    
        <span class="c1"># flush file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Table Layout&#39;</span><span class="p">]</span>
        <span class="n">recLayout</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;_record_layout&#39;</span><span class="p">]</span>
        
        <span class="c1"># now loop through Table Layout and populate all the 1 and 2 d arrays</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># number of records to load at once</span>
        <span class="n">total_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total_steps</span> <span class="o">*</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">):</span>
            <span class="n">total_steps</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_steps</span><span class="p">):</span>
            <span class="n">startTimeIndex</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">step</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">step</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">endTimeIndex</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">endTimeIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">table_data</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">[</span><span class="n">startTimeIndex</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">[</span><span class="n">endTimeIndex</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="c1"># loop through all groups</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">arrDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">tableSubset</span> <span class="o">=</span> <span class="n">_TableSubset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">table_data</span><span class="p">)</span>
                <span class="c1"># its possible no data in this slice for this subset</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                
                <span class="n">timestamps</span> <span class="o">=</span> <span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>

                <span class="c1"># get index of first and last time found</span>
                <span class="n">first_ut1_unix</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
                <span class="n">last_ut1_unix</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
                <span class="n">time_index_1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">first_ut1_unix</span><span class="p">)</span>
                <span class="n">time_index_2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">last_ut1_unix</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">groupName</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">getGroupName</span><span class="p">()</span>
                <span class="c1"># get shape of 2D data (number of dimensions dynamic)</span>
                <span class="n">twoDShape</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                        <span class="c1"># not needed</span>
                        <span class="k">continue</span>
                    <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">indParm</span><span class="p">]))</span>
                <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_index_2</span> <span class="o">-</span> <span class="n">time_index_1</span><span class="p">)</span>
                <span class="c1"># ind parm indexes</span>
                <span class="n">indParmIndexDict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                        <span class="c1"># not needed</span>
                        <span class="k">continue</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                    <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">),),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">indParm</span><span class="p">])):</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">values</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span>
                        <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                    
                <span class="c1"># finally time dimension</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
                <span class="n">timeIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">),),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                <span class="n">thisTimestampArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisTimestampArr</span><span class="p">)):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">thisTimestampArr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">values</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span>
                    <span class="n">timeIndices</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

                <span class="c1"># concatenate</span>
                <span class="n">tableIndex</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                        <span class="c1"># not needed</span>
                        <span class="k">continue</span>
                    <span class="n">tableIndex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">])</span>
                <span class="n">tableIndex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timeIndices</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                    <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">oneDIndices</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">groupName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="n">groupName</span><span class="p">][</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">parm</span><span class="p">][</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">parm</span><span class="p">][</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span>
                    <span class="k">elif</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                            <span class="n">dset2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                            <span class="n">dset2</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                            <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                            <span class="n">dset2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">((</span><span class="nb">str</span><span class="p">,</span> <span class="n">strLen</span><span class="p">)))</span>
                            <span class="n">dset2</span><span class="p">[:]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dset2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                            <span class="n">dset2</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
                        <span class="n">dset2</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tableIndex</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                        
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">groupName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">fdata</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="n">groupName</span><span class="p">][</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">][</span><span class="n">parm</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">fdata</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">][</span><span class="n">parm</span><span class="p">]</span>
                            
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">fdata</span><span class="p">[:,</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset2</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">fdata</span><span class="p">[:,:,</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset2</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">fdata</span><span class="p">[:,:,:,</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset2</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">fdata</span><span class="p">[:,:,:,:,</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset2</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="n">fdata</span><span class="p">[:,:,:,:,:,</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not handle more than 5 independent spatial parms - there are </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)))</span>
                        
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
                    
    <span class="k">def</span> <span class="nf">_writeNetCDF4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">arraySplittingParms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_writeNetCDF4 will write to a netCDF4 file f</span>
<span class="sd">        </span>
<span class="sd">        arraySplittingParms - a list of parameters as mnemonics used to split</span>
<span class="sd">            arrays into subarrays.  For example, beamcode would split data with separate beamcodes</span>
<span class="sd">            into separate arrays. The number of separate arrays will be up to the product of the number of </span>
<span class="sd">            unique values found for each parameter, with the restriction that combinations with no records will</span>
<span class="sd">            not create a separate array.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create merged datasets table and recLayout</span>
        <span class="n">datasetList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">recordList</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">datasetList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recordList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">recordList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;catalog&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">catalog_text</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
                
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;header&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">header_text</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;No data records in file&#39;</span><span class="p">)</span>
        
        <span class="n">table</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span>
        <span class="n">recLayout</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">recordList</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refreshSummary</span><span class="p">()</span>
        
        <span class="c1"># write Experiment Parameters</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># make text acceptable attribute names</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;(s)&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(s)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        
        <span class="n">indParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
        
        <span class="c1"># add &quot;Parameters Used to Split Array Data&quot; to Metadata</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">arrSplitParmDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">arrSplitParm</span> <span class="ow">in</span> <span class="n">arraySplittingParms</span><span class="p">:</span>
                <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arrSplitParm</span><span class="p">)</span>
                <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">arrSplitParm</span> <span class="o">!=</span> <span class="n">arraySplittingParms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39; -- &#39;</span>
            <span class="n">f</span><span class="o">.</span><span class="n">parameters_used_to_split_data</span> <span class="o">=</span> <span class="n">arrSplitParmDesc</span>
            
        
        <span class="n">arraySplittingList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of lists of all existing values for each array splitting parm</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">arraySplittingParms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">arraySplittingList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]))</span>
        
        <span class="n">tableSubsets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">arraySplittingList</span><span class="p">):</span>
            <span class="n">tableSubsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_TableSubset</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">,</span> <span class="n">combo</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">tableSubset</span> <span class="ow">in</span> <span class="n">tableSubsets</span><span class="p">:</span>
            <span class="n">uniqueIndValueDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">])</span>
            <span class="n">unique_times</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">])</span>
            <span class="n">group_name</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">getGroupName</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">group_name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">group_name</span> <span class="o">=</span> <span class="n">group_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">createGroup</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">f</span> <span class="c1"># no splitting, so no subgroup needed</span>
            <span class="c1"># next step - create dimensions</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">))</span>
            <span class="n">timeVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,),</span>
                                               <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">timeVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Unix seconds&#39;</span>
            <span class="n">timeVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Number of seconds since UT midnight 1970-01-01&#39;</span>
            <span class="n">timeVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">unique_times</span>
            <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                    <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                    <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStringFormat</span><span class="p">(</span><span class="n">indParm</span><span class="p">),</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">thisVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="n">thisVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                <span class="n">thisVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                
            <span class="c1"># create one and two D parm arrays, set 1D</span>
            <span class="n">twoDVarDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = parm name, value = netCDF4 variable</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">dset</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">oneDIndices</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStringFormat</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                           <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1"># float</span>
                        <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">oneDVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    <span class="n">oneDVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">oneDVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">dset</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;There may be an issue with array splitting because more records than times&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStringFormat</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span> <span class="n">dims</span><span class="p">,</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    
            <span class="c1"># two D parm arrays</span>
            
            <span class="c1"># get shape of 2D data (number of dimensions dynamic)</span>
            <span class="n">twoDShape</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
            
            <span class="n">dsetDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = parm, value 2D dataset</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_int</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing</span>
                    
            <span class="c1"># precalculate the indices</span>
            <span class="c1"># time index</span>
            <span class="n">time_indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">)),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">)):</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">unique_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">times</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span>
                <span class="n">time_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            
            <span class="c1"># ind parm indexes</span>
            <span class="n">indParmIndexDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">)),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">])):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">values</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span>
                    <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                
            <span class="c1"># concatenate</span>
            <span class="n">tableIndex</span> <span class="o">=</span> <span class="n">time_indices</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">tableIndex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tableIndex</span><span class="p">,</span> <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
                    
            <span class="c1"># set 2D parms</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not handle more than 3 independent spatial parms - there are </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)))</span>
                        
            <span class="c1"># write the datasets out</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:,:]</span> <span class="o">=</span> <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:,:,:]</span> <span class="o">=</span> <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:,:,:,:]</span> <span class="o">=</span> <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                        
                        
                        
    <span class="k">def</span> <span class="nf">_firstDumpNetCDF4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_firstDumpNetCDF4 will dump initial data to a netCDF4 file f.  Called via dump</span>
<span class="sd">        </span>
<span class="sd">            </span>
<span class="sd">        parmIndexDict - is a dictionary with key = timestamps and ind spatial parm names,</span>
<span class="sd">            value = dictionary of keys = unique values, value = index of that value. Can only be used when</span>
<span class="sd">            arraySplittingParms == []</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create merged datasets table and recLayout</span>
        <span class="n">datasetList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">recordList</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">datasetList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recordList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">recordList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;catalog&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">catalog_text</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
                
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;header&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">header_text</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;No data records in file&#39;</span><span class="p">)</span>
        
        <span class="n">table</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span>
        <span class="n">recLayout</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">recordList</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refreshSummary</span><span class="p">()</span>
        
        <span class="c1"># write Experiment Parameters</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># make text acceptable attribute names</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;(s)&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(s)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        
        <span class="n">indParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
        
        <span class="n">uniqueIndValueDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
            <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">unique_times</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">f</span> <span class="c1"># no splitting, so no subgroup needed</span>
        <span class="c1"># next step - create dimensions</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">))</span>
        <span class="n">timeVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,),</span>
                                           <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">timeVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Unix seconds&#39;</span>
        <span class="n">timeVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Number of seconds since UT midnight 1970-01-01&#39;</span>
        <span class="n">timeVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">unique_times</span>
        <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
            <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStringFormat</span><span class="p">(</span><span class="n">indParm</span><span class="p">),</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">thisVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
            <span class="n">thisVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            <span class="n">thisVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            
        <span class="c1"># create one and two D parm arrays, set 1D</span>
        <span class="n">twoDVarDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = parm name, value = netCDF4 variable</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
            <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dset</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][:]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStringFormat</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># float</span>
                    <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">oneDVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                <span class="n">oneDVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                <span class="n">lastTS</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">ts</span> <span class="o">!=</span> <span class="n">lastTS</span><span class="p">:</span>
                        <span class="c1"># set it</span>
                        <span class="n">oneDVar</span><span class="p">[</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="n">ts</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">lastTS</span> <span class="o">=</span> <span class="n">ts</span>

            <span class="k">elif</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStringFormat</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span> <span class="n">dims</span><span class="p">,</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                
                
        <span class="c1"># set 2D parms</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">)):</span>
            <span class="n">parmIndices</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]]</span> 
                    
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">parmIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">item</span><span class="p">])</span>
                
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">parmIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">parmIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">parmIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not handle more than 3 independent spatial parms - there are </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)))</span>

                    
                    
    <span class="k">def</span> <span class="nf">_appendNetCDF4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_appendNetCDF4 will dump appended data to a netCDF4 file f. Called via dump</span>
<span class="sd">        </span>
<span class="sd">            </span>
<span class="sd">        parmIndexDict - is a dictionary with key = timestamps and ind spatial parm names,</span>
<span class="sd">            value = dictionary of keys = unique values, value = index of that value. Can only be used when</span>
<span class="sd">            arraySplittingParms == []</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create merged datasets table and recLayout</span>
        <span class="n">datasetList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">recordList</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">datasetList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recordList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">recordList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;catalog&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">catalog_text</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
                
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;header&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">header_text</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;No data records in file&#39;</span><span class="p">)</span>
        
        <span class="n">table</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span>
        <span class="n">recLayout</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">recordList</span><span class="p">)</span>
        
        
        <span class="n">indParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
        
        <span class="n">uniqueIndValueDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
            <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">unique_times</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">f</span> <span class="c1"># no splitting, so no subgroup needed</span>
        <span class="c1"># next step - create dimensions</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">timeVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;timestamps&quot;</span><span class="p">]</span>
        <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
            <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
            <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            
        <span class="c1"># create one and two D parm arrays, set 1D</span>
        <span class="n">twoDVarDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = parm name, value = netCDF4 variable</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
            <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dset</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][:]</span>
                <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                <span class="n">lastTS</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">ts</span> <span class="o">!=</span> <span class="n">lastTS</span><span class="p">:</span>
                        <span class="c1"># set it</span>
                        <span class="n">oneDVar</span><span class="p">[</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="n">ts</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">lastTS</span> <span class="o">=</span> <span class="n">ts</span>

            <span class="k">elif</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                
                
        <span class="c1"># set 2D parms</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
            <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">)):</span>
                    <span class="n">parmIndices</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]]</span> 
                        
                    <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                            <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                        <span class="n">parmIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">item</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">parmIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">parmIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">parmIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not handle more than 3 independent spatial parms - there are </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)))</span>
                    
                    
    <span class="k">def</span> <span class="nf">_addLayoutDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_addLayoutDescription added a Layout Description dataset to h5py group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indSpatialParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
        <span class="n">layoutDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getLayoutDescription</span><span class="p">()</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indSpatialParms</span><span class="p">),</span>
                                                     <span class="nb">str</span><span class="p">(</span><span class="n">indSpatialParms</span><span class="p">),</span>
                                                     <span class="mi">1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">indSpatialParms</span><span class="p">),</span>
                                                     <span class="nb">len</span><span class="p">(</span><span class="n">indSpatialParms</span><span class="p">),</span>
                                                     <span class="nb">str</span><span class="p">(</span><span class="n">indSpatialParms</span><span class="p">),</span>
                                                     <span class="nb">str</span><span class="p">(</span><span class="n">indSpatialParms</span><span class="p">))</span>
        <span class="n">LayoutDescription</span> <span class="o">=</span> <span class="n">layoutDesc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># create a recarray to hold this text</span>
        <span class="n">textArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">LayoutDescription</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Layout Description&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">))])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">LayoutDescription</span><span class="p">)):</span>
            <span class="n">textArr</span><span class="p">[</span><span class="s1">&#39;Layout Description&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">LayoutDescription</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
        <span class="n">group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Layout Description&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">textArr</span><span class="p">)</span>
        
                    
    
    <span class="k">def</span> <span class="nf">_getLayoutDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_getLayoutDescription returns a description of the layout selected.</span>
<span class="sd">        </span>
<span class="sd">        Returns: </span>
<span class="sd">            LayoutDescription: A list of strings summarizing the Layout Description</span>

<span class="sd">        Affects: Nothing</span>

<span class="sd">        Exceptions: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">LayoutDescription</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                This data layout contains reshaped data from the Table Layout. The reshaped data is stored as an array, with time and</span>
<span class="s2">                the independent spatial parameters (</span><span class="si">%s</span><span class="s2">) in different dimensions. It creates an array for each parameter found in file.</span>
<span class="s2">                </span>
<span class="s2">                This layout contains:</span>
<span class="s2">                - &quot;1D parameters&quot; group: contains one 1D-array for each 1d parameter</span>
<span class="s2">                                  stored in the file. Time-dependent only parameters.</span>
<span class="s2">                - &quot;2D parameters&quot; group: contains one 2D-array for each 2d parameter</span>
<span class="s2">                                  stored in the file. Time and </span><span class="si">%s</span><span class="s2"> are independent parameters.</span>
<span class="s2">                                  Every 2D array has </span><span class="si">%i</span><span class="s2"> dimensions - one for time, and </span><span class="si">%i</span><span class="s2"> for</span>
<span class="s2">                                  the independent spatial parameters (</span><span class="si">%s</span><span class="s2">).</span>
<span class="s2">                - timestamps:     Time vector in seconds from 1/1/1970.</span>
<span class="s2">                </span>
<span class="s2">                - </span><span class="si">%s</span><span class="s2"> :          The independent spatial parameters for this file&quot;&quot;&quot;</span>
                
        <span class="k">return</span><span class="p">(</span><span class="n">LayoutDescription</span><span class="p">)</span>
        
        
        
        
    <span class="k">def</span> <span class="nf">_addDataParametersTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_addDataParametersTable adds the &quot;Data Parameters&quot; table to the h5py Group group if any parameters found</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            group - the h5py Group to add the dataset to</span>
<span class="sd">            </span>
<span class="sd">            dim - if None, include all parameters. If 1 or 2, just include non-required 1 or 2 D parms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dim must be in (None, 1, 2), not &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">)))</span>
        
        <span class="c1"># this first pass is just to set the maximum length of all the strings</span>
        <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">longestDescStr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">longestUnitsStr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">longestCategoryStr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):</span>
                <span class="c1"># skipping default parms</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParmDim</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="o">!=</span> <span class="n">dim</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">longestMnemStr</span><span class="p">:</span>
                <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">longestDescStr</span><span class="p">:</span>
                <span class="n">longestDescStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">longestUnitsStr</span><span class="p">:</span>
                <span class="n">longestUnitsStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCategory</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">longestCategoryStr</span><span class="p">:</span>
                <span class="n">longestCategoryStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCategory</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># no parms to add</span>
            <span class="k">return</span>
        
        <span class="n">parmArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="n">count</span><span class="p">,),</span>
                                 <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestMnemStr</span><span class="p">)),</span>
                                          <span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestDescStr</span><span class="p">)),</span>
                                          <span class="p">(</span><span class="s1">&#39;isError&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">),</span>
                                          <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestUnitsStr</span><span class="p">)),</span>
                                          <span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestCategoryStr</span><span class="p">))])</span>
        
        <span class="c1"># set all the values</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):</span>
                <span class="c1"># skipping default parms</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParmDim</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="o">!=</span> <span class="n">dim</span><span class="p">:</span>
                    <span class="k">continue</span>
                
            <span class="n">parmArr</span><span class="p">[</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="n">parmArr</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="n">parmArr</span><span class="p">[</span><span class="s1">&#39;isError&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="n">parmArr</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="n">parmArr</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCategory</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="n">group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;Data Parameters&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parmArr</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">_writeRecordLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadataGroup</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_writeRecordLayout adds the &quot;_record_layout&quot; table to the Metadata group metadataGroup if needed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tableName</span> <span class="o">=</span> <span class="s1">&#39;_record_layout&#39;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;self._recDset not yet specified&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">tableName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadataGroup</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">tableName</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">)</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;This is meant to be internal data.  For each Madrigal record and parameter, it has a 2 if its a 2D parameter, 1 if its a 1D parameter, and 0 if there is no data.&#39;</span>
            
            
            
    <span class="k">def</span> <span class="nf">_verifyFormat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableDset</span><span class="p">,</span> <span class="n">recDset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;verifyFormat raises an exception if any problem with the Hdf5 input file.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            tableDset - dataset from hdfFile[&quot;Data&quot;][&quot;Table Layout&quot;]</span>
<span class="sd">            recDset - dataset from hdfFile[&quot;Metadata&quot;][&quot;_record_layout&quot;]</span>
<span class="sd">        </span>
<span class="sd">        Rules:  1. self._tableDset must start with  int columns &#39;year&#39;, &#39;month&#39;, &#39;day&#39;, &#39;hour&#39;, &#39;min&#39;, &#39;sec&#39;, </span>
<span class="sd">                    &#39;recno&#39;, &#39;kindat&#39;, &#39;kinst&#39; and float columns &#39;ut1_unix&#39;, &#39;ut2_unix&#39;</span>
<span class="sd">                2. The len of self._recDset must be 1 and must start with the same columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">requiredField</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">requiredField</span> <span class="o">!=</span> <span class="n">tableDset</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Field </span><span class="si">%s</span><span class="s1"> not found in table dset of Hdf5 file </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">requiredField</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">requiredField</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Field </span><span class="si">%s</span><span class="s1"> not found in record dset of Hdf5 file </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">requiredField</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">)))</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recDset</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;recDset must have len 1, not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recDset</span><span class="p">)))</span>
        
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">field</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;For field </span><span class="si">%s</span><span class="s1">, got illegal recordset value </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">field</span><span class="p">])))</span>
       
       
    <span class="k">def</span> <span class="nf">_appendCatalogRecs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expNotesDataset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_appendCatalogRecs will append 0 or more MadrigalCatalogRecords to self._privList based</span>
<span class="sd">        on the contents in h5py dataset expNotesDataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_delimiter</span> <span class="o">=</span> <span class="s1">&#39;Catalog information from record&#39;</span>
        <span class="n">end_delimiter</span> <span class="o">=</span> <span class="s1">&#39;Header information from record&#39;</span>
        <span class="n">in_catalog</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">catalog_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">start_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kinst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kinst</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">expNotesDataset</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">in_catalog</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start_delimiter</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">in_catalog</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_catalog</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">end_delimiter</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start_delimiter</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">start_found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">catalog_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MadrigalCatalogRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                                <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                                <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                                <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                                                <span class="n">catalog_text</span><span class="p">))</span>
                    <span class="n">catalog_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start_delimiter</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">in_catalog</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_catalog</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start_found</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_catalog</span><span class="p">:</span>
                <span class="n">start_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">catalog_text</span> <span class="o">+=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                
        <span class="c1"># see if last part was a catalog</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">catalog_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">catalog_text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MadrigalCatalogRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                        <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                        <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                        <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="p">,</span>
                                                        <span class="n">catalog_text</span><span class="p">))</span>
            <span class="n">catalog_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            
            
    <span class="k">def</span> <span class="nf">_appendHeaderRecs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expNotesDataset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_appendHeaderRecs will append 0 or more MadrigalHeaderRecords to self._privList based</span>
<span class="sd">        on the contents in h5py dataset expNotesDataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_delimiter</span> <span class="o">=</span> <span class="s1">&#39;Header information from record&#39;</span>
        <span class="n">end_delimiter</span> <span class="o">=</span> <span class="s1">&#39;Catalog information from record&#39;</span>
        <span class="n">in_header</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">header_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">start_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kinst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kinst</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kindat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kindat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">expNotesDataset</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">in_header</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start_delimiter</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">in_header</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_header</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">end_delimiter</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start_delimiter</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">start_found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MadrigalHeaderRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span><span class="n">kindat</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                               <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                               <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                               <span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="p">,</span> 
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="p">,</span> <span class="n">header_text</span><span class="p">))</span>
                    <span class="n">header_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start_delimiter</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">in_header</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_header</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start_found</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_header</span><span class="p">:</span>
                <span class="n">header_text</span> <span class="o">+=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>

                
        <span class="c1"># see if last part was a header</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MadrigalHeaderRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span><span class="n">kindat</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                       <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                       <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                       <span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="p">,</span> 
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="p">,</span> <span class="n">header_text</span><span class="p">))</span>
            <span class="n">header_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            
            
    <span class="k">def</span> <span class="nf">_getArraySplitParms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadataGroup</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_getArraySplitParms appends a list of parameters used to split arrays (if any) from</span>
<span class="sd">        metadataGroup[&quot;Parameters Used to Split Array Data&quot;].  If no such table or empty, returns</span>
<span class="sd">        empty list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retList2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">metadataGroup</span><span class="p">[</span><span class="s2">&quot;Parameters Used to Split Array Data&quot;</span><span class="p">]</span>
            <span class="n">retList2</span> <span class="o">=</span> <span class="p">[</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">retList2</span><span class="p">)</span>
        
        <span class="c1"># verify ascii</span>
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="n">retList2</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mnem</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
        
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
            
            
            
    <span class="k">def</span> <span class="nf">writeExperimentNotes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadataGroup</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;writeExperimentNotes writes the &quot;Experiment Notes&quot; dataset to the h5py group metadataGroup</span>
<span class="sd">        if any catalog or header records found.</span>
<span class="sd">        </span>
<span class="sd">            refreshCatHeadTimes - if True, update start and and times in the catalog and header</span>
<span class="sd">                records to represent the times in the data.  If False, use existing times in those records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># templates</span>
        <span class="n">cat_template</span> <span class="o">=</span> <span class="s1">&#39;Catalog information from record </span><span class="si">%i</span><span class="s1">:&#39;</span>
        <span class="n">head_template</span> <span class="o">=</span> <span class="s1">&#39;Header information from record </span><span class="si">%i</span><span class="s1">:&#39;</span>
        
        <span class="k">if</span> <span class="s2">&quot;Experiment Notes&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadataGroup</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c1"># already exists</span>
            <span class="k">return</span>
        
        <span class="n">recDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = rec number, value = tuple of recarray of lines, &#39;Catalog&#39; or &#39;Header&#39; str)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;catalog&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">refreshCatHeadTimes</span><span class="p">:</span>
                    <span class="n">sDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span>
                    <span class="n">eDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span>
                    <span class="n">rec</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">sDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                     <span class="n">sDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">),</span>
                                     <span class="n">eDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                     <span class="n">eDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">eDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">))</span>
                <span class="n">recarray</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getLines</span><span class="p">()</span>
                <span class="n">recDict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">recarray</span><span class="p">,</span> <span class="s1">&#39;Catalog&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;header&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">refreshCatHeadTimes</span><span class="p">:</span>
                    <span class="n">sDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span>
                    <span class="n">eDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span>
                    <span class="n">rec</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">sDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                     <span class="n">sDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">),</span>
                                     <span class="n">eDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                     <span class="n">eDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">eDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">))</span>
                <span class="n">recarray</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getLines</span><span class="p">()</span>
                <span class="n">recDict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">recarray</span><span class="p">,</span> <span class="s1">&#39;Header&#39;</span><span class="p">)</span>
                
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">recDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">recarray</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">new_recarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="mi">2</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;File Notes&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">))])</span>
            <span class="k">if</span> <span class="n">recDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Catalog&#39;</span><span class="p">:</span>
                <span class="n">topStr</span> <span class="o">=</span> <span class="n">cat_template</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">topStr</span> <span class="o">=</span> <span class="n">head_template</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">new_recarray</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">topStr</span><span class="p">))</span>
            <span class="n">new_recarray</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">80</span>
            <span class="k">if</span> <span class="n">recarray</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">recarray</span> <span class="o">=</span> <span class="n">new_recarray</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">recarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">recarray</span><span class="p">,</span> <span class="n">new_recarray</span><span class="p">))</span>
            <span class="n">recarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">recarray</span><span class="p">,</span> <span class="n">recDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
            
        <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">recarray</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">_getKinstList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recarr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_getKinstList returns an array of instrument code ints by parsing a numpy recarray</span>
<span class="sd">        with columns name and value.  If name is &quot;instrument code(s)&quot;, then parse comma separated</span>
<span class="sd">        kinst int values in values column. Returns empty list if not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recarr</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;instrument code(s)&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">retList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kinst</span><span class="p">))</span> <span class="k">for</span> <span class="n">kinst</span> <span class="ow">in</span> <span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                    <span class="k">break</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># not binary</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;instrument code(s)&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">retList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kinst</span><span class="p">))</span> <span class="k">for</span> <span class="n">kinst</span> <span class="ow">in</span> <span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                    <span class="k">break</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="nf">_getKindatList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recarr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_getKindatList returns an array of kind of data code ints by parsing a numpy recarray</span>
<span class="sd">        with columns name and value.  If name is &quot;kindat code(s)&quot;, then parse comma separated</span>
<span class="sd">        kindat int values in values column. Returns empty list if not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recarr</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;kindat code(s)&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">retList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kindat</span><span class="p">))</span> <span class="k">for</span> <span class="n">kindat</span> <span class="ow">in</span> <span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                    <span class="k">break</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># not binary</span>
                <span class="k">if</span> <span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;kindat code(s)&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">retList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kindat</span><span class="p">))</span> <span class="k">for</span> <span class="n">kindat</span> <span class="ow">in</span> <span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                    <span class="k">break</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
        
        
    
    <span class="k">def</span> <span class="nf">_printSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">filterList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_printSummary prints an overview of the original filename and filters used if any</span>
<span class="sd">        to open file f (may be stdout)</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            f - open file to write to</span>
<span class="sd">            </span>
<span class="sd">            filterList - a list of madrigal.derivation.MadrigalFilter objects to be described in the </span>
<span class="sd">                summary.  Default is None, in which case not described in summary.  Ignored if summary</span>
<span class="sd">                is not &#39;summary&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Data derived from file </span><span class="si">%s</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">))</span>
            
        <span class="k">if</span> <span class="n">filterList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filterList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Filters used:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filterList</span><span class="p">)):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Filter </span><span class="si">%i</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filterList</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
        
            
    
    <span class="k">def</span> <span class="nf">_getGroupName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indValues</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_getGroupName returns the name of a array group when split</span>
<span class="sd">        </span>
<span class="sd">        Input:</span>
<span class="sd">            indValues - a list of values, one for each array splitting parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">groupName</span> <span class="o">=</span> <span class="s1">&#39;Array with &#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">parmString</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parmString</span> <span class="o">=</span> <span class="n">parm</span>
            <span class="n">groupName</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parmString</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">indValues</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">indValues</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">groupName</span> <span class="o">+=</span> <span class="s1">&#39;and &#39;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">groupName</span><span class="p">)</span>
        
        

    <span class="sd">&quot;&quot;&quot; the following methods are added to allow this class to emulate a list.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># check that value in (MadrigalCatalogRecord, MadrigalHeaderRecord, MadrigalDataRecord)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MadrigalCatalogRecord</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MadrigalHeaderRecord</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MadrigalDataRecord</span><span class="p">):</span>
            <span class="c1"># check that its not an empty list (used to delete records)</span>
            <span class="n">okay</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">okay</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">okay</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;In MadrigalCedarFile, can only add MadrigalCatalogRecord, MadrigalHeaderRecord, or MadrigalDataRecord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">seq</span><span class="p">):</span>
        <span class="c1"># check every item in seq</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MadrigalCatalogRecord</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MadrigalHeaderRecord</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MadrigalDataRecord</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;In MadrigalCedarFile, can only add MadrigalCatalogRecord, MadrigalHeaderRecord, or MadrigalDataRecord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">):]</span> <span class="o">=</span> <span class="n">seq</span>

    <span class="k">def</span> <span class="nf">__delslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">):]</span>
            
            

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>
        <span class="c1"># not found</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">retStr</span>
            

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="c1"># check that value in (MadrigalCatalogRecord, MadrigalHeaderRecord, MadrigalDataRecord)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MadrigalCatalogRecord</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MadrigalHeaderRecord</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MadrigalDataRecord</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;In MadrigalCedarFile, can only add MadrigalCatalogRecord, MadrigalHeaderRecord, or MadrigalDataRecord&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MadrigalDataRecord</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getDType</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Varying dtypes found: </span><span class="si">%s</span><span class="s1"> versus </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getDType</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDType</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getDType</span><span class="p">())</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getRecordset</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Varying recordsets found: </span><span class="si">%s</span><span class="s1"> versus </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getRecordset</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getRecordset</span><span class="p">()</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># set all internal data structures set by data records only if not yet set</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getInd2DParms</span><span class="p">()</span>
                <span class="c1"># set self._num2DSplit</span>
                <span class="n">twoDSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">mnemonic</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">])</span>
                <span class="n">arraySplitSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDSet</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">arraySplitSet</span><span class="p">))</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getKinst</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getKindat</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getKindat</span><span class="p">())</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setRecno</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_totalDataRecords</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_totalDataRecords</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># update self._recIndexList</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lastIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lastIndex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lastIndex</span><span class="p">,</span> <span class="n">lastIndex</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getDataset</span><span class="p">())))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dataset</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getDataset</span><span class="p">()</span>
                <span class="n">rowsToCheck</span> <span class="o">=</span> <span class="n">dataset</span>
                    
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">thisRow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rowsToCheck</span><span class="p">):</span>

                    <span class="c1"># update self._arrDict</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">==</span> <span class="p">[]:</span>
                        
                        <span class="n">arraySplitParms</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                                <span class="n">arraySplitParms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">arraySplitParms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">arraySplitParms</span><span class="p">])</span>

                        <span class="c1"># array splitting parameters can never be nan</span>
                        <span class="k">for</span> <span class="n">this_value</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">this_value</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">this_value</span><span class="p">):</span>
                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is an array splitting parameter, so its illegal to have a nan value for it anywhere in the file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># no splitting</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        
                    <span class="c1"># first add ut1_unix if needed </span>
                    <span class="k">if</span> <span class="s1">&#39;ut1_unix&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">thisRow</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]])</span>
                    
                    <span class="c1"># now deal with all ind parms</span>
                    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
                        <span class="n">mnem</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span>
                        <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                            <span class="c1"># no need to create separate dimension since already split out</span>
                            <span class="k">continue</span>
                        
                        <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">thisRow</span><span class="p">[</span><span class="n">mnem</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">]</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="n">mnem</span><span class="p">]])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="n">mnem</span><span class="p">]])</span>
                            
                        <span class="c1"># enforce nan rule for ind2DList</span>
                        <span class="n">thisList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">skip</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">thisList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">bytes</span><span class="p">:</span>
                                <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">thisList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">thisList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">:</span>
                                    <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">thisList</span><span class="p">)):</span>
                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot have nan in ind parm </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mnem</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">])))</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        

    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">MadrigalDataRecord</span><span class="o">.</span><span class="n">cmpDataRec</span><span class="p">)</span>
        <span class="c1"># reset recno values</span>
        <span class="n">recno</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">set1D</span><span class="p">(</span><span class="s1">&#39;recno&#39;</span><span class="p">,</span> <span class="n">recno</span><span class="p">)</span>
                <span class="n">recno</span> <span class="o">+=</span> <span class="mi">1</span>
        
        
    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createFlag</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;Warning - created file </span><span class="si">%s</span><span class="s1"> being closed by __del__. Best practice is to call close() directly, to avoid this warning&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">))))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">MadrigalDataRecord</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;MadrigalDataRecord holds all the information in a Cedar data record.&quot;&quot;&quot;</span>

    <span class="c1"># cedar special values</span>
    <span class="n">missing</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">assumed</span>  <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
    <span class="n">knownbad</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span>
    <span class="n">missing_int</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
    <span class="n">assumed_int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">knownbad_int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
    
    <span class="c1"># standard parms</span>
    <span class="n">_stdParms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;sec&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;recno&#39;</span><span class="p">,</span> <span class="s1">&#39;kindat&#39;</span><span class="p">,</span> <span class="s1">&#39;kinst&#39;</span><span class="p">,</span> <span class="s1">&#39;ut1_unix&#39;</span><span class="p">,</span> <span class="s1">&#39;ut2_unix&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kinst</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">kindat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sYear</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sMonth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sDay</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sHour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sMin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sSec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sCentisec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">eYear</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eMonth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eDay</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eHour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eMin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eSec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eCentisec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">oneDList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">twoDList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">nrow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">madInstObj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">madParmObj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">ind2DList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">recordSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">parmObjList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">madDB</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__init__ creates a MadrigalDataRecord with all missing data.</span>
<span class="sd">        </span>
<span class="sd">        Note: all inputs have default values because there are two ways to populate this structure:</span>
<span class="sd">        1) with all inputs from kinst to nrow when new data is being created, or </span>
<span class="sd">        2) with numpy arrays dataset and recordSet from existing Hdf5 file.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            kinst - the kind of instrument code.  A warning will be raised if not in instTab.txt.</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            kindat - kind of data code. Must be a non-negative integer.</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - record start time. sCentisec must be 0-99</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - record end time. eCentisec must be 0-99</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            oneDList - list of one-dimensional parameters in record. Parameters can be defined as codes</span>
<span class="sd">                       (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                       Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            twoDList - list of two-dimensional parameters in record. Parameters can be defined as codes</span>
<span class="sd">                       (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                       Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            nrow - number of rows of 2D data to create. Until set, all values default to missing.</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            madInstObj - a madrigal.metadata.MadrigalInstrument object.  If None, one will be created.</span>
<span class="sd">                              Used to verify kinst.</span>

<span class="sd">            madParmObj - a madrigal.data.MadrigalParameter object.  If None, one will be created.</span>
<span class="sd">                              Used to verify convert parameters to codes.</span>
<span class="sd">                              </span>
<span class="sd">            ind2DList -  list of indepedent spatial two-dimensional parameters in record. </span>
<span class="sd">                       Parameters can be defined as codes. Each must also be listed in twoDList.</span>
<span class="sd">                       (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                       Default is None, in which case dataset, and recordSet must be given.</span>
<span class="sd">                </span>
<span class="sd">            dataset - an h5py dataset, as found in the Hdf5 group &quot;Data&quot;, dataset &quot;Table Layout&quot;.</span>
<span class="sd">                Set to None if this is a new record.</span>
<span class="sd">                </span>
<span class="sd">            recordSet - an h5py dataset, as found in the Hdf5 group &quot;Metadata&quot;, dataset &quot;_record_layout&quot;.</span>
<span class="sd">                Set to None if this is a new record.</span>
<span class="sd">                </span>
<span class="sd">            verbose - if True (the default), print all warnings.  If False, surpress warnings</span>
<span class="sd">            </span>
<span class="sd">            parmObjList - a list or tuple of three lists: self._oneDList, self._twoDList, and</span>
<span class="sd">                self._ind2DList described below.  Used only to speed performance.  Default is</span>
<span class="sd">                None, in which case new copies are created.</span>
<span class="sd">                </span>
<span class="sd">            madDB - madrigal.metadata.MadrigalDB object. If None, one will be created.</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Returns: None</span>
<span class="sd">        </span>
<span class="sd">        Affects:</span>
<span class="sd">            Creates attributes:</span>
<span class="sd">                self._madInstObj - madrigal.metadata.MadrigalInstrument object</span>
<span class="sd">                self._madParmObj - madrigal.data.MadrigalParameters object</span>
<span class="sd">                self._dataset - h5py dataset in from of Table Layout numpy recarray</span>
<span class="sd">                self._recordSet - h5py dataset in form of _record_layout numpy recarray</span>
<span class="sd">                self._verbose - bool indicating verbose or not</span>
<span class="sd">                self._oneDList - a list of 1D CedarParameter objects in this MadrigalDataRecord</span>
<span class="sd">                self._twoDList - a list of 2D CedarParameter objects in this MadrigalDataRecord</span>
<span class="sd">                self._ind2DList - a list of independent spatial parameters in self._twoDList</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">madDB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalDB</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span> <span class="o">=</span> <span class="n">madDB</span>
        <span class="c1"># create any needed Madrigal objects, if not passed in</span>
        <span class="k">if</span> <span class="n">madInstObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalInstrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madInstObj</span>

        <span class="k">if</span> <span class="n">madParmObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span> <span class="o">=</span> <span class="n">madParmObj</span>


        <span class="k">if</span> <span class="n">twoDList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">twoDList</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="k">if</span> <span class="n">ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ind2DList</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="k">if</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">recordSet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># get it from cachedFiles.ini</span>
                <span class="n">extraParms</span><span class="p">,</span> <span class="n">ind2DList</span><span class="p">,</span> <span class="n">splitParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span><span class="o">.</span><span class="n">getKinstKindatConfig</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span> <span class="n">kindat</span><span class="p">)</span>
            <span class="c1"># verify there are independent spatial parms if there are 2D parms</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind2DList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot have 2D parms without an independent spatial parm set&#39;</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_createArraysFromArgs</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span><span class="n">kindat</span><span class="p">,</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                                       <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">,</span>
                                       <span class="n">oneDList</span><span class="p">,</span><span class="n">twoDList</span><span class="p">,</span><span class="n">nrow</span><span class="p">,</span><span class="n">ind2DList</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># verify there are independent spatial parms if there are 2D parms</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind2DList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot have 2D parms without an independent spatial parm set&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">dataset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">recordSet</span>
            
        <span class="k">if</span> <span class="n">parmObjList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parmObjList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parmObjList</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parmObjList</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># populate self._oneDList, self._twoDList, and self._ind2DList</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stdParms</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">isInt</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">isInt</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">newCedarParm</span> <span class="o">=</span> <span class="n">CedarParameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCodeFromMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                              <span class="n">parm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                              <span class="n">isInt</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
        
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        
    
    
    <span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the type &#39;data&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;data&#39;</span>
    
    
    <span class="k">def</span> <span class="nf">getDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getDType returns the dtype of the table array with this data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getRecDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRecDType returns the dtype of _record_array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getDataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getDataset returns the dataset table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">getRecordset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRecordset returns the recordSet table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">parmIsInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parmIsInt returns True if this parm (mnemonic) is integer type, False if float or string</span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if parm not in record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">typeStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">typeStr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">parmIsString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parmIsString returns True if this parm (mnemonic) is String type, False if float or int</span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError is parm not in record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">typeStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">typeStr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">getStrLen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStrLen returns True if this parm (mnemonic) is integer type, False if float or string</span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError is parm not in record, or is not String</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not string type&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">itemsize</span><span class="p">)</span>
    


    <span class="k">def</span> <span class="nf">add1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oneDParm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;add1D adds a new one-dim parameter to a MadrigalDataRecord</span>

<span class="sd">        Input: oneDParm - Parameter can be defined as codes (integer) or case-insensitive</span>
<span class="sd">               mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">        Affects: 1) adds new column to self._dataset with all values Nan, and 2) adds </span>
<span class="sd">        value to end of self._recordSet with value = 1 since 1D parm</span>
<span class="sd">        </span>
<span class="sd">        If these addition makes self._dataset.dtype differ from that in MadrigalCedarFile, appending this</span>
<span class="sd">        MadrigalDataRecord to MadrigalCedarFile will raise an IOError. Also raises error if parm already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addParm</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">add2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">twoDParm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;add2D adds a new two-dim parameter to a MadrigalDataRecord</span>

<span class="sd">        Input: twoDParm - Parameter can be defined as codes (integer) or case-insensitive</span>
<span class="sd">               mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">        Affects: 1) adds new column to self._dataset with all values Nan, and 2) adds </span>
<span class="sd">        value to end of self._recordSet with value = 2 since 2D parm</span>
<span class="sd">        </span>
<span class="sd">        If these addition makes self._dataset.dtype differ from that in MadrigalCedarFile, appending this</span>
<span class="sd">        MadrigalDataRecord to MadrigalCedarFile will raise an IOError. Also raises error if parm already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addParm</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        
        

    <span class="k">def</span> <span class="nf">addParm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newParm</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;addParm adds a new one or two-dim parameter to a MadrigalDataRecord</span>

<span class="sd">        Input: newParm - Parameter can be defined as codes (integer) or case-insensitive</span>
<span class="sd">               mnemonic string (eg, &quot;Gdalt&quot;)</span>
<span class="sd">               </span>
<span class="sd">               dim - either 1 for scalar, or 2 for vector parm</span>

<span class="sd">        Affects: 1) adds new column to self._dataset with all values Nan, and 2) adds </span>
<span class="sd">        value to end of self._recordSet with value = dim</span>
<span class="sd">        </span>
<span class="sd">        If these addition makes self._dataset.dtype differ from that in MadrigalCedarFile, appending this</span>
<span class="sd">        MadrigalDataRecord to MadrigalCedarFile will raise an IOError. Also raises error if parm already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dim must be 1 or 2, not </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">)))</span>
        
        <span class="c1"># see if its an integer</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">newParm</span><span class="p">)</span>
            <span class="n">isInt</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">isInt</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">isInt</span><span class="p">:</span>
            <span class="c1"># try to look up mnemonic</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newParm</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mnem</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">newParm</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Cannot use unknown parm </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newParm</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># this must succeed or an exception raised</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCodeFromMnemonic</span><span class="p">(</span><span class="n">newParm</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Mnem </span><span class="si">%s</span><span class="s1"> not found&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newParm</span><span class="p">))</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="n">newParm</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># issue warning if an unneeded time parameter being added</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">timeParms</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;WARNING: Parameter </span><span class="si">%s</span><span class="s1"> is a time parameter that potentially conflicts with prolog times</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># figure out dtype</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmFormat</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">format</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span>
            
        <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">),),</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">append_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dim</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">append_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">usemask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">newCedarParm</span> <span class="o">=</span> <span class="n">CedarParameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCodeFromMnemonic</span><span class="p">(</span><span class="n">mnem</span><span class="p">),</span>
                                      <span class="n">mnem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmDescription</span><span class="p">(</span><span class="n">mnem</span><span class="p">),</span>
                                      <span class="n">isInt</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">,</span> <span class="n">valueIn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set1D sets a 1D value for a given 1D parameter</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>


<span class="sd">            valueIn - double (or string convertable to double) value to set 1D parameter to.  To set special Cedar values, the global values</span>
<span class="sd">                    missing, assumed, or knownbad may be used, or the strings &quot;missing&quot;, &quot;assumed&quot;, or &quot;knownbad&quot;</span>
<span class="sd">                    May also be int or string if that type</span>

<span class="sd">        Outputs: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># avoid numpy / python disagreement when comparing strings/arrays</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">valueIn</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">str_</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">valueIn</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">valueIn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">valueIn</span>
            
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;missing&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_int</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStrLen</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;assumed&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed_int</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;knownbad&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad_int</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;assumed&#39;</span><span class="p">,</span> <span class="s1">&#39;knownbad&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;It is illegal to set the non-error parm </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="c1"># make sure this is a one-d parm</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 2D, not 1D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        
        <span class="c1"># set it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        


    <span class="k">def</span> <span class="nf">set2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">valueIn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set2D sets a 2D value for a given 2D parameter and row</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">            row - row number to set data.  Starts at 0.</span>

<span class="sd">            valueIn - double (or string convertable to double) value to set 2D parameter to. To set special Cedar values, the global values</span>
<span class="sd">                    missing, assumed, or knownbad may be used, or the strings &quot;missing&quot;, &quot;assumed&quot;, or &quot;knownbad&quot;</span>
<span class="sd">                    May also be int or string if that type</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span> <span class="ow">or</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal value of row </span><span class="si">%i</span><span class="s1"> with nrow = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)))</span>
        
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">isString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        
        <span class="c1"># avoid numpy / python disagreement when comparing strings</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">valueIn</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">str_</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">valueIn</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">valueIn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">valueIn</span>
        
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;missing&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_int</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStrLen</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;assumed&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed_int</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;knownbad&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad_int</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;assumed&#39;</span><span class="p">,</span> <span class="s1">&#39;knownbad&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;It is illegal to set the non-error parm </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="c1"># make sure this is a two-d parm</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 1D, not 2D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        
        <span class="c1"># if its ind parm, make sure its not nan</span>
        <span class="k">if</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set ind parm </span><span class="si">%s</span><span class="s1"> to nan at row </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
        
        
        <span class="c1"># set it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        
        
    <span class="k">def</span> <span class="nf">set2DParmValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set2DParmValues sets all 2D value in all rows for a given 2D parameter</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">            value - list, tuple, or numpy array of int64 or float64 type.  Must match len of nrows.  User is responsible</span>
<span class="sd">                for having set all special values to missing, assumed and knownbad as defined at top</span>
<span class="sd">                of this class for either ints or floats</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># make sure this is a two-d parm</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">isString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 1D, not 2D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        
        <span class="k">if</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set any ind parm </span><span class="si">%s</span><span class="s1"> value to nan: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">)))</span>
        
        <span class="c1"># set it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>



    <span class="k">def</span> <span class="nf">get1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get1D returns the 1D value for a given 1D parameter</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">        Outputs: value</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        <span class="c1"># make sure this is a one-d parm</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">isString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 2D, not 1D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
                
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># check for special values</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="s1">&#39;missing&#39;</span><span class="p">)</span>

        <span class="c1"># if its an error parameter, allow assumed or knownbad</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed_int</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="s1">&#39;assumed&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad_int</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="s1">&#39;knownbad&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>


    <span class="k">def</span> <span class="nf">get2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get2D returns the 2D value for a given 2D parameter</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">            row - row number to get data.  Starts at 0.</span>

<span class="sd">        Outputs: double value, or the strings &quot;missing&quot;, &quot;assumed&quot;, or &quot;knownbad&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span> <span class="ow">or</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal value of row </span><span class="si">%i</span><span class="s1"> with nrow = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)))</span>
        
        <span class="c1"># make sure this is a two-d parm</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">isString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 1D, not 2D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
                
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">row</span><span class="p">]</span>

        <span class="c1"># check for special values</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="s1">&#39;missing&#39;</span><span class="p">)</span>

        <span class="c1"># if its an error parameter, allow assumed or knownbad</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed_int</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="s1">&#39;assumed&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad_int</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="s1">&#39;knownbad&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>
    
    
    <span class="k">def</span> <span class="nf">getRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRow returns the row of data in order defined in self._dataset.dtype</span>
<span class="sd">        </span>
<span class="sd">        Input: row number</span>
<span class="sd">        </span>
<span class="sd">        IndexError raised if not a valid row index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
    
    
    <span class="k">def</span> <span class="nf">setRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setRow sets an entire row of data at once</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            row - row number to set</span>
<span class="sd">            </span>
<span class="sd">            values - a tuple of values in the right format to match self._dataset.dtype</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>


    <span class="k">def</span> <span class="nf">delete1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;delete1D removes the given 1D parameter from the record</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Raise exception if 1D parm does not exist. If this deletion makes self._dataset.dtype differ from that in </span>
<span class="sd">        MadrigalCedarFile, appending this MadrigalDataRecord to MadrigalCedarFile will raise an IOError. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># make sure this is a one-d parm</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 2D, not 1D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span>
        
        <span class="c1"># find index to delete from self._oneDList</span>
        <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parmObj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">parmObj</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="n">parm</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Did not find parm </span><span class="si">%s</span><span class="s1"> in self._oneDList&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        

    <span class="k">def</span> <span class="nf">delete2DParm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;delete2DParm removes the given 2D parameter from every row in the record</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Raise exception if 2D parm does not exist. If this deletion makes self._dataset.dtype differ from that in </span>
<span class="sd">        MadrigalCedarFile, appending this MadrigalDataRecord to MadrigalCedarFile will raise an IOError. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># make sure this is a two-d parm</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 1D, not 2D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span>

        <span class="c1"># find index to delete from self._twoDList</span>
        <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parmObj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">parmObj</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="n">parm</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Did not find parm </span><span class="si">%s</span><span class="s1"> in self._twoDList&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        
        

    <span class="k">def</span> <span class="nf">delete2DRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;delete2DRows removes the given 2D row or rows in the record (first is row 0)</span>

<span class="sd">        Inputs:</span>

<span class="sd">            row number (integer) or list of row numbers to delete (first is row 0)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Raise exception if row does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># make sure row is a list</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">rows</span><span class="p">]</span>
            
        <span class="n">keepIndices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># make sure all rows actually exist</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">keepIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Some row in </span><span class="si">%s</span><span class="s1"> out of range, total number of rows is </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">keepIndices</span><span class="p">]</span>
        
        

    <span class="k">def</span> <span class="nf">getKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKinst returns the kind of instrument code (int) for a given data record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the kind of instrument code (int) for a given data record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">setKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newKinst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setKinst sets the kind of instrument code (int) for a given data record.</span>

<span class="sd">        Inputs: newKinst - new instrument code (integer)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets self._dataset[&#39;kinst&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newKinst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">newKinst</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newKinst</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Kinst must not be less than 0, not </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newKinst</span><span class="p">))</span>
        <span class="c1"># verify  and set kinst</span>
        <span class="n">instList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentList</span><span class="p">()</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">newKinst</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="s1">&#39;Unknown instrument&#39;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: kinst </span><span class="si">%i</span><span class="s1"> not found in instTab.txt</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newKinst</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newKinst</span>


    <span class="k">def</span> <span class="nf">getKindat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKindat returns the kind of data code (int) for a given data record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the kind of data code (int) for a given data record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">setKindat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newKindat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setKindat sets the kind of data code (int) for a given data record.</span>

<span class="sd">        Inputs: newKindat (integer)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets self._dataset[&#39;kindat&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">newKindat</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kindat cannot be negative: </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newKindat</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">newKindat</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">getRecno</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRecno returns the recno (int) for a given data record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the recno (int) for a given data record. May be 0 if not yet in a file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">setRecno</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newRecno</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setRecno sets the recno (int) for a given data record.</span>

<span class="sd">        Inputs: newRecno (integer)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets self._dataset[&#39;recno&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">newRecno</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;recno cannot be negative: </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newRecno</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">newRecno</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getNrow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getNrow returns the number of 2D data rows (int) for a given data record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the number of 2D data rows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">getStartTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStartTimeList returns a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">startDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
        <span class="k">return</span><span class="p">((</span><span class="n">startDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">startDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">startDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> 
                <span class="n">startDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">startDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">startDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">startDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mf">1.0E4</span><span class="p">)))</span>
        
        
    <span class="k">def</span> <span class="nf">getStartDatetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStartDatetime returns a start record datetime</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a datetime.datetime object representing the start time of the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>


    <span class="k">def</span> <span class="nf">setStartTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="n">sCentisec</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setStartTimeList changes the data record start time</span>

<span class="sd">        Inputs: integers sYear, sMonth, sDay, sHour, sMin, sSec. sCentisec defaults to 0</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: changes self._dataset fields ut1_unix, year, month, day, hour, min,sec</span>

<span class="sd">        Prints warning if new start time after present end time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check validity of input time</span>
        <span class="n">sCentisec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sCentisec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sCentisec</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">sCentisec</span> <span class="o">&gt;</span> <span class="mi">99</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal sCentisec </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sCentisec</span><span class="p">))</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sCentisec</span><span class="o">*</span><span class="mf">1E4</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal datetime </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="n">sCentisec</span><span class="p">))))</span>

        <span class="k">if</span> <span class="n">sDT</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: New starting time </span><span class="si">%s</span><span class="s1"> after present ending time </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sDT</span><span class="p">),</span> 
                                                                                               <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">())))</span>
            
        <span class="n">ut1_unix</span> <span class="o">=</span> <span class="p">(</span><span class="n">sDT</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut1_unix</span>
        
        <span class="c1"># need to reset average time</span>
        <span class="n">aveDT</span> <span class="o">=</span> <span class="n">sDT</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span> <span class="o">-</span> <span class="n">sDT</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">hour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">minute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;sec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">second</span>



    <span class="k">def</span> <span class="nf">getEndTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getEndTimeList returns a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
        <span class="k">return</span><span class="p">((</span><span class="n">endDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">endDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">endDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> 
                <span class="n">endDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">endDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">endDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">endDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mf">1.0E4</span><span class="p">)))</span>
        
        
    <span class="k">def</span> <span class="nf">getEndDatetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getEndDatetime returns a end record datetime</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a datetime.datetime object representing the end time of the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    
    
    <span class="k">def</span> <span class="nf">setEndTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="n">eCentisec</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setEndTimeList changes the data record end time</span>

<span class="sd">        Inputs: integers eYear, eMonth, eDay, eHour, eMin, eSec. eCentisec defaults to 0</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: changes self._dataset fields ut2_unix, year, month, day, hour, min,sec</span>

<span class="sd">        Prints warning if new start time after present end time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check validity of input time</span>
        <span class="n">eCentisec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">eCentisec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eCentisec</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">eCentisec</span> <span class="o">&gt;</span> <span class="mi">99</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal eCentisec </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">eCentisec</span><span class="p">))</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">eCentisec</span><span class="o">*</span><span class="mf">1E4</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal datetime </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="n">eCentisec</span><span class="p">))))</span>

        <span class="k">if</span> <span class="n">eDT</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: New ending time </span><span class="si">%s</span><span class="s1"> before present starting time </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">eDT</span><span class="p">),</span> 
                                                                                                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">())))</span>
            
        <span class="n">ut2_unix</span> <span class="o">=</span> <span class="p">(</span><span class="n">eDT</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut2_unix</span>
        
        <span class="c1"># need to reset average time</span>
        <span class="n">aveDT</span> <span class="o">=</span> <span class="n">eDT</span> <span class="o">-</span> <span class="p">(</span><span class="n">eDT</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">())</span><span class="o">/</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">hour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">minute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;sec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">second</span>


    


    <span class="k">def</span> <span class="nf">get1DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get1DParms returns a list of 1D parameters in the MadrigalDataRecord.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a list of 1D CedarParameter objects in the MadrigalDataRecord.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get2DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get2DParms returns a list of 2D parameters in the MadrigalDataRecord.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a list of 2D CedarParameter objects in the MadrigalDataRecord. Includes</span>
<span class="sd">            both independent and dependent parms.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getInd2DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getInd2DParms returns a list of the subset 2D parameters ithat are independent parmeters.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a list of independent 2D CedarParameter objects in the MadrigalDataRecord. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getParmDim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getParmDim returns the dimension (1, 2, or 3 for independent spatial parm) of a given parm mnemonic</span>
<span class="sd">        </span>
<span class="sd">        Raise KeyError if that parameter not found in file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># do ind 2D next since they are in both lists</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in data&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    

    <span class="k">def</span> <span class="nf">getHeaderKodLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getHeaderKodLines creates the lines in the Madrigal header record that start KOD and describe parms</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Returns: a string of length 80*num parms.  Each 80 characters contains a description</span>
<span class="sd">                 of a single parm accodring to the Cedar Standard</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create a list of oneDCedar codes for the data record.</span>
        <span class="c1">#  Each item has three elements: (code, parameter description, units)</span>
        <span class="n">oneDCedarCodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
            <span class="n">oneDCedarCodes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">)))</span>
        
        <span class="n">oneDCedarCodes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">compareParms</span><span class="p">)</span>

        <span class="c1"># create a list of twoDCedar codes for the data record.</span>
        <span class="c1"># Each item has three elements: (code, parameter description, units)</span>
        <span class="n">twoDCedarCodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
            <span class="n">twoDCedarCodes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">)))</span>
            
        <span class="n">twoDCedarCodes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">compareParms</span><span class="p">)</span>
        

        <span class="c1"># write out lines - one D</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oneDCedarCodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;C 1D Parameters:&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;C 1D Parameters:&#39;</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oneDCedarCodes</span><span class="p">)):</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">oneDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="n">oneDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">oneDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;KODS(</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
            <span class="n">codeNum</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="n">codeNum</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">codeNum</span><span class="p">))</span><span class="o">*</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">codeNum</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">codeNum</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">48</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">desc</span><span class="p">[:</span><span class="mi">48</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">desc</span> <span class="o">+</span> <span class="p">(</span><span class="mi">49</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">))</span><span class="o">*</span> <span class="s1">&#39; &#39;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">desc</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">units</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">line</span>

        <span class="c1"># two D</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDCedarCodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;C 2D Parameters:&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;C 2D Parameters:&#39;</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">twoDCedarCodes</span><span class="p">)):</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">twoDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="n">twoDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">twoDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;KODM(</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
            <span class="n">codeNum</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="n">codeNum</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">codeNum</span><span class="p">))</span><span class="o">*</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">codeNum</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">codeNum</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">48</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">desc</span><span class="p">[:</span><span class="mi">48</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">desc</span> <span class="o">+</span> <span class="p">(</span><span class="mi">49</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">))</span><span class="o">*</span> <span class="s1">&#39; &#39;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">desc</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">units</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">line</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>

                    

    
        
        
    <span class="k">def</span> <span class="nf">_createArraysFromArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kinst</span><span class="p">,</span><span class="n">kindat</span><span class="p">,</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                                       <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">,</span>
                                       <span class="n">oneDList</span><span class="p">,</span><span class="n">twoDList</span><span class="p">,</span><span class="n">nrow</span><span class="p">,</span><span class="n">ind2DList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createArraysFromArgs creates a table layout array and record array numpy array based in input arguments.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>

<span class="sd">            kinst - the kind of instrument code.  A warning will be raised if not in instTab.txt.</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            kindat - kind of data code. Must be a non-negative integer.</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - record start time. sCentisec must be 0-99</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - record end time. eCentisec must be 0-99</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            oneDList - list of one-dimensional parameters in record. Parameters can be defined as codes</span>
<span class="sd">                       (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                       Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            twoDList - list of two-dimensional parameters in record. Parameters can be defined as codes</span>
<span class="sd">                       (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                       Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            nrow - number of rows of 2D data to create. Until set, all values default to missing.</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>
<span class="sd">                </span>
<span class="sd">            ind2DList -  list of indepedent spatial two-dimensional parameters in record. </span>
<span class="sd">                       Parameters can be defined as codes. Each must also be listed in twoDList.</span>
<span class="sd">                       (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                       Default is None, in which case dataset, and recordSet must be given.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaultParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stdParms</span>
        <span class="n">dataDtype</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># data type for the Table Layout recarray</span>
        <span class="n">recDType</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># data type for _record_layout recarray</span>
        <span class="n">recDims</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># dimension of each parameter (1 for 1D, 2 for dependent 2D, 3 for independent 2D)</span>
        <span class="n">parmsAddedSoFar</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># mnemonics added so far</span>
        
        <span class="c1"># the following is simply to ensure that independent 2D parms are also listed in twoDList</span>
        <span class="n">twoDParms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">twoDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">CedarParameter</span><span class="p">):</span>
                <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="n">twoDParms</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Duplicate parmeter </span><span class="si">%s</span><span class="s1"> in twoDList&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mnem</span><span class="p">))</span>
            <span class="n">twoDParms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
        
        <span class="c1"># default parms</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">defaultParms</span><span class="p">:</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># default parms cannot be strings</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">float</span><span class="p">))</span>
            <span class="n">recDType</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="n">recDims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">parmsAddedSoFar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
            
        <span class="c1"># one D parms</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">oneDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">CedarParameter</span><span class="p">):</span>
                <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="n">parmsAddedSoFar</span><span class="p">:</span>
                <span class="k">continue</span> <span class="c1"># legal because it may be a default parm</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">,</span> <span class="n">strLen</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">float</span><span class="p">))</span>
            <span class="n">recDType</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="n">recDims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">parmsAddedSoFar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">ind2DList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">CedarParameter</span><span class="p">):</span>
                <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="n">parmsAddedSoFar</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Duplicate parmeter </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mnem</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">mnem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">twoDParms</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Independent 2D parm </span><span class="si">%s</span><span class="s1"> not found in twoDList&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mnem</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">,</span> <span class="n">strLen</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">float</span><span class="p">))</span>
            <span class="n">recDType</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="n">recDims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">parmsAddedSoFar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">twoDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">CedarParameter</span><span class="p">):</span>
                <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="n">parmsAddedSoFar</span><span class="p">:</span>
                <span class="k">continue</span> <span class="c1"># legal because may be independent parm</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">,</span> <span class="n">strLen</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">float</span><span class="p">))</span>
            <span class="n">recDType</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="n">recDims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            
        <span class="c1"># create two recarrays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span> <span class="mi">1</span><span class="p">),),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">dataDtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">recDims</span><span class="p">),],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">recDType</span><span class="p">)</span>
        
        <span class="c1"># set prolog values</span>
        <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sYear</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sMonth</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sDay</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sHour</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sMin</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sSec</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sCentisec</span><span class="p">)</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">eYear</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">eMonth</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">eDay</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">eHour</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">eMin</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">eSec</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">eCentisec</span><span class="p">)</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">midDT</span> <span class="o">=</span> <span class="n">sDT</span> <span class="o">+</span> <span class="p">((</span><span class="n">eDT</span><span class="o">-</span><span class="n">sDT</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midDT</span><span class="o">.</span><span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midDT</span><span class="o">.</span><span class="n">month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midDT</span><span class="o">.</span><span class="n">day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midDT</span><span class="o">.</span><span class="n">hour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midDT</span><span class="o">.</span><span class="n">minute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;sec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midDT</span><span class="o">.</span><span class="n">second</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kindat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getUnixUTFromDT</span><span class="p">(</span><span class="n">sDT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getUnixUTFromDT</span><span class="p">(</span><span class="n">eDT</span><span class="p">)</span>
        <span class="c1"># set all other values to default</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">defaultParms</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataDtype</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">dataDtype</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">dataDtype</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing</span>
            <span class="k">elif</span> <span class="n">dataDtype</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">dataDtype</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_int</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># string type only one left</span>
                <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">dataDtype</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">dataDtype</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">strLen</span>
                
                    
            

    <span class="k">def</span> <span class="nf">__get2DValueList__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__get2DValueList__ returns a list containing all the 2D values of a given parameter.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>


<span class="sd">        Outputs: a list containing all the 2D values of a given parameter.  Special values will</span>
<span class="sd">                 be given the values &#39;missing&#39;, &#39;assumed&#39;, or &#39;knownbad&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">):</span>
            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get2D</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__get2DMainValueList__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">scaleFactor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__get2DMainValueList__ returns a list containing all the 2D values of a given main parameter.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            code - parameter code (integer).  Must</span>
<span class="sd">                   be a parameter with an additional increment parameter.</span>


<span class="sd">        Outputs: a list containing all the 2D values of a given main parameter that has an</span>
<span class="sd">                 additional increment parameter.  Special values will be given the values &#39;missing&#39;, &#39;assumed&#39;, or &#39;knownbad&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2D</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bytes</span><span class="p">:</span>
                <span class="c1"># subtract off additional increment part</span>
                <span class="n">addIncr</span> <span class="o">=</span> <span class="n">value</span> <span class="o">%</span> <span class="n">scaleFactor</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">addIncr</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">scaleFactor</span> <span class="o">-</span> <span class="n">addIncr</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="n">addIncr</span>
            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__get2DIncrValueList__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">scaleFactor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__get2DIncrValueList__ returns a list containing all the additional increment 2D values of a given main parameter.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - parameter code (integer).  Must</span>
<span class="sd">                   be a parameter with an additional increment parameter.</span>


<span class="sd">        Outputs: a list containing all the additional increment 2D values of a given main parameter.</span>
<span class="sd">                 Special values will be given the values &#39;missing&#39;, &#39;assumed&#39;, or &#39;knownbad&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2D</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bytes</span><span class="p">:</span>
                <span class="c1"># get additional increment part</span>
                <span class="n">incr</span> <span class="o">=</span> <span class="n">value</span> <span class="o">%</span> <span class="n">scaleFactor</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">incr</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">scaleFactor</span> <span class="o">-</span> <span class="n">incr</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">incr</span>
            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns a string representation of a MadrigalDataRecord &quot;&quot;&quot;</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;Data record:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;kinst = </span><span class="si">%i</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;kindat = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKindat</span><span class="p">())</span>
        <span class="n">startTimeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
        <span class="n">endTimeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;record start: </span><span class="si">%04i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">.</span><span class="si">%02i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">startTimeList</span><span class="p">))</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;record end:   </span><span class="si">%04i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">.</span><span class="si">%02i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">endTimeList</span><span class="p">))</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;one-dim parameters:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDData</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c1"># there may not be oneDData</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;two-dim parameters:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_twoDData</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c1"># there may not be twoDData</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">cmpDataRec</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;cmpDataRec returns a tuple of:</span>
<span class="sd">            1. 0 if catalog, 1 if header, 2 if data</span>
<span class="sd">            2.  start datetime</span>
<span class="sd">            3.  end datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># compare record start times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="n">typeEnum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thisType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dataType</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">thisType</span> <span class="o">==</span> <span class="n">dataType</span><span class="p">:</span>
                <span class="n">typeEnum</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
            
        <span class="c1"># compare record stop times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="k">return</span><span class="p">((</span><span class="n">typeEnum</span><span class="p">,</span> <span class="n">sDT</span><span class="p">,</span> <span class="n">eDT</span><span class="p">))</span>

        
        

<span class="k">class</span> <span class="nc">MadrigalCatalogRecord</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;MadrigalCatalogRecord holds all the information in a Cedar catalog record.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kinst</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">modexp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sYear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sMonth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sDay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sHour</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sSec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sCentisec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">eYear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eMonth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eDay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">eHour</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eSec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eCentisec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">text</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">madInstObj</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">modexpDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">expNotesLines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__init__ creates a MadrigalCatalogRecord.</span>
<span class="sd">        </span>
<span class="sd">        Note: all inputs have default values because there are two ways to populate this structure:</span>
<span class="sd">        1) with all inputs from kinst to text when new data is being created, or </span>
<span class="sd">        2) with catalog line list from existing Hdf5 file Experiment Notes metadata, plus non-default inputs</span>

<span class="sd">        Inputs:</span>

<span class="sd">            kinst - the kind of instrument code.  A warning will be raised if not in instTab.txt.</span>

<span class="sd">            modexp - Code to indicate experimental mode employed. Must be a non-negative integer.</span>

<span class="sd">            sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - experiment start time. sCentisec must be 0-99</span>

<span class="sd">            eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - experiment end time. eCentisec must be 0-99</span>

<span class="sd">            text - string containing text in catalog record.  Length must be divisible by 80.  No linefeeds</span>
<span class="sd">                   allowed.</span>

<span class="sd">            madInstObj - a madrigal.metadata.MadrigalInstrument object.  If None, one will be created.</span>
<span class="sd">                              Used to verify kinst.</span>
<span class="sd">                              </span>
<span class="sd">            modexpDesc - string describing the modexp</span>
<span class="sd">                              </span>
<span class="sd">            expNotesList - a list of all lines in an existing catalog section &quot;Experiment Notes&quot; </span>
<span class="sd">                metadata table.  All the above attributes are parsed from these lines.</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create any needed Madrigal objects, if not passed in</span>
        <span class="k">if</span> <span class="n">madInstObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalInstrument</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madInstObj</span>
            
        <span class="k">if</span> <span class="n">expNotesLines</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get all information from this dataset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parseExpNotesLines</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kinst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># kinst set via catalog record overrides kinst argument</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
        <span class="c1"># verify kinst set, or raise error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kinst not set when MadrigalCatalogRecord created - required&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">modexp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setModexp</span><span class="p">(</span><span class="n">modexp</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modexpDesc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setModexpDesc</span><span class="p">(</span><span class="n">modexpDesc</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                              <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        

        
    <span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the type &#39;catalog&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;catalog&#39;</span>
    


    <span class="k">def</span> <span class="nf">getKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKinst returns the kind of instrument code (int) for a given catalog record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the kind of instrument code (int) for a given catalog record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">setKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kinst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setKinst sets the kind of instrument code (int) for a given catalog record.</span>

<span class="sd">        Inputs: kind of instrument code (integer)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets the kind of instrument code (int) (self._kinst) for a given catalog record.</span>
<span class="sd">        Prints warning if kinst not found in instTab.txt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kinst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
        <span class="c1"># verify  and set kinst</span>
        <span class="n">instList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentList</span><span class="p">()</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">kinst</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="s1">&#39;Unknown instrument&#39;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: kinst </span><span class="si">%i</span><span class="s1"> not found in instTab.txt</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kinst</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span> <span class="o">=</span> <span class="n">kinst</span>

    <span class="k">def</span> <span class="nf">getModexp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getModexp returns the mode of experiment code (int) for a given catalog record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the mode of experiment code (int) for a given catalog record. Returns -1 if not set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_modexp</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setModexp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modexp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setModexp sets the mode of experiment code (int) for a given catalog record.</span>

<span class="sd">        Inputs: the mode of experiment code (int)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets the mode of experiment code (int) (self._modexp)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modexp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">modexp</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">getModexpDesc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getModexp returns the description of the mode of experiment code for a given catalog record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the description of the mode of experiment code for a given catalog record (string).</span>
<span class="sd">            Returns empty string if not set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_modexpDesc</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setModexpDesc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modexpDesc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setModexpDesc sets the description of the mode of experiment code for a given catalog record.</span>

<span class="sd">        Inputs: the description mode of experiment code (string)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets the description of the mode of experiment code (string) (self._modexpDesc)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modexpDesc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">modexpDesc</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getText returns the catalog text.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the catalog text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getTextLineCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getTextLineCount returns the number of 80 character lines in self._text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">setText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setText sets the catalog text.</span>

<span class="sd">        Inputs: text: text to be set.  Must be length divisible by 80, and not contain line feeds.</span>

<span class="sd">        Outputs: None.</span>

<span class="sd">        Affects: sets self._text</span>

<span class="sd">        Raise TypeError if problem with test</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text must be of type string&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text length must be divisible by 80: len is </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text must not contain linefeed character&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">text</span>


    <span class="k">def</span> <span class="nf">getStartTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStartTimeList returns a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">getEndTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getEndTimeList returns a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span><span class="p">))</span>
    

    <span class="k">def</span> <span class="nf">setTimeLists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                     <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setTimeList resets start and end times</span>

<span class="sd">        Inputs:</span>

<span class="sd">            sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - experiment start time. sCentisec must be 0-99</span>

<span class="sd">            eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - experiment end time. eCentisec must be 0-99</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets all time attributes (see code).</span>

<span class="sd">        Exceptions: Raises ValueError if startTime &gt; endTime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># verify times</span>
        <span class="n">sTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">eTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">eTime</span> <span class="o">&lt;</span> <span class="n">sTime</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Starting time cannot be after ending time&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_sTime</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMadrigalUTFromDT</span><span class="p">(</span><span class="n">sTime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eTime</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMadrigalUTFromDT</span><span class="p">(</span><span class="n">eTime</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span> <span class="o">=</span> <span class="n">sYear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span> <span class="o">=</span> <span class="n">sMonth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span> <span class="o">=</span> <span class="n">sDay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span> <span class="o">=</span> <span class="n">sHour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span> <span class="o">=</span> <span class="n">sMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span> <span class="o">=</span> <span class="n">sSec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span> <span class="o">=</span> <span class="n">sCentisec</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span> <span class="o">=</span> <span class="n">eYear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span> <span class="o">=</span> <span class="n">eMonth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span> <span class="o">=</span> <span class="n">eDay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span> <span class="o">=</span> <span class="n">eHour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span> <span class="o">=</span> <span class="n">eMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span> <span class="o">=</span> <span class="n">eSec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span> <span class="o">=</span> <span class="n">eCentisec</span>
        
        
    <span class="k">def</span> <span class="nf">getLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getLines returns a numpy recarray of the format expected by the &quot;Experiment Notes&quot; dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># templates</span>
        <span class="n">kreccStr</span> <span class="o">=</span> <span class="s1">&#39;KRECC       2001 Catalogue Record, Version 1&#39;</span>
        <span class="n">kinstTempStr</span> <span class="o">=</span> <span class="s1">&#39;KINSTE     </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="n">modExpTempStr</span> <span class="o">=</span> <span class="s1">&#39;MODEXP    </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="n">byearTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBYRT               </span><span class="si">%04i</span><span class="s1"> Beginning year&#39;</span>
        <span class="n">bmdTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBDTT               </span><span class="si">%04i</span><span class="s1"> Beginning month and day&#39;</span>
        <span class="n">bhmTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBHMT               </span><span class="si">%04i</span><span class="s1"> Beginning UT hour and minute&#39;</span>
        <span class="n">bcsTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBCST               </span><span class="si">%04i</span><span class="s1"> Beginning centisecond&#39;</span>
        <span class="n">eyearTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEYRT               </span><span class="si">%04i</span><span class="s1"> Ending year&#39;</span>
        <span class="n">emdTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEDTT               </span><span class="si">%04i</span><span class="s1"> Ending month and day&#39;</span>
        <span class="n">ehmTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEHMT               </span><span class="si">%04i</span><span class="s1"> Ending UT hour and minute&#39;</span>
        <span class="n">ecsTempStr</span> <span class="o">=</span> <span class="s1">&#39;IECST               </span><span class="si">%04i</span><span class="s1"> Ending centisecond&#39;</span>
        
        
        <span class="n">numLines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTextLineCount</span><span class="p">()</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="c1"># 8 times lines, KRECC, KINSTE, MODEXP, and final blank</span>
        <span class="n">textArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="n">numLines</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;File Notes&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">))])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numLines</span><span class="o">-</span><span class="mi">9</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kreccStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kreccStr</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">kinstName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">())</span>
                <span class="n">kinstStr</span> <span class="o">=</span> <span class="n">kinstTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">(),</span> <span class="n">kinstName</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="n">kinstStr</span> <span class="o">=</span> <span class="n">kinstStr</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinstStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstStr</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">modExpStr</span> <span class="o">=</span> <span class="n">modExpTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getModexp</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModexpDesc</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modExpStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="n">modExpStr</span> <span class="o">=</span> <span class="n">modExpStr</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modExpStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">modExpStr</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()[(</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">:(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">]</span>
                
        <span class="c1"># finally add time lines</span>
        <span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="n">sCentisec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
        <span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="n">eCentisec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
        <span class="n">ibdtt</span> <span class="o">=</span> <span class="n">sMonth</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sDay</span>
        <span class="n">ibhmt</span> <span class="o">=</span> <span class="n">sHour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sMin</span>
        <span class="n">ibcst</span> <span class="o">=</span> <span class="n">sSec</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sCentisec</span>
        <span class="n">iedtt</span> <span class="o">=</span> <span class="n">eMonth</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eDay</span>
        <span class="n">iehmt</span> <span class="o">=</span> <span class="n">eHour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eMin</span>
        <span class="n">iecst</span> <span class="o">=</span> <span class="n">eSec</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eCentisec</span>
        
        <span class="n">sYearStr</span> <span class="o">=</span> <span class="n">byearTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">sYear</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sYearStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sYearStr</span><span class="p">))</span>
        <span class="n">sMDStr</span> <span class="o">=</span> <span class="n">bmdTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibdtt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sMDStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sMDStr</span><span class="p">))</span>
        <span class="n">sHMStr</span> <span class="o">=</span> <span class="n">bhmTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibhmt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sHMStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sHMStr</span><span class="p">))</span>
        <span class="n">sCSStr</span> <span class="o">=</span> <span class="n">bcsTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibcst</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sCSStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sCSStr</span><span class="p">))</span>
        
        <span class="n">eYearStr</span> <span class="o">=</span> <span class="n">eyearTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">eYear</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eYearStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eYearStr</span><span class="p">))</span>
        <span class="n">eMDStr</span> <span class="o">=</span> <span class="n">emdTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iedtt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eMDStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eMDStr</span><span class="p">))</span>
        <span class="n">eHMStr</span> <span class="o">=</span> <span class="n">ehmTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iehmt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eHMStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eHMStr</span><span class="p">))</span>
        <span class="n">eCSStr</span> <span class="o">=</span> <span class="n">ecsTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iecst</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eCSStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eCSStr</span><span class="p">))</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">9</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">80</span>
        
        <span class="k">return</span><span class="p">(</span><span class="n">textArr</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">_parseExpNotesLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expNotesLines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_parseExpNotesLines populates all attributes in MadrigalCatalogRecord</span>
<span class="sd">        from text from metadata table &quot;Experiment Notes&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Len of expNotesLines must be divisible by 80, len </span><span class="si">%i</span><span class="s1"> is not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># init to empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modexpDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modexp</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="c1"># default times</span>
        <span class="n">bsec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bcsec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">esec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ecsec</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">expNotesLines</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">80</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">]</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># blank line</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;KRECC&#39;</span><span class="p">:</span>
                <span class="c1"># ignore</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;KINSTE&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;MODEXP&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setModexp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setModexp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setModexpDesc</span><span class="p">(</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">:]))</span>
                    
            <span class="c1"># start time</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBYRE&#39;</span><span class="p">:</span>
                <span class="n">byear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBDTE&#39;</span><span class="p">:</span>
                <span class="n">ibdte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">bmonth</span> <span class="o">=</span> <span class="n">ibdte</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">bday</span> <span class="o">=</span> <span class="n">ibdte</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBHME&#39;</span><span class="p">:</span>
                <span class="n">ibhme</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">bhour</span> <span class="o">=</span> <span class="n">ibhme</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">bmin</span> <span class="o">=</span> <span class="n">ibhme</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBCSE&#39;</span><span class="p">:</span>
                <span class="n">ibcse</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">bsec</span> <span class="o">=</span> <span class="n">ibcse</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">bcsec</span> <span class="o">=</span> <span class="n">ibcse</span> <span class="o">%</span> <span class="mi">100</span>
                
            <span class="c1"># end time</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IEYRE&#39;</span><span class="p">:</span>
                <span class="n">eyear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IEDTE&#39;</span><span class="p">:</span>
                <span class="n">iedte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">emonth</span> <span class="o">=</span> <span class="n">iedte</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">eday</span> <span class="o">=</span> <span class="n">iedte</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IEHME&#39;</span><span class="p">:</span>
                <span class="n">iehme</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">ehour</span> <span class="o">=</span> <span class="n">iehme</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">emin</span> <span class="o">=</span> <span class="n">iehme</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IECSE&#39;</span><span class="p">:</span>
                <span class="n">iecse</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">esec</span> <span class="o">=</span> <span class="n">iecse</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">ecsec</span> <span class="o">=</span> <span class="n">iecse</span> <span class="o">%</span> <span class="mi">100</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
                    
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># set times</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">byear</span><span class="p">,</span> <span class="n">bmonth</span><span class="p">,</span> <span class="n">bday</span><span class="p">,</span> <span class="n">bhour</span><span class="p">,</span> <span class="n">bmin</span><span class="p">,</span> <span class="n">bsec</span><span class="p">,</span> <span class="n">bcsec</span><span class="p">,</span> 
                              <span class="n">eyear</span><span class="p">,</span> <span class="n">emonth</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">ehour</span><span class="p">,</span> <span class="n">emin</span><span class="p">,</span> <span class="n">esec</span><span class="p">,</span> <span class="n">ecsec</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
        
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns a string representation of a MadrigalCatalogRecord &quot;&quot;&quot;</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;Catalog Record:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;kinst = </span><span class="si">%i</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;modexp = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_modexp</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;record start: </span><span class="si">%04i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">.</span><span class="si">%02i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;record end:   </span><span class="si">%04i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">.</span><span class="si">%02i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">):</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">80</span><span class="p">])</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">cmpDataRec</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;cmpDataRec returns a tuple of:</span>
<span class="sd">            1. 0 if catalog, 1 if header, 2 if data</span>
<span class="sd">            2.  start datetime</span>
<span class="sd">            3.  end datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># compare record start times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="n">typeEnum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thisType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dataType</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">thisType</span> <span class="o">==</span> <span class="n">dataType</span><span class="p">:</span>
                <span class="n">typeEnum</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
            
        <span class="c1"># compare record stop times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="k">return</span><span class="p">((</span><span class="n">typeEnum</span><span class="p">,</span> <span class="n">sDT</span><span class="p">,</span> <span class="n">eDT</span><span class="p">))</span>

    

<span class="k">class</span> <span class="nc">MadrigalHeaderRecord</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;MadrigalHeaderRecord holds all the information in a Cedar header record.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kinst</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">kindat</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sYear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sMonth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sDay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sHour</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sSec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sCentisec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">eYear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eMonth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eDay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">eHour</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eSec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eCentisec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">jpar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mpar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">text</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">madInstObj</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">madKindatObj</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">expNotesLines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__init__ creates a MadrigalCatalogRecord.</span>
<span class="sd">        </span>
<span class="sd">        Note: all inputs have default values because there are two ways to populate this structure:</span>
<span class="sd">        1) with all inputs from kinst to text when new data is being created, or </span>
<span class="sd">        2) with catalog line list from existing Hdf5 file Experiment Notes metadata, plus non-default inputs</span>

<span class="sd">        Inputs:</span>

<span class="sd">            kinst - the kind of instrument code.  A warning will be raised if not in instTab.txt.</span>

<span class="sd">            kindat - kind of data code. Must be a non-negative integer.</span>

<span class="sd">            sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - experiment start time. sCentisec must be 0-99</span>

<span class="sd">            eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - experiment end time. eCentisec must be 0-99</span>

<span class="sd">            jpar - the number of 1d parameters in the following data records</span>

<span class="sd">            mpar - the number of 2d parameters in the following data records</span>

<span class="sd">            text - string containing text in catalog record.  Length must be divisible by 80.  No linefeeds</span>
<span class="sd">                   allowed.</span>

<span class="sd">            madInstObj - a madrigal.metadata.MadrigalInstrument object.  If None, one will be created.</span>
<span class="sd">                              Used to verify kinst.</span>
<span class="sd">                              </span>
<span class="sd">            madKindatObj - a madrigal.metadata.MadrigalKindat onject. If none, one will be created.</span>
<span class="sd">                            Used to verify kindat.</span>
<span class="sd">                              </span>
<span class="sd">            expNotesList - a list of all lines in an existing header section in &quot;Experiment Notes&quot; </span>
<span class="sd">                metadata table.  All the above attributes are parsed from these lines.</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create any needed Madrigal objects, if not passed in</span>
        <span class="k">if</span> <span class="n">madInstObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalInstrument</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madInstObj</span>
        <span class="k">if</span> <span class="n">madKindatObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalKindat</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span> <span class="o">=</span> <span class="n">madKindatObj</span>
            
        <span class="k">if</span> <span class="n">expNotesLines</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get all information from this dataset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parseExpNotesLines</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kinst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># kinst set via header record overrides kinst argument</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
        <span class="c1"># verify kinst set, or raise error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kinst not set when MadrigalHeaderRecord created - required&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kindat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># kindat set via header record overrides kindat argument</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getKindat</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setKindat</span><span class="p">(</span><span class="n">kindat</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                              <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">jpar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setJpar</span><span class="p">(</span><span class="n">jpar</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mpar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMpar</span><span class="p">(</span><span class="n">mpar</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        
    <span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the type &#39;header&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;header&#39;</span>


    

    <span class="k">def</span> <span class="nf">getKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKinst returns the kind of instrument code (int) for a given header record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the kind of instrument code (int) for a given header record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">setKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kinst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setKinst sets the kind of instrument code (int) for a given header record.</span>

<span class="sd">        Inputs: kind of instrument code (integer)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets the kind of instrument code (int) (self._kinst) for a given header record.</span>
<span class="sd">        Prints warning if kinst not found in instTab.txt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kinst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
        <span class="c1"># verify  and set kinst</span>
        <span class="n">instList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentList</span><span class="p">()</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">kinst</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="s1">&#39;Unknown instrument&#39;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: kinst </span><span class="si">%i</span><span class="s1"> not found in instTab.txt</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kinst</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span> <span class="o">=</span> <span class="n">kinst</span>


    <span class="k">def</span> <span class="nf">getKindat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKindat returns the kind of data code (int) for a given header record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the kind of data code (int) for a given header record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">setKindat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kindat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setKindat sets the mode of kind of data code (int) for a given header record.</span>

<span class="sd">        Inputs: the kind of data code (int)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets the kind of data code (int) (self._kindat)</span>

<span class="sd">        Exceptions: Raises ValueError if kindat less than 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kindat</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kindat must not be less than 0, not </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getText returns the header text.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the header text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getTextLineCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getTextLineCount returns the number of 80 character lines in self._text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)))</span>
    

    <span class="k">def</span> <span class="nf">setText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setText sets the header text.</span>

<span class="sd">        Inputs: text: text to be set.  Must be length divisible by 80, and not contain line feeds.</span>
<span class="sd">        For now, must not exceed 2^16 - 80 bytes to be able to be handled by Cedar format.</span>

<span class="sd">        Outputs: None.</span>

<span class="sd">        Affects: sets self._text</span>

<span class="sd">        Raises TypeError if problem with text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">textTypes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">textTypes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text must be of type string&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text length must be divisible by 80: len is </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text must not contain linefeed character&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">65536</span> <span class="o">-</span> <span class="mi">80</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text exceeds ability of Cedar format to store&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">text</span>


    <span class="k">def</span> <span class="nf">getJpar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns the number of one-dimensional parameters in the associated data records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jpar</span>


    <span class="k">def</span> <span class="nf">setJpar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jpar</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set the number of one-dimensional parameters in the associated data records.</span>

<span class="sd">        Must not be negative.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jpar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">jpar</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jpar</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;jpar must not be less than 0&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getMpar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns the number of two-dimensional parameters in the associated data records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpar</span>
        

    <span class="k">def</span> <span class="nf">setMpar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mpar</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set the number of two-dimensional parameters in the associated data records.</span>

<span class="sd">        Must not be negative.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mpar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mpar</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpar</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;mpar must not be less than 0&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getStartTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStartTimeList returns a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">getEndTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getEndTimeList returns a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span><span class="p">))</span>
        
        
    <span class="k">def</span> <span class="nf">getLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getLines returns a numpy recarray of the format expected by the &quot;Experiment Notes&quot; dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># templates</span>
        <span class="n">krechStr</span> <span class="o">=</span> <span class="s1">&#39;KRECH               3002 Header Record, Version 3&#39;</span>
        <span class="n">kinstTempStr</span> <span class="o">=</span> <span class="s1">&#39;KINST     </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="n">kindatTempStr</span> <span class="o">=</span> <span class="s1">&#39;KINDAT    </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="n">byearTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBYRT               </span><span class="si">%04i</span><span class="s1"> Beginning year&#39;</span>
        <span class="n">bmdTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBDTT               </span><span class="si">%04i</span><span class="s1"> Beginning month and day&#39;</span>
        <span class="n">bhmTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBHMT               </span><span class="si">%04i</span><span class="s1"> Beginning UT hour and minute&#39;</span>
        <span class="n">bcsTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBCST               </span><span class="si">%04i</span><span class="s1"> Beginning centisecond&#39;</span>
        <span class="n">eyearTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEYRT               </span><span class="si">%04i</span><span class="s1"> Ending year&#39;</span>
        <span class="n">emdTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEDTT               </span><span class="si">%04i</span><span class="s1"> Ending month and day&#39;</span>
        <span class="n">ehmTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEHMT               </span><span class="si">%04i</span><span class="s1"> Ending UT hour and minute&#39;</span>
        <span class="n">ecsTempStr</span> <span class="o">=</span> <span class="s1">&#39;IECST               </span><span class="si">%04i</span><span class="s1"> Ending centisecond&#39;</span>
        
        <span class="n">numLines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTextLineCount</span><span class="p">()</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="c1"># 8 times lines, KRECH, KINST, KINDAT, and final blank</span>
        <span class="n">textArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="n">numLines</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;File Notes&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">))])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numLines</span><span class="o">-</span><span class="mi">9</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">krechStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">krechStr</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">kinstName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">())</span>
                <span class="n">kinstStr</span> <span class="o">=</span> <span class="n">kinstTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">(),</span> <span class="n">kinstName</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="n">kinstStr</span> <span class="o">=</span> <span class="n">kinstStr</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinstStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstStr</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">kindatStr</span> <span class="o">=</span> <span class="n">kindatTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKindat</span><span class="p">(),</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="o">.</span><span class="n">getKindatDescription</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKindat</span><span class="p">(),</span>
                                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="n">kindatStr</span> <span class="o">=</span> <span class="n">kindatStr</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kindatStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatStr</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()[(</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">:(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">]</span>
                
        <span class="c1"># finally add time lines</span>
        <span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="n">sCentisec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
        <span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="n">eCentisec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
        <span class="n">ibdtt</span> <span class="o">=</span> <span class="n">sMonth</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sDay</span>
        <span class="n">ibhmt</span> <span class="o">=</span> <span class="n">sHour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sMin</span>
        <span class="n">ibcst</span> <span class="o">=</span> <span class="n">sSec</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sCentisec</span>
        <span class="n">iedtt</span> <span class="o">=</span> <span class="n">eMonth</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eDay</span>
        <span class="n">iehmt</span> <span class="o">=</span> <span class="n">eHour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eMin</span>
        <span class="n">iecst</span> <span class="o">=</span> <span class="n">eSec</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eCentisec</span>
        
        <span class="n">sYearStr</span> <span class="o">=</span> <span class="n">byearTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">sYear</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sYearStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sYearStr</span><span class="p">))</span>
        <span class="n">sMDStr</span> <span class="o">=</span> <span class="n">bmdTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibdtt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sMDStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sMDStr</span><span class="p">))</span>
        <span class="n">sHMStr</span> <span class="o">=</span> <span class="n">bhmTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibhmt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sHMStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sHMStr</span><span class="p">))</span>
        <span class="n">sCSStr</span> <span class="o">=</span> <span class="n">bcsTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibcst</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sCSStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sCSStr</span><span class="p">))</span>
        
        <span class="n">eYearStr</span> <span class="o">=</span> <span class="n">eyearTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">eYear</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eYearStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eYearStr</span><span class="p">))</span>
        <span class="n">eMDStr</span> <span class="o">=</span> <span class="n">emdTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iedtt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eMDStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eMDStr</span><span class="p">))</span>
        <span class="n">eHMStr</span> <span class="o">=</span> <span class="n">ehmTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iehmt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eHMStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eHMStr</span><span class="p">))</span>
        <span class="n">eCSStr</span> <span class="o">=</span> <span class="n">ecsTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iecst</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eCSStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eCSStr</span><span class="p">))</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">9</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">80</span>
        
        <span class="k">return</span><span class="p">(</span><span class="n">textArr</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="nf">setTimeLists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                     <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setTimeList resets start and end times</span>

<span class="sd">        Inputs:</span>

<span class="sd">            sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - experiment start time. sCentisec must be 0-99</span>

<span class="sd">            eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - experiment end time. eCentisec must be 0-99</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets all time attributes (see code).</span>

<span class="sd">        Exceptions: Raises ValueError if startTime &gt; endTime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># verify times</span>
        <span class="n">sTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">eTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">eTime</span> <span class="o">&lt;</span> <span class="n">sTime</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Starting time cannot be after ending time&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_sTime</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMadrigalUTFromDT</span><span class="p">(</span><span class="n">sTime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eTime</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMadrigalUTFromDT</span><span class="p">(</span><span class="n">eTime</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span> <span class="o">=</span> <span class="n">sYear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span> <span class="o">=</span> <span class="n">sMonth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span> <span class="o">=</span> <span class="n">sDay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span> <span class="o">=</span> <span class="n">sHour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span> <span class="o">=</span> <span class="n">sMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span> <span class="o">=</span> <span class="n">sSec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span> <span class="o">=</span> <span class="n">sCentisec</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span> <span class="o">=</span> <span class="n">eYear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span> <span class="o">=</span> <span class="n">eMonth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span> <span class="o">=</span> <span class="n">eDay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span> <span class="o">=</span> <span class="n">eHour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span> <span class="o">=</span> <span class="n">eMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span> <span class="o">=</span> <span class="n">eSec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span> <span class="o">=</span> <span class="n">eCentisec</span>
        
        
    <span class="k">def</span> <span class="nf">_parseExpNotesLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expNotesLines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_parseExpNotesLines populates all attributes in MadrigalHeaderRecord</span>
<span class="sd">        from text from metadata table &quot;Experiment Notes&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Len of expNotesLines must be divisible by 80, len </span><span class="si">%i</span><span class="s1"> is not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># init to empty</span>
        
        <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="c1"># default times</span>
        <span class="n">byear</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># to verify lines found</span>
        <span class="n">addItem</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># check for the case where there is a addition item in front of date field</span>
        <span class="n">bsec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bcsec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">esec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ecsec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">expNotesLines</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">80</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">]</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># blank line</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;KRECH&#39;</span><span class="p">:</span>
                <span class="c1"># ignore</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;KINST&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;KINDAT&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setKindat</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setKindat</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setKindat</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    
            <span class="c1"># start time</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBYRT&#39;</span><span class="p">:</span>
                <span class="n">byear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">byear</span> <span class="o">&lt;</span> <span class="mi">1950</span><span class="p">:</span>
                    <span class="c1"># wrong column parsed</span>
                    <span class="n">addItem</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">byear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
                
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;IBDTT&#39;</span><span class="p">,</span> <span class="s1">&#39;IBDT&#39;</span><span class="p">):</span>
                <span class="n">ibdte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
                <span class="n">bmonth</span> <span class="o">=</span> <span class="n">ibdte</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">bday</span> <span class="o">=</span> <span class="n">ibdte</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBHMT&#39;</span><span class="p">:</span>
                <span class="n">ibhme</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
                <span class="n">bhour</span> <span class="o">=</span> <span class="n">ibhme</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">bmin</span> <span class="o">=</span> <span class="n">ibhme</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBCST&#39;</span><span class="p">:</span>
                <span class="n">ibcse</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">]))</span>
                <span class="n">bsec</span> <span class="o">=</span> <span class="n">ibcse</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">bcsec</span> <span class="o">=</span> <span class="n">ibcse</span> <span class="o">%</span> <span class="mi">100</span>
                
            <span class="c1"># end time</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IEYRT&#39;</span><span class="p">:</span>
                <span class="n">eyear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;IEDTT&#39;</span><span class="p">,</span> <span class="s1">&#39;IEDT&#39;</span><span class="p">):</span>
                <span class="n">iedte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
                <span class="n">emonth</span> <span class="o">=</span> <span class="n">iedte</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">eday</span> <span class="o">=</span> <span class="n">iedte</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IEHMT&#39;</span><span class="p">:</span>
                <span class="n">iehme</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
                <span class="n">ehour</span> <span class="o">=</span> <span class="n">iehme</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">emin</span> <span class="o">=</span> <span class="n">iehme</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IECST&#39;</span><span class="p">:</span>
                <span class="n">iecse</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">]))</span>
                <span class="n">esec</span> <span class="o">=</span> <span class="n">iecse</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">ecsec</span> <span class="o">=</span> <span class="n">iecse</span> <span class="o">%</span> <span class="mi">100</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
                    
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># set times</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">byear</span><span class="p">,</span> <span class="n">bmonth</span><span class="p">,</span> <span class="n">bday</span><span class="p">,</span> <span class="n">bhour</span><span class="p">,</span> <span class="n">bmin</span><span class="p">,</span> <span class="n">bsec</span><span class="p">,</span> <span class="n">bcsec</span><span class="p">,</span> 
                              <span class="n">eyear</span><span class="p">,</span> <span class="n">emonth</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">ehour</span><span class="p">,</span> <span class="n">emin</span><span class="p">,</span> <span class="n">esec</span><span class="p">,</span> <span class="n">ecsec</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
    
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns a string representation of a MadrigalHeaderRecord &quot;&quot;&quot;</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;Header Record:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;kinst = </span><span class="si">%i</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;kindat = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;record start: </span><span class="si">%04i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">.</span><span class="si">%02i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;record end:   </span><span class="si">%04i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">.</span><span class="si">%02i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span><span class="p">)</span>
        
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;jpar = </span><span class="si">%i</span><span class="s1">, mpar = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpar</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">):</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">80</span><span class="p">])</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">cmpDataRec</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;cmpDataRec returns a tuple of:</span>
<span class="sd">            1. 0 if catalog, 1 if header, 2 if data</span>
<span class="sd">            2.  start datetime</span>
<span class="sd">            3.  end datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># compare record start times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="n">typeEnum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thisType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dataType</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">thisType</span> <span class="o">==</span> <span class="n">dataType</span><span class="p">:</span>
                <span class="n">typeEnum</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
            
        <span class="c1"># compare record stop times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="k">return</span><span class="p">((</span><span class="n">typeEnum</span><span class="p">,</span> <span class="n">sDT</span><span class="p">,</span> <span class="n">eDT</span><span class="p">))</span>



<span class="k">class</span> <span class="nc">CatalogHeaderCreator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;CatalogHeaderCreator is a class that automates the creation of catalog and header records</span>
<span class="sd">    </span>
<span class="sd">    This class creates and adds catalog and header records that meet the Cedar standards.  It does this </span>
<span class="sd">    by examining the input Cedar file for all summary information possible.  The user needs only </span>
<span class="sd">    add text that describes their experiment.  A Cedar file must already be written to disk before</span>
<span class="sd">    this class is created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">madFilename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__init__ reads in all summary information about madFilename using madrigal.data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madFilename</span> <span class="o">=</span> <span class="n">madFilename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madFilename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span> <span class="o">=</span> <span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">madFilename</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># parse small part of file into MadrigalCedarFile object</span>
        <span class="c1"># create default header and catalog records</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span> <span class="o">=</span> <span class="mi">80</span>
        
        
    <span class="k">def</span> <span class="nf">createCatalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">principleInvestigator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">expPurpose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">expMode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">cycleTime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">correlativeExp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">sciRemarks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">instRemarks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;createCatalog will create a catalog record appropriate for this file.  The additional</span>
<span class="sd">        information fields are all optional, and are all simple text strings (except for</span>
<span class="sd">        cycleTime, which is in minutes).  If the text contains line feeds, those will be used </span>
<span class="sd">        as line breaks in the catalog record.</span>
<span class="sd">        </span>
<span class="sd">        The descriptions of these fields all come from Barbara Emery&#39;s documentation</span>
<span class="sd">        cedarFormat.pdf</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            principleInvestigator - Names of responsible Principal Investigator(s) or others knowledgeable </span>
<span class="sd">                                    about the experiment.</span>
<span class="sd">            </span>
<span class="sd">            expPurpose - Brief description of the experiment purpose</span>
<span class="sd">            </span>
<span class="sd">            expMode - Further elaboration of meaning of MODEXP; e.g. antenna patterns and </span>
<span class="sd">                      pulse sequences.</span>
<span class="sd">                      </span>
<span class="sd">            cycleTime - Minutes for one full measurement cycle</span>
<span class="sd">            </span>
<span class="sd">            correlativeExp - Correlative experiments (experiments with related data)</span>
<span class="sd">            </span>
<span class="sd">            sciRemarks - scientific remarks</span>
<span class="sd">            </span>
<span class="sd">            instRemarks - instrument remarks</span>
<span class="sd">            </span>
<span class="sd">        Returns: None</span>
<span class="sd">        </span>
<span class="sd">        Affects: sets self._catalog</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># the first step is to create the text part</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="c1"># start with parameter summary lines</span>
        <span class="k">if</span> <span class="n">cycleTime</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;TIMCY  </span><span class="si">%9i</span><span class="s1"> minutes&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cycleTime</span><span class="p">))</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createMaxMinSummaryLines</span><span class="p">()</span>
        
        <span class="c1"># add the time lines</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCatalogTimeSection</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># then add any text from input arguments</span>
        <span class="k">if</span> <span class="n">expMode</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CMODEXP &#39;</span><span class="p">,</span> <span class="n">expMode</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">expPurpose</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CPURP   &#39;</span><span class="p">,</span> <span class="n">expPurpose</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">correlativeExp</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CCOREXP &#39;</span><span class="p">,</span> <span class="n">correlativeExp</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">sciRemarks</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CSREM   &#39;</span><span class="p">,</span> <span class="n">sciRemarks</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">instRemarks</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CIREM   &#39;</span><span class="p">,</span> <span class="n">instRemarks</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">principleInvestigator</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CPI     &#39;</span><span class="p">,</span> <span class="n">principleInvestigator</span><span class="p">)</span>
            
        <span class="c1"># get some other metadata</span>
        <span class="n">kinst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">modexp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getKindatList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getEarliestTime</span><span class="p">()</span>
        <span class="n">sCentisec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getLatestTime</span><span class="p">()</span>
        <span class="n">eCentisec</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1"># now create the catalog record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span> <span class="o">=</span> <span class="n">MadrigalCatalogRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span> <span class="n">modexp</span><span class="p">,</span>
                                              <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                                              <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">,</span>
                                              <span class="n">text</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">createHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kindatDesc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">analyst</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">comments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;createHeader will create a header record appropriate for this file.  The additional</span>
<span class="sd">        information fields are all optional, and are all simple text strings.  If the text contains l</span>
<span class="sd">        ine feeds, those will be used as line breaks in the header record.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            kindatDesc - description of how this data was analyzed (the kind of data)</span>
<span class="sd">            </span>
<span class="sd">            analyst - name of person who analyzed this data</span>
<span class="sd">            </span>
<span class="sd">            comments - additional comments about data (describe any instrument-specific parameters) </span>
<span class="sd">            </span>
<span class="sd">            history - a description of the history of the processing of this file</span>
<span class="sd">            </span>
<span class="sd">        Returns: None</span>
<span class="sd">        </span>
<span class="sd">        Affects: sets self._header</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># the first step is to create the text part</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="k">if</span> <span class="n">kindatDesc</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CKINDAT&#39;</span><span class="p">,</span> <span class="n">kindatDesc</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">history</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CHIST  &#39;</span><span class="p">,</span> <span class="n">history</span><span class="p">)</span>
            
        <span class="c1"># add the time lines</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createHeaderTimeSection</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># add the KOD linesfrom the last record of file (must be data record)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getHeaderKodLines</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">comments</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;C      &#39;</span><span class="p">,</span> <span class="n">comments</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">analyst</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CANALYST&#39;</span><span class="p">,</span> <span class="n">analyst</span><span class="p">)</span>
            
        <span class="c1"># last - time of analysis line</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="n">nowStr</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1"> %b </span><span class="si">%d</span><span class="s1"> %H:%M:%S %Y&#39;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;CANDATE  </span><span class="si">%s</span><span class="s1"> UT&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nowStr</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
        
        <span class="c1"># get some other metadata</span>
        <span class="n">kinst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kindat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getKindatList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getEarliestTime</span><span class="p">()</span>
        <span class="n">sCentisec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getLatestTime</span><span class="p">()</span>
        <span class="n">eCentisec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">jpar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">())</span>
        <span class="n">mpar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">())</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">MadrigalHeaderRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span> <span class="n">kindat</span><span class="p">,</span>
                                            <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                                            <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">,</span>
                                            <span class="n">jpar</span><span class="p">,</span> <span class="n">mpar</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;write will output the new file with prepended catalog and header records</span>
<span class="sd">        </span>
<span class="sd">        Raises an IOError if no new catalog or header records to prepend</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            newFilename - if None, overwrite original file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Does not make sense to save a new file if no catalog or header has been added&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">newFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madFilename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madFilename</span><span class="p">,</span> <span class="n">newFilename</span><span class="p">)</span>
            
        <span class="c1"># open file for appening</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="o">.</span><span class="n">writeExperimentNotes</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        
        
        
    <span class="k">def</span> <span class="nf">_createCatalogTimeSection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createCatalogTimeSection will return all the lines in the catalog record that</span>
<span class="sd">        describe the start and end time of the data records.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Returns:  a tuple with three items 1) a string in the format of the time section of a</span>
<span class="sd">        catalog record, 2) earliest datetime, 3) latest datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">earliestStartTimeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getEarliestTime</span><span class="p">()</span>
        <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">earliestStartTimeList</span><span class="p">)</span>
        <span class="n">latestEndTimeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getLatestTime</span><span class="p">()</span>
        <span class="n">latestEndTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">latestEndTimeList</span><span class="p">)</span>

        <span class="n">sy</span> <span class="o">=</span> <span class="s1">&#39;IBYRE       </span><span class="si">%4s</span><span class="s1"> Beginning year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="s1">&#39;IBDTE       </span><span class="si">%4s</span><span class="s1"> Beginning month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                              <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="s1">&#39;IBHME       </span><span class="si">%4s</span><span class="s1"> Beginning UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                   <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;IBCSE       </span><span class="si">%4s</span><span class="s1"> Beginning centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>
        
        <span class="n">ey</span> <span class="o">=</span> <span class="s1">&#39;IEYRE       </span><span class="si">%4s</span><span class="s1"> Ending year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;IEDTE       </span><span class="si">%4s</span><span class="s1"> Ending month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                           <span class="n">latestEndTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">eh</span> <span class="o">=</span> <span class="s1">&#39;IEHME       </span><span class="si">%4s</span><span class="s1"> Ending UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                <span class="n">latestEndTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">latestEndTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">es</span> <span class="o">=</span> <span class="s1">&#39;IECSE       </span><span class="si">%4s</span><span class="s1"> Ending centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>

        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sy</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ss</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ey</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ey</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ed</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ed</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">eh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">eh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">es</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>

        <span class="k">return</span><span class="p">((</span><span class="n">retStr</span><span class="p">,</span> <span class="n">earliestStartTime</span><span class="p">,</span> <span class="n">latestEndTime</span><span class="p">))</span>
    
    
    <span class="k">def</span> <span class="nf">_createHeaderTimeSection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataRecList</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createHeaderTimeSection will return all the lines in the header record that</span>
<span class="sd">        describe the start and end time of the data records.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            dataRecList - if given, examine only those MadrigalDataRecords in dataRecList.</span>
<span class="sd">                          If None (the default), examine all MadrigalDataRecords in this</span>
<span class="sd">                          MadrigalCedarFile</span>

<span class="sd">        Returns:  a tuple with three items 1) a string in the format of the time section of a</span>
<span class="sd">        header record, 2) earliest datetime, 3) latest datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">earliestStartTimeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getEarliestTime</span><span class="p">()</span>
        <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">earliestStartTimeList</span><span class="p">)</span>
        <span class="n">latestEndTimeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getLatestTime</span><span class="p">()</span>
        <span class="n">latestEndTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">latestEndTimeList</span><span class="p">)</span>
                

        <span class="n">sy</span> <span class="o">=</span> <span class="s1">&#39;IBYRT               </span><span class="si">%4s</span><span class="s1"> Beginning year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="s1">&#39;IBDTT               </span><span class="si">%4s</span><span class="s1"> Beginning month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                              <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="s1">&#39;IBHMT               </span><span class="si">%4s</span><span class="s1"> Beginning UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                   <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;IBCST               </span><span class="si">%4s</span><span class="s1"> Beginning centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>
        
        <span class="n">ey</span> <span class="o">=</span> <span class="s1">&#39;IEYRT               </span><span class="si">%4s</span><span class="s1"> Ending year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;IEDTT               </span><span class="si">%4s</span><span class="s1"> Ending month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                           <span class="n">latestEndTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">eh</span> <span class="o">=</span> <span class="s1">&#39;IEHMT               </span><span class="si">%4s</span><span class="s1"> Ending UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                <span class="n">latestEndTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">latestEndTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">es</span> <span class="o">=</span> <span class="s1">&#39;IECST               </span><span class="si">%4s</span><span class="s1"> Ending centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>

        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sy</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ss</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ey</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ey</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ed</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ed</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">eh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">eh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">es</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>

        <span class="k">return</span><span class="p">((</span><span class="n">retStr</span><span class="p">,</span> <span class="n">earliestStartTime</span><span class="p">,</span> <span class="n">latestEndTime</span><span class="p">))</span>
        
        
    
    <span class="k">def</span> <span class="nf">_createMaxMinSummaryLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createMaxMinSummaryLines is a private method that creates the max and min summary </span>
<span class="sd">        lines (e.g., alt, gdlat, etc)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alt1</span> <span class="o">=</span> <span class="s1">&#39;ALT1 </span><span class="si">%11i</span><span class="s1"> km. Lowest altitude measured&#39;</span>
        <span class="n">alt2</span> <span class="o">=</span> <span class="s1">&#39;ALT2 </span><span class="si">%11i</span><span class="s1"> km. Highest altitude measured&#39;</span>
        <span class="n">lat1</span> <span class="o">=</span> <span class="s1">&#39;GGLAT1    </span><span class="si">%6i</span><span class="s1"> degrees. Lowest geographic latitude measured&#39;</span>
        <span class="n">lat2</span> <span class="o">=</span> <span class="s1">&#39;GGLAT2    </span><span class="si">%6i</span><span class="s1"> degrees. Highest geographic latitude measured&#39;</span>
        <span class="n">lon1</span> <span class="o">=</span> <span class="s1">&#39;GGLON1    </span><span class="si">%6i</span><span class="s1"> degrees. Westmost geographic longitude measured&#39;</span>
        <span class="n">lon2</span> <span class="o">=</span> <span class="s1">&#39;GGLON2    </span><span class="si">%6i</span><span class="s1"> degrees. Eastmost geographic longitude measured&#39;</span>
        <span class="n">pl1</span> <span class="o">=</span> <span class="s1">&#39;PL1  </span><span class="si">%11i</span><span class="s1"> Shortest radar pulse length&#39;</span>
        <span class="n">pl2</span> <span class="o">=</span> <span class="s1">&#39;PL2  </span><span class="si">%11i</span><span class="s1"> Longest radar pulse length&#39;</span>
        
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="n">minAlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMinValidAltitude</span><span class="p">()</span>
        <span class="n">maxAlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMaxValidAltitude</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">minAlt</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">minAlt</span> <span class="o">&lt;</span> <span class="mf">1E9</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">alt1</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minAlt</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">alt2</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">maxAlt</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            
        <span class="n">minLat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMinLatitude</span><span class="p">()</span>
        <span class="n">maxLat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMaxLatitude</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">minLat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">91</span> <span class="ow">and</span> <span class="n">minLat</span> <span class="o">&lt;</span> <span class="mi">91</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">lat1</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minLat</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">lat2</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">maxLat</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            
        <span class="n">minLon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMinLongitude</span><span class="p">()</span>
        <span class="n">maxLon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMaxLongitude</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">minLon</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">181</span> <span class="ow">and</span> <span class="n">minLon</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">lon1</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minLon</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">lon2</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">maxLon</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            
        <span class="n">minPl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMinPulseLength</span><span class="p">()</span>
        <span class="n">maxPl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMaxPulseLength</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">minPl</span> <span class="o">&gt;</span> <span class="mf">0.001</span> <span class="ow">and</span> <span class="n">minPl</span> <span class="o">&lt;</span> <span class="mf">10E9</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">pl1</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minPl</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">pl2</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">maxPl</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            
        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="nf">_createCedarLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createCedarLines is a private method that returns a string which is a multiple of </span>
<span class="sd">        80 characters (no line feeds) where each 80 character block starts with prefix,then a space, </span>
<span class="sd">        and then the next part of text that fits on line, padded with spaces</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lineLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Too long prefix </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">prefix</span><span class="p">)))</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="c1"># first check for line feeds</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="c1"># now split by words</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
                <span class="c1"># see if this word can fit on one line</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">lineLen</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Can not fit the word &lt;</span><span class="si">%s</span><span class="s1">&gt; in a Cedar text record&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="p">))</span>
                <span class="c1"># see if there&#39;s room for this word</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">lineLen</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span> <span class="o">%</span> <span class="n">lineLen</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span> <span class="o">%</span> <span class="n">lineLen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="n">lineLen</span><span class="p">)</span>
                    <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
                <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="p">)</span>
            <span class="c1"># at line break, we always pad</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="n">lineLen</span><span class="p">)</span>
            
        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_padStr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thisStr</span><span class="p">,</span> <span class="n">lineLen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_padStr is a private method that pads a string with spaces so its length is module lineLen</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spacesToPad</span> <span class="o">=</span> <span class="n">lineLen</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisStr</span><span class="p">)</span> <span class="o">%</span> <span class="n">lineLen</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spacesToPad</span> <span class="o">==</span> <span class="n">lineLen</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">thisStr</span><span class="p">)</span>
        <span class="n">thisStr</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">spacesToPad</span>
        <span class="k">return</span><span class="p">(</span><span class="n">thisStr</span><span class="p">)</span>
        


<span class="k">class</span> <span class="nc">CedarParameter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;CedarParameter is a class with attributes code, mnemonic, and description, and isInt&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">mnemonic</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">isInt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isInt</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">isInt</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%6i</span><span class="s1">: </span><span class="si">%20s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">, isInt=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isInt</span><span class="p">)))</span>
    
    
    
<span class="k">class</span> <span class="nc">convertToNetCDF4</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputHdf5</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;convertToNetCDF4 converts a Madrigal HDF5 file to netCDF4 using Array Layout</span>
<span class="sd">            rather than using Table Layout as cedar module does.  Can handle large Hdf5 file</span>
<span class="sd">            without large memory footprint, and is much faster than reading in using </span>
<span class="sd">            madrigal.cedar.MadrigalCedarFile</span>
<span class="sd">            </span>
<span class="sd">            Inputs:</span>
<span class="sd">                inputHdf5 - filename of input Madrigal Hdf5 file</span>
<span class="sd">                outputNC - output netCDF4 file</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">madParmObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalParameters</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;Array Layout&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50000000</span><span class="p">:</span>
                <span class="c1"># for smaller files we simply go through the slower full cedar conversion</span>
                <span class="n">cedarObj</span> <span class="o">=</span> <span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">)</span>
                <span class="n">cedarObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;netCDF4&#39;</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># file is to big to load into memory at once, read only 10 records at once at write to file</span>
                <span class="c1"># parm IndexDict is a dictionary with key = timestamps and ind spatial parm names,</span>
                <span class="c1"># value = dictionary of keys = unique values, value = index</span>
                <span class="c1"># temp only</span>
                <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">parmIndexDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getParmIndexDict</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">madCedarObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">madCedarObj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;netCDF4&#39;</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">)</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="mi">10</span>
                <span class="k">while</span> <span class="p">(</span><span class="kc">True</span><span class="p">):</span>
                    <span class="c1"># temp only</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> done so far in </span><span class="si">%f</span><span class="s1"> secs&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t</span><span class="p">))</span>
                    <span class="n">newRecs</span><span class="p">,</span> <span class="n">isComplete</span> <span class="o">=</span> <span class="n">madCedarObj</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">isComplete</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">madCedarObj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;netCDF4&#39;</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">newRecs</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">total</span> <span class="o">+=</span> <span class="n">newRecs</span>
                    
                <span class="c1"># compress</span>
                <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">outputNC</span><span class="p">)</span>
                <span class="c1"># tmp file name to use to run h5repack</span>
                <span class="n">tmpFile</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;_tmp&#39;</span> <span class="o">+</span> <span class="n">file_extension</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;h5repack -i </span><span class="si">%s</span><span class="s1"> -o </span><span class="si">%s</span><span class="s1"> --filter=GZIP=4&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">outputNC</span><span class="p">,</span> <span class="n">tmpFile</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                    <span class="k">return</span>
                
                <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">)</span>
                    
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">outputNC</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">catalog_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCatalogText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">header_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHeaderText</span><span class="p">()</span>
        
        <span class="c1"># write Experiment Parameters</span>
        <span class="n">experimentParameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Experiment Parameters&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">experimentParameters</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">experimentParameters</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
            <span class="c1"># make text acceptable attribute names</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(s)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">experimentParameters</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            
        <span class="n">indParmListOrg</span> <span class="o">=</span> <span class="p">[</span><span class="n">parm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Independent Spatial Parameters&#39;</span><span class="p">]]</span>
        <span class="n">indParmList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmListOrg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">indParmList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">indParmList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            
            
        <span class="c1"># split parms - if any</span>
        <span class="n">has_split</span> <span class="o">=</span> <span class="s1">&#39;Parameters Used to Split Array Data&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">arraySplittingMnemonics</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">has_split</span><span class="p">:</span>
            <span class="n">arraySplittingParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Parameters Used to Split Array Data&#39;</span><span class="p">]</span>
            <span class="n">arrSplitParmDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">)):</span>
                <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="n">arraySplittingMnemonic</span> <span class="o">=</span> <span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">arraySplittingMnemonic</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="n">arraySplittingMnemonic</span> <span class="o">=</span> <span class="n">arraySplittingMnemonic</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
                <span class="n">arraySplittingMnemonics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arraySplittingMnemonic</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">arraySplittingParms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39; -- &#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">parameters_used_to_split_data</span> <span class="o">=</span> <span class="n">arrSplitParmDesc</span>
            
        <span class="k">if</span> <span class="n">has_split</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">]]</span>
            
            
        <span class="c1"># loop through each split array (or just top level, if none</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nc_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">createGroup</span><span class="p">(</span><span class="n">nc_name</span><span class="p">)</span>
                <span class="n">hdf5Group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span>
                <span class="n">hdf5Group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">]</span>
                
            <span class="n">times</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">]</span>
                
            <span class="c1"># next step - create dimensions</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="c1"># first time dim</span>
            <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">))</span>
            <span class="n">timeVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,),</span>
                                               <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">timeVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Unix seconds&#39;</span>
            <span class="n">timeVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Number of seconds since UT midnight 1970-01-01&#39;</span>
            <span class="n">timeVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">times</span>
            <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">)</span>
            
            <span class="c1"># next ind parms, because works well with ncview that way</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">arraySplittingMnemonics</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                    <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">thisVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                    <span class="n">slen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">slen</span><span class="p">)</span>
                    <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">])):</span>
                        <span class="n">thisVar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">thisVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="n">thisVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                <span class="n">thisVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                
            
                
            <span class="c1"># get all one d data</span>
            <span class="n">oneDParms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">oneDParm</span> <span class="ow">in</span> <span class="n">oneDParms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="n">oneDParm</span> <span class="o">=</span> <span class="n">oneDParm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">oneDParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">oneDParm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arraySplittingMnemonics</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">oneDParm</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Data Parameters&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">):</span>
                    <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">):</span>
                    <span class="n">slen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">oneDParm</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">slen</span><span class="p">)</span>
                    <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">oneDVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">)</span>
                <span class="n">oneDVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">oneDVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">oneDParm</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">oneDVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">oneDParm</span><span class="p">][()]</span>
                
                
            <span class="c1"># get all two d data</span>
            <span class="n">twoDParms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">twoDParm</span> <span class="ow">in</span> <span class="n">twoDParms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="n">twoDParm</span> <span class="o">=</span> <span class="n">twoDParm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">twoDParm</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Data Parameters&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">twoDParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">twoDParm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arraySplittingMnemonics</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">):</span>
                    <span class="n">twoDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">):</span>
                    <span class="n">slen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">][</span><span class="n">twoDParm</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">slen</span><span class="p">)</span>
                    <span class="n">twoDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">twoDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">twoDVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span>
                <span class="n">twoDVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span>
                <span class="c1"># move the last dim in Hdf5 (time) to be the first now</span>
                <span class="n">reshape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)))</span>
                <span class="n">newShape</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">reshape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">][</span><span class="n">twoDParm</span><span class="p">],</span> <span class="n">newShape</span><span class="p">)</span>
                <span class="n">twoDVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
            
                
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        
    <span class="k">def</span> <span class="nf">getCatalogText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getCatalogText returns the catalog record text as a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Experiment Notes&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">return</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">]</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">substr</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Header information&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Header information&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">retStr</span> <span class="o">+=</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">retStr</span> <span class="o">+=</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getHeaderText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getHeaderText returns the header record text as a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Experiment Notes&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">return</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">]</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">headerFound</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">substr</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Header information&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">headerFound</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Header information&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">headerFound</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">headerFound</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">_getParmIndexDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_getParmIndexDict returns a dictionary with key = timestamps and ind spatial parm names,</span>
<span class="sd">            value = dictionary of keys = unique values, value = index of that value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">parmList</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">parm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Independent Spatial Parameters&#39;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">parmList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Table Layout&#39;</span><span class="p">][</span><span class="n">parm</span><span class="p">]</span>
            <span class="n">unique_values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">sorted_values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span>
            <span class="n">retDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">sorted_values</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">retDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retDict</span><span class="p">)</span>
            
        
    
    
    
<span class="k">class</span> <span class="nc">convertToText</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputHdf5</span><span class="p">,</span> <span class="n">outputTxt</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="n">showHeaders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">filterList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">assumed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">knownbad</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;convertToText converts a Madrigal HDF5 file to a text file. Designed to be able</span>
<span class="sd">        to handle large files without a large memory footprint</span>
<span class="sd">            </span>
<span class="sd">            Inputs:</span>
<span class="sd">                inputHdf5 - filename of input Madrigal Hdf5 file</span>
<span class="sd">                outputTxt - output text file</span>
<span class="sd">                summary - type of summary line to print at top.  Allowed values are:</span>
<span class="sd">                    &#39;plain&#39; - text only mnemonic names, but only if not showHeaders</span>
<span class="sd">                    &#39;html&#39; - mnemonic names wrapped in standard javascript code to allow descriptive popups</span>
<span class="sd">                    &#39;summary&#39; - print overview of file and filters used. Also text only mnemonic names, </span>
<span class="sd">                        but only if not showHeaders</span>
<span class="sd">                    None - no summary line</span>
<span class="sd">                    </span>
<span class="sd">                showHeaders - if True, print header in format for each record.  If False, the default,</span>
<span class="sd">                    do not.</span>
<span class="sd">                    </span>
<span class="sd">                filterList - a list of madrigal.derivation.MadrigalFilter objects to be described in the </span>
<span class="sd">                    summary.  Default is None, in which case not described in summary.  Ignored if summary</span>
<span class="sd">                    is not &#39;summary&#39;</span>
<span class="sd">                    </span>
<span class="sd">                missing, assumed, knownbad - how to print Cedar special values.  Default is None for</span>
<span class="sd">                    all, so that value printed in value in numpy table as per spec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">madCedarObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">madCedarObj</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="n">outputTxt</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span> <span class="n">showHeaders</span><span class="o">=</span><span class="n">showHeaders</span><span class="p">,</span> <span class="n">filterList</span><span class="o">=</span><span class="n">filterList</span><span class="p">,</span>
                              <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span> <span class="n">assumed</span><span class="o">=</span><span class="n">assumed</span><span class="p">,</span> <span class="n">knownbad</span><span class="o">=</span><span class="n">knownbad</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">firstWrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">while</span> <span class="p">(</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">newRecs</span><span class="p">,</span> <span class="n">isComplete</span> <span class="o">=</span> <span class="n">madCedarObj</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newRecs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">madCedarObj</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="n">outputTxt</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span> <span class="n">showHeaders</span><span class="o">=</span><span class="n">showHeaders</span><span class="p">,</span>
                                  <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span> <span class="n">assumed</span><span class="o">=</span><span class="n">assumed</span><span class="p">,</span> <span class="n">knownbad</span><span class="o">=</span><span class="n">knownbad</span><span class="p">,</span> 
                                  <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">firstWrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">isComplete</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">newRecs</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">break</span>
            
            
            
<span class="k">class</span> <span class="nc">mergeCedarFiles</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input1Hdf5</span><span class="p">,</span> <span class="n">input2Hdf5</span><span class="p">,</span> <span class="n">outputHdf5</span><span class="p">,</span> <span class="n">includeDuplicate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skipArray</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;mergeCedarFiles creates a new CEDAR Madrigal File by combining two CEDAR Madrigal input files.</span>
<span class="sd">        Records are merged in time.  Both files must have the same parameters.  Header and Catalog text from the</span>
<span class="sd">        first of the two files.</span>
<span class="sd">            </span>
<span class="sd">            Inputs:</span>
<span class="sd">                input1Hdf5 - filename of first input Madrigal Hdf5 file (header and catalog used for output file)</span>
<span class="sd">                input2Hdf5 - filename of second input Madrigal Hdf5 file (header and catalog ignored)</span>
<span class="sd">                outputHdf5 - output combined Hdf5 file, records sorted in time</span>
<span class="sd">                includeDuplicate - if False (the default), print message when two records have duplicate start and end</span>
<span class="sd">                    times and ignore one in input2Hdf5.  If True, include both (first input1Hdf5, then input2Hdf5)</span>
<span class="sd">                skipArray - if False and any 2D parms, create array layout (the default).  If True, skip array</span>
<span class="sd">                    layout (typically used when there are too many ind parm value combinations).</span>
<span class="sd">                    </span>
<span class="sd">        Reduces memory footprint using dump</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input1</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">input1Hdf5</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">arraySplitParms</span> <span class="o">=</span> <span class="n">input1</span><span class="o">.</span><span class="n">getArraySplitParms</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">arraySplitParms</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">arraySplitParms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">input2</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">input2Hdf5</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">outputHdf5</span><span class="p">,</span> <span class="n">createFlag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">arraySplitParms</span><span class="o">=</span><span class="n">arraySplitParms</span><span class="p">,</span>
                                                  <span class="n">skipArray</span><span class="o">=</span><span class="n">skipArray</span><span class="p">)</span>
        
        <span class="n">rec1</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># index into input1</span>
        <span class="n">rec2</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># index into input2</span>
        <span class="n">complete1</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">complete2</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">outputCount</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># used for</span>
        
        <span class="k">while</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
            <span class="c1"># see if we need to dump output</span>
            <span class="k">if</span> <span class="n">outputCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">outputCount</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
                
            <span class="c1"># see if we need to load any more data</span>
            
            <span class="k">if</span> <span class="n">rec1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input1</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">complete1</span><span class="p">:</span>
                <span class="c1"># try to load more</span>
                <span class="n">loaded</span><span class="p">,</span> <span class="n">complete1</span> <span class="o">=</span> <span class="n">input1</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">rec1</span> <span class="o">=</span> <span class="mi">0</span>
                    
            <span class="k">if</span> <span class="n">rec2</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input2</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">complete2</span><span class="p">:</span>
                <span class="c1"># try to load more</span>
                <span class="n">loaded</span><span class="p">,</span> <span class="n">complete2</span> <span class="o">=</span> <span class="n">input2</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">rec2</span> <span class="o">=</span> <span class="mi">0</span>
                    
            <span class="k">if</span> <span class="n">complete1</span> <span class="ow">and</span> <span class="n">complete2</span><span class="p">:</span>
                <span class="c1"># no more data</span>
                <span class="k">break</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">complete1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">]</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                    <span class="c1"># add catalog or header record</span>
                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                    <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">complete2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">]</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                    <span class="c1"># ignore catalog or header record</span>
                    <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
            
            <span class="c1"># add from remaining file if only one file left</span>
            <span class="k">if</span> <span class="n">complete1</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            
            <span class="k">if</span> <span class="n">complete2</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            
            <span class="c1"># now we know we have two data records - add earlier</span>
            <span class="n">sDT1</span> <span class="o">=</span> <span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">]</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
            <span class="n">sDT2</span> <span class="o">=</span> <span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">]</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
            <span class="n">eDT1</span> <span class="o">=</span> <span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">]</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
            <span class="n">eDT2</span> <span class="o">=</span> <span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">]</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">sDT1</span> <span class="o">&lt;</span> <span class="n">sDT2</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            
            <span class="k">elif</span> <span class="n">sDT1</span> <span class="o">&gt;</span> <span class="n">sDT2</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            
            <span class="k">elif</span> <span class="n">eDT1</span> <span class="o">&lt;</span> <span class="n">eDT2</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            
            <span class="k">elif</span> <span class="n">eDT1</span> <span class="o">&gt;</span> <span class="n">eDT2</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            
            <span class="c1"># times match - handle depending on includeDuplicate</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">includeDuplicate</span><span class="p">:</span>
                <span class="c1"># only take from first, throw away second</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ignoring record from </span><span class="si">%s</span><span class="s1"> with duplicate times </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">input2Hdf5</span><span class="p">,</span>
                                                                                <span class="nb">str</span><span class="p">(</span><span class="n">sDT2</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">eDT2</span><span class="p">)))</span>
                <span class="k">continue</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># add both</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">])</span>
                <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># not technically correct, but makes sure dump is not missed</span>
                
        <span class="k">if</span> <span class="n">outputCount</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
            
        <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                
            
            
            
            
            
            
            
    
    
    
<span class="k">class</span> <span class="nc">_TableSubset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;_TableSubset is a private class which defines a subset of a Table Layout created by</span>
<span class="sd">    one combination of array splitting parameter values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arraySplittingParms</span><span class="p">,</span>
                 <span class="n">arraySplittingValues</span><span class="p">,</span>
                 <span class="n">fullTable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;TableSubset creates a TableSubset based on input parameters</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            arraySplittingParms - ordered list of mnemonics used to split table</span>
<span class="sd">            </span>
<span class="sd">            arraySplittingValues - values used for this subset</span>
<span class="sd">            </span>
<span class="sd">            fullTable - the full table to take a subset of</span>
<span class="sd">            </span>
<span class="sd">        Creates attributes:</span>
<span class="sd">            self.arraySplittingParms - input parm</span>
<span class="sd">            self.arraySplittingValues - input parm</span>
<span class="sd">            self.table - table subset</span>
<span class="sd">            self.oneDIndices - a numpy int array of indicies of one D values (one index per time/record)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingValues</span> <span class="o">=</span> <span class="n">arraySplittingValues</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingParms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">arraySplittingParms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingParms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingParms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingParms</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingValues</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Two input list must have equal length, not </span><span class="si">%i</span><span class="s1"> and </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingParms</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingValues</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingParms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">fullTable</span>
            <span class="c1"># get oneDIndices</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]))</span>
            <span class="n">a2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oneDIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a1</span> <span class="o">!=</span> <span class="n">a2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oneDIndices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oneDIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span>
        
        <span class="n">indices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">trueArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">fullTable</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">falseArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">fullTable</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingParms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fullTable</span><span class="p">[</span><span class="n">arraySplittingParms</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">==</span><span class="n">arraySplittingValues</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">trueArr</span><span class="p">,</span> <span class="n">falseArr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">fullTable</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        
        <span class="c1"># I can only figure out how to get numpy to AND two conditions at once, so do this as a loop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingParms</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">fullTable</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">==</span><span class="n">arraySplittingValues</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                                                            <span class="n">fullTable</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">==</span><span class="n">arraySplittingValues</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                                          <span class="n">trueArr</span><span class="p">,</span> <span class="n">falseArr</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> 
                                                            <span class="n">fullTable</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">==</span><span class="n">arraySplittingValues</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                                          <span class="n">trueArr</span><span class="p">,</span> <span class="n">falseArr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">fullTable</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
            
        <span class="c1"># get oneDIndices</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]))</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oneDIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a1</span> <span class="o">!=</span> <span class="n">a2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oneDIndices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oneDIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># verify the number of records == number of times</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oneDIndices</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Number of times </span><span class="si">%i</span><span class="s1"> not equal to number of records </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">])),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oneDIndices</span><span class="p">)))</span>
        
            
    <span class="k">def</span> <span class="nf">getGroupName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getGroupName returns the group name in the form &lt;Array with parm=value [and ...]&gt;</span>
<span class="sd">        </span>
<span class="sd">        If no arraySplittingParms, returns None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arraySplittingParms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingParms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">arraySplittingParms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arraySplittingParms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">groupName</span> <span class="o">=</span> <span class="s1">&#39;Array with &#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">):</span>
            <span class="n">groupName</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingValues</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arraySplittingValues</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">groupName</span> <span class="o">+=</span> <span class="s1">&#39;and &#39;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">groupName</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">compareParms</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;compareParms is used internally by getHeaderKodLines to order the parameters</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - tuple of (code, parameter description, units) </span>


<span class="sd">        Returns float(absolute value of code) + 0.5 if less than zero.  Else returns float(code)</span>
<span class="sd">            which results in positive code coming before negative of same absolute value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">parm</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">parm</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
    
    

        
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">cedarObj</span> <span class="o">=</span> <span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="s1">&#39;/home/grail/brideout/madroot/experiments/1998/mlh/20jan98/mlh980120g.001&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;len of cedarObj is </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cedarObj</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cedarObj</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="n">cedarObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Madrigal&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/grail/brideout/junk.001&#39;</span><span class="p">)</span>

    <span class="n">newCedarObj</span> <span class="o">=</span> <span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="s1">&#39;/home/grail/brideout/madroot/experiments/1998/mlh/20jan98/mlh980120g.002&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">dataObj</span> <span class="o">=</span> <span class="n">MadrigalDataRecord</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span>
                 <span class="mi">1000</span><span class="p">,</span>
                 <span class="mi">2001</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
                 <span class="mi">2001</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span>
                 <span class="p">[</span><span class="s1">&#39;azm&#39;</span><span class="p">,</span> <span class="s1">&#39;elm&#39;</span><span class="p">,</span> <span class="s1">&#39;rgate&#39;</span><span class="p">],</span>
                 <span class="p">[</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="s1">&#39;ti&#39;</span><span class="p">,</span> <span class="s1">&#39;drange&#39;</span><span class="p">],</span>
                 <span class="mi">4</span><span class="p">)</span>

    <span class="n">dataObj</span><span class="o">.</span><span class="n">set1D</span><span class="p">(</span><span class="s1">&#39;azm&#39;</span><span class="p">,</span><span class="mf">45.0</span><span class="p">)</span>
    <span class="n">dataObj</span><span class="o">.</span><span class="n">set1D</span><span class="p">(</span><span class="s1">&#39;elm&#39;</span><span class="p">,</span><span class="mf">85.0</span><span class="p">)</span>
    <span class="n">dataObj</span><span class="o">.</span><span class="n">set2D</span><span class="p">(</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;assumed&#39;</span><span class="p">)</span>

    <span class="n">newCedarObj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataObj</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newCedarObj</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">newCedarObj</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">dataObj</span><span class="o">.</span><span class="n">get1D</span><span class="p">(</span><span class="s1">&#39;azm&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dataObj</span><span class="o">.</span><span class="n">get1D</span><span class="p">(</span><span class="s1">&#39;elm&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dataObj</span><span class="o">.</span><span class="n">get1D</span><span class="p">(</span><span class="s1">&#39;rgate&#39;</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">dataObj</span><span class="o">.</span><span class="n">get2D</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dataObj</span><span class="o">.</span><span class="n">get2D</span><span class="p">(</span><span class="s1">&#39;drange&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="n">dataObj</span><span class="o">.</span><span class="n">set2D</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">dataObj</span><span class="o">.</span><span class="n">set2D</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
    <span class="n">dataObj</span><span class="o">.</span><span class="n">set2D</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">dataObj</span><span class="o">.</span><span class="n">set2D</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;kinst is </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dataObj</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;kindat is </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dataObj</span><span class="o">.</span><span class="n">getKindat</span><span class="p">()))</span>

    <span class="n">oneDList</span> <span class="o">=</span> <span class="n">dataObj</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The following are 1D parms:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">oneDList</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;now removing 1d rgate&#39;</span><span class="p">)</span>
    <span class="n">dataObj</span><span class="o">.</span><span class="n">delete1D</span><span class="p">(</span><span class="s1">&#39;rgate&#39;</span><span class="p">)</span>

    <span class="n">oneDList</span> <span class="o">=</span> <span class="n">dataObj</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The following are now the 1D parms:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">oneDList</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>

    <span class="n">twoDList</span> <span class="o">=</span> <span class="n">dataObj</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The following are 2D parms:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">twoDList</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">dataObj</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;now deleting drange&#39;</span><span class="p">)</span>
    <span class="n">dataObj</span><span class="o">.</span><span class="n">delete2DParm</span><span class="p">(</span><span class="s1">&#39;drange&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">dataObj</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;now deleting 2nd and 3rd row&#39;</span><span class="p">)</span>
    <span class="n">dataObj</span><span class="o">.</span><span class="n">delete2DRows</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">dataObj</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="madrigal.cedar.assumed" class="name">var <span class="ident">assumed</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="madrigal.cedar.knownbad" class="name">var <span class="ident">knownbad</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="madrigal.cedar.missing" class="name">var <span class="ident">missing</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="madrigal.cedar.timeParms" class="name">var <span class="ident">timeParms</span></p>
      
  
  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="madrigal.cedar.compareParms">
    <p>def <span class="ident">compareParms</span>(</p><p>parm)</p>
    </div>
    

    
  
    <div class="desc"><p>compareParms is used internally by getHeaderKodLines to order the parameters</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="err">parm - tuple of (code, parameter description, units)</span>
</pre></div>


<p>Returns float(absolute value of code) + 0.5 if less than zero.  Else returns float(code)
    which results in positive code coming before negative of same absolute value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.compareParms', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.compareParms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">compareParms</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;compareParms is used internally by getHeaderKodLines to order the parameters</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - tuple of (code, parameter description, units) </span>


<span class="sd">        Returns float(absolute value of code) + 0.5 if less than zero.  Else returns float(code)</span>
<span class="sd">            which results in positive code coming before negative of same absolute value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">parm</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">parm</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="madrigal.cedar.getLowerCaseList">
    <p>def <span class="ident">getLowerCaseList</span>(</p><p>l)</p>
    </div>
    

    
  
    <div class="desc"><p>getLowerCaseList returns a new list that is all lowercase given an input list
that may have upper case strings</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.getLowerCaseList', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.getLowerCaseList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getLowerCaseList</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getLowerCaseList returns a new list that is all lowercase given an input list</span>
<span class="sd">    that may have upper case strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="madrigal.cedar.listRecords">
    <p>def <span class="ident">listRecords</span>(</p><p>hdf5Filename, newFilename=None, addedLinkFormat=None)</p>
    </div>
    

    
  
    <div class="desc"><p>listRecords outputs a summary of records in the hdf5Filename.  Is lower memory footprint than
loading full file into memory, then calling loadNextRecords.  However, if the file is already fully
in memory, than classing the MadrigalCedarFile method loadNextRecords is faster.</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="err">hdf5Filename - input Madrigal hdf5 file to use</span>
<span class="err">newFilename - name of new file to create and write to.  If None, the default, write to stdout</span>
<span class="err">addedLinkFormat - if not None, add link to end of each record with value addedLinkFormat % (recno).</span>
<span class="err">    If None (the default) no added link.  Must contain one and only one integer format to be</span>
<span class="err">    filled in by recno.</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.listRecords', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.listRecords" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">listRecords</span><span class="p">(</span><span class="n">hdf5Filename</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">addedLinkFormat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;listRecords outputs a summary of records in the hdf5Filename.  Is lower memory footprint than</span>
<span class="sd">    loading full file into memory, then calling loadNextRecords.  However, if the file is already fully</span>
<span class="sd">    in memory, than classing the MadrigalCedarFile method loadNextRecords is faster.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">        hdf5Filename - input Madrigal hdf5 file to use</span>
<span class="sd">        newFilename - name of new file to create and write to.  If None, the default, write to stdout</span>
<span class="sd">        addedLinkFormat - if not None, add link to end of each record with value addedLinkFormat % (recno).</span>
<span class="sd">            If None (the default) no added link.  Must contain one and only one integer format to be</span>
<span class="sd">            filled in by recno.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">madParmObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalParameters</span><span class="p">()</span>
    <span class="n">madDataObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalFile</span><span class="p">(</span><span class="n">hdf5Filename</span><span class="p">)</span>
    
    <span class="n">formatStr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%6i</span><span class="s1">: </span><span class="si">%s</span><span class="s1">   </span><span class="si">%s</span><span class="s1">&#39;</span>
    <span class="n">headerStr</span> <span class="o">=</span> <span class="s1">&#39; record    start_time            end_time&#39;</span>
    <span class="n">parms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kinstList</span> <span class="o">=</span> <span class="n">madDataObj</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;        </span><span class="si">%i</span><span class="s1">&#39;</span>
        <span class="n">headerStr</span> <span class="o">+=</span> <span class="s1">&#39;             kinst&#39;</span>
        <span class="n">parms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;kinst&#39;</span><span class="p">)</span>
    <span class="n">kindatList</span> <span class="o">=</span> <span class="n">madDataObj</span><span class="o">.</span><span class="n">getKindatList</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;        </span><span class="si">%i</span><span class="s1">&#39;</span>
        <span class="n">headerStr</span> <span class="o">+=</span> <span class="s1">&#39;          kindat&#39;</span>
        <span class="n">parms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;kindat&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="n">addedLinkFormat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;   &#39;</span> <span class="o">+</span> <span class="n">addedLinkFormat</span>
        <span class="n">headerStr</span> <span class="o">+=</span> <span class="s1">&#39;    record_plot&#39;</span>
    <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">headerStr</span><span class="p">)</span>
    
    <span class="c1"># read in data from file</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">hdf5Filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fi</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Table Layout&#39;</span><span class="p">]</span>
        <span class="n">recno</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span>
        <span class="n">ut1_unix</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
        <span class="n">ut2_unix</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;kinst&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
            <span class="n">kinst</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;kindat&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
            <span class="n">kindat</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">]</span>
        
        <span class="n">max_recno</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">recno</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_recno</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">recno</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="n">this_ut1_unix</span> <span class="o">=</span> <span class="n">ut1_unix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">this_ut2_unix</span> <span class="o">=</span> <span class="n">ut2_unix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;kinst&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">this_kinst</span> <span class="o">=</span> <span class="n">kinst</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;kindat&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">this_kindat</span> <span class="o">=</span> <span class="n">kindat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">this_ut1_unix</span><span class="p">)</span>
            <span class="n">sDTStr</span> <span class="o">=</span> <span class="n">sDT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">this_ut2_unix</span><span class="p">)</span>
            <span class="n">eDTStr</span> <span class="o">=</span> <span class="n">eDT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
            
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">sDTStr</span><span class="p">,</span> <span class="n">eDTStr</span><span class="p">]</span> 
            <span class="k">if</span> <span class="s1">&#39;kinst&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_kinst</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;kindat&#39;</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_kindat</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">addedLinkFormat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">+=</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span>
                
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">formatStr</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            
    <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="madrigal.cedar.parseArraySplittingParms">
    <p>def <span class="ident">parseArraySplittingParms</span>(</p><p>hdf5Filename)</p>
    </div>
    

    
  
    <div class="desc"><p>parseArraySplittingParms returns a (possibly empty) list of parameter mnemonic used to split
the array layout for a Madrigal Hdf5 file</p>
<p>Input: hdf5Filename - Madrigal Hdf5 filename</p>
<p>Raise IOError if not a valid Madrigal Hdf5 file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.parseArraySplittingParms', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.parseArraySplittingParms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parseArraySplittingParms</span><span class="p">(</span><span class="n">hdf5Filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parseArraySplittingParms returns a (possibly empty) list of parameter mnemonic used to split</span>
<span class="sd">        the array layout for a Madrigal Hdf5 file</span>
<span class="sd">        </span>
<span class="sd">        Input: hdf5Filename - Madrigal Hdf5 filename</span>
<span class="sd">        </span>
<span class="sd">        Raise IOError if not a valid Madrigal Hdf5 file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">hdf5Filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Hdf5 file </span><span class="si">%s</span><span class="s1"> does not have required top level Data group&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hdf5Filename</span><span class="p">))</span>
            <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="s1">&#39;Array Layout&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataGroup</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span> <span class="c1"># no array layout in this file</span>
            <span class="n">arrGroup</span> <span class="o">=</span> <span class="n">dataGroup</span><span class="p">[</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">arrGroup</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Array with&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">items</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">subitems</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                            <span class="n">parm</span> <span class="o">=</span> <span class="n">subitems</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                            <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
                            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
            
        <span class="c1"># None found</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="madrigal.cedar.CatalogHeaderCreator" class="name">class <span class="ident">CatalogHeaderCreator</span></p>
      
  
    <div class="desc"><p>CatalogHeaderCreator is a class that automates the creation of catalog and header records</p>
<p>This class creates and adds catalog and header records that meet the Cedar standards.  It does this 
by examining the input Cedar file for all summary information possible.  The user needs only 
add text that describes their experiment.  A Cedar file must already be written to disk before
this class is created.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.CatalogHeaderCreator', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.CatalogHeaderCreator" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">CatalogHeaderCreator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;CatalogHeaderCreator is a class that automates the creation of catalog and header records</span>
<span class="sd">    </span>
<span class="sd">    This class creates and adds catalog and header records that meet the Cedar standards.  It does this </span>
<span class="sd">    by examining the input Cedar file for all summary information possible.  The user needs only </span>
<span class="sd">    add text that describes their experiment.  A Cedar file must already be written to disk before</span>
<span class="sd">    this class is created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">madFilename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__init__ reads in all summary information about madFilename using madrigal.data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madFilename</span> <span class="o">=</span> <span class="n">madFilename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madFilename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span> <span class="o">=</span> <span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">madFilename</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># parse small part of file into MadrigalCedarFile object</span>
        <span class="c1"># create default header and catalog records</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span> <span class="o">=</span> <span class="mi">80</span>
        
        
    <span class="k">def</span> <span class="nf">createCatalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">principleInvestigator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">expPurpose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">expMode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">cycleTime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">correlativeExp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">sciRemarks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">instRemarks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;createCatalog will create a catalog record appropriate for this file.  The additional</span>
<span class="sd">        information fields are all optional, and are all simple text strings (except for</span>
<span class="sd">        cycleTime, which is in minutes).  If the text contains line feeds, those will be used </span>
<span class="sd">        as line breaks in the catalog record.</span>
<span class="sd">        </span>
<span class="sd">        The descriptions of these fields all come from Barbara Emery&#39;s documentation</span>
<span class="sd">        cedarFormat.pdf</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            principleInvestigator - Names of responsible Principal Investigator(s) or others knowledgeable </span>
<span class="sd">                                    about the experiment.</span>
<span class="sd">            </span>
<span class="sd">            expPurpose - Brief description of the experiment purpose</span>
<span class="sd">            </span>
<span class="sd">            expMode - Further elaboration of meaning of MODEXP; e.g. antenna patterns and </span>
<span class="sd">                      pulse sequences.</span>
<span class="sd">                      </span>
<span class="sd">            cycleTime - Minutes for one full measurement cycle</span>
<span class="sd">            </span>
<span class="sd">            correlativeExp - Correlative experiments (experiments with related data)</span>
<span class="sd">            </span>
<span class="sd">            sciRemarks - scientific remarks</span>
<span class="sd">            </span>
<span class="sd">            instRemarks - instrument remarks</span>
<span class="sd">            </span>
<span class="sd">        Returns: None</span>
<span class="sd">        </span>
<span class="sd">        Affects: sets self._catalog</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># the first step is to create the text part</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="c1"># start with parameter summary lines</span>
        <span class="k">if</span> <span class="n">cycleTime</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;TIMCY  </span><span class="si">%9i</span><span class="s1"> minutes&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cycleTime</span><span class="p">))</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createMaxMinSummaryLines</span><span class="p">()</span>
        
        <span class="c1"># add the time lines</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCatalogTimeSection</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># then add any text from input arguments</span>
        <span class="k">if</span> <span class="n">expMode</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CMODEXP &#39;</span><span class="p">,</span> <span class="n">expMode</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">expPurpose</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CPURP   &#39;</span><span class="p">,</span> <span class="n">expPurpose</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">correlativeExp</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CCOREXP &#39;</span><span class="p">,</span> <span class="n">correlativeExp</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">sciRemarks</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CSREM   &#39;</span><span class="p">,</span> <span class="n">sciRemarks</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">instRemarks</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CIREM   &#39;</span><span class="p">,</span> <span class="n">instRemarks</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">principleInvestigator</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CPI     &#39;</span><span class="p">,</span> <span class="n">principleInvestigator</span><span class="p">)</span>
            
        <span class="c1"># get some other metadata</span>
        <span class="n">kinst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">modexp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getKindatList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getEarliestTime</span><span class="p">()</span>
        <span class="n">sCentisec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getLatestTime</span><span class="p">()</span>
        <span class="n">eCentisec</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1"># now create the catalog record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span> <span class="o">=</span> <span class="n">MadrigalCatalogRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span> <span class="n">modexp</span><span class="p">,</span>
                                              <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                                              <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">,</span>
                                              <span class="n">text</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">createHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kindatDesc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">analyst</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">comments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;createHeader will create a header record appropriate for this file.  The additional</span>
<span class="sd">        information fields are all optional, and are all simple text strings.  If the text contains l</span>
<span class="sd">        ine feeds, those will be used as line breaks in the header record.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            kindatDesc - description of how this data was analyzed (the kind of data)</span>
<span class="sd">            </span>
<span class="sd">            analyst - name of person who analyzed this data</span>
<span class="sd">            </span>
<span class="sd">            comments - additional comments about data (describe any instrument-specific parameters) </span>
<span class="sd">            </span>
<span class="sd">            history - a description of the history of the processing of this file</span>
<span class="sd">            </span>
<span class="sd">        Returns: None</span>
<span class="sd">        </span>
<span class="sd">        Affects: sets self._header</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># the first step is to create the text part</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="k">if</span> <span class="n">kindatDesc</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CKINDAT&#39;</span><span class="p">,</span> <span class="n">kindatDesc</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">history</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CHIST  &#39;</span><span class="p">,</span> <span class="n">history</span><span class="p">)</span>
            
        <span class="c1"># add the time lines</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createHeaderTimeSection</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># add the KOD linesfrom the last record of file (must be data record)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getHeaderKodLines</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">comments</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;C      &#39;</span><span class="p">,</span> <span class="n">comments</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">analyst</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CANALYST&#39;</span><span class="p">,</span> <span class="n">analyst</span><span class="p">)</span>
            
        <span class="c1"># last - time of analysis line</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="n">nowStr</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1"> %b </span><span class="si">%d</span><span class="s1"> %H:%M:%S %Y&#39;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;CANDATE  </span><span class="si">%s</span><span class="s1"> UT&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nowStr</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
        
        <span class="c1"># get some other metadata</span>
        <span class="n">kinst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kindat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getKindatList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getEarliestTime</span><span class="p">()</span>
        <span class="n">sCentisec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getLatestTime</span><span class="p">()</span>
        <span class="n">eCentisec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">jpar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">())</span>
        <span class="n">mpar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">())</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">MadrigalHeaderRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span> <span class="n">kindat</span><span class="p">,</span>
                                            <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                                            <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">,</span>
                                            <span class="n">jpar</span><span class="p">,</span> <span class="n">mpar</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;write will output the new file with prepended catalog and header records</span>
<span class="sd">        </span>
<span class="sd">        Raises an IOError if no new catalog or header records to prepend</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            newFilename - if None, overwrite original file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Does not make sense to save a new file if no catalog or header has been added&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">newFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madFilename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madFilename</span><span class="p">,</span> <span class="n">newFilename</span><span class="p">)</span>
            
        <span class="c1"># open file for appening</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="o">.</span><span class="n">writeExperimentNotes</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        
        
        
    <span class="k">def</span> <span class="nf">_createCatalogTimeSection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createCatalogTimeSection will return all the lines in the catalog record that</span>
<span class="sd">        describe the start and end time of the data records.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Returns:  a tuple with three items 1) a string in the format of the time section of a</span>
<span class="sd">        catalog record, 2) earliest datetime, 3) latest datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">earliestStartTimeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getEarliestTime</span><span class="p">()</span>
        <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">earliestStartTimeList</span><span class="p">)</span>
        <span class="n">latestEndTimeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getLatestTime</span><span class="p">()</span>
        <span class="n">latestEndTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">latestEndTimeList</span><span class="p">)</span>

        <span class="n">sy</span> <span class="o">=</span> <span class="s1">&#39;IBYRE       </span><span class="si">%4s</span><span class="s1"> Beginning year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="s1">&#39;IBDTE       </span><span class="si">%4s</span><span class="s1"> Beginning month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                              <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="s1">&#39;IBHME       </span><span class="si">%4s</span><span class="s1"> Beginning UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                   <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;IBCSE       </span><span class="si">%4s</span><span class="s1"> Beginning centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>
        
        <span class="n">ey</span> <span class="o">=</span> <span class="s1">&#39;IEYRE       </span><span class="si">%4s</span><span class="s1"> Ending year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;IEDTE       </span><span class="si">%4s</span><span class="s1"> Ending month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                           <span class="n">latestEndTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">eh</span> <span class="o">=</span> <span class="s1">&#39;IEHME       </span><span class="si">%4s</span><span class="s1"> Ending UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                <span class="n">latestEndTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">latestEndTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">es</span> <span class="o">=</span> <span class="s1">&#39;IECSE       </span><span class="si">%4s</span><span class="s1"> Ending centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>

        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sy</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ss</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ey</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ey</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ed</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ed</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">eh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">eh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">es</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>

        <span class="k">return</span><span class="p">((</span><span class="n">retStr</span><span class="p">,</span> <span class="n">earliestStartTime</span><span class="p">,</span> <span class="n">latestEndTime</span><span class="p">))</span>
    
    
    <span class="k">def</span> <span class="nf">_createHeaderTimeSection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataRecList</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createHeaderTimeSection will return all the lines in the header record that</span>
<span class="sd">        describe the start and end time of the data records.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            dataRecList - if given, examine only those MadrigalDataRecords in dataRecList.</span>
<span class="sd">                          If None (the default), examine all MadrigalDataRecords in this</span>
<span class="sd">                          MadrigalCedarFile</span>

<span class="sd">        Returns:  a tuple with three items 1) a string in the format of the time section of a</span>
<span class="sd">        header record, 2) earliest datetime, 3) latest datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">earliestStartTimeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getEarliestTime</span><span class="p">()</span>
        <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">earliestStartTimeList</span><span class="p">)</span>
        <span class="n">latestEndTimeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getLatestTime</span><span class="p">()</span>
        <span class="n">latestEndTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">latestEndTimeList</span><span class="p">)</span>
                

        <span class="n">sy</span> <span class="o">=</span> <span class="s1">&#39;IBYRT               </span><span class="si">%4s</span><span class="s1"> Beginning year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="s1">&#39;IBDTT               </span><span class="si">%4s</span><span class="s1"> Beginning month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                              <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="s1">&#39;IBHMT               </span><span class="si">%4s</span><span class="s1"> Beginning UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                   <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;IBCST               </span><span class="si">%4s</span><span class="s1"> Beginning centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>
        
        <span class="n">ey</span> <span class="o">=</span> <span class="s1">&#39;IEYRT               </span><span class="si">%4s</span><span class="s1"> Ending year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;IEDTT               </span><span class="si">%4s</span><span class="s1"> Ending month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                           <span class="n">latestEndTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">eh</span> <span class="o">=</span> <span class="s1">&#39;IEHMT               </span><span class="si">%4s</span><span class="s1"> Ending UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                <span class="n">latestEndTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">latestEndTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">es</span> <span class="o">=</span> <span class="s1">&#39;IECST               </span><span class="si">%4s</span><span class="s1"> Ending centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>

        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sy</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ss</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ey</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ey</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ed</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ed</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">eh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">eh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">es</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>

        <span class="k">return</span><span class="p">((</span><span class="n">retStr</span><span class="p">,</span> <span class="n">earliestStartTime</span><span class="p">,</span> <span class="n">latestEndTime</span><span class="p">))</span>
        
        
    
    <span class="k">def</span> <span class="nf">_createMaxMinSummaryLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createMaxMinSummaryLines is a private method that creates the max and min summary </span>
<span class="sd">        lines (e.g., alt, gdlat, etc)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alt1</span> <span class="o">=</span> <span class="s1">&#39;ALT1 </span><span class="si">%11i</span><span class="s1"> km. Lowest altitude measured&#39;</span>
        <span class="n">alt2</span> <span class="o">=</span> <span class="s1">&#39;ALT2 </span><span class="si">%11i</span><span class="s1"> km. Highest altitude measured&#39;</span>
        <span class="n">lat1</span> <span class="o">=</span> <span class="s1">&#39;GGLAT1    </span><span class="si">%6i</span><span class="s1"> degrees. Lowest geographic latitude measured&#39;</span>
        <span class="n">lat2</span> <span class="o">=</span> <span class="s1">&#39;GGLAT2    </span><span class="si">%6i</span><span class="s1"> degrees. Highest geographic latitude measured&#39;</span>
        <span class="n">lon1</span> <span class="o">=</span> <span class="s1">&#39;GGLON1    </span><span class="si">%6i</span><span class="s1"> degrees. Westmost geographic longitude measured&#39;</span>
        <span class="n">lon2</span> <span class="o">=</span> <span class="s1">&#39;GGLON2    </span><span class="si">%6i</span><span class="s1"> degrees. Eastmost geographic longitude measured&#39;</span>
        <span class="n">pl1</span> <span class="o">=</span> <span class="s1">&#39;PL1  </span><span class="si">%11i</span><span class="s1"> Shortest radar pulse length&#39;</span>
        <span class="n">pl2</span> <span class="o">=</span> <span class="s1">&#39;PL2  </span><span class="si">%11i</span><span class="s1"> Longest radar pulse length&#39;</span>
        
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="n">minAlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMinValidAltitude</span><span class="p">()</span>
        <span class="n">maxAlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMaxValidAltitude</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">minAlt</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">minAlt</span> <span class="o">&lt;</span> <span class="mf">1E9</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">alt1</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minAlt</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">alt2</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">maxAlt</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            
        <span class="n">minLat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMinLatitude</span><span class="p">()</span>
        <span class="n">maxLat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMaxLatitude</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">minLat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">91</span> <span class="ow">and</span> <span class="n">minLat</span> <span class="o">&lt;</span> <span class="mi">91</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">lat1</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minLat</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">lat2</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">maxLat</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            
        <span class="n">minLon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMinLongitude</span><span class="p">()</span>
        <span class="n">maxLon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMaxLongitude</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">minLon</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">181</span> <span class="ow">and</span> <span class="n">minLon</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">lon1</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minLon</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">lon2</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">maxLon</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            
        <span class="n">minPl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMinPulseLength</span><span class="p">()</span>
        <span class="n">maxPl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getMaxPulseLength</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">minPl</span> <span class="o">&gt;</span> <span class="mf">0.001</span> <span class="ow">and</span> <span class="n">minPl</span> <span class="o">&lt;</span> <span class="mf">10E9</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">pl1</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">minPl</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">pl2</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">maxPl</span><span class="p">))</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
            
        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="nf">_createCedarLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createCedarLines is a private method that returns a string which is a multiple of </span>
<span class="sd">        80 characters (no line feeds) where each 80 character block starts with prefix,then a space, </span>
<span class="sd">        and then the next part of text that fits on line, padded with spaces</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lineLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Too long prefix </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">prefix</span><span class="p">)))</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="c1"># first check for line feeds</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="c1"># now split by words</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
                <span class="c1"># see if this word can fit on one line</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">lineLen</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Can not fit the word &lt;</span><span class="si">%s</span><span class="s1">&gt; in a Cedar text record&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="p">))</span>
                <span class="c1"># see if there&#39;s room for this word</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">lineLen</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span> <span class="o">%</span> <span class="n">lineLen</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span> <span class="o">%</span> <span class="n">lineLen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="n">lineLen</span><span class="p">)</span>
                    <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
                <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="p">)</span>
            <span class="c1"># at line break, we always pad</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">retStr</span><span class="p">,</span> <span class="n">lineLen</span><span class="p">)</span>
            
        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_padStr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thisStr</span><span class="p">,</span> <span class="n">lineLen</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_padStr is a private method that pads a string with spaces so its length is module lineLen</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spacesToPad</span> <span class="o">=</span> <span class="n">lineLen</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisStr</span><span class="p">)</span> <span class="o">%</span> <span class="n">lineLen</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spacesToPad</span> <span class="o">==</span> <span class="n">lineLen</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">thisStr</span><span class="p">)</span>
        <span class="n">thisStr</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">spacesToPad</span>
        <span class="k">return</span><span class="p">(</span><span class="n">thisStr</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#madrigal.cedar.CatalogHeaderCreator">CatalogHeaderCreator</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.CatalogHeaderCreator.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, madFilename)</p>
    </div>
    

    
  
    <div class="desc"><p><strong>init</strong> reads in all summary information about madFilename using madrigal.data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.CatalogHeaderCreator.__init__', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.CatalogHeaderCreator.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">madFilename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;__init__ reads in all summary information about madFilename using madrigal.data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_madFilename</span> <span class="o">=</span> <span class="n">madFilename</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madFilename</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span> <span class="o">=</span> <span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">madFilename</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># parse small part of file into MadrigalCedarFile object</span>
    <span class="c1"># create default header and catalog records</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span> <span class="o">=</span> <span class="mi">80</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.CatalogHeaderCreator.createCatalog">
    <p>def <span class="ident">createCatalog</span>(</p><p>self, principleInvestigator=None, expPurpose=None, expMode=None, cycleTime=None, correlativeExp=None, sciRemarks=None, instRemarks=None)</p>
    </div>
    

    
  
    <div class="desc"><p>createCatalog will create a catalog record appropriate for this file.  The additional
information fields are all optional, and are all simple text strings (except for
cycleTime, which is in minutes).  If the text contains line feeds, those will be used 
as line breaks in the catalog record.</p>
<p>The descriptions of these fields all come from Barbara Emery's documentation
cedarFormat.pdf</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">principleInvestigator</span> <span class="o">-</span> <span class="k">Names</span> <span class="k">of</span> <span class="n">responsible</span> <span class="n">Principal</span> <span class="n">Investigator</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">or</span> <span class="n">others</span> <span class="n">knowledgeable</span> 
                        <span class="n">about</span> <span class="n">the</span> <span class="n">experiment</span><span class="p">.</span>

<span class="n">expPurpose</span> <span class="o">-</span> <span class="n">Brief</span> <span class="n">description</span> <span class="k">of</span> <span class="n">the</span> <span class="n">experiment</span> <span class="n">purpose</span>

<span class="n">expMode</span> <span class="o">-</span> <span class="n">Further</span> <span class="n">elaboration</span> <span class="k">of</span> <span class="n">meaning</span> <span class="k">of</span> <span class="n">MODEXP</span><span class="p">;</span> <span class="n">e</span><span class="p">.</span><span class="k">g</span><span class="p">.</span> <span class="n">antenna</span> <span class="n">patterns</span> <span class="k">and</span> 
          <span class="n">pulse</span> <span class="n">sequences</span><span class="p">.</span>

<span class="n">cycleTime</span> <span class="o">-</span> <span class="n">Minutes</span> <span class="k">for</span> <span class="n">one</span> <span class="k">full</span> <span class="n">measurement</span> <span class="k">cycle</span>

<span class="n">correlativeExp</span> <span class="o">-</span> <span class="n">Correlative</span> <span class="n">experiments</span> <span class="p">(</span><span class="n">experiments</span> <span class="k">with</span> <span class="n">related</span> <span class="k">data</span><span class="p">)</span>

<span class="n">sciRemarks</span> <span class="o">-</span> <span class="n">scientific</span> <span class="n">remarks</span>

<span class="n">instRemarks</span> <span class="o">-</span> <span class="n">instrument</span> <span class="n">remarks</span>
</pre></div>


<p>Returns: None</p>
<p>Affects: sets self._catalog</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.CatalogHeaderCreator.createCatalog', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.CatalogHeaderCreator.createCatalog" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">createCatalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">principleInvestigator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">expPurpose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">expMode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">cycleTime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">correlativeExp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">sciRemarks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">instRemarks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;createCatalog will create a catalog record appropriate for this file.  The additional</span>
<span class="sd">    information fields are all optional, and are all simple text strings (except for</span>
<span class="sd">    cycleTime, which is in minutes).  If the text contains line feeds, those will be used </span>
<span class="sd">    as line breaks in the catalog record.</span>
<span class="sd">    </span>
<span class="sd">    The descriptions of these fields all come from Barbara Emery&#39;s documentation</span>
<span class="sd">    cedarFormat.pdf</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">        principleInvestigator - Names of responsible Principal Investigator(s) or others knowledgeable </span>
<span class="sd">                                about the experiment.</span>
<span class="sd">        </span>
<span class="sd">        expPurpose - Brief description of the experiment purpose</span>
<span class="sd">        </span>
<span class="sd">        expMode - Further elaboration of meaning of MODEXP; e.g. antenna patterns and </span>
<span class="sd">                  pulse sequences.</span>
<span class="sd">                  </span>
<span class="sd">        cycleTime - Minutes for one full measurement cycle</span>
<span class="sd">        </span>
<span class="sd">        correlativeExp - Correlative experiments (experiments with related data)</span>
<span class="sd">        </span>
<span class="sd">        sciRemarks - scientific remarks</span>
<span class="sd">        </span>
<span class="sd">        instRemarks - instrument remarks</span>
<span class="sd">        </span>
<span class="sd">    Returns: None</span>
<span class="sd">    </span>
<span class="sd">    Affects: sets self._catalog</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># the first step is to create the text part</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    
    <span class="c1"># start with parameter summary lines</span>
    <span class="k">if</span> <span class="n">cycleTime</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;TIMCY  </span><span class="si">%9i</span><span class="s1"> minutes&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cycleTime</span><span class="p">))</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
        
    <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createMaxMinSummaryLines</span><span class="p">()</span>
    
    <span class="c1"># add the time lines</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCatalogTimeSection</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># then add any text from input arguments</span>
    <span class="k">if</span> <span class="n">expMode</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CMODEXP &#39;</span><span class="p">,</span> <span class="n">expMode</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">expPurpose</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CPURP   &#39;</span><span class="p">,</span> <span class="n">expPurpose</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">correlativeExp</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CCOREXP &#39;</span><span class="p">,</span> <span class="n">correlativeExp</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">sciRemarks</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CSREM   &#39;</span><span class="p">,</span> <span class="n">sciRemarks</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">instRemarks</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CIREM   &#39;</span><span class="p">,</span> <span class="n">instRemarks</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">principleInvestigator</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CPI     &#39;</span><span class="p">,</span> <span class="n">principleInvestigator</span><span class="p">)</span>
        
    <span class="c1"># get some other metadata</span>
    <span class="n">kinst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">modexp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getKindatList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getEarliestTime</span><span class="p">()</span>
    <span class="n">sCentisec</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getLatestTime</span><span class="p">()</span>
    <span class="n">eCentisec</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># now create the catalog record</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span> <span class="o">=</span> <span class="n">MadrigalCatalogRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span> <span class="n">modexp</span><span class="p">,</span>
                                          <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                                          <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">,</span>
                                          <span class="n">text</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.CatalogHeaderCreator.createHeader">
    <p>def <span class="ident">createHeader</span>(</p><p>self, kindatDesc=None, analyst=None, comments=None, history=None)</p>
    </div>
    

    
  
    <div class="desc"><p>createHeader will create a header record appropriate for this file.  The additional
information fields are all optional, and are all simple text strings.  If the text contains l
ine feeds, those will be used as line breaks in the header record.</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">kindatDesc</span> <span class="o">-</span> <span class="n">description</span> <span class="k">of</span> <span class="n">how</span> <span class="n">this</span> <span class="k">data</span> <span class="n">was</span> <span class="n">analyzed</span> <span class="p">(</span><span class="n">the</span> <span class="n">kind</span> <span class="k">of</span> <span class="k">data</span><span class="p">)</span>

<span class="n">analyst</span> <span class="o">-</span> <span class="n">name</span> <span class="k">of</span> <span class="n">person</span> <span class="n">who</span> <span class="n">analyzed</span> <span class="n">this</span> <span class="k">data</span>

<span class="n">comments</span> <span class="o">-</span> <span class="n">additional</span> <span class="n">comments</span> <span class="n">about</span> <span class="k">data</span> <span class="p">(</span><span class="k">describe</span> <span class="k">any</span> <span class="n">instrument</span><span class="o">-</span><span class="k">specific</span> <span class="k">parameters</span><span class="p">)</span>

<span class="n">history</span> <span class="o">-</span> <span class="n">a</span> <span class="n">description</span> <span class="k">of</span> <span class="n">the</span> <span class="n">history</span> <span class="k">of</span> <span class="n">the</span> <span class="n">processing</span> <span class="k">of</span> <span class="n">this</span> <span class="n">file</span>
</pre></div>


<p>Returns: None</p>
<p>Affects: sets self._header</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.CatalogHeaderCreator.createHeader', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.CatalogHeaderCreator.createHeader" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">createHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kindatDesc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                       <span class="n">analyst</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                       <span class="n">comments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                       <span class="n">history</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;createHeader will create a header record appropriate for this file.  The additional</span>
<span class="sd">    information fields are all optional, and are all simple text strings.  If the text contains l</span>
<span class="sd">    ine feeds, those will be used as line breaks in the header record.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">        kindatDesc - description of how this data was analyzed (the kind of data)</span>
<span class="sd">        </span>
<span class="sd">        analyst - name of person who analyzed this data</span>
<span class="sd">        </span>
<span class="sd">        comments - additional comments about data (describe any instrument-specific parameters) </span>
<span class="sd">        </span>
<span class="sd">        history - a description of the history of the processing of this file</span>
<span class="sd">        </span>
<span class="sd">    Returns: None</span>
<span class="sd">    </span>
<span class="sd">    Affects: sets self._header</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># the first step is to create the text part</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    
    <span class="k">if</span> <span class="n">kindatDesc</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CKINDAT&#39;</span><span class="p">,</span> <span class="n">kindatDesc</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">history</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CHIST  &#39;</span><span class="p">,</span> <span class="n">history</span><span class="p">)</span>
        
    <span class="c1"># add the time lines</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createHeaderTimeSection</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># add the KOD linesfrom the last record of file (must be data record)</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getHeaderKodLines</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">comments</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;C      &#39;</span><span class="p">,</span> <span class="n">comments</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">analyst</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createCedarLines</span><span class="p">(</span><span class="s1">&#39;CANALYST&#39;</span><span class="p">,</span> <span class="n">analyst</span><span class="p">)</span>
        
    <span class="c1"># last - time of analysis line</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
    <span class="n">nowStr</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1"> %b </span><span class="si">%d</span><span class="s1"> %H:%M:%S %Y&#39;</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;CANDATE  </span><span class="si">%s</span><span class="s1"> UT&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nowStr</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padStr</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lineLen</span><span class="p">)</span>
    
    <span class="c1"># get some other metadata</span>
    <span class="n">kinst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">kindat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getKindatList</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getEarliestTime</span><span class="p">()</span>
    <span class="n">sCentisec</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="o">.</span><span class="n">getLatestTime</span><span class="p">()</span>
    <span class="n">eCentisec</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">jpar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">())</span>
    <span class="n">mpar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">())</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">=</span> <span class="n">MadrigalHeaderRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span> <span class="n">kindat</span><span class="p">,</span>
                                        <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                                        <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">,</span>
                                        <span class="n">jpar</span><span class="p">,</span> <span class="n">mpar</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.CatalogHeaderCreator.write">
    <p>def <span class="ident">write</span>(</p><p>self, newFilename=None)</p>
    </div>
    

    
  
    <div class="desc"><p>write will output the new file with prepended catalog and header records</p>
<p>Raises an IOError if no new catalog or header records to prepend</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="err">newFilename - if None, overwrite original file</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.CatalogHeaderCreator.write', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.CatalogHeaderCreator.write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;write will output the new file with prepended catalog and header records</span>
<span class="sd">    </span>
<span class="sd">    Raises an IOError if no new catalog or header records to prepend</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">        newFilename - if None, overwrite original file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Does not make sense to save a new file if no catalog or header has been added&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalog</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">newFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madFilename</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madFilename</span><span class="p">,</span> <span class="n">newFilename</span><span class="p">)</span>
        
    <span class="c1"># open file for appening</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cedar</span><span class="o">.</span><span class="n">writeExperimentNotes</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="madrigal.cedar.CedarParameter" class="name">class <span class="ident">CedarParameter</span></p>
      
  
    <div class="desc"><p>CedarParameter is a class with attributes code, mnemonic, and description, and isInt</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.CedarParameter', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.CedarParameter" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">CedarParameter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;CedarParameter is a class with attributes code, mnemonic, and description, and isInt&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">mnemonic</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">isInt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isInt</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">isInt</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%6i</span><span class="s1">: </span><span class="si">%20s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">, isInt=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isInt</span><span class="p">)))</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#madrigal.cedar.CedarParameter">CedarParameter</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.CedarParameter.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, code, mnemonic, description, isInt)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialize self.  See help(type(self)) for accurate signature.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.CedarParameter.__init__', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.CedarParameter.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">mnemonic</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">isInt</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mnemonic</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">isInt</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">isInt</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="madrigal.cedar.CedarParameter.code" class="name">var <span class="ident">code</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="madrigal.cedar.CedarParameter.description" class="name">var <span class="ident">description</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="madrigal.cedar.CedarParameter.isInt" class="name">var <span class="ident">isInt</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="madrigal.cedar.CedarParameter.mnemonic" class="name">var <span class="ident">mnemonic</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="madrigal.cedar.MadrigalCatalogRecord" class="name">class <span class="ident">MadrigalCatalogRecord</span></p>
      
  
    <div class="desc"><p>MadrigalCatalogRecord holds all the information in a Cedar catalog record.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MadrigalCatalogRecord</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;MadrigalCatalogRecord holds all the information in a Cedar catalog record.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kinst</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">modexp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sYear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sMonth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sDay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sHour</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sSec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sCentisec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">eYear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eMonth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eDay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">eHour</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eSec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eCentisec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">text</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">madInstObj</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">modexpDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">expNotesLines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__init__ creates a MadrigalCatalogRecord.</span>
<span class="sd">        </span>
<span class="sd">        Note: all inputs have default values because there are two ways to populate this structure:</span>
<span class="sd">        1) with all inputs from kinst to text when new data is being created, or </span>
<span class="sd">        2) with catalog line list from existing Hdf5 file Experiment Notes metadata, plus non-default inputs</span>

<span class="sd">        Inputs:</span>

<span class="sd">            kinst - the kind of instrument code.  A warning will be raised if not in instTab.txt.</span>

<span class="sd">            modexp - Code to indicate experimental mode employed. Must be a non-negative integer.</span>

<span class="sd">            sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - experiment start time. sCentisec must be 0-99</span>

<span class="sd">            eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - experiment end time. eCentisec must be 0-99</span>

<span class="sd">            text - string containing text in catalog record.  Length must be divisible by 80.  No linefeeds</span>
<span class="sd">                   allowed.</span>

<span class="sd">            madInstObj - a madrigal.metadata.MadrigalInstrument object.  If None, one will be created.</span>
<span class="sd">                              Used to verify kinst.</span>
<span class="sd">                              </span>
<span class="sd">            modexpDesc - string describing the modexp</span>
<span class="sd">                              </span>
<span class="sd">            expNotesList - a list of all lines in an existing catalog section &quot;Experiment Notes&quot; </span>
<span class="sd">                metadata table.  All the above attributes are parsed from these lines.</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create any needed Madrigal objects, if not passed in</span>
        <span class="k">if</span> <span class="n">madInstObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalInstrument</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madInstObj</span>
            
        <span class="k">if</span> <span class="n">expNotesLines</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get all information from this dataset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parseExpNotesLines</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kinst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># kinst set via catalog record overrides kinst argument</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
        <span class="c1"># verify kinst set, or raise error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kinst not set when MadrigalCatalogRecord created - required&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">modexp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setModexp</span><span class="p">(</span><span class="n">modexp</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modexpDesc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setModexpDesc</span><span class="p">(</span><span class="n">modexpDesc</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                              <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        

        
    <span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the type &#39;catalog&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;catalog&#39;</span>
    


    <span class="k">def</span> <span class="nf">getKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKinst returns the kind of instrument code (int) for a given catalog record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the kind of instrument code (int) for a given catalog record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">setKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kinst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setKinst sets the kind of instrument code (int) for a given catalog record.</span>

<span class="sd">        Inputs: kind of instrument code (integer)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets the kind of instrument code (int) (self._kinst) for a given catalog record.</span>
<span class="sd">        Prints warning if kinst not found in instTab.txt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kinst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
        <span class="c1"># verify  and set kinst</span>
        <span class="n">instList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentList</span><span class="p">()</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">kinst</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="s1">&#39;Unknown instrument&#39;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: kinst </span><span class="si">%i</span><span class="s1"> not found in instTab.txt</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kinst</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span> <span class="o">=</span> <span class="n">kinst</span>

    <span class="k">def</span> <span class="nf">getModexp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getModexp returns the mode of experiment code (int) for a given catalog record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the mode of experiment code (int) for a given catalog record. Returns -1 if not set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_modexp</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setModexp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modexp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setModexp sets the mode of experiment code (int) for a given catalog record.</span>

<span class="sd">        Inputs: the mode of experiment code (int)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets the mode of experiment code (int) (self._modexp)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modexp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">modexp</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">getModexpDesc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getModexp returns the description of the mode of experiment code for a given catalog record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the description of the mode of experiment code for a given catalog record (string).</span>
<span class="sd">            Returns empty string if not set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_modexpDesc</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setModexpDesc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modexpDesc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setModexpDesc sets the description of the mode of experiment code for a given catalog record.</span>

<span class="sd">        Inputs: the description mode of experiment code (string)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets the description of the mode of experiment code (string) (self._modexpDesc)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modexpDesc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">modexpDesc</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getText returns the catalog text.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the catalog text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getTextLineCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getTextLineCount returns the number of 80 character lines in self._text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">setText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setText sets the catalog text.</span>

<span class="sd">        Inputs: text: text to be set.  Must be length divisible by 80, and not contain line feeds.</span>

<span class="sd">        Outputs: None.</span>

<span class="sd">        Affects: sets self._text</span>

<span class="sd">        Raise TypeError if problem with test</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text must be of type string&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text length must be divisible by 80: len is </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text must not contain linefeed character&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">text</span>


    <span class="k">def</span> <span class="nf">getStartTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStartTimeList returns a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">getEndTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getEndTimeList returns a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span><span class="p">))</span>
    

    <span class="k">def</span> <span class="nf">setTimeLists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                     <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setTimeList resets start and end times</span>

<span class="sd">        Inputs:</span>

<span class="sd">            sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - experiment start time. sCentisec must be 0-99</span>

<span class="sd">            eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - experiment end time. eCentisec must be 0-99</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets all time attributes (see code).</span>

<span class="sd">        Exceptions: Raises ValueError if startTime &gt; endTime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># verify times</span>
        <span class="n">sTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">eTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">eTime</span> <span class="o">&lt;</span> <span class="n">sTime</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Starting time cannot be after ending time&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_sTime</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMadrigalUTFromDT</span><span class="p">(</span><span class="n">sTime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eTime</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMadrigalUTFromDT</span><span class="p">(</span><span class="n">eTime</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span> <span class="o">=</span> <span class="n">sYear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span> <span class="o">=</span> <span class="n">sMonth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span> <span class="o">=</span> <span class="n">sDay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span> <span class="o">=</span> <span class="n">sHour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span> <span class="o">=</span> <span class="n">sMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span> <span class="o">=</span> <span class="n">sSec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span> <span class="o">=</span> <span class="n">sCentisec</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span> <span class="o">=</span> <span class="n">eYear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span> <span class="o">=</span> <span class="n">eMonth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span> <span class="o">=</span> <span class="n">eDay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span> <span class="o">=</span> <span class="n">eHour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span> <span class="o">=</span> <span class="n">eMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span> <span class="o">=</span> <span class="n">eSec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span> <span class="o">=</span> <span class="n">eCentisec</span>
        
        
    <span class="k">def</span> <span class="nf">getLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getLines returns a numpy recarray of the format expected by the &quot;Experiment Notes&quot; dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># templates</span>
        <span class="n">kreccStr</span> <span class="o">=</span> <span class="s1">&#39;KRECC       2001 Catalogue Record, Version 1&#39;</span>
        <span class="n">kinstTempStr</span> <span class="o">=</span> <span class="s1">&#39;KINSTE     </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="n">modExpTempStr</span> <span class="o">=</span> <span class="s1">&#39;MODEXP    </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="n">byearTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBYRT               </span><span class="si">%04i</span><span class="s1"> Beginning year&#39;</span>
        <span class="n">bmdTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBDTT               </span><span class="si">%04i</span><span class="s1"> Beginning month and day&#39;</span>
        <span class="n">bhmTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBHMT               </span><span class="si">%04i</span><span class="s1"> Beginning UT hour and minute&#39;</span>
        <span class="n">bcsTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBCST               </span><span class="si">%04i</span><span class="s1"> Beginning centisecond&#39;</span>
        <span class="n">eyearTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEYRT               </span><span class="si">%04i</span><span class="s1"> Ending year&#39;</span>
        <span class="n">emdTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEDTT               </span><span class="si">%04i</span><span class="s1"> Ending month and day&#39;</span>
        <span class="n">ehmTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEHMT               </span><span class="si">%04i</span><span class="s1"> Ending UT hour and minute&#39;</span>
        <span class="n">ecsTempStr</span> <span class="o">=</span> <span class="s1">&#39;IECST               </span><span class="si">%04i</span><span class="s1"> Ending centisecond&#39;</span>
        
        
        <span class="n">numLines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTextLineCount</span><span class="p">()</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="c1"># 8 times lines, KRECC, KINSTE, MODEXP, and final blank</span>
        <span class="n">textArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="n">numLines</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;File Notes&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">))])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numLines</span><span class="o">-</span><span class="mi">9</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kreccStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kreccStr</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">kinstName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">())</span>
                <span class="n">kinstStr</span> <span class="o">=</span> <span class="n">kinstTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">(),</span> <span class="n">kinstName</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="n">kinstStr</span> <span class="o">=</span> <span class="n">kinstStr</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinstStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstStr</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">modExpStr</span> <span class="o">=</span> <span class="n">modExpTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getModexp</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModexpDesc</span><span class="p">())</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modExpStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="n">modExpStr</span> <span class="o">=</span> <span class="n">modExpStr</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modExpStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">modExpStr</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()[(</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">:(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">]</span>
                
        <span class="c1"># finally add time lines</span>
        <span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="n">sCentisec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
        <span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="n">eCentisec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
        <span class="n">ibdtt</span> <span class="o">=</span> <span class="n">sMonth</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sDay</span>
        <span class="n">ibhmt</span> <span class="o">=</span> <span class="n">sHour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sMin</span>
        <span class="n">ibcst</span> <span class="o">=</span> <span class="n">sSec</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sCentisec</span>
        <span class="n">iedtt</span> <span class="o">=</span> <span class="n">eMonth</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eDay</span>
        <span class="n">iehmt</span> <span class="o">=</span> <span class="n">eHour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eMin</span>
        <span class="n">iecst</span> <span class="o">=</span> <span class="n">eSec</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eCentisec</span>
        
        <span class="n">sYearStr</span> <span class="o">=</span> <span class="n">byearTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">sYear</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sYearStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sYearStr</span><span class="p">))</span>
        <span class="n">sMDStr</span> <span class="o">=</span> <span class="n">bmdTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibdtt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sMDStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sMDStr</span><span class="p">))</span>
        <span class="n">sHMStr</span> <span class="o">=</span> <span class="n">bhmTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibhmt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sHMStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sHMStr</span><span class="p">))</span>
        <span class="n">sCSStr</span> <span class="o">=</span> <span class="n">bcsTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibcst</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sCSStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sCSStr</span><span class="p">))</span>
        
        <span class="n">eYearStr</span> <span class="o">=</span> <span class="n">eyearTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">eYear</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eYearStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eYearStr</span><span class="p">))</span>
        <span class="n">eMDStr</span> <span class="o">=</span> <span class="n">emdTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iedtt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eMDStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eMDStr</span><span class="p">))</span>
        <span class="n">eHMStr</span> <span class="o">=</span> <span class="n">ehmTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iehmt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eHMStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eHMStr</span><span class="p">))</span>
        <span class="n">eCSStr</span> <span class="o">=</span> <span class="n">ecsTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iecst</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eCSStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eCSStr</span><span class="p">))</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">9</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">80</span>
        
        <span class="k">return</span><span class="p">(</span><span class="n">textArr</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">_parseExpNotesLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expNotesLines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_parseExpNotesLines populates all attributes in MadrigalCatalogRecord</span>
<span class="sd">        from text from metadata table &quot;Experiment Notes&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Len of expNotesLines must be divisible by 80, len </span><span class="si">%i</span><span class="s1"> is not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># init to empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modexpDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modexp</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="c1"># default times</span>
        <span class="n">bsec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bcsec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">esec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ecsec</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">expNotesLines</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">80</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">]</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># blank line</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;KRECC&#39;</span><span class="p">:</span>
                <span class="c1"># ignore</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;KINSTE&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;MODEXP&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setModexp</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setModexp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setModexpDesc</span><span class="p">(</span><span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">:]))</span>
                    
            <span class="c1"># start time</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBYRE&#39;</span><span class="p">:</span>
                <span class="n">byear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBDTE&#39;</span><span class="p">:</span>
                <span class="n">ibdte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">bmonth</span> <span class="o">=</span> <span class="n">ibdte</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">bday</span> <span class="o">=</span> <span class="n">ibdte</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBHME&#39;</span><span class="p">:</span>
                <span class="n">ibhme</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">bhour</span> <span class="o">=</span> <span class="n">ibhme</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">bmin</span> <span class="o">=</span> <span class="n">ibhme</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBCSE&#39;</span><span class="p">:</span>
                <span class="n">ibcse</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">bsec</span> <span class="o">=</span> <span class="n">ibcse</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">bcsec</span> <span class="o">=</span> <span class="n">ibcse</span> <span class="o">%</span> <span class="mi">100</span>
                
            <span class="c1"># end time</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IEYRE&#39;</span><span class="p">:</span>
                <span class="n">eyear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IEDTE&#39;</span><span class="p">:</span>
                <span class="n">iedte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">emonth</span> <span class="o">=</span> <span class="n">iedte</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">eday</span> <span class="o">=</span> <span class="n">iedte</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IEHME&#39;</span><span class="p">:</span>
                <span class="n">iehme</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">ehour</span> <span class="o">=</span> <span class="n">iehme</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">emin</span> <span class="o">=</span> <span class="n">iehme</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IECSE&#39;</span><span class="p">:</span>
                <span class="n">iecse</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">esec</span> <span class="o">=</span> <span class="n">iecse</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">ecsec</span> <span class="o">=</span> <span class="n">iecse</span> <span class="o">%</span> <span class="mi">100</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
                    
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># set times</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">byear</span><span class="p">,</span> <span class="n">bmonth</span><span class="p">,</span> <span class="n">bday</span><span class="p">,</span> <span class="n">bhour</span><span class="p">,</span> <span class="n">bmin</span><span class="p">,</span> <span class="n">bsec</span><span class="p">,</span> <span class="n">bcsec</span><span class="p">,</span> 
                              <span class="n">eyear</span><span class="p">,</span> <span class="n">emonth</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">ehour</span><span class="p">,</span> <span class="n">emin</span><span class="p">,</span> <span class="n">esec</span><span class="p">,</span> <span class="n">ecsec</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
        
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns a string representation of a MadrigalCatalogRecord &quot;&quot;&quot;</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;Catalog Record:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;kinst = </span><span class="si">%i</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;modexp = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_modexp</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;record start: </span><span class="si">%04i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">.</span><span class="si">%02i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;record end:   </span><span class="si">%04i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">.</span><span class="si">%02i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">):</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">80</span><span class="p">])</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">cmpDataRec</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;cmpDataRec returns a tuple of:</span>
<span class="sd">            1. 0 if catalog, 1 if header, 2 if data</span>
<span class="sd">            2.  start datetime</span>
<span class="sd">            3.  end datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># compare record start times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="n">typeEnum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thisType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dataType</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">thisType</span> <span class="o">==</span> <span class="n">dataType</span><span class="p">:</span>
                <span class="n">typeEnum</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
            
        <span class="c1"># compare record stop times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="k">return</span><span class="p">((</span><span class="n">typeEnum</span><span class="p">,</span> <span class="n">sDT</span><span class="p">,</span> <span class="n">eDT</span><span class="p">))</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#madrigal.cedar.MadrigalCatalogRecord">MadrigalCatalogRecord</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, kinst=None, modexp=None, sYear=None, sMonth=None, sDay=None, sHour=None, sMin=None, sSec=None, sCentisec=None, eYear=None, eMonth=None, eDay=None, eHour=None, eMin=None, eSec=None, eCentisec=None, text=None, madInstObj=None, modexpDesc=&#39;&#39;, expNotesLines=None)</p>
    </div>
    

    
  
    <div class="desc"><p><strong>init</strong> creates a MadrigalCatalogRecord.</p>
<p>Note: all inputs have default values because there are two ways to populate this structure:
1) with all inputs from kinst to text when new data is being created, or 
2) with catalog line list from existing Hdf5 file Experiment Notes metadata, plus non-default inputs</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">kinst</span> <span class="o">-</span> <span class="n">the</span> <span class="n">kind</span> <span class="k">of</span> <span class="n">instrument</span> <span class="n">code</span><span class="p">.</span>  <span class="n">A</span> <span class="n">warning</span> <span class="n">will</span> <span class="n">be</span> <span class="n">raised</span> <span class="k">if</span> <span class="k">not</span> <span class="k">in</span> <span class="n">instTab</span><span class="p">.</span><span class="n">txt</span><span class="p">.</span>

<span class="n">modexp</span> <span class="o">-</span> <span class="n">Code</span> <span class="k">to</span> <span class="n">indicate</span> <span class="n">experimental</span> <span class="k">mode</span> <span class="n">employed</span><span class="p">.</span> <span class="n">Must</span> <span class="n">be</span> <span class="n">a</span> <span class="n">non</span><span class="o">-</span><span class="n">negative</span> <span class="nb">integer</span><span class="p">.</span>

<span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span> <span class="o">-</span> <span class="n">experiment</span> <span class="k">start</span> <span class="n">time</span><span class="p">.</span> <span class="n">sCentisec</span> <span class="n">must</span> <span class="n">be</span> <span class="mi">0</span><span class="o">-</span><span class="mi">99</span>

<span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span> <span class="o">-</span> <span class="n">experiment</span> <span class="k">end</span> <span class="n">time</span><span class="p">.</span> <span class="n">eCentisec</span> <span class="n">must</span> <span class="n">be</span> <span class="mi">0</span><span class="o">-</span><span class="mi">99</span>

<span class="nb">text</span> <span class="o">-</span> <span class="n">string</span> <span class="n">containing</span> <span class="nb">text</span> <span class="k">in</span> <span class="k">catalog</span> <span class="n">record</span><span class="p">.</span>  <span class="k">Length</span> <span class="n">must</span> <span class="n">be</span> <span class="n">divisible</span> <span class="k">by</span> <span class="mi">80</span><span class="p">.</span>  <span class="k">No</span> <span class="n">linefeeds</span>
       <span class="n">allowed</span><span class="p">.</span>

<span class="n">madInstObj</span> <span class="o">-</span> <span class="n">a</span> <span class="n">madrigal</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">MadrigalInstrument</span> <span class="k">object</span><span class="p">.</span>  <span class="k">If</span> <span class="k">None</span><span class="p">,</span> <span class="n">one</span> <span class="n">will</span> <span class="n">be</span> <span class="n">created</span><span class="p">.</span>
                  <span class="n">Used</span> <span class="k">to</span> <span class="n">verify</span> <span class="n">kinst</span><span class="p">.</span>

<span class="n">modexpDesc</span> <span class="o">-</span> <span class="n">string</span> <span class="n">describing</span> <span class="n">the</span> <span class="n">modexp</span>

<span class="n">expNotesList</span> <span class="o">-</span> <span class="n">a</span> <span class="n">list</span> <span class="k">of</span> <span class="k">all</span> <span class="n">lines</span> <span class="k">in</span> <span class="n">an</span> <span class="k">existing</span> <span class="k">catalog</span> <span class="n">section</span> <span class="ss">&quot;Experiment Notes&quot;</span> 
    <span class="n">metadata</span> <span class="k">table</span><span class="p">.</span>  <span class="k">All</span> <span class="n">the</span> <span class="n">above</span> <span class="n">attributes</span> <span class="k">are</span> <span class="n">parsed</span> <span class="k">from</span> <span class="n">these</span> <span class="n">lines</span><span class="p">.</span>
</pre></div>


<p>Outputs: None</p>
<p>Returns: None</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.__init__', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kinst</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">modexp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">sYear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sMonth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sDay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">sHour</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sSec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sCentisec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">eYear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eMonth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eDay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">eHour</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eSec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eCentisec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">text</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">madInstObj</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">modexpDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
             <span class="n">expNotesLines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;__init__ creates a MadrigalCatalogRecord.</span>
<span class="sd">    </span>
<span class="sd">    Note: all inputs have default values because there are two ways to populate this structure:</span>
<span class="sd">    1) with all inputs from kinst to text when new data is being created, or </span>
<span class="sd">    2) with catalog line list from existing Hdf5 file Experiment Notes metadata, plus non-default inputs</span>
<span class="sd">    Inputs:</span>
<span class="sd">        kinst - the kind of instrument code.  A warning will be raised if not in instTab.txt.</span>
<span class="sd">        modexp - Code to indicate experimental mode employed. Must be a non-negative integer.</span>
<span class="sd">        sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - experiment start time. sCentisec must be 0-99</span>
<span class="sd">        eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - experiment end time. eCentisec must be 0-99</span>
<span class="sd">        text - string containing text in catalog record.  Length must be divisible by 80.  No linefeeds</span>
<span class="sd">               allowed.</span>
<span class="sd">        madInstObj - a madrigal.metadata.MadrigalInstrument object.  If None, one will be created.</span>
<span class="sd">                          Used to verify kinst.</span>
<span class="sd">                          </span>
<span class="sd">        modexpDesc - string describing the modexp</span>
<span class="sd">                          </span>
<span class="sd">        expNotesList - a list of all lines in an existing catalog section &quot;Experiment Notes&quot; </span>
<span class="sd">            metadata table.  All the above attributes are parsed from these lines.</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create any needed Madrigal objects, if not passed in</span>
    <span class="k">if</span> <span class="n">madInstObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalInstrument</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madInstObj</span>
        
    <span class="k">if</span> <span class="n">expNotesLines</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># get all information from this dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parseExpNotesLines</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="n">kinst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># kinst set via catalog record overrides kinst argument</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
    <span class="c1"># verify kinst set, or raise error</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kinst not set when MadrigalCatalogRecord created - required&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">modexp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModexp</span><span class="p">(</span><span class="n">modexp</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modexpDesc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModexpDesc</span><span class="p">(</span><span class="n">modexpDesc</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                          <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.cmpDataRec">
    <p>def <span class="ident">cmpDataRec</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>cmpDataRec returns a tuple of:
1. 0 if catalog, 1 if header, 2 if data
2.  start datetime
3.  end datetime</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.cmpDataRec', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.cmpDataRec" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">cmpDataRec</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;cmpDataRec returns a tuple of:</span>
<span class="sd">        1. 0 if catalog, 1 if header, 2 if data</span>
<span class="sd">        2.  start datetime</span>
<span class="sd">        3.  end datetime</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># compare record start times</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
        <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">sDT</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="n">typeEnum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">thisType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dataType</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">thisType</span> <span class="o">==</span> <span class="n">dataType</span><span class="p">:</span>
            <span class="n">typeEnum</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">break</span>
        
    <span class="c1"># compare record stop times</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
        <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">eDT</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">return</span><span class="p">((</span><span class="n">typeEnum</span><span class="p">,</span> <span class="n">sDT</span><span class="p">,</span> <span class="n">eDT</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.getEndTimeList">
    <p>def <span class="ident">getEndTimeList</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getEndTimeList returns a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec</p>
<p>Inputs: None</p>
<p>Outputs: a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.getEndTimeList', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.getEndTimeList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getEndTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getEndTimeList returns a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.getKinst">
    <p>def <span class="ident">getKinst</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getKinst returns the kind of instrument code (int) for a given catalog record.</p>
<p>Inputs: None</p>
<p>Outputs: the kind of instrument code (int) for a given catalog record.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.getKinst', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.getKinst" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getKinst returns the kind of instrument code (int) for a given catalog record.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: the kind of instrument code (int) for a given catalog record.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.getLines">
    <p>def <span class="ident">getLines</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getLines returns a numpy recarray of the format expected by the "Experiment Notes" dataset</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.getLines', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.getLines" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getLines returns a numpy recarray of the format expected by the &quot;Experiment Notes&quot; dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># templates</span>
    <span class="n">kreccStr</span> <span class="o">=</span> <span class="s1">&#39;KRECC       2001 Catalogue Record, Version 1&#39;</span>
    <span class="n">kinstTempStr</span> <span class="o">=</span> <span class="s1">&#39;KINSTE     </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span>
    <span class="n">modExpTempStr</span> <span class="o">=</span> <span class="s1">&#39;MODEXP    </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span>
    <span class="n">byearTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBYRT               </span><span class="si">%04i</span><span class="s1"> Beginning year&#39;</span>
    <span class="n">bmdTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBDTT               </span><span class="si">%04i</span><span class="s1"> Beginning month and day&#39;</span>
    <span class="n">bhmTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBHMT               </span><span class="si">%04i</span><span class="s1"> Beginning UT hour and minute&#39;</span>
    <span class="n">bcsTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBCST               </span><span class="si">%04i</span><span class="s1"> Beginning centisecond&#39;</span>
    <span class="n">eyearTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEYRT               </span><span class="si">%04i</span><span class="s1"> Ending year&#39;</span>
    <span class="n">emdTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEDTT               </span><span class="si">%04i</span><span class="s1"> Ending month and day&#39;</span>
    <span class="n">ehmTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEHMT               </span><span class="si">%04i</span><span class="s1"> Ending UT hour and minute&#39;</span>
    <span class="n">ecsTempStr</span> <span class="o">=</span> <span class="s1">&#39;IECST               </span><span class="si">%04i</span><span class="s1"> Ending centisecond&#39;</span>
    
    
    <span class="n">numLines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTextLineCount</span><span class="p">()</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="c1"># 8 times lines, KRECC, KINSTE, MODEXP, and final blank</span>
    <span class="n">textArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="n">numLines</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;File Notes&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">))])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numLines</span><span class="o">-</span><span class="mi">9</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kreccStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kreccStr</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">kinstName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">())</span>
            <span class="n">kinstStr</span> <span class="o">=</span> <span class="n">kinstTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">(),</span> <span class="n">kinstName</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">kinstStr</span> <span class="o">=</span> <span class="n">kinstStr</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
            <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinstStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstStr</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">modExpStr</span> <span class="o">=</span> <span class="n">modExpTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getModexp</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModexpDesc</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modExpStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">modExpStr</span> <span class="o">=</span> <span class="n">modExpStr</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
            <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modExpStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">modExpStr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()[(</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">:(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">]</span>
            
    <span class="c1"># finally add time lines</span>
    <span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="n">sCentisec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
    <span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="n">eCentisec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
    <span class="n">ibdtt</span> <span class="o">=</span> <span class="n">sMonth</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sDay</span>
    <span class="n">ibhmt</span> <span class="o">=</span> <span class="n">sHour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sMin</span>
    <span class="n">ibcst</span> <span class="o">=</span> <span class="n">sSec</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sCentisec</span>
    <span class="n">iedtt</span> <span class="o">=</span> <span class="n">eMonth</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eDay</span>
    <span class="n">iehmt</span> <span class="o">=</span> <span class="n">eHour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eMin</span>
    <span class="n">iecst</span> <span class="o">=</span> <span class="n">eSec</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eCentisec</span>
    
    <span class="n">sYearStr</span> <span class="o">=</span> <span class="n">byearTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">sYear</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sYearStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sYearStr</span><span class="p">))</span>
    <span class="n">sMDStr</span> <span class="o">=</span> <span class="n">bmdTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibdtt</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sMDStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sMDStr</span><span class="p">))</span>
    <span class="n">sHMStr</span> <span class="o">=</span> <span class="n">bhmTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibhmt</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sHMStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sHMStr</span><span class="p">))</span>
    <span class="n">sCSStr</span> <span class="o">=</span> <span class="n">bcsTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibcst</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sCSStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sCSStr</span><span class="p">))</span>
    
    <span class="n">eYearStr</span> <span class="o">=</span> <span class="n">eyearTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">eYear</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eYearStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eYearStr</span><span class="p">))</span>
    <span class="n">eMDStr</span> <span class="o">=</span> <span class="n">emdTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iedtt</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eMDStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eMDStr</span><span class="p">))</span>
    <span class="n">eHMStr</span> <span class="o">=</span> <span class="n">ehmTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iehmt</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eHMStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eHMStr</span><span class="p">))</span>
    <span class="n">eCSStr</span> <span class="o">=</span> <span class="n">ecsTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iecst</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eCSStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eCSStr</span><span class="p">))</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">9</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">80</span>
    
    <span class="k">return</span><span class="p">(</span><span class="n">textArr</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.getModexp">
    <p>def <span class="ident">getModexp</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getModexp returns the mode of experiment code (int) for a given catalog record.</p>
<p>Inputs: None</p>
<p>Outputs: the mode of experiment code (int) for a given catalog record. Returns -1 if not set</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.getModexp', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.getModexp" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getModexp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getModexp returns the mode of experiment code (int) for a given catalog record.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: the mode of experiment code (int) for a given catalog record. Returns -1 if not set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_modexp</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.getModexpDesc">
    <p>def <span class="ident">getModexpDesc</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getModexp returns the description of the mode of experiment code for a given catalog record.</p>
<p>Inputs: None</p>
<p>Outputs: the description of the mode of experiment code for a given catalog record (string).
    Returns empty string if not set</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.getModexpDesc', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.getModexpDesc" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getModexpDesc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getModexp returns the description of the mode of experiment code for a given catalog record.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: the description of the mode of experiment code for a given catalog record (string).</span>
<span class="sd">        Returns empty string if not set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_modexpDesc</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.getStartTimeList">
    <p>def <span class="ident">getStartTimeList</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getStartTimeList returns a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec</p>
<p>Inputs: None</p>
<p>Outputs: a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.getStartTimeList', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.getStartTimeList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getStartTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getStartTimeList returns a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.getText">
    <p>def <span class="ident">getText</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getText returns the catalog text.</p>
<p>Inputs: None</p>
<p>Outputs: the catalog text.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.getText', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.getText" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getText returns the catalog text.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: the catalog text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.getTextLineCount">
    <p>def <span class="ident">getTextLineCount</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getTextLineCount returns the number of 80 character lines in self._text</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.getTextLineCount', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.getTextLineCount" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getTextLineCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getTextLineCount returns the number of 80 character lines in self._text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.getType">
    <p>def <span class="ident">getType</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>returns the type 'catalog'</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.getType', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.getType" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns the type &#39;catalog&#39;&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;catalog&#39;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.setKinst">
    <p>def <span class="ident">setKinst</span>(</p><p>self, kinst)</p>
    </div>
    

    
  
    <div class="desc"><p>setKinst sets the kind of instrument code (int) for a given catalog record.</p>
<p>Inputs: kind of instrument code (integer)</p>
<p>Outputs: None</p>
<p>Affects: sets the kind of instrument code (int) (self._kinst) for a given catalog record.
Prints warning if kinst not found in instTab.txt</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.setKinst', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.setKinst" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kinst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setKinst sets the kind of instrument code (int) for a given catalog record.</span>
<span class="sd">    Inputs: kind of instrument code (integer)</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: sets the kind of instrument code (int) (self._kinst) for a given catalog record.</span>
<span class="sd">    Prints warning if kinst not found in instTab.txt</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kinst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
    <span class="c1"># verify  and set kinst</span>
    <span class="n">instList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentList</span><span class="p">()</span>
    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">inst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">kinst</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="s1">&#39;Unknown instrument&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: kinst </span><span class="si">%i</span><span class="s1"> not found in instTab.txt</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kinst</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span> <span class="o">=</span> <span class="n">kinst</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.setModexp">
    <p>def <span class="ident">setModexp</span>(</p><p>self, modexp)</p>
    </div>
    

    
  
    <div class="desc"><p>setModexp sets the mode of experiment code (int) for a given catalog record.</p>
<p>Inputs: the mode of experiment code (int)</p>
<p>Outputs: None</p>
<p>Affects: sets the mode of experiment code (int) (self._modexp)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.setModexp', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.setModexp" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setModexp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modexp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setModexp sets the mode of experiment code (int) for a given catalog record.</span>
<span class="sd">    Inputs: the mode of experiment code (int)</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: sets the mode of experiment code (int) (self._modexp)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_modexp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">modexp</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.setModexpDesc">
    <p>def <span class="ident">setModexpDesc</span>(</p><p>self, modexpDesc)</p>
    </div>
    

    
  
    <div class="desc"><p>setModexpDesc sets the description of the mode of experiment code for a given catalog record.</p>
<p>Inputs: the description mode of experiment code (string)</p>
<p>Outputs: None</p>
<p>Affects: sets the description of the mode of experiment code (string) (self._modexpDesc)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.setModexpDesc', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.setModexpDesc" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setModexpDesc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modexpDesc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setModexpDesc sets the description of the mode of experiment code for a given catalog record.</span>
<span class="sd">    Inputs: the description mode of experiment code (string)</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: sets the description of the mode of experiment code (string) (self._modexpDesc)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_modexpDesc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">modexpDesc</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.setText">
    <p>def <span class="ident">setText</span>(</p><p>self, text)</p>
    </div>
    

    
  
    <div class="desc"><p>setText sets the catalog text.</p>
<p>Inputs: text: text to be set.  Must be length divisible by 80, and not contain line feeds.</p>
<p>Outputs: None.</p>
<p>Affects: sets self._text</p>
<p>Raise TypeError if problem with test</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.setText', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.setText" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setText sets the catalog text.</span>
<span class="sd">    Inputs: text: text to be set.  Must be length divisible by 80, and not contain line feeds.</span>
<span class="sd">    Outputs: None.</span>
<span class="sd">    Affects: sets self._text</span>
<span class="sd">    Raise TypeError if problem with test</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text must be of type string&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text length must be divisible by 80: len is </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text must not contain linefeed character&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">text</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCatalogRecord.setTimeLists">
    <p>def <span class="ident">setTimeLists</span>(</p><p>self, sYear, sMonth, sDay, sHour, sMin, sSec, sCentisec, eYear, eMonth, eDay, eHour, eMin, eSec, eCentisec)</p>
    </div>
    

    
  
    <div class="desc"><p>setTimeList resets start and end times</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span> <span class="o">-</span> <span class="n">experiment</span> <span class="k">start</span> <span class="n">time</span><span class="p">.</span> <span class="n">sCentisec</span> <span class="n">must</span> <span class="n">be</span> <span class="mi">0</span><span class="o">-</span><span class="mi">99</span>

<span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span> <span class="o">-</span> <span class="n">experiment</span> <span class="k">end</span> <span class="n">time</span><span class="p">.</span> <span class="n">eCentisec</span> <span class="n">must</span> <span class="n">be</span> <span class="mi">0</span><span class="o">-</span><span class="mi">99</span>
</pre></div>


<p>Outputs: None</p>
<p>Affects: sets all time attributes (see code).</p>
<p>Exceptions: Raises ValueError if startTime &gt; endTime</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCatalogRecord.setTimeLists', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCatalogRecord.setTimeLists" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setTimeLists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                 <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setTimeList resets start and end times</span>
<span class="sd">    Inputs:</span>
<span class="sd">        sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - experiment start time. sCentisec must be 0-99</span>
<span class="sd">        eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - experiment end time. eCentisec must be 0-99</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: sets all time attributes (see code).</span>
<span class="sd">    Exceptions: Raises ValueError if startTime &gt; endTime</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># verify times</span>
    <span class="n">sTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">eTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">eTime</span> <span class="o">&lt;</span> <span class="n">sTime</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Starting time cannot be after ending time&#39;</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_sTime</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMadrigalUTFromDT</span><span class="p">(</span><span class="n">sTime</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eTime</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMadrigalUTFromDT</span><span class="p">(</span><span class="n">eTime</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span> <span class="o">=</span> <span class="n">sYear</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span> <span class="o">=</span> <span class="n">sMonth</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span> <span class="o">=</span> <span class="n">sDay</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span> <span class="o">=</span> <span class="n">sHour</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span> <span class="o">=</span> <span class="n">sMin</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span> <span class="o">=</span> <span class="n">sSec</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span> <span class="o">=</span> <span class="n">sCentisec</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span> <span class="o">=</span> <span class="n">eYear</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span> <span class="o">=</span> <span class="n">eMonth</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span> <span class="o">=</span> <span class="n">eDay</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span> <span class="o">=</span> <span class="n">eHour</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span> <span class="o">=</span> <span class="n">eMin</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span> <span class="o">=</span> <span class="n">eSec</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span> <span class="o">=</span> <span class="n">eCentisec</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="madrigal.cedar.MadrigalCedarFile" class="name">class <span class="ident">MadrigalCedarFile</span></p>
      
  
    <div class="desc"><p>MadrigalCedarFile is an object that allows the creation and editing of Cedar files.</p>
<p>This class emulates a python list, and so users may treat it just like a python list.  The
restriction enforced is that all items in the list must be either MadrigalCatalogRecords,
MadrigalHeaderRecords, or MadrigalDataRecords (all also defined in the madrigal.cedar module).
Each of these three classes supports the method getType(), which returns 'catalog', 'header',
and 'data', respectively.</p>
<p>There are two programming patterns to choice from when using this module.  For smaller input or output files,
read in files using the default maxRecords=None, so that the entire file is read into memory.  Output files
using write for hdf5 or netCDF4 output, or writeText with the default append=False for text files.  This
will be somewhat faster than using the larger file pattern below.</p>
<p>For larger files, init the reading with maxRecords = some value, and then read in the rest using loadNextRecords.
Write hdf5 file with a series of dumps, and then close with close(). Write text files using writeText with append
= True.  Write large netCDF4 files by first creating a large Hdf5 file as above, and then use convertToNetCDF4
to create the large netCDF4 file. This approach is somewhat slower, but has a limited memory footprint.</p>
<p>Usage example::</p>
<div class="codehilite"><pre><span></span><span class="c1"># the following example inserts a catalog record at the beginning of an existing file</span>

<span class="kn">import</span> <span class="nn">madrigal.cedar.MadrigalCedarFile</span><span class="o">,</span> <span class="nn">time</span>

<span class="n">cedarObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="s1">&#39;/opt/madrigal/experiments/1998/mlh/20jan98/mil980120g.003.hdf5&#39;</span><span class="p">)</span>

<span class="n">startTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">((</span><span class="mi">1998</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">timezone</span>

<span class="n">endTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">((</span><span class="mi">1998</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">timezone</span>

<span class="c1"># catLines is a list of 80 character lines to be included in catalog record</span>

<span class="n">catObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCatalogRecord</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1998</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
                                              <span class="mi">1998</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span> <span class="n">catLines</span><span class="p">)</span>

<span class="n">cedarObj</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">catObj</span><span class="p">)</span>

<span class="n">cedarObj</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</pre></div>


<p>Non-standard Python modules used: None</p>
<p>Change history:</p>
<p>Major rewrite in Jan 2013 as moved to Hdf5 and Madrigal 3.0</p>
<p>Written by "Bill Rideout":mailto:wrideout@haystack.mit.edu  April. 6, 2005</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MadrigalCedarFile</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;MadrigalCedarFile is an object that allows the creation and editing of Cedar files.</span>

<span class="sd">    This class emulates a python list, and so users may treat it just like a python list.  The</span>
<span class="sd">    restriction enforced is that all items in the list must be either MadrigalCatalogRecords,</span>
<span class="sd">    MadrigalHeaderRecords, or MadrigalDataRecords (all also defined in the madrigal.cedar module).</span>
<span class="sd">    Each of these three classes supports the method getType(), which returns &#39;catalog&#39;, &#39;header&#39;,</span>
<span class="sd">    and &#39;data&#39;, respectively.</span>
<span class="sd">    </span>
<span class="sd">    There are two programming patterns to choice from when using this module.  For smaller input or output files,</span>
<span class="sd">    read in files using the default maxRecords=None, so that the entire file is read into memory.  Output files</span>
<span class="sd">    using write for hdf5 or netCDF4 output, or writeText with the default append=False for text files.  This</span>
<span class="sd">    will be somewhat faster than using the larger file pattern below.</span>
<span class="sd">    </span>
<span class="sd">    For larger files, init the reading with maxRecords = some value, and then read in the rest using loadNextRecords.</span>
<span class="sd">    Write hdf5 file with a series of dumps, and then close with close(). Write text files using writeText with append</span>
<span class="sd">    = True.  Write large netCDF4 files by first creating a large Hdf5 file as above, and then use convertToNetCDF4</span>
<span class="sd">    to create the large netCDF4 file. This approach is somewhat slower, but has a limited memory footprint.</span>
<span class="sd"> </span>

<span class="sd">    Usage example::</span>

<span class="sd">        # the following example inserts a catalog record at the beginning of an existing file</span>

<span class="sd">        import madrigal.cedar.MadrigalCedarFile, time</span>
<span class="sd">    </span>
<span class="sd">        cedarObj = madrigal.cedar.MadrigalCedarFile(&#39;/opt/madrigal/experiments/1998/mlh/20jan98/mil980120g.003.hdf5&#39;)</span>

<span class="sd">        startTime = time.mktime((1998,1,20,0,0,0,0,0,0)) - time.timezone</span>

<span class="sd">        endTime = time.mktime((1998,1,21,23,59,59,0,0,0)) - time.timezone</span>

<span class="sd">        # catLines is a list of 80 character lines to be included in catalog record</span>

<span class="sd">        catObj = madrigal.cedar.MadrigalCatalogRecord(31, 1000, 1998,1,20,0,0,0,0,</span>
<span class="sd">                                                      1998,1,21,23,59,59,99, catLines)</span>

<span class="sd">        cedarObj.insert(0, catObj)</span>

<span class="sd">        cedarObj.write()</span>


<span class="sd">    Non-standard Python modules used: None</span>


<span class="sd">    Change history:</span>
<span class="sd">    </span>
<span class="sd">    Major rewrite in Jan 2013 as moved to Hdf5 and Madrigal 3.0</span>

<span class="sd">    Written by &quot;Bill Rideout&quot;:mailto:wrideout@haystack.mit.edu  April. 6, 2005</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># cedar special values</span>
    <span class="n">missing</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">missing_int</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
    <span class="n">requiredFields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;sec&#39;</span><span class="p">,</span> <span class="s1">&#39;recno&#39;</span><span class="p">,</span> <span class="s1">&#39;kindat&#39;</span><span class="p">,</span> <span class="s1">&#39;kinst&#39;</span><span class="p">,</span> 
                          <span class="s1">&#39;ut1_unix&#39;</span><span class="p">,</span> <span class="s1">&#39;ut2_unix&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullFilename</span><span class="p">,</span>
		 <span class="n">createFlag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">startDatetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">endDatetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">maxRecords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">recDset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">arraySplitParms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">skipArray</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__init__ initializes MadrigalCedarFile by reading in existing file, if any.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            fullFilename - either the existing Cedar file in Hdf5 format,</span>
<span class="sd">                           or a file to be created. May also be None if this</span>
<span class="sd">                           data is simply derived parameters that be written to stdout.</span>

<span class="sd">            createFlag - tells whether this is a file to be created.  If False and</span>
<span class="sd">                         fullFilename cannot be read, an error is raised.  If True and</span>
<span class="sd">                         fullFilename already exists, or fullFilename cannot be created,</span>
<span class="sd">                         an error is raised.</span>
<span class="sd">                         </span>
<span class="sd">            startDatetime - if not None (the default), reject all input records where</span>
<span class="sd">                  record end time &lt; startDatetime (datetime.datetime object).</span>
<span class="sd">                  Ignored if createFlag == True</span>
<span class="sd">    </span>
<span class="sd">            endDatetime - if not None (the default), reject all input records where</span>
<span class="sd">                  record start time &gt; endDatetime (datetime.datetime object)</span>
<span class="sd">                  Ignored if createFlag == True</span>
<span class="sd">                  </span>
<span class="sd">            maxRecords - the maximum number of records to read into memory</span>
<span class="sd">                    Ignored if createFlag == True</span>
<span class="sd">                    </span>
<span class="sd">            recDset - a numpy recarray with column names the names of all parameters, starting</span>
<span class="sd">                with requiredFields.  Values are 1 for 1D (all the required parms are 1D), 2 for</span>
<span class="sd">                dependent 2D, and 3 for independent spatial 2D parameters.  If None, self._recDset</span>
<span class="sd">                not set until first data record appended.</span>
<span class="sd">                </span>
<span class="sd">            arraySplitParms - if None (the default), read in arraySplitParms from the exiting file.</span>
<span class="sd">                Otherwise set self._arraySplitParms to arraySplitParms, which is a list of 1D or 2D parms</span>
<span class="sd">                where each unique set of value of the parms in this list will be used to split the full</span>
<span class="sd">                data into separate arrays in Hdf5 or netCDF4 files.  For example arraySplitParms=[&#39;beamid&#39;]</span>
<span class="sd">                would split the data into separate arrays for each beamid. If None and new file is being</span>
<span class="sd">                created, no array splitting (self._arraySplitParms = []).</span>
<span class="sd">                </span>
<span class="sd">            skipArray - if False and any 2D parms, create array layout (the default).  If True, skip array</span>
<span class="sd">                layout (typically used when there are too many ind parm value combinations - generally not recommended).</span>
<span class="sd">            </span>
<span class="sd">	        </span>
<span class="sd">        Affects: populates self._privList if file exists.  self._privList is the underlying</span>
<span class="sd">            list of MadrigalDataRecords, MadrigalCatalogRecords, and MadrigalHeaderRecords.</span>
<span class="sd">            Also populates:</span>
<span class="sd">                self._tableDType - the numpy dtype to use to build the table layout  </span>
<span class="sd">                self._nextRecord - the index of the next record to read from the input file. Not used if</span>
<span class="sd">                    createFlag = True</span>
<span class="sd">                    (The following are the input arguments described above)</span>
<span class="sd">                self._fullFilename</span>
<span class="sd">                self._createFlag</span>
<span class="sd">                self._startDatetime</span>
<span class="sd">                self._endDatetime</span>
<span class="sd">                self._maxRecords</span>
<span class="sd">                self._totalDataRecords - number of data records appended (may differ from len(self._privList)</span>
<span class="sd">                    if dump called).</span>
<span class="sd">                self._minMaxParmDict - a dictionary with key = parm mnems, value = tuple of</span>
<span class="sd">                    min, max values (may be nan)</span>
<span class="sd">                self._arrDict - a dictionary with key = list of array split parm values found in file,</span>
<span class="sd">                    (&#39;&#39; if no spliting), and values = dict of key = &#39;ut1_unix&#39; and ind 2d parm names (excluding</span>
<span class="sd">                    array splitting parms, if also ind 2D parm), and values</span>
<span class="sd">                    = python set of all unique values.  Populated only if createFlag=True. Used to create</span>
<span class="sd">                    Array Layout</span>
<span class="sd">                self._recIndexList - a list of (startIndex, endIndex) for each data record added.  Used to slice out</span>
<span class="sd">                    data records from Table Layout</span>
<span class="sd">                self._num2DSplit - Number of arraySplitParms that are 2D</span>
<span class="sd">                self._closed - a boolean used to determine if the file being created was already closed</span>
<span class="sd">                </span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">        </span>
<span class="sd">        Returns: void</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span> <span class="o">=</span> <span class="n">fullFilename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_startDatetime</span> <span class="o">=</span> <span class="n">startDatetime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endDatetime</span> <span class="o">=</span> <span class="n">endDatetime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxRecords</span> <span class="o">=</span> <span class="n">maxRecords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_totalDataRecords</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set to the dtype of Table Layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set when first data record appended</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set when first data record appended</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set when first data record appended</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="n">arraySplitParms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skipArray</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">skipArray</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">createFlag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># no need to close file only being read</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;.hdf&#39;</span><span class="p">)</span>
        
        <span class="c1"># keep track of earliest and latest record times</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># summary info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># a list of all kinsts integers in file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># a list of all kindats integers in file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span> <span class="c1"># can be externally set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used to check that partial writes via dump are consistent</span>

        <span class="k">if</span> <span class="n">createFlag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;in MadrigalCedarFile, createFlag must be either True or False&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_createFlag</span> <span class="o">=</span> <span class="n">createFlag</span>

        <span class="k">if</span> <span class="n">createFlag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;in MadrigalCedarFile, fullFilename </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fullFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;MadrigalCedarFile can only read in CEDAR Hdf5 files, not </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fullFilename</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">createFlag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fullFilename</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># then this data will never be persisted - only written to stdout</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;in MadrigalCedarFile, fullFilename </span><span class="si">%s</span><span class="s1"> already exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;in MadrigalCedarFile, fullFilename </span><span class="si">%s</span><span class="s1"> cannot be created&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fullFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;All Madrigal files must end with hdf5 extension, &lt;</span><span class="si">%s</span><span class="s1">&gt; does not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="p">[]</span>
                
        <span class="c1"># create needed Madrigal objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madDBObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalDB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalInstrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDBObj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDBObj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalKindat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDBObj</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set to bool when first record added</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">recDset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">=</span> <span class="n">recDset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">createFlag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maxRecords</span><span class="p">)</span>
        
                
        
    <span class="k">def</span> <span class="nf">loadNextRecords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numRecords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">removeExisting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;loadNextRecords loads a maximum of numRecords.  Returns tuple of the the number of records loaded, and boolean of whether complete.</span>
<span class="sd">        May be less than numRecords if not enough records in the input file.  Returns 0 if no records left.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            numRecords - number of records to try to load.  If None, load all remaining records</span>
<span class="sd">            </span>
<span class="sd">            removeExisting - if True (the default), remove existing records before loading new</span>
<span class="sd">                ones.  If False, append new records to existing records.</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            </span>
<span class="sd">                tuple of the the number of records loaded, and boolean of whether complete. </span>
<span class="sd">                May be less than numRecords if not enough records.  </span>
<span class="sd">                </span>
<span class="sd">        Raises error if file opened with createFlag = True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createFlag</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Cannot call loadNextRecords when creating a new MadrigalCedarFile&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">removeExisting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="n">isComplete</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="n">hdfFile</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">tableDset</span> <span class="o">=</span> <span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">][</span><span class="s2">&quot;Table Layout&quot;</span><span class="p">]</span>
        <span class="n">metadataGroup</span> <span class="o">=</span> <span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">]</span>
        <span class="n">recDset</span> <span class="o">=</span> <span class="n">metadataGroup</span><span class="p">[</span><span class="s2">&quot;_record_layout&quot;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">=</span> <span class="n">recDset</span><span class="p">[()]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">!=</span> <span class="n">recDset</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;recDset in first record &lt;</span><span class="si">%s</span><span class="s1">&gt; does not match expected recDset &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> \
                    <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">recDset</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verifyFormat</span><span class="p">(</span><span class="n">tableDset</span><span class="p">,</span> <span class="n">recDset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="o">=</span> <span class="n">tableDset</span><span class="o">.</span><span class="n">dtype</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">][</span><span class="s1">&#39;Experiment Parameters&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getKinstList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getKindatList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getArraySplitParms</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;Experiment Notes&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_appendCatalogRecs</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">][</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_appendHeaderRecs</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">][</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">])</span>
            
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parmObjList</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">)</span> <span class="c1"># used for performance in load</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parmObjList</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="c1"># get indices for each record</span>
        <span class="n">recLoaded</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">recTested</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;recnoArr&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recnoArr</span> <span class="o">=</span> <span class="n">tableDset</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span>
        <span class="c1"># read all the records in at once for performance</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numRecords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recnoArr</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">+</span> <span class="n">numRecords</span><span class="p">]))</span>
            <span class="n">tableIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableIndices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fullTableSlice</span> <span class="o">=</span> <span class="n">tableDset</span><span class="p">[</span><span class="n">tableIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">tableIndices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">fullRecnoArr</span> <span class="o">=</span> <span class="n">fullTableSlice</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fullTableSlice</span> <span class="o">=</span> <span class="n">tableDset</span>
            <span class="n">fullRecnoArr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recnoArr</span>
            
        <span class="k">while</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">numRecords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableIndices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">isComplete</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">numRecords</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">recTested</span> <span class="o">&gt;=</span> <span class="n">numRecords</span><span class="p">:</span>
                    <span class="k">break</span>
                
            <span class="c1"># get slices of tableDset and recDset to create next MadrigalDataRecord</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">fullRecnoArr</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
            <span class="n">tableIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableIndices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">isComplete</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
            <span class="n">tableSlice</span> <span class="o">=</span> <span class="n">fullTableSlice</span><span class="p">[</span><span class="n">tableIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">tableIndices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tableIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">tableIndices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="n">firstRow</span> <span class="o">=</span> <span class="n">tableSlice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">startDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">])</span>
            <span class="n">stopDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">])</span>
                
            <span class="k">if</span> <span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">])</span>
            
            <span class="c1"># find earliest and latest times</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="n">startDT</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="n">stopDT</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">startDT</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="n">startDT</span>
                <span class="k">if</span> <span class="n">stopDT</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="n">stopDT</span>
                    
            <span class="n">recTested</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># increment here because the next step may reject it</span>
            
            <span class="c1"># check if datetime filter should be applied</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startDatetime</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endDatetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startDatetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">stopDT</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startDatetime</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endDatetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">startDT</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endDatetime</span><span class="p">:</span>
                        <span class="n">isComplete</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">indParmList</span> <span class="o">=</span> <span class="n">metadataGroup</span><span class="p">[</span><span class="s1">&#39;Independent Spatial Parameters&#39;</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span>
                    <span class="n">indParms</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">indParms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">indParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span>
                
                    
            <span class="n">newMadDataRec</span> <span class="o">=</span> <span class="n">MadrigalDataRecord</span><span class="p">(</span><span class="n">madInstObj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="p">,</span> <span class="n">madParmObj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="p">,</span>
                                               <span class="n">dataset</span><span class="o">=</span><span class="n">tableSlice</span><span class="p">,</span> <span class="n">recordSet</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">,</span> 
                                               <span class="n">parmObjList</span><span class="o">=</span><span class="n">parmObjList</span><span class="p">,</span> <span class="n">ind2DList</span><span class="o">=</span><span class="n">indParms</span><span class="p">)</span>
            

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="n">newMadDataRec</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="n">newMadDataRec</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="n">newMadDataRec</span><span class="o">.</span><span class="n">getInd2DParms</span><span class="p">()</span>
                <span class="n">parmObjList</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">)</span> <span class="c1"># used for performance in load</span>
                <span class="c1"># set self._num2DSplit</span>
                <span class="n">twoDSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">mnemonic</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">])</span>
                <span class="n">arraySplitSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDSet</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">arraySplitSet</span><span class="p">))</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newMadDataRec</span><span class="p">)</span>
            <span class="n">recLoaded</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="n">hdfFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="c1"># update minmax</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totalDataRecords</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateMinMaxParmDict</span><span class="p">()</span>
        
        <span class="k">return</span><span class="p">((</span><span class="n">recLoaded</span><span class="p">,</span> <span class="n">isComplete</span><span class="p">))</span>
            
            


    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">arraySplittingParms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skipArrayLayout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;write persists a MadrigalCedarFile to file.</span>
<span class="sd">        </span>
<span class="sd">        Note:  There are two ways to write to a MadrigalCedarFile.  Either this method (write) is called after all the</span>
<span class="sd">        records have been appended to the MadrigalCedarFile, or dump is called after a certain number of records are appended,</span>
<span class="sd">        and then at the end dump is called a final time if there were any records not yet dumped, followed by close.</span>
<span class="sd">        The __del__ method will automatically call close if needed, and print a warning that the user should add it to</span>
<span class="sd">        their code.</span>
<span class="sd">        </span>
<span class="sd">        write has the advantage of being simplier, but has the disadvantage for larger files of keeping all those records</span>
<span class="sd">        in memory.  dump/close has the advantage of significantly reducing the memory footprint, but is somewhat more complex.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            format - a format to save the file in.  For now, the allowed values are </span>
<span class="sd">            &#39;hdf5&#39; and &#39;netCDF4&#39;.  Defaults to &#39;hdf5&#39;. Use writeText method to get text output.</span>

<span class="sd">            newFilename - a filename to save to.  Defaults to self._fullFilename passed into initializer if not given.</span>

<span class="sd">            refreshCatHeadTimes - if True (the default), update start and and times in the catalog and header</span>
<span class="sd">                records to represent the times in the data.  If False, use existing times in those records.</span>
<span class="sd">                </span>
<span class="sd">            skipArrayLayout - if True, do not include Array Layout even if there are independent spatial</span>
<span class="sd">                parameters.  If False (the default) write Array Layout if there are independent spatial</span>
<span class="sd">                parameters and format = &#39;hdf5&#39;</span>
<span class="sd">                </span>
<span class="sd">            arraySplittingParms - a list of parameters as mnemonics used to split</span>
<span class="sd">                arrays into subarrays.  For example, beamcode would split data with separate beamcodes</span>
<span class="sd">                into separate arrays. The number of separate arrays will be up to the product of the number of </span>
<span class="sd">                unique values found for each parameter, with the restriction that combinations with no records will</span>
<span class="sd">                not create a separate array. If default None passed in, then set to self._arraySplitParms, </span>
<span class="sd">                set when CEDAR file read in.</span>
<span class="sd">                </span>
<span class="sd">            overwrite - if False (the default) do not overwrite existing file.  If True, overwrite file is it already exists.</span>
<span class="sd">                </span>
<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: writes a MadrigalCedarFile to file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot call write method after calling dump method&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">newFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span>
            
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal format &lt;</span><span class="si">%s</span><span class="s1">&gt; - must be hdf5 or netCDF4&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;newFilename &lt;</span><span class="si">%s</span><span class="s1">&gt; already exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newFilename</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">=</span> <span class="nb">format</span>
        
        <span class="k">if</span> <span class="n">arraySplittingParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arraySplittingParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span>
        <span class="k">if</span> <span class="n">arraySplittingParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arraySplittingParms</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">newFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;filename must end with </span><span class="si">%s</span><span class="s1">, &lt;</span><span class="si">%s</span><span class="s1">&gt; does not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">),</span> <span class="n">newFilename</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># we need to make sure this file is closed and then deleted if an error</span>
                <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used if next line fails</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Metadata</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Data</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_createArrayLayout</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">arraySplittingParms</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># on any error, close and delete file, then reraise error</span>
                <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newFilename</span><span class="p">)</span>
                <span class="k">raise</span>
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">==</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># we need to make sure this file is closed and then deleted if an error</span>
                <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used if next line fails</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_writeNetCDF4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">arraySplittingParms</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># on any error, close and delete file, then reraise error</span>
                <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newFilename</span><span class="p">)</span>
                <span class="k">raise</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># write ends with closed file</span>
            




    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dump appends all the present records in MadrigalCedarFile to file, and removes present data records from MadrigalCedarFile.</span>

<span class="sd">        Can be used to append records to a file. Catalog and header records are maintaained.</span>
<span class="sd">        </span>
<span class="sd">        Typically close is called after all calls to dump. The __del__ method will automatically call </span>
<span class="sd">        close if needed, and print a warning that the user should add it to their code.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            format - a format to save the file in.  The format argument only exists for backwards</span>
<span class="sd">                compatibility - only hdf5 is allowed.  IOError raised is any other argument given.</span>
<span class="sd">                </span>
<span class="sd">            newFilename - a filename to save to.  Defaults to self._fullFilename passed into initializer if not given.</span>
<span class="sd">                </span>
<span class="sd">            parmIndexDict - used only for dumping netCDF4</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: writes a MadrigalCedarFile to file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">!=</span> <span class="nb">format</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Previous dump format was </span><span class="si">%s</span><span class="s1">, cannot now use </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">format</span><span class="p">)))</span>

        <span class="k">if</span> <span class="nb">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Format must be hdf5 for dump, not </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">format</span><span class="p">)))</span>
        
        <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">newFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># first write - run checks, and create all possible metadata and data</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;newFilename &lt;</span><span class="si">%s</span><span class="s1">&gt; already exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newFilename</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">newFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;.nc&#39;</span><span class="p">])):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;filename must end with </span><span class="si">%s</span><span class="s1">, &lt;</span><span class="si">%s</span><span class="s1">&gt; does not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;.nc&#39;</span><span class="p">])),</span> <span class="n">newFilename</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">newFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;filename must end with </span><span class="si">%s</span><span class="s1">, &lt;</span><span class="si">%s</span><span class="s1">&gt; does not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">,</span> <span class="n">newFilename</span><span class="p">))</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># nothing to dump</span>
            <span class="k">return</span>
        
        
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
        
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># we need to make sure this file is closed and then deleted if an error</span>
                <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used if next line fails</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasArray</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Cannot call dump for hdf5 after write or close&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Data</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># on any error, close and delete file, then reraise error</span>
                <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newFilename</span><span class="p">)</span>
                <span class="k">raise</span>
            
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Cannot dump netCDF4 files with arraySplitParms - write to Hdf5 and then convert&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># first write</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_firstDumpNetCDF4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_appendNetCDF4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
                

        <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">=</span> <span class="nb">format</span>
        
        <span class="c1"># dump data records out of memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="o">=</span> <span class="p">[</span><span class="n">rec</span> <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">]</span>
        
        
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;close closes an open MadrigalCedarFile.  It calls _writeHdf5Metadata and _addArray if ind parms.</span>
<span class="sd">        </span>
<span class="sd">        Most be called directly when dump used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span><span class="p">:</span>
            <span class="c1"># nothing to do</span>
            <span class="k">return</span>
        
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Metadata</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skipArray</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_addArrayDump</span><span class="p">()</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">True</span>
        
        
        
    <span class="k">def</span> <span class="nf">writeText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="n">showHeaders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">selectParms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">filterList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">assumed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">knownbad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">firstWrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;writeText writes text to new filename</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            newFilename - name of new file to create and write to.  If None, the default, write to stdout</span>
<span class="sd">            </span>
<span class="sd">            summary - type of summary line to print at top.  Allowed values are:</span>
<span class="sd">                &#39;plain&#39; - text only mnemonic names, but only if not showHeaders</span>
<span class="sd">                &#39;html&#39; - mnemonic names wrapped in standard javascript code to allow descriptive popups</span>
<span class="sd">                &#39;summary&#39; - print overview of file and filters used. Also text only mnemonic names, </span>
<span class="sd">                    but only if not showHeaders</span>
<span class="sd">                None - no summary line</span>
<span class="sd">                </span>
<span class="sd">            showHeaders - if True, print header in format for each record.  If False, the default,</span>
<span class="sd">                do not.</span>
<span class="sd">                </span>
<span class="sd">            selectParms - If None, simply print all parms that are in the file.  If a list</span>
<span class="sd">                of parm mnemonics, print only those parms in the order specified.</span>
<span class="sd">                </span>
<span class="sd">            filterList - a list of madrigal.derivation.MadrigalFilter objects to be described in the </span>
<span class="sd">                summary.  Default is None, in which case not described in summary.  Ignored if summary</span>
<span class="sd">                is not &#39;summary&#39;</span>
<span class="sd">                </span>
<span class="sd">            missing, assumed, knownbad - how to print Cedar special values.  Default is None for</span>
<span class="sd">                all, so that value printed in value in numpy table as per spec.</span>
<span class="sd">                </span>
<span class="sd">            append - if True, open newFilename in append mode, and dump records after writing.  If False, </span>
<span class="sd">                open in write mode. Used to allow writing in conjuction with loadNextRecords.</span>
<span class="sd">                </span>
<span class="sd">            firstWrite - True if this is the first group of records added, and append mode is True.</span>
<span class="sd">                Used to know whether to write summary lines.  If False and append is True, no summary</span>
<span class="sd">                lines are added; if True and append is True, summary lines are added.  If append is not </span>
<span class="sd">                True, this argument ignored.</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># constants </span>
        <span class="n">_underscore</span> <span class="o">=</span> <span class="mi">95</span> <span class="c1"># used to indicate missing character</span>
        
        <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
            
        <span class="k">if</span> <span class="n">summary</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal summary value &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">summary</span><span class="p">)))</span>
        
        <span class="c1"># cache information needed to replace special values if needed</span>
        <span class="c1"># helps performance when replacing</span>
        <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
            <span class="n">missing_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
            <span class="n">missing_search</span> <span class="o">=</span> <span class="s1">&#39;\ &#39;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">missing_len</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;nan&#39;</span>
            <span class="k">if</span> <span class="n">missing_len</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">missing</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">missing_len</span><span class="p">)</span> <span class="o">+</span> <span class="n">missing</span>
        <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">assumed</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">assumed</span><span class="p">)</span>
            <span class="n">assumed_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assumed</span><span class="p">)</span>
            <span class="n">assumed_search</span> <span class="o">=</span> <span class="s1">&#39;\ &#39;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">assumed_len</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;inf&#39;</span>
            <span class="k">if</span> <span class="n">assumed_len</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">assumed</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">assumed_len</span><span class="p">)</span> <span class="o">+</span> <span class="n">assumed</span>
        <span class="k">if</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">knownbad</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">knownbad</span><span class="p">)</span>
            <span class="n">knownbad_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">knownbad</span><span class="p">)</span>
            <span class="n">knownbad_search</span> <span class="o">=</span> <span class="s1">&#39;\ &#39;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">knownbad_len</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-inf&#39;</span>
            <span class="k">if</span> <span class="n">knownbad_len</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">knownbad</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="n">knownbad_len</span><span class="p">)</span> <span class="o">+</span> <span class="n">knownbad</span>
            
        <span class="c1"># create format string and header strings</span>
        <span class="n">formatStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">parmStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">selectParms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="o">.</span><span class="n">names</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmFormat</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># first handle float formats</span>
                <span class="n">dataWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">format</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)])</span>
                <span class="c1"># make sure width is big enough for special values</span>
                <span class="n">newDataWidth</span> <span class="o">=</span> <span class="n">dataWidth</span>
                <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">newDataWidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">newDataWidth</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">newDataWidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">newDataWidth</span><span class="p">,</span> <span class="n">dataWidth</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">assumed</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">newDataWidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">newDataWidth</span><span class="p">,</span> <span class="n">dataWidth</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">knownbad</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">newDataWidth</span> <span class="o">&gt;</span> <span class="n">dataWidth</span><span class="p">:</span>
                    <span class="c1"># we need to expand format</span>
                    <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%%%i%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newDataWidth</span><span class="p">,</span> <span class="nb">format</span><span class="p">[</span><span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):])</span>
                    <span class="n">dataWidth</span> <span class="o">=</span> <span class="n">newDataWidth</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="c1"># now handle integer or string formats - assumed to never be error values</span>
                <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c1"># we need to insert a length</span>
                        <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%%%i</span><span class="s1">i&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmWidth</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">dataWidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmWidth</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dataWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">format</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">dataWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">format</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
            <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmWidth</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span> <span class="n">dataWidth</span><span class="p">)</span>
            <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span><span class="p">)</span>
            <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">-</span><span class="n">dataWidth</span><span class="p">))</span> <span class="c1"># sets spacing between numbers</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># need to truncate name</span>
                <span class="k">if</span> <span class="n">summary</span> <span class="o">!=</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                    <span class="n">parmStr</span> <span class="o">+=</span> <span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parmStr</span> <span class="o">+=</span> <span class="s2">&quot;&lt;a href=JavaScript:popup(&#39;</span><span class="si">%s</span><span class="s2">&#39;) title=&#39;</span><span class="si">%s</span><span class="s2">, units=</span><span class="si">%s</span><span class="s2">&#39;&gt;</span><span class="si">%s</span><span class="s2">&lt;/a&gt;&amp;nbsp;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                                                                                     <span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># pad evenly on both sides</span>
                <span class="n">firstHalfSpace</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">width</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">secHalfSpace</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">width</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span> <span class="o">-</span> <span class="n">firstHalfSpace</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">summary</span> <span class="o">!=</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                    <span class="n">parmStr</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">firstHalfSpace</span> <span class="o">+</span> <span class="n">parm</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">secHalfSpace</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parmStr</span> <span class="o">+=</span> <span class="s1">&#39;&amp;nbsp;&#39;</span> <span class="o">*</span> <span class="n">firstHalfSpace</span> 
                    <span class="n">parmStr</span> <span class="o">+=</span> <span class="s2">&quot;&lt;a href=JavaScript:popup(&#39;</span><span class="si">%s</span><span class="s2">&#39;) title=&#39;</span><span class="si">%s</span><span class="s2">, units=</span><span class="si">%s</span><span class="s2">&#39;&gt;</span><span class="si">%s</span><span class="s2">&lt;/a&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                                                               <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                                                                               <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                                                                               <span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                    <span class="n">parmStr</span> <span class="o">+=</span> <span class="s1">&#39;&amp;nbsp;&#39;</span> <span class="o">*</span> <span class="n">secHalfSpace</span>
                    
        <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">firstHeaderPrinted</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># state variable for adding extra space between lines</span>
        
        <span class="k">if</span> <span class="n">summary</span> <span class="o">==</span> <span class="s1">&#39;summary&#39;</span><span class="p">:</span> 
            <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span> <span class="ow">or</span> <span class="p">(</span><span class="n">append</span> <span class="ow">and</span> <span class="n">firstWrite</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_printSummary</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">filterList</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">summary</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">showHeaders</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span> <span class="ow">or</span> <span class="p">(</span><span class="n">append</span> <span class="ow">and</span> <span class="n">firstWrite</span><span class="p">):</span>
                <span class="c1"># print single header at top</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parmStr</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">summary</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;br&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># nothing more to write</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span>
        
        <span class="c1"># see if only 1D parms are selected, which implies printing only a single line per record</span>
        <span class="n">is1D</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#make sure its a lowercase list</span>
            <span class="n">selectParms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">selectParms</span><span class="p">)</span>
            <span class="n">selectParms</span> <span class="o">=</span> <span class="n">getLowerCaseList</span><span class="p">(</span><span class="n">selectParms</span><span class="p">)</span>
            <span class="c1"># see if only 1D parameters are being printed, so that we should only print the first row</span>
            <span class="n">is1D</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">recordset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRecordset</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">selectParms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">recordset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">is1D</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
                
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="k">if</span> <span class="n">showHeaders</span><span class="p">:</span>
                <span class="n">kinst</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
                <span class="n">instDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentName</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
                <span class="n">sDT</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
                <span class="n">sDTStr</span> <span class="o">=</span> <span class="n">sDT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H%M:%S&#39;</span><span class="p">)</span>
                <span class="n">eDT</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
                <span class="n">eDTStr</span> <span class="o">=</span> <span class="n">eDT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M:%S&#39;</span><span class="p">)</span>
                <span class="n">headerStr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">instDesc</span><span class="p">,</span> <span class="n">sDTStr</span><span class="p">,</span> <span class="n">eDTStr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">firstHeaderPrinted</span> <span class="ow">or</span> <span class="n">summary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">headerStr</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">headerStr</span><span class="p">))</span>
                    <span class="n">firstHeaderPrinted</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parmStr</span><span class="p">))</span>
                
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getDataset</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">recnoSet</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># used to see if we are at a new record</span>
                <span class="n">dataset_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">selectParms</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dataset_view</span> <span class="o">=</span> <span class="n">dataset</span>
                
            <span class="c1"># modify special values if required</span>
            <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dataset_view</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="c1"># set all -1 values to inf</span>
                            <span class="n">assumedIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dataset_view</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assumedIndices</span><span class="p">):</span>
                                <span class="n">dataset_view</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">assumedIndices</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">Inf</span>
                        <span class="k">if</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="c1"># set all -2 values to ninf</span>
                            <span class="n">knownbadIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dataset_view</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">knownbadIndices</span><span class="p">):</span>
                                <span class="n">dataset_view</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">knownbadIndices</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">NINF</span>
                            
            <span class="n">lastRecno</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_view</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">thisRecno</span> <span class="o">=</span> <span class="n">recnoSet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">is1D</span> <span class="ow">and</span> <span class="p">(</span><span class="n">thisRecno</span> <span class="o">==</span> <span class="n">lastRecno</span><span class="p">):</span>
                        <span class="k">continue</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dataset_view</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">formatStr</span> <span class="o">%</span> <span class="n">data</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1"># something bad happened - give up and just convert data to a string</span>
                    <span class="n">textList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
                    <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textList</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="c1"># modify special values if required</span>
                <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">missing_search</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">knownbad_search</span><span class="p">,</span> <span class="n">knownbad</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">assumed_search</span><span class="p">,</span> <span class="n">assumed</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">summary</span> <span class="o">!=</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;nbsp;&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">summary</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;br&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">lastRecno</span> <span class="o">=</span> <span class="n">thisRecno</span>
                    
        <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
            <span class="c1"># remove all records</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="o">=</span> <span class="p">[]</span>
            
        
        
    <span class="k">def</span> <span class="nf">getDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getDType returns the dtype of the table array in this file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">setDType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setDType sets the dtype of the table array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="o">=</span> <span class="n">dtype</span>
        
        
    <span class="k">def</span> <span class="nf">getRecDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRecDType returns the dtype of _record_layout</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">getRecordset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRecordset returns the recordset array from the first data record.</span>
<span class="sd">        </span>
<span class="sd">        Raises IOError if None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;self._recDset is None&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">get1DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get1DParms returns a list of mnemonics of 1D parms</span>
<span class="sd">        in file.  May be empty if none. </span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if self._oneDList is None, since parameters unknown</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;get1DParms cannot be called before any data records added to this file&#39;</span><span class="p">)</span>
        
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">get2DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get2DParms returns a list of mnemonics of dependent 2D parms</span>
<span class="sd">        in file.  May be empty if none. </span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if self._twoDList is None, since parameters unknown</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;get2DParms cannot be called before any data records added to this file&#39;</span><span class="p">)</span>
        
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
        
        
        
    <span class="k">def</span> <span class="nf">getIndSpatialParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getIndSpatialParms returns a list of mnemonics of independent spatial parameters</span>
<span class="sd">        in file.  May be empty if none. </span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if self._ind2DList is None, since parameters unknown</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;getIndSpatialParms cannot be called before any data records added to this file&#39;</span><span class="p">)</span>
        
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">getArraySplitParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getArraySplitParms returns a list of mnemonics of parameters used to split array.  May be empty or None. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getParmDim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getParmDim returns the dimension (1,2, or 3 for independent spatial parms) of input parm</span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if no data records yet.</span>
<span class="sd">        Raise KeyError if that parameter not found in file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;getParmDim cannot be called before any data records added to this file&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># do ind 2D next since they are in both lists</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in data&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        
        
    <span class="k">def</span> <span class="nf">getStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStatus returns the status string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">setStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setStatus sets the status string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">getEarliestDT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getEarliestDT returns the earliest datetime found in file, or None if no data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getLatestDT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getLatestDT returns the latest datetime found in file, or None if no data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getKinstList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKinstList returns the list of kinst integers in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getKindatList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKindatList returns the list of kindat integers in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">getRecIndexList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRecIndexList returns a list of record indexes into Table Layout</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">parmIsInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parmIsInt returns True if this parm (mnemonic) is integer type, False if not</span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if parm not in record. or table dtype not yet set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot call parmIsInt until a data record is added&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">typeStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">typeStr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">parmIsString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parmIsString returns True if this parm (mnemonic) is string type, False if not</span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if parm not in record. or table dtype not yet set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot call parmIsInt until a data record is added&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">typeStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">typeStr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">getStringFormat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStringFormat returns string format string.  Raises error if not string type,</span>
<span class="sd">        or parm not in record. or table dtype not yet set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> not a string, cannot call getStringFormat&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()]))</span>
        
        
    <span class="k">def</span> <span class="nf">hasArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;hasArray returns True in f[&#39;Data&#39;][&#39;Array Layout&#39;] exists, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;Data&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="s1">&#39;Array Layout&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getMaxMinValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mnemonic</span><span class="p">,</span> <span class="n">verifyValid</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getMaxMinValues returns a tuple of (minimum value, maximum value) of the value</span>
<span class="sd">        of parm in this file.  If verifyValid is True, then only lines with valid 2D data</span>
<span class="sd">        are included.  If no valid values, returns (NaN, NaN). Also updates self._minMaxParmDict</span>
<span class="sd">        </span>
<span class="sd">        Raise IOError if parm not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        
        <span class="c1"># for string data, always return (Nan, Nan)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span>
            <span class="k">return</span><span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">))</span>
        
        <span class="c1"># create a merged dataset</span>
        <span class="n">datasetList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">datasetList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;No data records in file&#39;</span><span class="p">)</span>
        
        <span class="n">merged_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verifyValid</span><span class="p">:</span>
            <span class="c1"># veru simple - just jusr numpy methods</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">))</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
                <span class="n">minValue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">maxValue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">orgMin</span><span class="p">,</span> <span class="n">orgMax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">minValue</span><span class="p">,</span> <span class="n">orgMin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxValue</span><span class="p">,</span> <span class="n">orgMax</span><span class="p">)]</span>
            <span class="k">return</span><span class="p">((</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">))</span>
        
        <span class="c1"># we need to find the minimum and maximum for only valid data</span>
        <span class="c1"># first sort by parm so we just need to walk until we find a valid row starting at the top and bottom</span>
        <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">])</span>
        
        <span class="c1"># find min</span>
        <span class="n">minValue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_indices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">twoDParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">twoDParm</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                    <span class="k">continue</span>
                <span class="c1"># make sure its not a special error value</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span> <span class="ow">and</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">twoDParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># minimum found</span>
                <span class="n">minValue</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">minValue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            
        <span class="c1"># find max</span>
        <span class="n">maxValue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">sorted_indices</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">twoDParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">twoDParm</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                    <span class="k">continue</span>
                <span class="c1"># make sure its not a special error value</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span> <span class="ow">and</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">twoDParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># minimum found</span>
                <span class="n">maxValue</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">maxValue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
                
        <span class="k">if</span> <span class="n">minValue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">minValue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">maxValue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maxValue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
            
        <span class="k">if</span> <span class="n">parm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orgMin</span><span class="p">,</span> <span class="n">orgMax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">minValue</span><span class="p">,</span> <span class="n">orgMin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxValue</span><span class="p">,</span> <span class="n">orgMax</span><span class="p">)]</span>
            
        <span class="k">return</span><span class="p">((</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">))</span>
    
    
    <span class="k">def</span> <span class="nf">refreshSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;refreshSummary rebuilds the recarray self._experimentParameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span>
        <span class="n">kinstCodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kinstNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">():</span>
            <span class="n">kinstCodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">)))</span>
            <span class="n">kinstNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentName</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">))))</span>
        <span class="n">instrumentCodes</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kinstCodes</span><span class="p">)</span>
        <span class="n">instrumentName</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kinstNames</span><span class="p">)</span>
        
        <span class="n">categoryStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getCategory</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="n">piStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getContactName</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="n">piEmailStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getContactEmail</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        
        <span class="n">startDateStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UT&#39;</span><span class="p">)</span>
        <span class="n">endDateStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UT&#39;</span><span class="p">)</span>
        
        <span class="n">cedarFileName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">))</span>

        <span class="n">statusDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>
        <span class="n">instLat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="n">instLon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="n">instAlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getAltitude</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        
        <span class="c1"># create kindat description based on all kindats</span>
        <span class="n">kindatList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getKindatList</span><span class="p">()</span>
        <span class="n">kindatDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">kindatListStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">kindatDesc</span> <span class="o">=</span> <span class="s1">&#39;This experiment has </span><span class="si">%i</span><span class="s1"> kinds of data.  They are:&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kindatList</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kindat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kindatList</span><span class="p">):</span>
                <span class="n">thisKindatDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="o">.</span><span class="n">getKindatDescription</span><span class="p">(</span><span class="n">kindat</span><span class="p">,</span> <span class="n">inst</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">thisKindatDesc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;kindat </span><span class="si">%i</span><span class="s1"> undefined - please add to typeTab.txt&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kindat</span><span class="p">))</span>
                <span class="n">thisKindatDesc</span> <span class="o">=</span> <span class="n">thisKindatDesc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">kindatDesc</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%i</span><span class="s1">) </span><span class="si">%s</span><span class="s1"> (code </span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">thisKindatDesc</span><span class="p">,</span> <span class="n">kindat</span><span class="p">)</span>
                <span class="n">kindatListStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kindat</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">kindatDesc</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span>
                    <span class="n">kindatListStr</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kindatDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="o">.</span><span class="n">getKindatDescription</span><span class="p">(</span><span class="n">kindatList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inst</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kindatDesc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;kindat for </span><span class="si">%s</span><span class="s1"> undefined - please add to typeTab.txt&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">kindatList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inst</span><span class="p">))))</span>
            <span class="n">kindatDesc</span> <span class="o">=</span> <span class="n">kindatDesc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">kindatListStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kindatList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            
        <span class="c1"># create an expSummary numpy recarray  </span>
        <span class="n">summArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="mi">14</span><span class="p">,),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="p">),</span>
                                                <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="p">)])</span>
        
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument code(s)&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;kind of data file&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;kindat code(s)&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;start time&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;end time&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Cedar file name&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;status description&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument latitude&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument longitude&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument altitude&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument category&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument PI&#39;</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument PI email&#39;</span>
                      
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">instrumentName</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">instrumentCodes</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">kindatDesc</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">kindatListStr</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">startDateStr</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">endDateStr</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">cedarFileName</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">statusDesc</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instLat</span><span class="p">)</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instLon</span><span class="p">)</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instAlt</span><span class="p">)</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">categoryStr</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">piStr</span>
        <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">piEmailStr</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="o">=</span> <span class="n">summArr</span>

        
        
    <span class="k">def</span> <span class="nf">createCatalogTimeSection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;createCatalogTimeSection will return all the lines in the catalog record that</span>
<span class="sd">        describe the start and end time of the data records.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Returns:  a tuple with three items 1) a string in the format of the time section of a</span>
<span class="sd">        catalog record, 2) earliest datetime, 3) latest datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span>
        <span class="n">latestEndTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span>

        <span class="n">sy</span> <span class="o">=</span> <span class="s1">&#39;IBYRE       </span><span class="si">%4s</span><span class="s1"> Beginning year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="s1">&#39;IBDTE       </span><span class="si">%4s</span><span class="s1"> Beginning month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                              <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="s1">&#39;IBHME       </span><span class="si">%4s</span><span class="s1"> Beginning UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                   <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;IBCSE       </span><span class="si">%4s</span><span class="s1"> Beginning centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>
        
        <span class="n">ey</span> <span class="o">=</span> <span class="s1">&#39;IEYRE       </span><span class="si">%4s</span><span class="s1"> Ending year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;IEDTE       </span><span class="si">%4s</span><span class="s1"> Ending month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                           <span class="n">latestEndTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">eh</span> <span class="o">=</span> <span class="s1">&#39;IEHME       </span><span class="si">%4s</span><span class="s1"> Ending UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                <span class="n">latestEndTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">latestEndTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">es</span> <span class="o">=</span> <span class="s1">&#39;IECSE       </span><span class="si">%4s</span><span class="s1"> Ending centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>

        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sy</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ss</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ey</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ey</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ed</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ed</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">eh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">eh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">es</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>

        <span class="k">return</span><span class="p">((</span><span class="n">retStr</span><span class="p">,</span> <span class="n">earliestStartTime</span><span class="p">,</span> <span class="n">latestEndTime</span><span class="p">))</span>
    
    
    <span class="k">def</span> <span class="nf">createHeaderTimeSection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataRecList</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;createHeaderTimeSection will return all the lines in the header record that</span>
<span class="sd">        describe the start and end time of the data records.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            dataRecList - if given, examine only those MadrigalDataRecords in dataRecList.</span>
<span class="sd">                          If None (the default), examine all MadrigalDataRecords in this</span>
<span class="sd">                          MadrigalCedarFile</span>

<span class="sd">        Returns:  a tuple with three items 1) a string in the format of the time section of a</span>
<span class="sd">        header record, 2) earliest datetime, 3) latest datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dataRecList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span>
            <span class="n">latestEndTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">latestEndTime</span> <span class="o">=</span> <span class="kc">None</span>
    
            <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">dataRecList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
    
                <span class="c1">#earliest time</span>
                <span class="n">thisTime</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">earliestStartTime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="n">thisTime</span>
                <span class="k">if</span> <span class="n">earliestStartTime</span> <span class="o">&gt;</span> <span class="n">thisTime</span><span class="p">:</span>
                    <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="n">thisTime</span>
    
                <span class="c1">#latest time</span>
                <span class="n">thisTime</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">latestEndTime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">latestEndTime</span> <span class="o">=</span> <span class="n">thisTime</span>
                <span class="k">if</span> <span class="n">latestEndTime</span> <span class="o">&lt;</span> <span class="n">thisTime</span><span class="p">:</span>
                    <span class="n">latestEndTime</span> <span class="o">=</span> <span class="n">thisTime</span>
                

        <span class="n">sy</span> <span class="o">=</span> <span class="s1">&#39;IBYRT               </span><span class="si">%4s</span><span class="s1"> Beginning year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="s1">&#39;IBDTT               </span><span class="si">%4s</span><span class="s1"> Beginning month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                              <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="s1">&#39;IBHMT               </span><span class="si">%4s</span><span class="s1"> Beginning UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                   <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;IBCST               </span><span class="si">%4s</span><span class="s1"> Beginning centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>
        
        <span class="n">ey</span> <span class="o">=</span> <span class="s1">&#39;IEYRT               </span><span class="si">%4s</span><span class="s1"> Ending year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;IEDTT               </span><span class="si">%4s</span><span class="s1"> Ending month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                           <span class="n">latestEndTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
        <span class="n">eh</span> <span class="o">=</span> <span class="s1">&#39;IEHMT               </span><span class="si">%4s</span><span class="s1"> Ending UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                                <span class="n">latestEndTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
        <span class="n">totalCS</span> <span class="o">=</span> <span class="n">latestEndTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">es</span> <span class="o">=</span> <span class="s1">&#39;IECST               </span><span class="si">%4s</span><span class="s1"> Ending centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>

        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sy</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ss</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ey</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ey</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ed</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ed</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">eh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">eh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">es</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>

        <span class="k">return</span><span class="p">((</span><span class="n">retStr</span><span class="p">,</span> <span class="n">earliestStartTime</span><span class="p">,</span> <span class="n">latestEndTime</span><span class="p">))</span>
    
    
    <span class="k">def</span> <span class="nf">updateMinMaxParmDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;updateMinMaxParmDict updates self._minMaxParmDict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getMaxMinValues</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">_writeHdf5Metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_writeHdf5Metadata is responsible for writing Metadata group in Hdf5 file</span>
<span class="sd">        </span>
<span class="sd">        Can be called multiple times, but will only write &quot;Experiment Notes&quot; if any catalog or header</span>
<span class="sd">        records found</span>
<span class="sd">        </span>
<span class="sd">        Inputs: </span>
<span class="sd">        </span>
<span class="sd">            f - the open h5py.File object</span>
<span class="sd">            </span>
<span class="sd">            refreshCatHeadTimes - if True, update start and and times in the catalog and header</span>
<span class="sd">                records to represent the times in the data.  If False, use existing times in those records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Metadata&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c1"># metadata tables that are only updated once</span>
            <span class="n">metadataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Metadata&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addDataParametersTable</span><span class="p">(</span><span class="n">metadataGroup</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">refreshSummary</span><span class="p">()</span>
            <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Experiment Parameters&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">)</span>
            
            <span class="c1"># create Independent Spatial Parameters recordset</span>
            <span class="n">indParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
            <span class="n">indParmDesc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">longestDescStr</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">longestMnemStr</span><span class="p">:</span>
                    <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                <span class="n">indParmDesc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">indParm</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmDesc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">longestDescStr</span><span class="p">:</span>
                    <span class="n">longestDescStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmDesc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">indSpatialArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">),),</span>
                                         <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestMnemStr</span><span class="p">)),</span>
                                                  <span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestDescStr</span><span class="p">))])</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indParmList</span><span class="p">):</span>
                <span class="n">indSpatialArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indParm</span>
                <span class="n">indSpatialArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indParmDesc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Independent Spatial Parameters&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">indSpatialArr</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">metadataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_writeRecordLayout</span><span class="p">(</span><span class="n">metadataGroup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writeExperimentNotes</span><span class="p">(</span><span class="n">metadataGroup</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="p">)</span>
        
        
        
    <span class="k">def</span> <span class="nf">_addArrayDump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_addArrayDump adds Array Layout to an Hdf5 file created by dump.  </span>

<span class="sd">        Inputs: None </span>
<span class="sd">                </span>
<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: adds &quot;Array Layout&quot; group to f[&#39;Data&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">!=</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can only call _addArrayDump for Hdf5 files written using dump&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_createArrayLayout2</span><span class="p">()</span>
        
        <span class="c1"># try to gzip 2d array data</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">)</span>
        <span class="c1"># tmp file name to use to run h5repack</span>
        <span class="n">tmpFile</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;_tmp&#39;</span> <span class="o">+</span> <span class="n">file_extension</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;h5repack -i </span><span class="si">%s</span><span class="s1"> -o </span><span class="si">%s</span><span class="s1"> --filter=</span><span class="se">\&quot;</span><span class="s1">Data/Array Layout</span><span class="se">\&quot;</span><span class="s1">:GZIP=4&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">,</span> <span class="n">tmpFile</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span>
        
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">)</span>
        
    
    
    
    <span class="k">def</span> <span class="nf">_writeHdf5Data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_writeHdf5Data is responsible for writing Data group in Hdf5 file</span>
<span class="sd">        </span>
<span class="sd">        Input: f - the open h5py.File object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">tableName</span> <span class="o">=</span> <span class="s1">&#39;Table Layout&#39;</span>
        
        <span class="c1"># create a merged dataset</span>
        <span class="n">datasetList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">datasetList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nrows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">nrows</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;No data records in file&#39;</span><span class="p">)</span>
        
        <span class="n">merged_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s2">&quot;Data&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">dataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">dataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">tableName</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">merged_dataset</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">,</span> <span class="n">maxshape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,),</span>
                                            <span class="n">chunks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># append</span>
            <span class="n">dataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">]</span>
            <span class="n">added_len</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">dataGroup</span><span class="p">[</span><span class="n">tableName</span><span class="p">]</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">dset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">added_len</span><span class="p">,))</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">write_direct</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">s_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">added_len</span><span class="p">:])</span>
        
        <span class="k">del</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">_createArrayLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">arraySplittingParms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createArrayLayout will append an Array Layout to the open Hdf5 file f</span>
<span class="sd">        </span>
<span class="sd">        arraySplittingParms - a list of parameters as mnemonics used to split</span>
<span class="sd">            arrays into subarrays.  For example, beamcode would split data with separate beamcodes</span>
<span class="sd">            into separate arrays. The number of separate arrays will be up to the product of the number of </span>
<span class="sd">            unique values found for each parameter, with the restriction that combinations with no records will</span>
<span class="sd">            not create a separate array.</span>
<span class="sd">        </span>
<span class="sd">        IOError raised if Array Layout already exists - this can only be called once</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skipArray</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1"># get info from recarrays that already exist</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Table Layout&#39;</span><span class="p">]</span>
        <span class="n">recLayout</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;_record_layout&#39;</span><span class="p">]</span>
        <span class="n">metadataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span>
        
        <span class="c1"># inputs</span>
        <span class="n">indParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="s2">&quot;Array Layout&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Array Layout already created - this can only be created once.&#39;</span><span class="p">)</span>
        
        <span class="c1"># add &quot;Parameters Used to Split Array Data&quot; to Metadata</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">arrSplitParmDesc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">longestDescStr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">arrSplitParm</span> <span class="ow">in</span> <span class="n">arraySplittingParms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">longestMnemStr</span><span class="p">:</span>
                    <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">)</span>
                <span class="n">arrSplitParmDesc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParmDesc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">longestDescStr</span><span class="p">:</span>
                    <span class="n">longestDescStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParmDesc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">arrSplitArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">),),</span>
                                         <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestMnemStr</span><span class="p">)),</span>
                                                  <span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestDescStr</span><span class="p">))])</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arrSplitParm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">):</span>
                <span class="n">arrSplitArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrSplitParm</span>
                <span class="n">arrSplitArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrSplitParmDesc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Parameters Used to Split Array Data&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">arrSplitArr</span><span class="p">)</span>
            

        <span class="n">arrGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Array Layout&quot;</span><span class="p">)</span>
        
        <span class="n">arraySplittingList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of lists of all existing values for each array splitting parm</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">arraySplittingParms</span><span class="p">:</span>
            <span class="n">arraySplittingList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]))</span>
        
        <span class="n">tableSubsets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">arraySplittingList</span><span class="p">):</span>
            <span class="n">tableSubsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_TableSubset</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">,</span> <span class="n">combo</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">tableSubset</span> <span class="ow">in</span> <span class="n">tableSubsets</span><span class="p">:</span>
            <span class="n">uniqueIndValueDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">])</span>
            <span class="n">unique_times</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">])</span>
            <span class="n">group_name</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">getGroupName</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">group_name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">arrGroup</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">getGroupName</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">arrGroup</span> <span class="c1"># no splitting, so no subgroup needed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addLayoutDescription</span><span class="p">(</span><span class="n">thisGroup</span><span class="p">)</span>
            <span class="n">ts_dset</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">unique_times</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">])</span>
                
            <span class="c1"># one D parm arrays</span>
            <span class="n">oneDGroup</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addDataParametersTable</span><span class="p">(</span><span class="n">oneDGroup</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">dset</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">oneDIndices</span><span class="p">]</span>
                    <span class="n">oneDGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dset</span><span class="p">)</span>
                    
            <span class="c1"># two D parm arrays</span>
            <span class="n">twoDGroup</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addDataParametersTable</span><span class="p">(</span><span class="n">twoDGroup</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            
            <span class="c1"># get shape of 2D data (number of dimensions dynamic)</span>
            <span class="n">twoDShape</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
            <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">))</span>
            
            <span class="n">dsetDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = parm, value 2D dataset</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_int</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing</span>
                    
            <span class="c1"># precalculate the indices</span>
            <span class="c1"># time index</span>
            <span class="n">time_indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">)),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">)):</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">unique_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">times</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span>
                <span class="n">time_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            
            <span class="c1"># ind parm indexes</span>
            <span class="n">indParmIndexDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">)),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">])):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">values</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span>
                    <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                
            <span class="c1"># concatenate</span>
            <span class="n">tableIndex</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tableIndex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tableIndex</span> <span class="o">=</span> <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tableIndex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tableIndex</span><span class="p">,</span> <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">tableIndex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tableIndex</span><span class="p">,</span> <span class="n">time_indices</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>   
                    
            <span class="c1"># set 2D parms</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not handle more than 3 independent spatial parms - there are </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)))</span>
                        
            <span class="c1"># write the datasets out</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">twoDGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">],</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>
                    
                    
                    
    <span class="k">def</span> <span class="nf">_createArrayLayout2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createArrayLayout2 will append an Array Layout to the Hdf5 file.  Called after dump.</span>
<span class="sd">        </span>
<span class="sd">        IOError raised if Array Layout already exists - this can only be called once</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="c1"># get info from recarrays that already exist</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Table Layout&#39;</span><span class="p">]</span>
        <span class="n">recLayout</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;_record_layout&#39;</span><span class="p">]</span>
        <span class="n">metadataGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span>
        
        <span class="c1"># inputs</span>
        <span class="n">indParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="s2">&quot;Array Layout&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Array Layout already created - this can only be created once.&#39;</span><span class="p">)</span>
        
        <span class="c1"># update metadata now that file finished</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Metadata</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skipArray</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span>
        
        <span class="c1"># now that self._arrDict is competely filled out, create a similar dict, except that</span>
        <span class="c1"># all sets are replaced by ordered python arrays</span>
        <span class="n">total_allowed_records</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># make sure all ind parameters declared by checking that the product</span>
                                  <span class="c1"># of all the ind parm value lengths time the number of times is equal</span>
                                  <span class="c1"># to or greater than the number of total records</span>
        <span class="n">arrDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">total_ind_parm_lens</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">thisDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">thisDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">thisSet</span> <span class="o">=</span> <span class="n">thisDict</span><span class="p">[</span><span class="n">key2</span><span class="p">]</span>
                <span class="c1"># convert to ordered numpy array</span>
                <span class="n">thisList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">thisSet</span><span class="p">)</span>
                <span class="n">thisList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">total_ind_parm_lens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisList</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">key2</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thisList</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">key2</span><span class="p">):</span>
                    <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">key2</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thisList</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">strLen</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">thisList</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                
            <span class="c1"># add the max number of records for this group</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">total_ind_parm_lens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">total_ind_parm_lens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">tmp</span> <span class="o">*=</span> <span class="n">v</span>
            <span class="n">total_allowed_records</span> <span class="o">+=</span> <span class="n">tmp</span>
            
            <span class="c1"># protect against too many ind parm combinations (too sparse an array)</span>
            <span class="n">total_ind_combos</span> <span class="o">=</span> <span class="n">total_ind_parm_lens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">total_ind_parm_lens</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                <span class="n">total_ind_combos</span> <span class="o">*=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">total_ind_combos</span> <span class="o">&gt;</span> <span class="mi">1000000</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;Skipping array creation since </span><span class="si">%i</span><span class="s1"> independent parm combinations would create too big an array&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total_ind_combos</span><span class="p">)))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">return</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">total_allowed_records</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Found </span><span class="si">%i</span><span class="s1"> lines in table, but values of times and ind parms </span><span class="si">%s</span><span class="s1"> allow maximum of </span><span class="si">%i</span><span class="s1"> values in file </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">indParmList</span><span class="p">),</span> <span class="n">total_allowed_records</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">))</span>
        
        <span class="c1"># add &quot;Parameters Used to Split Array Data&quot; to Metadata</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">arrSplitParmDesc</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">longestDescStr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">arrSplitParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">longestMnemStr</span><span class="p">:</span>
                    <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">)</span>
                <span class="n">arrSplitParmDesc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParmDesc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">longestDescStr</span><span class="p">:</span>
                    <span class="n">longestDescStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrSplitParmDesc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">arrSplitArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">),),</span>
                                         <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestMnemStr</span><span class="p">)),</span>
                                                  <span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestDescStr</span><span class="p">))])</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arrSplitParm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">):</span>
                <span class="n">arrSplitArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrSplitParm</span>
                <span class="n">arrSplitArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrSplitParmDesc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Parameters Used to Split Array Data&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">arrSplitArr</span><span class="p">)</span>
            

        <span class="n">arrGroup</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;Array Layout&quot;</span><span class="p">)</span>
        
        <span class="c1"># stage 1 - write all needed tables with nan values</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">arrDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">groupName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getGroupName</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">arrGroup</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">groupName</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">arrGroup</span> <span class="c1"># no subgroups needed</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">_addLayoutDescription</span><span class="p">(</span><span class="n">thisGroup</span><span class="p">)</span>
                
            <span class="sd">&quot;&quot;&quot;thisDict is dict of key = &#39;ut1_unix&#39; and ind 2d parm names (possibly minus arraySplitParms), values</span>
<span class="sd">                = ordered numpy array of all unique values&quot;&quot;&quot;</span>
            <span class="n">thisDict</span> <span class="o">=</span> <span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> 
                                      
            <span class="n">unique_times</span> <span class="o">=</span> <span class="n">thisDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
            
            <span class="n">ts_dset</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">unique_times</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                    <span class="c1"># not needed</span>
                    <span class="k">continue</span>
                <span class="n">dataset</span> <span class="o">=</span> <span class="n">thisDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dataset</span><span class="p">)</span>
                
            <span class="c1"># one D parm arrays</span>
            <span class="n">oneDGroup</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addDataParametersTable</span><span class="p">(</span><span class="n">oneDGroup</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                        <span class="n">dset</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">((</span><span class="nb">str</span><span class="p">,</span> <span class="n">strLen</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                        <span class="n">dset</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">oneDGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dset</span><span class="p">)</span>
            
            <span class="c1"># two D parm arrays</span>
            <span class="n">twoDGroup</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addDataParametersTable</span><span class="p">(</span><span class="n">twoDGroup</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            
            <span class="c1"># get shape of 2D data (number of dimensions dynamic)</span>
            <span class="n">twoDShape</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                    <span class="c1"># not needed</span>
                    <span class="k">continue</span>
                <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
            <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                        <span class="n">dset</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">((</span><span class="nb">str</span><span class="p">,</span> <span class="n">strLen</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                        <span class="n">dset</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">twoDGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">dset</span><span class="p">)</span>
                    
        <span class="c1"># flush file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Table Layout&#39;</span><span class="p">]</span>
        <span class="n">recLayout</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;_record_layout&#39;</span><span class="p">]</span>
        
        <span class="c1"># now loop through Table Layout and populate all the 1 and 2 d arrays</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># number of records to load at once</span>
        <span class="n">total_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total_steps</span> <span class="o">*</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">):</span>
            <span class="n">total_steps</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_steps</span><span class="p">):</span>
            <span class="n">startTimeIndex</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">step</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">step</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">endTimeIndex</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">step</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">endTimeIndex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">table_data</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">[</span><span class="n">startTimeIndex</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">[</span><span class="n">endTimeIndex</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="c1"># loop through all groups</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">arrDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">tableSubset</span> <span class="o">=</span> <span class="n">_TableSubset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">table_data</span><span class="p">)</span>
                <span class="c1"># its possible no data in this slice for this subset</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                
                <span class="n">timestamps</span> <span class="o">=</span> <span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>

                <span class="c1"># get index of first and last time found</span>
                <span class="n">first_ut1_unix</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
                <span class="n">last_ut1_unix</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
                <span class="n">time_index_1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">first_ut1_unix</span><span class="p">)</span>
                <span class="n">time_index_2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">last_ut1_unix</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">groupName</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">getGroupName</span><span class="p">()</span>
                <span class="c1"># get shape of 2D data (number of dimensions dynamic)</span>
                <span class="n">twoDShape</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                        <span class="c1"># not needed</span>
                        <span class="k">continue</span>
                    <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">indParm</span><span class="p">]))</span>
                <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_index_2</span> <span class="o">-</span> <span class="n">time_index_1</span><span class="p">)</span>
                <span class="c1"># ind parm indexes</span>
                <span class="n">indParmIndexDict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                        <span class="c1"># not needed</span>
                        <span class="k">continue</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                    <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">),),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">indParm</span><span class="p">])):</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">values</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span>
                        <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                    
                <span class="c1"># finally time dimension</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
                <span class="n">timeIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">),),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                <span class="n">thisTimestampArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisTimestampArr</span><span class="p">)):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">thisTimestampArr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">values</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span>
                    <span class="n">timeIndices</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

                <span class="c1"># concatenate</span>
                <span class="n">tableIndex</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                        <span class="c1"># not needed</span>
                        <span class="k">continue</span>
                    <span class="n">tableIndex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">])</span>
                <span class="n">tableIndex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timeIndices</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                    <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dset</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">oneDIndices</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">groupName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="n">groupName</span><span class="p">][</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">parm</span><span class="p">][</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">parm</span><span class="p">][</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset</span>
                    <span class="k">elif</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                            <span class="n">dset2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                            <span class="n">dset2</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                            <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                            <span class="n">dset2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">((</span><span class="nb">str</span><span class="p">,</span> <span class="n">strLen</span><span class="p">)))</span>
                            <span class="n">dset2</span><span class="p">[:]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dset2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                            <span class="n">dset2</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
                        <span class="n">dset2</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tableIndex</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                        
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">groupName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">fdata</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="n">groupName</span><span class="p">][</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">][</span><span class="n">parm</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">fdata</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">][</span><span class="n">parm</span><span class="p">]</span>
                            
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">fdata</span><span class="p">[:,</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset2</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">fdata</span><span class="p">[:,:,</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset2</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">fdata</span><span class="p">[:,:,:,</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset2</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">fdata</span><span class="p">[:,:,:,:,</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset2</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="n">fdata</span><span class="p">[:,:,:,:,:,</span><span class="n">time_index_1</span><span class="p">:</span><span class="n">time_index_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dset2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not handle more than 5 independent spatial parms - there are </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)))</span>
                        
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
                    
    <span class="k">def</span> <span class="nf">_writeNetCDF4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">arraySplittingParms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_writeNetCDF4 will write to a netCDF4 file f</span>
<span class="sd">        </span>
<span class="sd">        arraySplittingParms - a list of parameters as mnemonics used to split</span>
<span class="sd">            arrays into subarrays.  For example, beamcode would split data with separate beamcodes</span>
<span class="sd">            into separate arrays. The number of separate arrays will be up to the product of the number of </span>
<span class="sd">            unique values found for each parameter, with the restriction that combinations with no records will</span>
<span class="sd">            not create a separate array.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create merged datasets table and recLayout</span>
        <span class="n">datasetList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">recordList</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">datasetList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recordList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">recordList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;catalog&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">catalog_text</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
                
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;header&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">header_text</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;No data records in file&#39;</span><span class="p">)</span>
        
        <span class="n">table</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span>
        <span class="n">recLayout</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">recordList</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refreshSummary</span><span class="p">()</span>
        
        <span class="c1"># write Experiment Parameters</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># make text acceptable attribute names</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;(s)&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(s)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        
        <span class="n">indParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
        
        <span class="c1"># add &quot;Parameters Used to Split Array Data&quot; to Metadata</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">arrSplitParmDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">arrSplitParm</span> <span class="ow">in</span> <span class="n">arraySplittingParms</span><span class="p">:</span>
                <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arrSplitParm</span><span class="p">)</span>
                <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">arrSplitParm</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">arrSplitParm</span> <span class="o">!=</span> <span class="n">arraySplittingParms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39; -- &#39;</span>
            <span class="n">f</span><span class="o">.</span><span class="n">parameters_used_to_split_data</span> <span class="o">=</span> <span class="n">arrSplitParmDesc</span>
            
        
        <span class="n">arraySplittingList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of lists of all existing values for each array splitting parm</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">arraySplittingParms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">arraySplittingList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]))</span>
        
        <span class="n">tableSubsets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">arraySplittingList</span><span class="p">):</span>
            <span class="n">tableSubsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_TableSubset</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">,</span> <span class="n">combo</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">tableSubset</span> <span class="ow">in</span> <span class="n">tableSubsets</span><span class="p">:</span>
            <span class="n">uniqueIndValueDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">])</span>
            <span class="n">unique_times</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">])</span>
            <span class="n">group_name</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">getGroupName</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">group_name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">group_name</span> <span class="o">=</span> <span class="n">group_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">createGroup</span><span class="p">(</span><span class="n">group_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">f</span> <span class="c1"># no splitting, so no subgroup needed</span>
            <span class="c1"># next step - create dimensions</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">))</span>
            <span class="n">timeVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,),</span>
                                               <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">timeVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Unix seconds&#39;</span>
            <span class="n">timeVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Number of seconds since UT midnight 1970-01-01&#39;</span>
            <span class="n">timeVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">unique_times</span>
            <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                    <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                    <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStringFormat</span><span class="p">(</span><span class="n">indParm</span><span class="p">),</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">thisVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="n">thisVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                <span class="n">thisVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                
            <span class="c1"># create one and two D parm arrays, set 1D</span>
            <span class="n">twoDVarDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = parm name, value = netCDF4 variable</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">dset</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">oneDIndices</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStringFormat</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                           <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1"># float</span>
                        <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">oneDVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    <span class="n">oneDVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">oneDVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">dset</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;There may be an issue with array splitting because more records than times&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStringFormat</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span> <span class="n">dims</span><span class="p">,</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    
            <span class="c1"># two D parm arrays</span>
            
            <span class="c1"># get shape of 2D data (number of dimensions dynamic)</span>
            <span class="n">twoDShape</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">twoDShape</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
            
            <span class="n">dsetDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = parm, value 2D dataset</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">twoDShape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_int</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing</span>
                    
            <span class="c1"># precalculate the indices</span>
            <span class="c1"># time index</span>
            <span class="n">time_indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">)),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">)):</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">unique_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">times</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span>
                <span class="n">time_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            
            <span class="c1"># ind parm indexes</span>
            <span class="n">indParmIndexDict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">)),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">])):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">values</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span>
                    <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                
            <span class="c1"># concatenate</span>
            <span class="n">tableIndex</span> <span class="o">=</span> <span class="n">time_indices</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">tableIndex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tableIndex</span><span class="p">,</span> <span class="n">indParmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
                    
            <span class="c1"># set 2D parms</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">tableIndex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tableIndex</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tableSubset</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not handle more than 3 independent spatial parms - there are </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)))</span>
                        
            <span class="c1"># write the datasets out</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:,:]</span> <span class="o">=</span> <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:,:,:]</span> <span class="o">=</span> <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][:,:,:,:]</span> <span class="o">=</span> <span class="n">dsetDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                        
                        
                        
    <span class="k">def</span> <span class="nf">_firstDumpNetCDF4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_firstDumpNetCDF4 will dump initial data to a netCDF4 file f.  Called via dump</span>
<span class="sd">        </span>
<span class="sd">            </span>
<span class="sd">        parmIndexDict - is a dictionary with key = timestamps and ind spatial parm names,</span>
<span class="sd">            value = dictionary of keys = unique values, value = index of that value. Can only be used when</span>
<span class="sd">            arraySplittingParms == []</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create merged datasets table and recLayout</span>
        <span class="n">datasetList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">recordList</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">datasetList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recordList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">recordList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;catalog&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">catalog_text</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
                
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;header&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">header_text</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;No data records in file&#39;</span><span class="p">)</span>
        
        <span class="n">table</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span>
        <span class="n">recLayout</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">recordList</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refreshSummary</span><span class="p">()</span>
        
        <span class="c1"># write Experiment Parameters</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># make text acceptable attribute names</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;(s)&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(s)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        
        <span class="n">indParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
        
        <span class="n">uniqueIndValueDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
            <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">unique_times</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">f</span> <span class="c1"># no splitting, so no subgroup needed</span>
        <span class="c1"># next step - create dimensions</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">))</span>
        <span class="n">timeVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,),</span>
                                           <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">timeVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Unix seconds&#39;</span>
        <span class="n">timeVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Number of seconds since UT midnight 1970-01-01&#39;</span>
        <span class="n">timeVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">unique_times</span>
        <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
            <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStringFormat</span><span class="p">(</span><span class="n">indParm</span><span class="p">),</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">thisVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
            <span class="n">thisVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            <span class="n">thisVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            
        <span class="c1"># create one and two D parm arrays, set 1D</span>
        <span class="n">twoDVarDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = parm name, value = netCDF4 variable</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
            <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dset</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][:]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStringFormat</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># float</span>
                    <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">oneDVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                <span class="n">oneDVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                <span class="n">lastTS</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">ts</span> <span class="o">!=</span> <span class="n">lastTS</span><span class="p">:</span>
                        <span class="c1"># set it</span>
                        <span class="n">oneDVar</span><span class="p">[</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="n">ts</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">lastTS</span> <span class="o">=</span> <span class="n">ts</span>

            <span class="k">elif</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStringFormat</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span> <span class="n">dims</span><span class="p">,</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">zlib</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                
                
        <span class="c1"># set 2D parms</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">)):</span>
            <span class="n">parmIndices</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]]</span> 
                    
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">parmIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">item</span><span class="p">])</span>
                
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">parmIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">parmIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">parmIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not handle more than 3 independent spatial parms - there are </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)))</span>

                    
                    
    <span class="k">def</span> <span class="nf">_appendNetCDF4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_appendNetCDF4 will dump appended data to a netCDF4 file f. Called via dump</span>
<span class="sd">        </span>
<span class="sd">            </span>
<span class="sd">        parmIndexDict - is a dictionary with key = timestamps and ind spatial parm names,</span>
<span class="sd">            value = dictionary of keys = unique values, value = index of that value. Can only be used when</span>
<span class="sd">            arraySplittingParms == []</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create merged datasets table and recLayout</span>
        <span class="n">datasetList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">recordList</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">datasetList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recordList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">recordList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;catalog&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">catalog_text</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
                
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;header&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">header_text</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span>
                
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;No data records in file&#39;</span><span class="p">)</span>
        
        <span class="n">table</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span>
        <span class="n">recLayout</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">recordList</span><span class="p">)</span>
        
        
        <span class="n">indParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
        
        <span class="n">uniqueIndValueDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
            <span class="n">uniqueIndValueDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">unique_times</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">thisGroup</span> <span class="o">=</span> <span class="n">f</span> <span class="c1"># no splitting, so no subgroup needed</span>
        <span class="c1"># next step - create dimensions</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">timeVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;timestamps&quot;</span><span class="p">]</span>
        <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
            <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
            <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            
        <span class="c1"># create one and two D parm arrays, set 1D</span>
        <span class="n">twoDVarDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = parm name, value = netCDF4 variable</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
            <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dset</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][:]</span>
                <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                <span class="n">lastTS</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">ts</span> <span class="o">!=</span> <span class="n">lastTS</span><span class="p">:</span>
                        <span class="c1"># set it</span>
                        <span class="n">oneDVar</span><span class="p">[</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="n">ts</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">lastTS</span> <span class="o">=</span> <span class="n">ts</span>

            <span class="k">elif</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
                
                
        <span class="c1"># set 2D parms</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">recLayout</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):]:</span>
            <span class="k">if</span> <span class="n">recLayout</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">)):</span>
                    <span class="n">parmIndices</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]]</span> 
                        
                    <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                            <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                        <span class="n">parmIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parmIndexDict</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">item</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">parmIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">parmIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">twoDVarDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">parmIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">parmIndices</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not handle more than 3 independent spatial parms - there are </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indParmList</span><span class="p">)))</span>
                    
                    
    <span class="k">def</span> <span class="nf">_addLayoutDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_addLayoutDescription added a Layout Description dataset to h5py group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">indSpatialParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">()</span>
        <span class="n">layoutDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getLayoutDescription</span><span class="p">()</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">indSpatialParms</span><span class="p">),</span>
                                                     <span class="nb">str</span><span class="p">(</span><span class="n">indSpatialParms</span><span class="p">),</span>
                                                     <span class="mi">1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">indSpatialParms</span><span class="p">),</span>
                                                     <span class="nb">len</span><span class="p">(</span><span class="n">indSpatialParms</span><span class="p">),</span>
                                                     <span class="nb">str</span><span class="p">(</span><span class="n">indSpatialParms</span><span class="p">),</span>
                                                     <span class="nb">str</span><span class="p">(</span><span class="n">indSpatialParms</span><span class="p">))</span>
        <span class="n">LayoutDescription</span> <span class="o">=</span> <span class="n">layoutDesc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># create a recarray to hold this text</span>
        <span class="n">textArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">LayoutDescription</span><span class="p">),),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Layout Description&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">))])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">LayoutDescription</span><span class="p">)):</span>
            <span class="n">textArr</span><span class="p">[</span><span class="s1">&#39;Layout Description&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">LayoutDescription</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
        <span class="n">group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Layout Description&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">textArr</span><span class="p">)</span>
        
                    
    
    <span class="k">def</span> <span class="nf">_getLayoutDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_getLayoutDescription returns a description of the layout selected.</span>
<span class="sd">        </span>
<span class="sd">        Returns: </span>
<span class="sd">            LayoutDescription: A list of strings summarizing the Layout Description</span>

<span class="sd">        Affects: Nothing</span>

<span class="sd">        Exceptions: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">LayoutDescription</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                This data layout contains reshaped data from the Table Layout. The reshaped data is stored as an array, with time and</span>
<span class="s2">                the independent spatial parameters (</span><span class="si">%s</span><span class="s2">) in different dimensions. It creates an array for each parameter found in file.</span>
<span class="s2">                </span>
<span class="s2">                This layout contains:</span>
<span class="s2">                - &quot;1D parameters&quot; group: contains one 1D-array for each 1d parameter</span>
<span class="s2">                                  stored in the file. Time-dependent only parameters.</span>
<span class="s2">                - &quot;2D parameters&quot; group: contains one 2D-array for each 2d parameter</span>
<span class="s2">                                  stored in the file. Time and </span><span class="si">%s</span><span class="s2"> are independent parameters.</span>
<span class="s2">                                  Every 2D array has </span><span class="si">%i</span><span class="s2"> dimensions - one for time, and </span><span class="si">%i</span><span class="s2"> for</span>
<span class="s2">                                  the independent spatial parameters (</span><span class="si">%s</span><span class="s2">).</span>
<span class="s2">                - timestamps:     Time vector in seconds from 1/1/1970.</span>
<span class="s2">                </span>
<span class="s2">                - </span><span class="si">%s</span><span class="s2"> :          The independent spatial parameters for this file&quot;&quot;&quot;</span>
                
        <span class="k">return</span><span class="p">(</span><span class="n">LayoutDescription</span><span class="p">)</span>
        
        
        
        
    <span class="k">def</span> <span class="nf">_addDataParametersTable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_addDataParametersTable adds the &quot;Data Parameters&quot; table to the h5py Group group if any parameters found</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            group - the h5py Group to add the dataset to</span>
<span class="sd">            </span>
<span class="sd">            dim - if None, include all parameters. If 1 or 2, just include non-required 1 or 2 D parms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dim must be in (None, 1, 2), not &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">)))</span>
        
        <span class="c1"># this first pass is just to set the maximum length of all the strings</span>
        <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">longestDescStr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">longestUnitsStr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">longestCategoryStr</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):</span>
                <span class="c1"># skipping default parms</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParmDim</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="o">!=</span> <span class="n">dim</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">longestMnemStr</span><span class="p">:</span>
                <span class="n">longestMnemStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">longestDescStr</span><span class="p">:</span>
                <span class="n">longestDescStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">longestUnitsStr</span><span class="p">:</span>
                <span class="n">longestUnitsStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCategory</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">longestCategoryStr</span><span class="p">:</span>
                <span class="n">longestCategoryStr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCategory</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># no parms to add</span>
            <span class="k">return</span>
        
        <span class="n">parmArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="n">count</span><span class="p">,),</span>
                                 <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestMnemStr</span><span class="p">)),</span>
                                          <span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestDescStr</span><span class="p">)),</span>
                                          <span class="p">(</span><span class="s1">&#39;isError&#39;</span><span class="p">,</span> <span class="s1">&#39;int&#39;</span><span class="p">),</span>
                                          <span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestUnitsStr</span><span class="p">)),</span>
                                          <span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;|S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">longestCategoryStr</span><span class="p">))])</span>
        
        <span class="c1"># set all the values</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):</span>
                <span class="c1"># skipping default parms</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParmDim</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="o">!=</span> <span class="n">dim</span><span class="p">:</span>
                    <span class="k">continue</span>
                
            <span class="n">parmArr</span><span class="p">[</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="n">parmArr</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="n">parmArr</span><span class="p">[</span><span class="s1">&#39;isError&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="n">parmArr</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="n">parmArr</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCategory</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="n">group</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;Data Parameters&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">parmArr</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">_writeRecordLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadataGroup</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_writeRecordLayout adds the &quot;_record_layout&quot; table to the Metadata group metadataGroup if needed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tableName</span> <span class="o">=</span> <span class="s1">&#39;_record_layout&#39;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;self._recDset not yet specified&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">tableName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadataGroup</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">tableName</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">)</span>
            <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;This is meant to be internal data.  For each Madrigal record and parameter, it has a 2 if its a 2D parameter, 1 if its a 1D parameter, and 0 if there is no data.&#39;</span>
            
            
            
    <span class="k">def</span> <span class="nf">_verifyFormat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tableDset</span><span class="p">,</span> <span class="n">recDset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;verifyFormat raises an exception if any problem with the Hdf5 input file.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            tableDset - dataset from hdfFile[&quot;Data&quot;][&quot;Table Layout&quot;]</span>
<span class="sd">            recDset - dataset from hdfFile[&quot;Metadata&quot;][&quot;_record_layout&quot;]</span>
<span class="sd">        </span>
<span class="sd">        Rules:  1. self._tableDset must start with  int columns &#39;year&#39;, &#39;month&#39;, &#39;day&#39;, &#39;hour&#39;, &#39;min&#39;, &#39;sec&#39;, </span>
<span class="sd">                    &#39;recno&#39;, &#39;kindat&#39;, &#39;kinst&#39; and float columns &#39;ut1_unix&#39;, &#39;ut2_unix&#39;</span>
<span class="sd">                2. The len of self._recDset must be 1 and must start with the same columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">requiredField</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requiredFields</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">requiredField</span> <span class="o">!=</span> <span class="n">tableDset</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Field </span><span class="si">%s</span><span class="s1"> not found in table dset of Hdf5 file </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">requiredField</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">requiredField</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Field </span><span class="si">%s</span><span class="s1"> not found in record dset of Hdf5 file </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">requiredField</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">)))</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recDset</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;recDset must have len 1, not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recDset</span><span class="p">)))</span>
        
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">field</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;For field </span><span class="si">%s</span><span class="s1">, got illegal recordset value </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">field</span><span class="p">])))</span>
       
       
    <span class="k">def</span> <span class="nf">_appendCatalogRecs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expNotesDataset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_appendCatalogRecs will append 0 or more MadrigalCatalogRecords to self._privList based</span>
<span class="sd">        on the contents in h5py dataset expNotesDataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_delimiter</span> <span class="o">=</span> <span class="s1">&#39;Catalog information from record&#39;</span>
        <span class="n">end_delimiter</span> <span class="o">=</span> <span class="s1">&#39;Header information from record&#39;</span>
        <span class="n">in_catalog</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">catalog_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">start_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kinst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kinst</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">expNotesDataset</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">in_catalog</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start_delimiter</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">in_catalog</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_catalog</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">end_delimiter</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start_delimiter</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">start_found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">catalog_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MadrigalCatalogRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                                <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                                <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                                <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                                                <span class="n">catalog_text</span><span class="p">))</span>
                    <span class="n">catalog_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start_delimiter</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">in_catalog</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_catalog</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start_found</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_catalog</span><span class="p">:</span>
                <span class="n">start_found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">catalog_text</span> <span class="o">+=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                
        <span class="c1"># see if last part was a catalog</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">catalog_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">catalog_text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MadrigalCatalogRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                        <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                        <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                        <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="p">,</span>
                                                        <span class="n">catalog_text</span><span class="p">))</span>
            <span class="n">catalog_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            
            
    <span class="k">def</span> <span class="nf">_appendHeaderRecs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expNotesDataset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_appendHeaderRecs will append 0 or more MadrigalHeaderRecords to self._privList based</span>
<span class="sd">        on the contents in h5py dataset expNotesDataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_delimiter</span> <span class="o">=</span> <span class="s1">&#39;Header information from record&#39;</span>
        <span class="n">end_delimiter</span> <span class="o">=</span> <span class="s1">&#39;Catalog information from record&#39;</span>
        <span class="n">in_header</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">header_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">start_found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kinst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kinst</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">kindat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kindat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">expNotesDataset</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">in_header</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start_delimiter</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">in_header</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_header</span> <span class="ow">and</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">end_delimiter</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start_delimiter</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">start_found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MadrigalHeaderRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span><span class="n">kindat</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                               <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                               <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                               <span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="p">,</span> 
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="p">,</span> <span class="n">header_text</span><span class="p">))</span>
                    <span class="n">header_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">start_delimiter</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">in_header</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_header</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">start_found</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_header</span><span class="p">:</span>
                <span class="n">header_text</span> <span class="o">+=</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>

                
        <span class="c1"># see if last part was a header</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MadrigalHeaderRecord</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span><span class="n">kindat</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                       <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                       <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span>
                                                       <span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="p">,</span> 
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="p">,</span> <span class="n">header_text</span><span class="p">))</span>
            <span class="n">header_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            
            
    <span class="k">def</span> <span class="nf">_getArraySplitParms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadataGroup</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_getArraySplitParms appends a list of parameters used to split arrays (if any) from</span>
<span class="sd">        metadataGroup[&quot;Parameters Used to Split Array Data&quot;].  If no such table or empty, returns</span>
<span class="sd">        empty list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retList2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dset</span> <span class="o">=</span> <span class="n">metadataGroup</span><span class="p">[</span><span class="s2">&quot;Parameters Used to Split Array Data&quot;</span><span class="p">]</span>
            <span class="n">retList2</span> <span class="o">=</span> <span class="p">[</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="n">dset</span><span class="p">[</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">retList2</span><span class="p">)</span>
        
        <span class="c1"># verify ascii</span>
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="n">retList2</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mnem</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
        
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
            
            
            
    <span class="k">def</span> <span class="nf">writeExperimentNotes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadataGroup</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;writeExperimentNotes writes the &quot;Experiment Notes&quot; dataset to the h5py group metadataGroup</span>
<span class="sd">        if any catalog or header records found.</span>
<span class="sd">        </span>
<span class="sd">            refreshCatHeadTimes - if True, update start and and times in the catalog and header</span>
<span class="sd">                records to represent the times in the data.  If False, use existing times in those records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># templates</span>
        <span class="n">cat_template</span> <span class="o">=</span> <span class="s1">&#39;Catalog information from record </span><span class="si">%i</span><span class="s1">:&#39;</span>
        <span class="n">head_template</span> <span class="o">=</span> <span class="s1">&#39;Header information from record </span><span class="si">%i</span><span class="s1">:&#39;</span>
        
        <span class="k">if</span> <span class="s2">&quot;Experiment Notes&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadataGroup</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c1"># already exists</span>
            <span class="k">return</span>
        
        <span class="n">recDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = rec number, value = tuple of recarray of lines, &#39;Catalog&#39; or &#39;Header&#39; str)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;catalog&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">refreshCatHeadTimes</span><span class="p">:</span>
                    <span class="n">sDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span>
                    <span class="n">eDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span>
                    <span class="n">rec</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">sDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                     <span class="n">sDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">),</span>
                                     <span class="n">eDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                     <span class="n">eDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">eDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">))</span>
                <span class="n">recarray</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getLines</span><span class="p">()</span>
                <span class="n">recDict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">recarray</span><span class="p">,</span> <span class="s1">&#39;Catalog&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;header&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">refreshCatHeadTimes</span><span class="p">:</span>
                    <span class="n">sDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span>
                    <span class="n">eDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span>
                    <span class="n">rec</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">sDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                     <span class="n">sDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">),</span>
                                     <span class="n">eDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                     <span class="n">eDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">eDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">))</span>
                <span class="n">recarray</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getLines</span><span class="p">()</span>
                <span class="n">recDict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">recarray</span><span class="p">,</span> <span class="s1">&#39;Header&#39;</span><span class="p">)</span>
                
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">recDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">recarray</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">new_recarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="mi">2</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;File Notes&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">))])</span>
            <span class="k">if</span> <span class="n">recDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Catalog&#39;</span><span class="p">:</span>
                <span class="n">topStr</span> <span class="o">=</span> <span class="n">cat_template</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">topStr</span> <span class="o">=</span> <span class="n">head_template</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">new_recarray</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">topStr</span><span class="p">))</span>
            <span class="n">new_recarray</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">80</span>
            <span class="k">if</span> <span class="n">recarray</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">recarray</span> <span class="o">=</span> <span class="n">new_recarray</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">recarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">recarray</span><span class="p">,</span> <span class="n">new_recarray</span><span class="p">))</span>
            <span class="n">recarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">recarray</span><span class="p">,</span> <span class="n">recDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
            
        <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">recarray</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">_getKinstList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recarr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_getKinstList returns an array of instrument code ints by parsing a numpy recarray</span>
<span class="sd">        with columns name and value.  If name is &quot;instrument code(s)&quot;, then parse comma separated</span>
<span class="sd">        kinst int values in values column. Returns empty list if not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recarr</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;instrument code(s)&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">retList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kinst</span><span class="p">))</span> <span class="k">for</span> <span class="n">kinst</span> <span class="ow">in</span> <span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                    <span class="k">break</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># not binary</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;instrument code(s)&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">retList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kinst</span><span class="p">))</span> <span class="k">for</span> <span class="n">kinst</span> <span class="ow">in</span> <span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                    <span class="k">break</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="nf">_getKindatList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recarr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_getKindatList returns an array of kind of data code ints by parsing a numpy recarray</span>
<span class="sd">        with columns name and value.  If name is &quot;kindat code(s)&quot;, then parse comma separated</span>
<span class="sd">        kindat int values in values column. Returns empty list if not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recarr</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;kindat code(s)&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">retList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kindat</span><span class="p">))</span> <span class="k">for</span> <span class="n">kindat</span> <span class="ow">in</span> <span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                    <span class="k">break</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># not binary</span>
                <span class="k">if</span> <span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;kindat code(s)&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">retList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">kindat</span><span class="p">))</span> <span class="k">for</span> <span class="n">kindat</span> <span class="ow">in</span> <span class="n">recarr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
                    <span class="k">break</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
        
        
    
    <span class="k">def</span> <span class="nf">_printSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">filterList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_printSummary prints an overview of the original filename and filters used if any</span>
<span class="sd">        to open file f (may be stdout)</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            f - open file to write to</span>
<span class="sd">            </span>
<span class="sd">            filterList - a list of madrigal.derivation.MadrigalFilter objects to be described in the </span>
<span class="sd">                summary.  Default is None, in which case not described in summary.  Ignored if summary</span>
<span class="sd">                is not &#39;summary&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Data derived from file </span><span class="si">%s</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">))</span>
            
        <span class="k">if</span> <span class="n">filterList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filterList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Filters used:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filterList</span><span class="p">)):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Filter </span><span class="si">%i</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filterList</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
        
            
    
    <span class="k">def</span> <span class="nf">_getGroupName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indValues</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_getGroupName returns the name of a array group when split</span>
<span class="sd">        </span>
<span class="sd">        Input:</span>
<span class="sd">            indValues - a list of values, one for each array splitting parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">groupName</span> <span class="o">=</span> <span class="s1">&#39;Array with &#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">parmString</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parmString</span> <span class="o">=</span> <span class="n">parm</span>
            <span class="n">groupName</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parmString</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">indValues</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">indValues</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">groupName</span> <span class="o">+=</span> <span class="s1">&#39;and &#39;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">groupName</span><span class="p">)</span>
        
        

    <span class="sd">&quot;&quot;&quot; the following methods are added to allow this class to emulate a list.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># check that value in (MadrigalCatalogRecord, MadrigalHeaderRecord, MadrigalDataRecord)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MadrigalCatalogRecord</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MadrigalHeaderRecord</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MadrigalDataRecord</span><span class="p">):</span>
            <span class="c1"># check that its not an empty list (used to delete records)</span>
            <span class="n">okay</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">okay</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">okay</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;In MadrigalCedarFile, can only add MadrigalCatalogRecord, MadrigalHeaderRecord, or MadrigalDataRecord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">seq</span><span class="p">):</span>
        <span class="c1"># check every item in seq</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MadrigalCatalogRecord</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MadrigalHeaderRecord</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MadrigalDataRecord</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;In MadrigalCedarFile, can only add MadrigalCatalogRecord, MadrigalHeaderRecord, or MadrigalDataRecord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">):]</span> <span class="o">=</span> <span class="n">seq</span>

    <span class="k">def</span> <span class="nf">__delslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">):]</span>
            
            

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">other</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>
        <span class="c1"># not found</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">retStr</span>
            

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="c1"># check that value in (MadrigalCatalogRecord, MadrigalHeaderRecord, MadrigalDataRecord)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MadrigalCatalogRecord</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MadrigalHeaderRecord</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MadrigalDataRecord</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;In MadrigalCedarFile, can only add MadrigalCatalogRecord, MadrigalHeaderRecord, or MadrigalDataRecord&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MadrigalDataRecord</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getDType</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Varying dtypes found: </span><span class="si">%s</span><span class="s1"> versus </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getDType</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDType</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getDType</span><span class="p">())</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getRecordset</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Varying recordsets found: </span><span class="si">%s</span><span class="s1"> versus </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getRecordset</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getRecordset</span><span class="p">()</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># set all internal data structures set by data records only if not yet set</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getInd2DParms</span><span class="p">()</span>
                <span class="c1"># set self._num2DSplit</span>
                <span class="n">twoDSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">mnemonic</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">])</span>
                <span class="n">arraySplitSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDSet</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">arraySplitSet</span><span class="p">))</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getKinst</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getKindat</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getKindat</span><span class="p">())</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setRecno</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_totalDataRecords</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_totalDataRecords</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># update self._recIndexList</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lastIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lastIndex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lastIndex</span><span class="p">,</span> <span class="n">lastIndex</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getDataset</span><span class="p">())))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dataset</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getDataset</span><span class="p">()</span>
                <span class="n">rowsToCheck</span> <span class="o">=</span> <span class="n">dataset</span>
                    
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">thisRow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rowsToCheck</span><span class="p">):</span>

                    <span class="c1"># update self._arrDict</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">==</span> <span class="p">[]:</span>
                        
                        <span class="n">arraySplitParms</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                                <span class="n">arraySplitParms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">arraySplitParms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">arraySplitParms</span><span class="p">])</span>

                        <span class="c1"># array splitting parameters can never be nan</span>
                        <span class="k">for</span> <span class="n">this_value</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">this_value</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">this_value</span><span class="p">):</span>
                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is an array splitting parameter, so its illegal to have a nan value for it anywhere in the file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># no splitting</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        
                    <span class="c1"># first add ut1_unix if needed </span>
                    <span class="k">if</span> <span class="s1">&#39;ut1_unix&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">thisRow</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]])</span>
                    
                    <span class="c1"># now deal with all ind parms</span>
                    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
                        <span class="n">mnem</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span>
                        <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                            <span class="c1"># no need to create separate dimension since already split out</span>
                            <span class="k">continue</span>
                        
                        <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">thisRow</span><span class="p">[</span><span class="n">mnem</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">]</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="n">mnem</span><span class="p">]])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="n">mnem</span><span class="p">]])</span>
                            
                        <span class="c1"># enforce nan rule for ind2DList</span>
                        <span class="n">thisList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">skip</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">thisList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">bytes</span><span class="p">:</span>
                                <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">thisList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">thisList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">:</span>
                                    <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">thisList</span><span class="p">)):</span>
                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot have nan in ind parm </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mnem</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">])))</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        

    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">MadrigalDataRecord</span><span class="o">.</span><span class="n">cmpDataRec</span><span class="p">)</span>
        <span class="c1"># reset recno values</span>
        <span class="n">recno</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">set1D</span><span class="p">(</span><span class="s1">&#39;recno&#39;</span><span class="p">,</span> <span class="n">recno</span><span class="p">)</span>
                <span class="n">recno</span> <span class="o">+=</span> <span class="mi">1</span>
        
        
    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createFlag</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">((</span><span class="s1">&#39;Warning - created file </span><span class="si">%s</span><span class="s1"> being closed by __del__. Best practice is to call close() directly, to avoid this warning&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">))))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#madrigal.cedar.MadrigalCedarFile">MadrigalCedarFile</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="madrigal.cedar.MadrigalCedarFile.missing" class="name">var <span class="ident">missing</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="madrigal.cedar.MadrigalCedarFile.missing_int" class="name">var <span class="ident">missing_int</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="madrigal.cedar.MadrigalCedarFile.requiredFields" class="name">var <span class="ident">requiredFields</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, fullFilename, createFlag=False, startDatetime=None, endDatetime=None, maxRecords=None, recDset=None, arraySplitParms=None, skipArray=False)</p>
    </div>
    

    
  
    <div class="desc"><p><strong>init</strong> initializes MadrigalCedarFile by reading in existing file, if any.</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">fullFilename</span> <span class="o">-</span> <span class="n">either</span> <span class="n">the</span> <span class="k">existing</span> <span class="n">Cedar</span> <span class="n">file</span> <span class="k">in</span> <span class="n">Hdf5</span> <span class="n">format</span><span class="p">,</span>
               <span class="k">or</span> <span class="n">a</span> <span class="n">file</span> <span class="k">to</span> <span class="n">be</span> <span class="n">created</span><span class="p">.</span> <span class="n">May</span> <span class="n">also</span> <span class="n">be</span> <span class="k">None</span> <span class="k">if</span> <span class="n">this</span>
               <span class="k">data</span> <span class="k">is</span> <span class="n">simply</span> <span class="n">derived</span> <span class="k">parameters</span> <span class="n">that</span> <span class="n">be</span> <span class="n">written</span> <span class="k">to</span> <span class="k">stdout</span><span class="p">.</span>

<span class="n">createFlag</span> <span class="o">-</span> <span class="n">tells</span> <span class="n">whether</span> <span class="n">this</span> <span class="k">is</span> <span class="n">a</span> <span class="n">file</span> <span class="k">to</span> <span class="n">be</span> <span class="n">created</span><span class="p">.</span>  <span class="k">If</span> <span class="k">False</span> <span class="k">and</span>
             <span class="n">fullFilename</span> <span class="n">cannot</span> <span class="n">be</span> <span class="k">read</span><span class="p">,</span> <span class="n">an</span> <span class="n">error</span> <span class="k">is</span> <span class="n">raised</span><span class="p">.</span>  <span class="k">If</span> <span class="k">True</span> <span class="k">and</span>
             <span class="n">fullFilename</span> <span class="n">already</span> <span class="k">exists</span><span class="p">,</span> <span class="k">or</span> <span class="n">fullFilename</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">created</span><span class="p">,</span>
             <span class="n">an</span> <span class="n">error</span> <span class="k">is</span> <span class="n">raised</span><span class="p">.</span>

<span class="n">startDatetime</span> <span class="o">-</span> <span class="k">if</span> <span class="k">not</span> <span class="k">None</span> <span class="p">(</span><span class="n">the</span> <span class="k">default</span><span class="p">),</span> <span class="n">reject</span> <span class="k">all</span> <span class="k">input</span> <span class="n">records</span> <span class="k">where</span>
      <span class="n">record</span> <span class="k">end</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="n">startDatetime</span> <span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span> <span class="k">object</span><span class="p">).</span>
      <span class="n">Ignored</span> <span class="k">if</span> <span class="n">createFlag</span> <span class="o">==</span> <span class="k">True</span>

<span class="n">endDatetime</span> <span class="o">-</span> <span class="k">if</span> <span class="k">not</span> <span class="k">None</span> <span class="p">(</span><span class="n">the</span> <span class="k">default</span><span class="p">),</span> <span class="n">reject</span> <span class="k">all</span> <span class="k">input</span> <span class="n">records</span> <span class="k">where</span>
      <span class="n">record</span> <span class="k">start</span> <span class="n">time</span> <span class="o">&gt;</span> <span class="n">endDatetime</span> <span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span> <span class="k">object</span><span class="p">)</span>
      <span class="n">Ignored</span> <span class="k">if</span> <span class="n">createFlag</span> <span class="o">==</span> <span class="k">True</span>

<span class="n">maxRecords</span> <span class="o">-</span> <span class="n">the</span> <span class="n">maximum</span> <span class="nb">number</span> <span class="k">of</span> <span class="n">records</span> <span class="k">to</span> <span class="k">read</span> <span class="k">into</span> <span class="n">memory</span>
        <span class="n">Ignored</span> <span class="k">if</span> <span class="n">createFlag</span> <span class="o">==</span> <span class="k">True</span>

<span class="n">recDset</span> <span class="o">-</span> <span class="n">a</span> <span class="n">numpy</span> <span class="n">recarray</span> <span class="k">with</span> <span class="k">column</span> <span class="k">names</span> <span class="n">the</span> <span class="k">names</span> <span class="k">of</span> <span class="k">all</span> <span class="k">parameters</span><span class="p">,</span> <span class="n">starting</span>
    <span class="k">with</span> <span class="n">requiredFields</span><span class="p">.</span>  <span class="k">Values</span> <span class="k">are</span> <span class="mi">1</span> <span class="k">for</span> <span class="mi">1</span><span class="n">D</span> <span class="p">(</span><span class="k">all</span> <span class="n">the</span> <span class="n">required</span> <span class="n">parms</span> <span class="k">are</span> <span class="mi">1</span><span class="n">D</span><span class="p">),</span> <span class="mi">2</span> <span class="k">for</span>
    <span class="n">dependent</span> <span class="mi">2</span><span class="n">D</span><span class="p">,</span> <span class="k">and</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">independent</span> <span class="n">spatial</span> <span class="mi">2</span><span class="n">D</span> <span class="k">parameters</span><span class="p">.</span>  <span class="k">If</span> <span class="k">None</span><span class="p">,</span> <span class="k">self</span><span class="p">.</span><span class="n">_recDset</span>
    <span class="k">not</span> <span class="k">set</span> <span class="k">until</span> <span class="k">first</span> <span class="k">data</span> <span class="n">record</span> <span class="n">appended</span><span class="p">.</span>

<span class="n">arraySplitParms</span> <span class="o">-</span> <span class="k">if</span> <span class="k">None</span> <span class="p">(</span><span class="n">the</span> <span class="k">default</span><span class="p">),</span> <span class="k">read</span> <span class="k">in</span> <span class="n">arraySplitParms</span> <span class="k">from</span> <span class="n">the</span> <span class="n">exiting</span> <span class="n">file</span><span class="p">.</span>
    <span class="n">Otherwise</span> <span class="k">set</span> <span class="k">self</span><span class="p">.</span><span class="n">_arraySplitParms</span> <span class="k">to</span> <span class="n">arraySplitParms</span><span class="p">,</span> <span class="n">which</span> <span class="k">is</span> <span class="n">a</span> <span class="n">list</span> <span class="k">of</span> <span class="mi">1</span><span class="n">D</span> <span class="k">or</span> <span class="mi">2</span><span class="n">D</span> <span class="n">parms</span>
    <span class="k">where</span> <span class="k">each</span> <span class="k">unique</span> <span class="k">set</span> <span class="k">of</span> <span class="n">value</span> <span class="k">of</span> <span class="n">the</span> <span class="n">parms</span> <span class="k">in</span> <span class="n">this</span> <span class="n">list</span> <span class="n">will</span> <span class="n">be</span> <span class="n">used</span> <span class="k">to</span> <span class="n">split</span> <span class="n">the</span> <span class="k">full</span>
    <span class="k">data</span> <span class="k">into</span> <span class="n">separate</span> <span class="n">arrays</span> <span class="k">in</span> <span class="n">Hdf5</span> <span class="k">or</span> <span class="n">netCDF4</span> <span class="n">files</span><span class="p">.</span>  <span class="k">For</span> <span class="n">example</span> <span class="n">arraySplitParms</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;beamid&#39;</span><span class="p">]</span>
    <span class="n">would</span> <span class="n">split</span> <span class="n">the</span> <span class="k">data</span> <span class="k">into</span> <span class="n">separate</span> <span class="n">arrays</span> <span class="k">for</span> <span class="k">each</span> <span class="n">beamid</span><span class="p">.</span> <span class="k">If</span> <span class="k">None</span> <span class="k">and</span> <span class="k">new</span> <span class="n">file</span> <span class="k">is</span> <span class="n">being</span>
    <span class="n">created</span><span class="p">,</span> <span class="k">no</span> <span class="nb">array</span> <span class="n">splitting</span> <span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="p">[]).</span>

<span class="n">skipArray</span> <span class="o">-</span> <span class="k">if</span> <span class="k">False</span> <span class="k">and</span> <span class="k">any</span> <span class="mi">2</span><span class="n">D</span> <span class="n">parms</span><span class="p">,</span> <span class="k">create</span> <span class="nb">array</span> <span class="n">layout</span> <span class="p">(</span><span class="n">the</span> <span class="k">default</span><span class="p">).</span>  <span class="k">If</span> <span class="k">True</span><span class="p">,</span> <span class="n">skip</span> <span class="nb">array</span>
    <span class="n">layout</span> <span class="p">(</span><span class="n">typically</span> <span class="n">used</span> <span class="k">when</span> <span class="n">there</span> <span class="k">are</span> <span class="n">too</span> <span class="n">many</span> <span class="n">ind</span> <span class="n">parm</span> <span class="n">value</span> <span class="n">combinations</span> <span class="o">-</span> <span class="n">generally</span> <span class="k">not</span> <span class="n">recommended</span><span class="p">).</span>
</pre></div>


<p>Affects: populates self._privList if file exists.  self._privList is the underlying
    list of MadrigalDataRecords, MadrigalCatalogRecords, and MadrigalHeaderRecords.
    Also populates:
        self._tableDType - the numpy dtype to use to build the table layout<br />
        self._nextRecord - the index of the next record to read from the input file. Not used if
            createFlag = True
            (The following are the input arguments described above)
        self._fullFilename
        self._createFlag
        self._startDatetime
        self._endDatetime
        self._maxRecords
        self._totalDataRecords - number of data records appended (may differ from len(self._privList)
            if dump called).
        self._minMaxParmDict - a dictionary with key = parm mnems, value = tuple of
            min, max values (may be nan)
        self._arrDict - a dictionary with key = list of array split parm values found in file,
            ('' if no spliting), and values = dict of key = 'ut1_unix' and ind 2d parm names (excluding
            array splitting parms, if also ind 2D parm), and values
            = python set of all unique values.  Populated only if createFlag=True. Used to create
            Array Layout
        self._recIndexList - a list of (startIndex, endIndex) for each data record added.  Used to slice out
            data records from Table Layout
        self._num2DSplit - Number of arraySplitParms that are 2D
        self._closed - a boolean used to determine if the file being created was already closed</p>
<p>Returns: void</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.__init__', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullFilename</span><span class="p">,</span>
<span class="n">reateFlag</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
     <span class="n">startDatetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
     <span class="n">endDatetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
     <span class="n">maxRecords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
     <span class="n">recDset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
     <span class="n">arraySplitParms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
     <span class="n">skipArray</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;__init__ initializes MadrigalCedarFile by reading in existing file, if any.</span>
<span class="sd">    Inputs:</span>
<span class="sd">        fullFilename - either the existing Cedar file in Hdf5 format,</span>
<span class="sd">                       or a file to be created. May also be None if this</span>
<span class="sd">                       data is simply derived parameters that be written to stdout.</span>
<span class="sd">        createFlag - tells whether this is a file to be created.  If False and</span>
<span class="sd">                     fullFilename cannot be read, an error is raised.  If True and</span>
<span class="sd">                     fullFilename already exists, or fullFilename cannot be created,</span>
<span class="sd">                     an error is raised.</span>
<span class="sd">                     </span>
<span class="sd">        startDatetime - if not None (the default), reject all input records where</span>
<span class="sd">              record end time &lt; startDatetime (datetime.datetime object).</span>
<span class="sd">              Ignored if createFlag == True</span>

<span class="sd">        endDatetime - if not None (the default), reject all input records where</span>
<span class="sd">              record start time &gt; endDatetime (datetime.datetime object)</span>
<span class="sd">              Ignored if createFlag == True</span>
<span class="sd">              </span>
<span class="sd">        maxRecords - the maximum number of records to read into memory</span>
<span class="sd">                Ignored if createFlag == True</span>
<span class="sd">                </span>
<span class="sd">        recDset - a numpy recarray with column names the names of all parameters, starting</span>
<span class="sd">            with requiredFields.  Values are 1 for 1D (all the required parms are 1D), 2 for</span>
<span class="sd">            dependent 2D, and 3 for independent spatial 2D parameters.  If None, self._recDset</span>
<span class="sd">            not set until first data record appended.</span>
<span class="sd">            </span>
<span class="sd">        arraySplitParms - if None (the default), read in arraySplitParms from the exiting file.</span>
<span class="sd">            Otherwise set self._arraySplitParms to arraySplitParms, which is a list of 1D or 2D parms</span>
<span class="sd">            where each unique set of value of the parms in this list will be used to split the full</span>
<span class="sd">            data into separate arrays in Hdf5 or netCDF4 files.  For example arraySplitParms=[&#39;beamid&#39;]</span>
<span class="sd">            would split the data into separate arrays for each beamid. If None and new file is being</span>
<span class="sd">            created, no array splitting (self._arraySplitParms = []).</span>
<span class="sd">            </span>
<span class="sd">        skipArray - if False and any 2D parms, create array layout (the default).  If True, skip array</span>
<span class="sd">            layout (typically used when there are too many ind parm value combinations - generally not recommended).</span>
<span class="sd">        </span>
<span class="sd">     </span>
<span class="sd">    Affects: populates self._privList if file exists.  self._privList is the underlying</span>
<span class="sd">        list of MadrigalDataRecords, MadrigalCatalogRecords, and MadrigalHeaderRecords.</span>
<span class="sd">        Also populates:</span>
<span class="sd">            self._tableDType - the numpy dtype to use to build the table layout  </span>
<span class="sd">            self._nextRecord - the index of the next record to read from the input file. Not used if</span>
<span class="sd">                createFlag = True</span>
<span class="sd">                (The following are the input arguments described above)</span>
<span class="sd">            self._fullFilename</span>
<span class="sd">            self._createFlag</span>
<span class="sd">            self._startDatetime</span>
<span class="sd">            self._endDatetime</span>
<span class="sd">            self._maxRecords</span>
<span class="sd">            self._totalDataRecords - number of data records appended (may differ from len(self._privList)</span>
<span class="sd">                if dump called).</span>
<span class="sd">            self._minMaxParmDict - a dictionary with key = parm mnems, value = tuple of</span>
<span class="sd">                min, max values (may be nan)</span>
<span class="sd">            self._arrDict - a dictionary with key = list of array split parm values found in file,</span>
<span class="sd">                (&#39;&#39; if no spliting), and values = dict of key = &#39;ut1_unix&#39; and ind 2d parm names (excluding</span>
<span class="sd">                array splitting parms, if also ind 2D parm), and values</span>
<span class="sd">                = python set of all unique values.  Populated only if createFlag=True. Used to create</span>
<span class="sd">                Array Layout</span>
<span class="sd">            self._recIndexList - a list of (startIndex, endIndex) for each data record added.  Used to slice out</span>
<span class="sd">                data records from Table Layout</span>
<span class="sd">            self._num2DSplit - Number of arraySplitParms that are 2D</span>
<span class="sd">            self._closed - a boolean used to determine if the file being created was already closed</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">        </span>
<span class="sd">    </span>
<span class="sd">    Returns: void</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span> <span class="o">=</span> <span class="n">fullFilename</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_startDatetime</span> <span class="o">=</span> <span class="n">startDatetime</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_endDatetime</span> <span class="o">=</span> <span class="n">endDatetime</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_maxRecords</span> <span class="o">=</span> <span class="n">maxRecords</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_totalDataRecords</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set to the dtype of Table Layout</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set when first data record appended</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set when first data record appended</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set when first data record appended</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="n">arraySplitParms</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_skipArray</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">skipArray</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">createFlag</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># no need to close file only being read</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;.hdf&#39;</span><span class="p">)</span>
    
    <span class="c1"># keep track of earliest and latest record times</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># summary info</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># a list of all kinsts integers in file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># a list of all kindats integers in file</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span> <span class="c1"># can be externally set</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used to check that partial writes via dump are consistent</span>
    <span class="k">if</span> <span class="n">createFlag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;in MadrigalCedarFile, createFlag must be either True or False&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_createFlag</span> <span class="o">=</span> <span class="n">createFlag</span>
    <span class="k">if</span> <span class="n">createFlag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;in MadrigalCedarFile, fullFilename </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fullFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;MadrigalCedarFile can only read in CEDAR Hdf5 files, not </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fullFilename</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">createFlag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fullFilename</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># then this data will never be persisted - only written to stdout</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;in MadrigalCedarFile, fullFilename </span><span class="si">%s</span><span class="s1"> already exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;in MadrigalCedarFile, fullFilename </span><span class="si">%s</span><span class="s1"> cannot be created&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">fullFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;All Madrigal files must end with hdf5 extension, &lt;</span><span class="si">%s</span><span class="s1">&gt; does not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fullFilename</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="p">[]</span>
            
    <span class="c1"># create needed Madrigal objects</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_madDBObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalDB</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalInstrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDBObj</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDBObj</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalKindat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDBObj</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">]</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># will be set to bool when first record added</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">if</span> <span class="n">recDset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">=</span> <span class="n">recDset</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">createFlag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maxRecords</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.append">
    <p>def <span class="ident">append</span>(</p><p>self, item)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.append', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.append" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="c1"># check that value in (MadrigalCatalogRecord, MadrigalHeaderRecord, MadrigalDataRecord)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MadrigalCatalogRecord</span><span class="p">)</span> <span class="ow">and</span> \
       <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MadrigalHeaderRecord</span><span class="p">)</span> <span class="ow">and</span> \
       <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MadrigalDataRecord</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;In MadrigalCedarFile, can only add MadrigalCatalogRecord, MadrigalHeaderRecord, or MadrigalDataRecord&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MadrigalDataRecord</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getDType</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Varying dtypes found: </span><span class="si">%s</span><span class="s1"> versus </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getDType</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDType</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getDType</span><span class="p">())</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getRecordset</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Varying recordsets found: </span><span class="si">%s</span><span class="s1"> versus </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getRecordset</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getRecordset</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># set all internal data structures set by data records only if not yet set</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getInd2DParms</span><span class="p">()</span>
            <span class="c1"># set self._num2DSplit</span>
            <span class="n">twoDSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">mnemonic</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">])</span>
            <span class="n">arraySplitSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDSet</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">arraySplitSet</span><span class="p">))</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getKinst</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">getKindat</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getKindat</span><span class="p">())</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setRecno</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_totalDataRecords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_totalDataRecords</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># update self._recIndexList</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lastIndex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lastIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lastIndex</span><span class="p">,</span> <span class="n">lastIndex</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getDataset</span><span class="p">())))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getDataset</span><span class="p">()</span>
            <span class="n">rowsToCheck</span> <span class="o">=</span> <span class="n">dataset</span>
                
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">thisRow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rowsToCheck</span><span class="p">):</span>
                <span class="c1"># update self._arrDict</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">==</span> <span class="p">[]:</span>
                    
                    <span class="n">arraySplitParms</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                            <span class="n">arraySplitParms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">arraySplitParms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">arraySplitParms</span><span class="p">])</span>
                    <span class="c1"># array splitting parameters can never be nan</span>
                    <span class="k">for</span> <span class="n">this_value</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">this_value</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">this_value</span><span class="p">):</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is an array splitting parameter, so its illegal to have a nan value for it anywhere in the file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># no splitting</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    
                <span class="c1"># first add ut1_unix if needed </span>
                <span class="k">if</span> <span class="s1">&#39;ut1_unix&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">thisRow</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]])</span>
                
                <span class="c1"># now deal with all ind parms</span>
                <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
                    <span class="n">mnem</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span>
                    <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">:</span>
                        <span class="c1"># no need to create separate dimension since already split out</span>
                        <span class="k">continue</span>
                    
                    <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">thisRow</span><span class="p">[</span><span class="n">mnem</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">]</span><span class="o">.</span><span class="n">union</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="n">mnem</span><span class="p">]])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">thisRow</span><span class="p">[</span><span class="n">mnem</span><span class="p">]])</span>
                        
                    <span class="c1"># enforce nan rule for ind2DList</span>
                    <span class="n">thisList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">skip</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">thisList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">bytes</span><span class="p">:</span>
                            <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">thisList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">thisList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">:</span>
                                <span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">thisList</span><span class="p">)):</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot have nan in ind parm </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mnem</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">mnem</span><span class="p">])))</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.close">
    <p>def <span class="ident">close</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>close closes an open MadrigalCedarFile.  It calls _writeHdf5Metadata and _addArray if ind parms.</p>
<p>Most be called directly when dump used.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.close', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.close" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;close closes an open MadrigalCedarFile.  It calls _writeHdf5Metadata and _addArray if ind parms.</span>
<span class="sd">    </span>
<span class="sd">    Most be called directly when dump used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span><span class="p">:</span>
        <span class="c1"># nothing to do</span>
        <span class="k">return</span>
    
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Metadata</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skipArray</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addArrayDump</span><span class="p">()</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.count">
    <p>def <span class="ident">count</span>(</p><p>self, other)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.count', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.count" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.createCatalogTimeSection">
    <p>def <span class="ident">createCatalogTimeSection</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>createCatalogTimeSection will return all the lines in the catalog record that
describe the start and end time of the data records.</p>
<p>Inputs: None</p>
<p>Returns:  a tuple with three items 1) a string in the format of the time section of a
catalog record, 2) earliest datetime, 3) latest datetime</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.createCatalogTimeSection', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.createCatalogTimeSection" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">createCatalogTimeSection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;createCatalogTimeSection will return all the lines in the catalog record that</span>
<span class="sd">    describe the start and end time of the data records.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Returns:  a tuple with three items 1) a string in the format of the time section of a</span>
<span class="sd">    catalog record, 2) earliest datetime, 3) latest datetime</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span>
    <span class="n">latestEndTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span>
    <span class="n">sy</span> <span class="o">=</span> <span class="s1">&#39;IBYRE       </span><span class="si">%4s</span><span class="s1"> Beginning year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
    <span class="n">sd</span> <span class="o">=</span> <span class="s1">&#39;IBDTE       </span><span class="si">%4s</span><span class="s1"> Beginning month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                          <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
    <span class="n">sh</span> <span class="o">=</span> <span class="s1">&#39;IBHME       </span><span class="si">%4s</span><span class="s1"> Beginning UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                               <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
    <span class="n">totalCS</span> <span class="o">=</span> <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;IBCSE       </span><span class="si">%4s</span><span class="s1"> Beginning centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>
    
    <span class="n">ey</span> <span class="o">=</span> <span class="s1">&#39;IEYRE       </span><span class="si">%4s</span><span class="s1"> Ending year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
    <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;IEDTE       </span><span class="si">%4s</span><span class="s1"> Ending month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                       <span class="n">latestEndTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
    <span class="n">eh</span> <span class="o">=</span> <span class="s1">&#39;IEHME       </span><span class="si">%4s</span><span class="s1"> Ending UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                            <span class="n">latestEndTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
    <span class="n">totalCS</span> <span class="o">=</span> <span class="n">latestEndTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">es</span> <span class="o">=</span> <span class="s1">&#39;IECSE       </span><span class="si">%4s</span><span class="s1"> Ending centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>
    <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sy</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ss</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ey</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ey</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ed</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ed</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">eh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">eh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">es</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="k">return</span><span class="p">((</span><span class="n">retStr</span><span class="p">,</span> <span class="n">earliestStartTime</span><span class="p">,</span> <span class="n">latestEndTime</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.createHeaderTimeSection">
    <p>def <span class="ident">createHeaderTimeSection</span>(</p><p>self, dataRecList=None)</p>
    </div>
    

    
  
    <div class="desc"><p>createHeaderTimeSection will return all the lines in the header record that
describe the start and end time of the data records.</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="err">dataRecList - if given, examine only those MadrigalDataRecords in dataRecList.</span>
<span class="err">              If None (the default), examine all MadrigalDataRecords in this</span>
<span class="err">              MadrigalCedarFile</span>
</pre></div>


<p>Returns:  a tuple with three items 1) a string in the format of the time section of a
header record, 2) earliest datetime, 3) latest datetime</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.createHeaderTimeSection', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.createHeaderTimeSection" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">createHeaderTimeSection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataRecList</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;createHeaderTimeSection will return all the lines in the header record that</span>
<span class="sd">    describe the start and end time of the data records.</span>
<span class="sd">    Inputs:</span>
<span class="sd">        dataRecList - if given, examine only those MadrigalDataRecords in dataRecList.</span>
<span class="sd">                      If None (the default), examine all MadrigalDataRecords in this</span>
<span class="sd">                      MadrigalCedarFile</span>
<span class="sd">    Returns:  a tuple with three items 1) a string in the format of the time section of a</span>
<span class="sd">    header record, 2) earliest datetime, 3) latest datetime</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dataRecList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span>
        <span class="n">latestEndTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">latestEndTime</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">dataRecList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1">#earliest time</span>
            <span class="n">thisTime</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">earliestStartTime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="n">thisTime</span>
            <span class="k">if</span> <span class="n">earliestStartTime</span> <span class="o">&gt;</span> <span class="n">thisTime</span><span class="p">:</span>
                <span class="n">earliestStartTime</span> <span class="o">=</span> <span class="n">thisTime</span>

            <span class="c1">#latest time</span>
            <span class="n">thisTime</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">latestEndTime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">latestEndTime</span> <span class="o">=</span> <span class="n">thisTime</span>
            <span class="k">if</span> <span class="n">latestEndTime</span> <span class="o">&lt;</span> <span class="n">thisTime</span><span class="p">:</span>
                <span class="n">latestEndTime</span> <span class="o">=</span> <span class="n">thisTime</span>
            
    <span class="n">sy</span> <span class="o">=</span> <span class="s1">&#39;IBYRT               </span><span class="si">%4s</span><span class="s1"> Beginning year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
    <span class="n">sd</span> <span class="o">=</span> <span class="s1">&#39;IBDTT               </span><span class="si">%4s</span><span class="s1"> Beginning month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                          <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
    <span class="n">sh</span> <span class="o">=</span> <span class="s1">&#39;IBHMT               </span><span class="si">%4s</span><span class="s1"> Beginning UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                               <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
    <span class="n">totalCS</span> <span class="o">=</span> <span class="n">earliestStartTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">earliestStartTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">ss</span> <span class="o">=</span> <span class="s1">&#39;IBCST               </span><span class="si">%4s</span><span class="s1"> Beginning centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>
    
    <span class="n">ey</span> <span class="o">=</span> <span class="s1">&#39;IEYRT               </span><span class="si">%4s</span><span class="s1"> Ending year&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
    <span class="n">ed</span> <span class="o">=</span> <span class="s1">&#39;IEDTT               </span><span class="si">%4s</span><span class="s1"> Ending month and day&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">month</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                       <span class="n">latestEndTime</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>
    <span class="n">eh</span> <span class="o">=</span> <span class="s1">&#39;IEHMT               </span><span class="si">%4s</span><span class="s1"> Ending UT hour and minute&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> \
                                                            <span class="n">latestEndTime</span><span class="o">.</span><span class="n">minute</span><span class="p">))</span>
    <span class="n">totalCS</span> <span class="o">=</span> <span class="n">latestEndTime</span><span class="o">.</span><span class="n">second</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">latestEndTime</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">es</span> <span class="o">=</span> <span class="s1">&#39;IECST               </span><span class="si">%4s</span><span class="s1"> Ending centisecond&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">totalCS</span><span class="p">))</span>
    <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sy</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sy</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sd</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">sh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ss</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ey</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ey</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">ed</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ed</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">eh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">eh</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">es</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">es</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="k">return</span><span class="p">((</span><span class="n">retStr</span><span class="p">,</span> <span class="n">earliestStartTime</span><span class="p">,</span> <span class="n">latestEndTime</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.dump">
    <p>def <span class="ident">dump</span>(</p><p>self, format=&#39;hdf5&#39;, newFilename=None, parmIndexDict=None)</p>
    </div>
    

    
  
    <div class="desc"><p>dump appends all the present records in MadrigalCedarFile to file, and removes present data records from MadrigalCedarFile.</p>
<p>Can be used to append records to a file. Catalog and header records are maintaained.</p>
<p>Typically close is called after all calls to dump. The <strong>del</strong> method will automatically call 
close if needed, and print a warning that the user should add it to their code.</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">format</span> <span class="o">-</span> <span class="n">a</span> <span class="n">format</span> <span class="k">to</span> <span class="n">save</span> <span class="n">the</span> <span class="n">file</span> <span class="k">in</span><span class="p">.</span>  <span class="n">The</span> <span class="n">format</span> <span class="n">argument</span> <span class="k">only</span> <span class="k">exists</span> <span class="k">for</span> <span class="n">backwards</span>
    <span class="n">compatibility</span> <span class="o">-</span> <span class="k">only</span> <span class="n">hdf5</span> <span class="k">is</span> <span class="n">allowed</span><span class="p">.</span>  <span class="n">IOError</span> <span class="n">raised</span> <span class="k">is</span> <span class="k">any</span> <span class="n">other</span> <span class="n">argument</span> <span class="n">given</span><span class="p">.</span>

<span class="n">newFilename</span> <span class="o">-</span> <span class="n">a</span> <span class="n">filename</span> <span class="k">to</span> <span class="n">save</span> <span class="k">to</span><span class="p">.</span>  <span class="k">Defaults</span> <span class="k">to</span> <span class="k">self</span><span class="p">.</span><span class="n">_fullFilename</span> <span class="n">passed</span> <span class="k">into</span> <span class="n">initializer</span> <span class="k">if</span> <span class="k">not</span> <span class="n">given</span><span class="p">.</span>

<span class="n">parmIndexDict</span> <span class="o">-</span> <span class="n">used</span> <span class="k">only</span> <span class="k">for</span> <span class="n">dumping</span> <span class="n">netCDF4</span>
</pre></div>


<p>Outputs: None</p>
<p>Affects: writes a MadrigalCedarFile to file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.dump', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.dump" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;dump appends all the present records in MadrigalCedarFile to file, and removes present data records from MadrigalCedarFile.</span>
<span class="sd">    Can be used to append records to a file. Catalog and header records are maintaained.</span>
<span class="sd">    </span>
<span class="sd">    Typically close is called after all calls to dump. The __del__ method will automatically call </span>
<span class="sd">    close if needed, and print a warning that the user should add it to their code.</span>
<span class="sd">    Inputs:</span>
<span class="sd">        format - a format to save the file in.  The format argument only exists for backwards</span>
<span class="sd">            compatibility - only hdf5 is allowed.  IOError raised is any other argument given.</span>
<span class="sd">            </span>
<span class="sd">        newFilename - a filename to save to.  Defaults to self._fullFilename passed into initializer if not given.</span>
<span class="sd">            </span>
<span class="sd">        parmIndexDict - used only for dumping netCDF4</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: writes a MadrigalCedarFile to file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">!=</span> <span class="nb">format</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Previous dump format was </span><span class="si">%s</span><span class="s1">, cannot now use </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">format</span><span class="p">)))</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Format must be hdf5 for dump, not </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">format</span><span class="p">)))</span>
    
    <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">newFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># first write - run checks, and create all possible metadata and data</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;newFilename &lt;</span><span class="si">%s</span><span class="s1">&gt; already exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newFilename</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">newFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;.nc&#39;</span><span class="p">])):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;filename must end with </span><span class="si">%s</span><span class="s1">, &lt;</span><span class="si">%s</span><span class="s1">&gt; does not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;.nc&#39;</span><span class="p">])),</span> <span class="n">newFilename</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">newFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;filename must end with </span><span class="si">%s</span><span class="s1">, &lt;</span><span class="si">%s</span><span class="s1">&gt; does not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">,</span> <span class="n">newFilename</span><span class="p">))</span>
        
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># nothing to dump</span>
        <span class="k">return</span>
    
    
    <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
    
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># we need to make sure this file is closed and then deleted if an error</span>
            <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used if next line fails</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasArray</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Cannot call dump for hdf5 after write or close&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Data</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># on any error, close and delete file, then reraise error</span>
            <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newFilename</span><span class="p">)</span>
            <span class="k">raise</span>
        
    <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Cannot dump netCDF4 files with arraySplitParms - write to Hdf5 and then convert&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># first write</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_firstDumpNetCDF4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_appendNetCDF4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
            
    <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">=</span> <span class="nb">format</span>
    
    <span class="c1"># dump data records out of memory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="o">=</span> <span class="p">[</span><span class="n">rec</span> <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.get1DParms">
    <p>def <span class="ident">get1DParms</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>get1DParms returns a list of mnemonics of 1D parms
in file.  May be empty if none. </p>
<p>Raises ValueError if self._oneDList is None, since parameters unknown</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.get1DParms', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.get1DParms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get1DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get1DParms returns a list of mnemonics of 1D parms</span>
<span class="sd">    in file.  May be empty if none. </span>
<span class="sd">    </span>
<span class="sd">    Raises ValueError if self._oneDList is None, since parameters unknown</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;get1DParms cannot be called before any data records added to this file&#39;</span><span class="p">)</span>
    
    <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
        <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.get2DParms">
    <p>def <span class="ident">get2DParms</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>get2DParms returns a list of mnemonics of dependent 2D parms
in file.  May be empty if none. </p>
<p>Raises ValueError if self._twoDList is None, since parameters unknown</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.get2DParms', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.get2DParms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get2DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get2DParms returns a list of mnemonics of dependent 2D parms</span>
<span class="sd">    in file.  May be empty if none. </span>
<span class="sd">    </span>
<span class="sd">    Raises ValueError if self._twoDList is None, since parameters unknown</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;get2DParms cannot be called before any data records added to this file&#39;</span><span class="p">)</span>
    
    <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
        <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getArraySplitParms">
    <p>def <span class="ident">getArraySplitParms</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getArraySplitParms returns a list of mnemonics of parameters used to split array.  May be empty or None.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getArraySplitParms', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getArraySplitParms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getArraySplitParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getArraySplitParms returns a list of mnemonics of parameters used to split array.  May be empty or None. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getDType">
    <p>def <span class="ident">getDType</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getDType returns the dtype of the table array in this file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getDType', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getDType" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getDType returns the dtype of the table array in this file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getEarliestDT">
    <p>def <span class="ident">getEarliestDT</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getEarliestDT returns the earliest datetime found in file, or None if no data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getEarliestDT', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getEarliestDT" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getEarliestDT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getEarliestDT returns the earliest datetime found in file, or None if no data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getIndSpatialParms">
    <p>def <span class="ident">getIndSpatialParms</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getIndSpatialParms returns a list of mnemonics of independent spatial parameters
in file.  May be empty if none. </p>
<p>Raises ValueError if self._ind2DList is None, since parameters unknown</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getIndSpatialParms', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getIndSpatialParms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getIndSpatialParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getIndSpatialParms returns a list of mnemonics of independent spatial parameters</span>
<span class="sd">    in file.  May be empty if none. </span>
<span class="sd">    </span>
<span class="sd">    Raises ValueError if self._ind2DList is None, since parameters unknown</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;getIndSpatialParms cannot be called before any data records added to this file&#39;</span><span class="p">)</span>
    
    <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
        <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getKindatList">
    <p>def <span class="ident">getKindatList</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getKindatList returns the list of kindat integers in the file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getKindatList', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getKindatList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getKindatList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getKindatList returns the list of kindat integers in the file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getKinstList">
    <p>def <span class="ident">getKinstList</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getKinstList returns the list of kinst integers in the file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getKinstList', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getKinstList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getKinstList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getKinstList returns the list of kinst integers in the file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getLatestDT">
    <p>def <span class="ident">getLatestDT</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getLatestDT returns the latest datetime found in file, or None if no data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getLatestDT', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getLatestDT" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getLatestDT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getLatestDT returns the latest datetime found in file, or None if no data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getMaxMinValues">
    <p>def <span class="ident">getMaxMinValues</span>(</p><p>self, mnemonic, verifyValid=False)</p>
    </div>
    

    
  
    <div class="desc"><p>getMaxMinValues returns a tuple of (minimum value, maximum value) of the value
of parm in this file.  If verifyValid is True, then only lines with valid 2D data
are included.  If no valid values, returns (NaN, NaN). Also updates self._minMaxParmDict</p>
<p>Raise IOError if parm not found</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getMaxMinValues', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getMaxMinValues" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getMaxMinValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mnemonic</span><span class="p">,</span> <span class="n">verifyValid</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getMaxMinValues returns a tuple of (minimum value, maximum value) of the value</span>
<span class="sd">    of parm in this file.  If verifyValid is True, then only lines with valid 2D data</span>
<span class="sd">    are included.  If no valid values, returns (NaN, NaN). Also updates self._minMaxParmDict</span>
<span class="sd">    </span>
<span class="sd">    Raise IOError if parm not found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parm</span> <span class="o">=</span> <span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    
    <span class="c1"># for string data, always return (Nan, Nan)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span>
        <span class="k">return</span><span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">))</span>
    
    <span class="c1"># create a merged dataset</span>
    <span class="n">datasetList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
            <span class="n">datasetList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;No data records in file&#39;</span><span class="p">)</span>
    
    <span class="n">merged_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">datasetList</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">verifyValid</span><span class="p">:</span>
        <span class="c1"># veru simple - just jusr numpy methods</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">))</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="n">minValue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">maxValue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orgMin</span><span class="p">,</span> <span class="n">orgMax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">minValue</span><span class="p">,</span> <span class="n">orgMin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxValue</span><span class="p">,</span> <span class="n">orgMax</span><span class="p">)]</span>
        <span class="k">return</span><span class="p">((</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">))</span>
    
    <span class="c1"># we need to find the minimum and maximum for only valid data</span>
    <span class="c1"># first sort by parm so we just need to walk until we find a valid row starting at the top and bottom</span>
    <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">])</span>
    
    <span class="c1"># find min</span>
    <span class="n">minValue</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sorted_indices</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">twoDParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">twoDParm</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="c1"># make sure its not a special error value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span> <span class="ow">and</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">twoDParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># minimum found</span>
            <span class="n">minValue</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">minValue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">break</span>
        
    <span class="c1"># find max</span>
    <span class="n">maxValue</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">sorted_indices</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">twoDParm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">merged_dataset</span><span class="p">[</span><span class="n">twoDParm</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                <span class="k">continue</span>
            <span class="c1"># make sure its not a special error value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span> <span class="ow">and</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">twoDParm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># minimum found</span>
            <span class="n">maxValue</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">maxValue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">break</span>
            
    <span class="k">if</span> <span class="n">minValue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">minValue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">if</span> <span class="n">maxValue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">maxValue</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        
    <span class="k">if</span> <span class="n">parm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">orgMin</span><span class="p">,</span> <span class="n">orgMax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxParmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">minValue</span><span class="p">,</span> <span class="n">orgMin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxValue</span><span class="p">,</span> <span class="n">orgMax</span><span class="p">)]</span>
        
    <span class="k">return</span><span class="p">((</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getParmDim">
    <p>def <span class="ident">getParmDim</span>(</p><p>self, parm)</p>
    </div>
    

    
  
    <div class="desc"><p>getParmDim returns the dimension (1,2, or 3 for independent spatial parms) of input parm</p>
<p>Raises ValueError if no data records yet.
Raise KeyError if that parameter not found in file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getParmDim', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getParmDim" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getParmDim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getParmDim returns the dimension (1,2, or 3 for independent spatial parms) of input parm</span>
<span class="sd">    </span>
<span class="sd">    Raises ValueError if no data records yet.</span>
<span class="sd">    Raise KeyError if that parameter not found in file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;getParmDim cannot be called before any data records added to this file&#39;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># do ind 2D next since they are in both lists</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in data&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getRecDType">
    <p>def <span class="ident">getRecDType</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getRecDType returns the dtype of _record_layout</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getRecDType', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getRecDType" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getRecDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getRecDType returns the dtype of _record_layout</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getRecIndexList">
    <p>def <span class="ident">getRecIndexList</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getRecIndexList returns a list of record indexes into Table Layout</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getRecIndexList', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getRecIndexList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getRecIndexList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getRecIndexList returns a list of record indexes into Table Layout</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getRecordset">
    <p>def <span class="ident">getRecordset</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getRecordset returns the recordset array from the first data record.</p>
<p>Raises IOError if None</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getRecordset', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getRecordset" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getRecordset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getRecordset returns the recordset array from the first data record.</span>
<span class="sd">    </span>
<span class="sd">    Raises IOError if None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;self._recDset is None&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getStatus">
    <p>def <span class="ident">getStatus</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getStatus returns the status string</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getStatus', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getStatus" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getStatus returns the status string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.getStringFormat">
    <p>def <span class="ident">getStringFormat</span>(</p><p>self, parm)</p>
    </div>
    

    
  
    <div class="desc"><p>getStringFormat returns string format string.  Raises error if not string type,
or parm not in record. or table dtype not yet set</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.getStringFormat', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.getStringFormat" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getStringFormat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getStringFormat returns string format string.  Raises error if not string type,</span>
<span class="sd">    or parm not in record. or table dtype not yet set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> not a string, cannot call getStringFormat&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()]))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.hasArray">
    <p>def <span class="ident">hasArray</span>(</p><p>self, f)</p>
    </div>
    

    
  
    <div class="desc"><p>hasArray returns True in f['Data']['Array Layout'] exists, False otherwise</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.hasArray', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.hasArray" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">hasArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;hasArray returns True in f[&#39;Data&#39;][&#39;Array Layout&#39;] exists, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;Data&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="s1">&#39;Array Layout&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        
    <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.index">
    <p>def <span class="ident">index</span>(</p><p>self, other)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.index', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.index" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.insert">
    <p>def <span class="ident">insert</span>(</p><p>self, i, x)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.insert', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.insert" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.loadNextRecords">
    <p>def <span class="ident">loadNextRecords</span>(</p><p>self, numRecords=None, removeExisting=True)</p>
    </div>
    

    
  
    <div class="desc"><p>loadNextRecords loads a maximum of numRecords.  Returns tuple of the the number of records loaded, and boolean of whether complete.
May be less than numRecords if not enough records in the input file.  Returns 0 if no records left.</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">numRecords</span> <span class="o">-</span> <span class="nb">number</span> <span class="k">of</span> <span class="n">records</span> <span class="k">to</span> <span class="n">try</span> <span class="k">to</span> <span class="k">load</span><span class="p">.</span>  <span class="k">If</span> <span class="k">None</span><span class="p">,</span> <span class="k">load</span> <span class="k">all</span> <span class="n">remaining</span> <span class="n">records</span>

<span class="n">removeExisting</span> <span class="o">-</span> <span class="k">if</span> <span class="k">True</span> <span class="p">(</span><span class="n">the</span> <span class="k">default</span><span class="p">),</span> <span class="n">remove</span> <span class="k">existing</span> <span class="n">records</span> <span class="k">before</span> <span class="n">loading</span> <span class="k">new</span>
    <span class="n">ones</span><span class="p">.</span>  <span class="k">If</span> <span class="k">False</span><span class="p">,</span> <span class="n">append</span> <span class="k">new</span> <span class="n">records</span> <span class="k">to</span> <span class="k">existing</span> <span class="n">records</span><span class="p">.</span>
</pre></div>


<p>Returns:</p>
<div class="codehilite"><pre><span></span><span class="err">    tuple of the the number of records loaded, and boolean of whether complete. </span>
<span class="err">    May be less than numRecords if not enough records.</span>
</pre></div>


<p>Raises error if file opened with createFlag = True</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.loadNextRecords', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.loadNextRecords" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">loadNextRecords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numRecords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">removeExisting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;loadNextRecords loads a maximum of numRecords.  Returns tuple of the the number of records loaded, and boolean of whether complete.</span>
<span class="sd">    May be less than numRecords if not enough records in the input file.  Returns 0 if no records left.</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">        numRecords - number of records to try to load.  If None, load all remaining records</span>
<span class="sd">        </span>
<span class="sd">        removeExisting - if True (the default), remove existing records before loading new</span>
<span class="sd">            ones.  If False, append new records to existing records.</span>
<span class="sd">            </span>
<span class="sd">    Returns:</span>
<span class="sd">        </span>
<span class="sd">            tuple of the the number of records loaded, and boolean of whether complete. </span>
<span class="sd">            May be less than numRecords if not enough records.  </span>
<span class="sd">            </span>
<span class="sd">    Raises error if file opened with createFlag = True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_createFlag</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Cannot call loadNextRecords when creating a new MadrigalCedarFile&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">removeExisting</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="n">isComplete</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="n">hdfFile</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">tableDset</span> <span class="o">=</span> <span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Data&quot;</span><span class="p">][</span><span class="s2">&quot;Table Layout&quot;</span><span class="p">]</span>
    <span class="n">metadataGroup</span> <span class="o">=</span> <span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">]</span>
    <span class="n">recDset</span> <span class="o">=</span> <span class="n">metadataGroup</span><span class="p">[</span><span class="s2">&quot;_record_layout&quot;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">=</span> <span class="n">recDset</span><span class="p">[()]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span> <span class="o">!=</span> <span class="n">recDset</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;recDset in first record &lt;</span><span class="si">%s</span><span class="s1">&gt; does not match expected recDset &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">recDset</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verifyFormat</span><span class="p">(</span><span class="n">tableDset</span><span class="p">,</span> <span class="n">recDset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="o">=</span> <span class="n">tableDset</span><span class="o">.</span><span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">][</span><span class="s1">&#39;Experiment Parameters&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getKinstList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getKindatList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getArraySplitParms</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;Experiment Notes&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_appendCatalogRecs</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">][</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_appendHeaderRecs</span><span class="p">(</span><span class="n">hdfFile</span><span class="p">[</span><span class="s2">&quot;Metadata&quot;</span><span class="p">][</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">])</span>
        
        
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parmObjList</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">)</span> <span class="c1"># used for performance in load</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">parmObjList</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="c1"># get indices for each record</span>
    <span class="n">recLoaded</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">recTested</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;recnoArr&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recnoArr</span> <span class="o">=</span> <span class="n">tableDset</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span>
    <span class="c1"># read all the records in at once for performance</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">numRecords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recnoArr</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">+</span> <span class="n">numRecords</span><span class="p">]))</span>
        <span class="n">tableIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableIndices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fullTableSlice</span> <span class="o">=</span> <span class="n">tableDset</span><span class="p">[</span><span class="n">tableIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">tableIndices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">fullRecnoArr</span> <span class="o">=</span> <span class="n">fullTableSlice</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fullTableSlice</span> <span class="o">=</span> <span class="n">tableDset</span>
        <span class="n">fullRecnoArr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recnoArr</span>
        
    <span class="k">while</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numRecords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableIndices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">isComplete</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">numRecords</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">recTested</span> <span class="o">&gt;=</span> <span class="n">numRecords</span><span class="p">:</span>
                <span class="k">break</span>
            
        <span class="c1"># get slices of tableDset and recDset to create next MadrigalDataRecord</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">fullRecnoArr</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">tableIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tableIndices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">isComplete</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>
        <span class="n">tableSlice</span> <span class="o">=</span> <span class="n">fullTableSlice</span><span class="p">[</span><span class="n">tableIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">tableIndices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recIndexList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tableIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">tableIndices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nextRecord</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="n">firstRow</span> <span class="o">=</span> <span class="n">tableSlice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">startDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">])</span>
        <span class="n">stopDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kinstList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">])</span>
            
        <span class="k">if</span> <span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kindatList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">firstRow</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">])</span>
        
        <span class="c1"># find earliest and latest times</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="n">startDT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="n">stopDT</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">startDT</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_earliestDT</span> <span class="o">=</span> <span class="n">startDT</span>
            <span class="k">if</span> <span class="n">stopDT</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_latestDT</span> <span class="o">=</span> <span class="n">stopDT</span>
                
        <span class="n">recTested</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># increment here because the next step may reject it</span>
        
        <span class="c1"># check if datetime filter should be applied</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startDatetime</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endDatetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startDatetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stopDT</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startDatetime</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endDatetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">startDT</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endDatetime</span><span class="p">:</span>
                    <span class="n">isComplete</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">indParmList</span> <span class="o">=</span> <span class="n">metadataGroup</span><span class="p">[</span><span class="s1">&#39;Independent Spatial Parameters&#39;</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span>
                <span class="n">indParms</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">indParms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span>
            
                
        <span class="n">newMadDataRec</span> <span class="o">=</span> <span class="n">MadrigalDataRecord</span><span class="p">(</span><span class="n">madInstObj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="p">,</span> <span class="n">madParmObj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="p">,</span>
                                           <span class="n">dataset</span><span class="o">=</span><span class="n">tableSlice</span><span class="p">,</span> <span class="n">recordSet</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_recDset</span><span class="p">,</span> 
                                           <span class="n">parmObjList</span><span class="o">=</span><span class="n">parmObjList</span><span class="p">,</span> <span class="n">ind2DList</span><span class="o">=</span><span class="n">indParms</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="n">newMadDataRec</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="n">newMadDataRec</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="n">newMadDataRec</span><span class="o">.</span><span class="n">getInd2DParms</span><span class="p">()</span>
            <span class="n">parmObjList</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">)</span> <span class="c1"># used for performance in load</span>
            <span class="c1"># set self._num2DSplit</span>
            <span class="n">twoDSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">mnemonic</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">])</span>
            <span class="n">arraySplitSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num2DSplit</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDSet</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">arraySplitSet</span><span class="p">))</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newMadDataRec</span><span class="p">)</span>
        <span class="n">recLoaded</span> <span class="o">+=</span> <span class="mi">1</span>
        
    <span class="n">hdfFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="c1"># update minmax</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totalDataRecords</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateMinMaxParmDict</span><span class="p">()</span>
    
    <span class="k">return</span><span class="p">((</span><span class="n">recLoaded</span><span class="p">,</span> <span class="n">isComplete</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.parmIsInt">
    <p>def <span class="ident">parmIsInt</span>(</p><p>self, parm)</p>
    </div>
    

    
  
    <div class="desc"><p>parmIsInt returns True if this parm (mnemonic) is integer type, False if not</p>
<p>Raises ValueError if parm not in record. or table dtype not yet set</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.parmIsInt', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.parmIsInt" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parmIsInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;parmIsInt returns True if this parm (mnemonic) is integer type, False if not</span>
<span class="sd">    </span>
<span class="sd">    Raises ValueError if parm not in record. or table dtype not yet set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot call parmIsInt until a data record is added&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">typeStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">typeStr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.parmIsString">
    <p>def <span class="ident">parmIsString</span>(</p><p>self, parm)</p>
    </div>
    

    
  
    <div class="desc"><p>parmIsString returns True if this parm (mnemonic) is string type, False if not</p>
<p>Raises ValueError if parm not in record. or table dtype not yet set</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.parmIsString', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.parmIsString" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parmIsString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;parmIsString returns True if this parm (mnemonic) is string type, False if not</span>
<span class="sd">    </span>
<span class="sd">    Raises ValueError if parm not in record. or table dtype not yet set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot call parmIsInt until a data record is added&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">typeStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">typeStr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.pop">
    <p>def <span class="ident">pop</span>(</p><p>self, i)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.pop', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.pop" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.refreshSummary">
    <p>def <span class="ident">refreshSummary</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>refreshSummary rebuilds the recarray self._experimentParameters</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.refreshSummary', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.refreshSummary" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">refreshSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;refreshSummary rebuilds the recarray self._experimentParameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span>
    <span class="n">kinstCodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kinstNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getKinstList</span><span class="p">():</span>
        <span class="n">kinstCodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">)))</span>
        <span class="n">kinstNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentName</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">))))</span>
    <span class="n">instrumentCodes</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kinstCodes</span><span class="p">)</span>
    <span class="n">instrumentName</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kinstNames</span><span class="p">)</span>
    
    <span class="n">categoryStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getCategory</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
    <span class="n">piStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getContactName</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
    <span class="n">piEmailStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getContactEmail</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
    
    <span class="n">startDateStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UT&#39;</span><span class="p">)</span>
    <span class="n">endDateStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UT&#39;</span><span class="p">)</span>
    
    <span class="n">cedarFileName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span><span class="p">))</span>
    <span class="n">statusDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>
    <span class="n">instLat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getLatitude</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
    <span class="n">instLon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getLongitude</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
    <span class="n">instAlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getAltitude</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
    
    <span class="c1"># create kindat description based on all kindats</span>
    <span class="n">kindatList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getKindatList</span><span class="p">()</span>
    <span class="n">kindatDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">kindatListStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">kindatDesc</span> <span class="o">=</span> <span class="s1">&#39;This experiment has </span><span class="si">%i</span><span class="s1"> kinds of data.  They are:&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kindatList</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kindat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kindatList</span><span class="p">):</span>
            <span class="n">thisKindatDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="o">.</span><span class="n">getKindatDescription</span><span class="p">(</span><span class="n">kindat</span><span class="p">,</span> <span class="n">inst</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">thisKindatDesc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;kindat </span><span class="si">%i</span><span class="s1"> undefined - please add to typeTab.txt&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kindat</span><span class="p">))</span>
            <span class="n">thisKindatDesc</span> <span class="o">=</span> <span class="n">thisKindatDesc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">kindatDesc</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%i</span><span class="s1">) </span><span class="si">%s</span><span class="s1"> (code </span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">thisKindatDesc</span><span class="p">,</span> <span class="n">kindat</span><span class="p">)</span>
            <span class="n">kindatListStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kindat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">kindatDesc</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span>
                <span class="n">kindatListStr</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kindatDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="o">.</span><span class="n">getKindatDescription</span><span class="p">(</span><span class="n">kindatList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inst</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kindatDesc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;kindat for </span><span class="si">%s</span><span class="s1"> undefined - please add to typeTab.txt&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">kindatList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inst</span><span class="p">))))</span>
        <span class="n">kindatDesc</span> <span class="o">=</span> <span class="n">kindatDesc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">kindatListStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kindatList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
    <span class="c1"># create an expSummary numpy recarray  </span>
    <span class="n">summArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="mi">14</span><span class="p">,),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="p">),</span>
                                            <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="p">)])</span>
    
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument code(s)&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;kind of data file&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;kindat code(s)&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;start time&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;end time&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Cedar file name&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;status description&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument latitude&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument longitude&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument altitude&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument category&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument PI&#39;</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;instrument PI email&#39;</span>
                  
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">instrumentName</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">instrumentCodes</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">kindatDesc</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">kindatListStr</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">startDateStr</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">endDateStr</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">cedarFileName</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">statusDesc</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instLat</span><span class="p">)</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instLon</span><span class="p">)</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">instAlt</span><span class="p">)</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">categoryStr</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">piStr</span>
    <span class="n">summArr</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="n">piEmailStr</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_experimentParameters</span> <span class="o">=</span> <span class="n">summArr</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.remove">
    <p>def <span class="ident">remove</span>(</p><p>self, x)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.remove', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.remove" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.reverse">
    <p>def <span class="ident">reverse</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.reverse', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.reverse" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.setDType">
    <p>def <span class="ident">setDType</span>(</p><p>self, dtype)</p>
    </div>
    

    
  
    <div class="desc"><p>setDType sets the dtype of the table array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.setDType', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.setDType" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setDType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setDType sets the dtype of the table array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span> <span class="o">=</span> <span class="n">dtype</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.setStatus">
    <p>def <span class="ident">setStatus</span>(</p><p>self, status)</p>
    </div>
    

    
  
    <div class="desc"><p>setStatus sets the status string</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.setStatus', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.setStatus" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setStatus sets the status string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.sort">
    <p>def <span class="ident">sort</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.sort', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.sort" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">MadrigalDataRecord</span><span class="o">.</span><span class="n">cmpDataRec</span><span class="p">)</span>
    <span class="c1"># reset recno values</span>
    <span class="n">recno</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">set1D</span><span class="p">(</span><span class="s1">&#39;recno&#39;</span><span class="p">,</span> <span class="n">recno</span><span class="p">)</span>
            <span class="n">recno</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.updateMinMaxParmDict">
    <p>def <span class="ident">updateMinMaxParmDict</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>updateMinMaxParmDict updates self._minMaxParmDict</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.updateMinMaxParmDict', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.updateMinMaxParmDict" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">updateMinMaxParmDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;updateMinMaxParmDict updates self._minMaxParmDict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get1DParms</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2DParms</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getMaxMinValues</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.write">
    <p>def <span class="ident">write</span>(</p><p>self, format=&#39;hdf5&#39;, newFilename=None, refreshCatHeadTimes=True, arraySplittingParms=None, skipArrayLayout=False, overwrite=False)</p>
    </div>
    

    
  
    <div class="desc"><p>write persists a MadrigalCedarFile to file.</p>
<p>Note:  There are two ways to write to a MadrigalCedarFile.  Either this method (write) is called after all the
records have been appended to the MadrigalCedarFile, or dump is called after a certain number of records are appended,
and then at the end dump is called a final time if there were any records not yet dumped, followed by close.
The <strong>del</strong> method will automatically call close if needed, and print a warning that the user should add it to
their code.</p>
<p>write has the advantage of being simplier, but has the disadvantage for larger files of keeping all those records
in memory.  dump/close has the advantage of significantly reducing the memory footprint, but is somewhat more complex.</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">format</span> <span class="o">-</span> <span class="n">a</span> <span class="n">format</span> <span class="k">to</span> <span class="n">save</span> <span class="n">the</span> <span class="n">file</span> <span class="k">in</span><span class="p">.</span>  <span class="k">For</span> <span class="n">now</span><span class="p">,</span> <span class="n">the</span> <span class="n">allowed</span> <span class="k">values</span> <span class="k">are</span> 
<span class="s1">&#39;hdf5&#39;</span> <span class="k">and</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">.</span>  <span class="k">Defaults</span> <span class="k">to</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">.</span> <span class="n">Use</span> <span class="n">writeText</span> <span class="k">method</span> <span class="k">to</span> <span class="k">get</span> <span class="nb">text</span> <span class="k">output</span><span class="p">.</span>

<span class="n">newFilename</span> <span class="o">-</span> <span class="n">a</span> <span class="n">filename</span> <span class="k">to</span> <span class="n">save</span> <span class="k">to</span><span class="p">.</span>  <span class="k">Defaults</span> <span class="k">to</span> <span class="k">self</span><span class="p">.</span><span class="n">_fullFilename</span> <span class="n">passed</span> <span class="k">into</span> <span class="n">initializer</span> <span class="k">if</span> <span class="k">not</span> <span class="n">given</span><span class="p">.</span>

<span class="n">refreshCatHeadTimes</span> <span class="o">-</span> <span class="k">if</span> <span class="k">True</span> <span class="p">(</span><span class="n">the</span> <span class="k">default</span><span class="p">),</span> <span class="k">update</span> <span class="k">start</span> <span class="k">and</span> <span class="k">and</span> <span class="n">times</span> <span class="k">in</span> <span class="n">the</span> <span class="k">catalog</span> <span class="k">and</span> <span class="n">header</span>
    <span class="n">records</span> <span class="k">to</span> <span class="n">represent</span> <span class="n">the</span> <span class="n">times</span> <span class="k">in</span> <span class="n">the</span> <span class="k">data</span><span class="p">.</span>  <span class="k">If</span> <span class="k">False</span><span class="p">,</span> <span class="n">use</span> <span class="k">existing</span> <span class="n">times</span> <span class="k">in</span> <span class="n">those</span> <span class="n">records</span><span class="p">.</span>

<span class="n">skipArrayLayout</span> <span class="o">-</span> <span class="k">if</span> <span class="k">True</span><span class="p">,</span> <span class="k">do</span> <span class="k">not</span> <span class="n">include</span> <span class="nb">Array</span> <span class="n">Layout</span> <span class="n">even</span> <span class="k">if</span> <span class="n">there</span> <span class="k">are</span> <span class="n">independent</span> <span class="n">spatial</span>
    <span class="k">parameters</span><span class="p">.</span>  <span class="k">If</span> <span class="k">False</span> <span class="p">(</span><span class="n">the</span> <span class="k">default</span><span class="p">)</span> <span class="k">write</span> <span class="nb">Array</span> <span class="n">Layout</span> <span class="k">if</span> <span class="n">there</span> <span class="k">are</span> <span class="n">independent</span> <span class="n">spatial</span>
    <span class="k">parameters</span> <span class="k">and</span> <span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;hdf5&#39;</span>

<span class="n">arraySplittingParms</span> <span class="o">-</span> <span class="n">a</span> <span class="n">list</span> <span class="k">of</span> <span class="k">parameters</span> <span class="k">as</span> <span class="n">mnemonics</span> <span class="n">used</span> <span class="k">to</span> <span class="n">split</span>
    <span class="n">arrays</span> <span class="k">into</span> <span class="n">subarrays</span><span class="p">.</span>  <span class="k">For</span> <span class="n">example</span><span class="p">,</span> <span class="n">beamcode</span> <span class="n">would</span> <span class="n">split</span> <span class="k">data</span> <span class="k">with</span> <span class="n">separate</span> <span class="n">beamcodes</span>
    <span class="k">into</span> <span class="n">separate</span> <span class="n">arrays</span><span class="p">.</span> <span class="n">The</span> <span class="nb">number</span> <span class="k">of</span> <span class="n">separate</span> <span class="n">arrays</span> <span class="n">will</span> <span class="n">be</span> <span class="n">up</span> <span class="k">to</span> <span class="n">the</span> <span class="n">product</span> <span class="k">of</span> <span class="n">the</span> <span class="nb">number</span> <span class="k">of</span> 
    <span class="k">unique</span> <span class="k">values</span> <span class="k">found</span> <span class="k">for</span> <span class="k">each</span> <span class="k">parameter</span><span class="p">,</span> <span class="k">with</span> <span class="n">the</span> <span class="n">restriction</span> <span class="n">that</span> <span class="n">combinations</span> <span class="k">with</span> <span class="k">no</span> <span class="n">records</span> <span class="n">will</span>
    <span class="k">not</span> <span class="k">create</span> <span class="n">a</span> <span class="n">separate</span> <span class="nb">array</span><span class="p">.</span> <span class="k">If</span> <span class="k">default</span> <span class="k">None</span> <span class="n">passed</span> <span class="k">in</span><span class="p">,</span> <span class="k">then</span> <span class="k">set</span> <span class="k">to</span> <span class="k">self</span><span class="p">.</span><span class="n">_arraySplitParms</span><span class="p">,</span> 
    <span class="k">set</span> <span class="k">when</span> <span class="n">CEDAR</span> <span class="n">file</span> <span class="k">read</span> <span class="k">in</span><span class="p">.</span>

<span class="n">overwrite</span> <span class="o">-</span> <span class="k">if</span> <span class="k">False</span> <span class="p">(</span><span class="n">the</span> <span class="k">default</span><span class="p">)</span> <span class="k">do</span> <span class="k">not</span> <span class="n">overwrite</span> <span class="k">existing</span> <span class="n">file</span><span class="p">.</span>  <span class="k">If</span> <span class="k">True</span><span class="p">,</span> <span class="n">overwrite</span> <span class="n">file</span> <span class="k">is</span> <span class="n">it</span> <span class="n">already</span> <span class="k">exists</span><span class="p">.</span>
</pre></div>


<p>Outputs: None</p>
<p>Affects: writes a MadrigalCedarFile to file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.write', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.write" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
          <span class="n">arraySplittingParms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skipArrayLayout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;write persists a MadrigalCedarFile to file.</span>
<span class="sd">    </span>
<span class="sd">    Note:  There are two ways to write to a MadrigalCedarFile.  Either this method (write) is called after all the</span>
<span class="sd">    records have been appended to the MadrigalCedarFile, or dump is called after a certain number of records are appended,</span>
<span class="sd">    and then at the end dump is called a final time if there were any records not yet dumped, followed by close.</span>
<span class="sd">    The __del__ method will automatically call close if needed, and print a warning that the user should add it to</span>
<span class="sd">    their code.</span>
<span class="sd">    </span>
<span class="sd">    write has the advantage of being simplier, but has the disadvantage for larger files of keeping all those records</span>
<span class="sd">    in memory.  dump/close has the advantage of significantly reducing the memory footprint, but is somewhat more complex.</span>
<span class="sd">    Inputs:</span>
<span class="sd">        format - a format to save the file in.  For now, the allowed values are </span>
<span class="sd">        &#39;hdf5&#39; and &#39;netCDF4&#39;.  Defaults to &#39;hdf5&#39;. Use writeText method to get text output.</span>
<span class="sd">        newFilename - a filename to save to.  Defaults to self._fullFilename passed into initializer if not given.</span>
<span class="sd">        refreshCatHeadTimes - if True (the default), update start and and times in the catalog and header</span>
<span class="sd">            records to represent the times in the data.  If False, use existing times in those records.</span>
<span class="sd">            </span>
<span class="sd">        skipArrayLayout - if True, do not include Array Layout even if there are independent spatial</span>
<span class="sd">            parameters.  If False (the default) write Array Layout if there are independent spatial</span>
<span class="sd">            parameters and format = &#39;hdf5&#39;</span>
<span class="sd">            </span>
<span class="sd">        arraySplittingParms - a list of parameters as mnemonics used to split</span>
<span class="sd">            arrays into subarrays.  For example, beamcode would split data with separate beamcodes</span>
<span class="sd">            into separate arrays. The number of separate arrays will be up to the product of the number of </span>
<span class="sd">            unique values found for each parameter, with the restriction that combinations with no records will</span>
<span class="sd">            not create a separate array. If default None passed in, then set to self._arraySplitParms, </span>
<span class="sd">            set when CEDAR file read in.</span>
<span class="sd">            </span>
<span class="sd">        overwrite - if False (the default) do not overwrite existing file.  If True, overwrite file is it already exists.</span>
<span class="sd">            </span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: writes a MadrigalCedarFile to file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot call write method after calling dump method&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">newFilename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fullFilename</span>
        
    <span class="k">if</span> <span class="nb">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal format &lt;</span><span class="si">%s</span><span class="s1">&gt; - must be hdf5 or netCDF4&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;newFilename &lt;</span><span class="si">%s</span><span class="s1">&gt; already exists&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newFilename</span><span class="p">))</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">=</span> <span class="nb">format</span>
    
    <span class="k">if</span> <span class="n">arraySplittingParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arraySplittingParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arraySplitParms</span>
    <span class="k">if</span> <span class="n">arraySplittingParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arraySplittingParms</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">==</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">newFilename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;filename must end with </span><span class="si">%s</span><span class="s1">, &lt;</span><span class="si">%s</span><span class="s1">&gt; does not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5Extensions</span><span class="p">),</span> <span class="n">newFilename</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># we need to make sure this file is closed and then deleted if an error</span>
            <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used if next line fails</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Metadata</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writeHdf5Data</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getIndSpatialParms</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_createArrayLayout</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">arraySplittingParms</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># on any error, close and delete file, then reraise error</span>
            <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newFilename</span><span class="p">)</span>
            <span class="k">raise</span>
        
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span> <span class="o">==</span> <span class="s1">&#39;netCDF4&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># we need to make sure this file is closed and then deleted if an error</span>
            <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># used if next line fails</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_writeNetCDF4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">arraySplittingParms</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># on any error, close and delete file, then reraise error</span>
            <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newFilename</span><span class="p">)</span>
            <span class="k">raise</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">_closed</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># write ends with closed file</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.writeExperimentNotes">
    <p>def <span class="ident">writeExperimentNotes</span>(</p><p>self, metadataGroup, refreshCatHeadTimes)</p>
    </div>
    

    
  
    <div class="desc"><p>writeExperimentNotes writes the "Experiment Notes" dataset to the h5py group metadataGroup
if any catalog or header records found.</p>
<div class="codehilite"><pre><span></span><span class="err">refreshCatHeadTimes - if True, update start and and times in the catalog and header</span>
<span class="err">    records to represent the times in the data.  If False, use existing times in those records.</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.writeExperimentNotes', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.writeExperimentNotes" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">writeExperimentNotes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadataGroup</span><span class="p">,</span> <span class="n">refreshCatHeadTimes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;writeExperimentNotes writes the &quot;Experiment Notes&quot; dataset to the h5py group metadataGroup</span>
<span class="sd">    if any catalog or header records found.</span>
<span class="sd">    </span>
<span class="sd">        refreshCatHeadTimes - if True, update start and and times in the catalog and header</span>
<span class="sd">            records to represent the times in the data.  If False, use existing times in those records.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># templates</span>
    <span class="n">cat_template</span> <span class="o">=</span> <span class="s1">&#39;Catalog information from record </span><span class="si">%i</span><span class="s1">:&#39;</span>
    <span class="n">head_template</span> <span class="o">=</span> <span class="s1">&#39;Header information from record </span><span class="si">%i</span><span class="s1">:&#39;</span>
    
    <span class="k">if</span> <span class="s2">&quot;Experiment Notes&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">metadataGroup</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="c1"># already exists</span>
        <span class="k">return</span>
    
    <span class="n">recDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># key = rec number, value = tuple of recarray of lines, &#39;Catalog&#39; or &#39;Header&#39; str)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;catalog&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">refreshCatHeadTimes</span><span class="p">:</span>
                <span class="n">sDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span>
                <span class="n">eDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">sDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                 <span class="n">sDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">),</span>
                                 <span class="n">eDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                 <span class="n">eDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">eDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">))</span>
            <span class="n">recarray</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getLines</span><span class="p">()</span>
            <span class="n">recDict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">recarray</span><span class="p">,</span> <span class="s1">&#39;Catalog&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;header&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">refreshCatHeadTimes</span><span class="p">:</span>
                <span class="n">sDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEarliestDT</span><span class="p">()</span>
                <span class="n">eDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLatestDT</span><span class="p">()</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">sDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                 <span class="n">sDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">sDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">),</span>
                                 <span class="n">eDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
                                 <span class="n">eDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">eDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">eDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mi">10000</span><span class="p">))</span>
            <span class="n">recarray</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getLines</span><span class="p">()</span>
            <span class="n">recDict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">recarray</span><span class="p">,</span> <span class="s1">&#39;Header&#39;</span><span class="p">)</span>
            
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">recDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">recarray</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">new_recarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="mi">2</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;File Notes&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">))])</span>
        <span class="k">if</span> <span class="n">recDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Catalog&#39;</span><span class="p">:</span>
            <span class="n">topStr</span> <span class="o">=</span> <span class="n">cat_template</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">topStr</span> <span class="o">=</span> <span class="n">head_template</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">new_recarray</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">topStr</span><span class="p">))</span>
        <span class="n">new_recarray</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">80</span>
        <span class="k">if</span> <span class="n">recarray</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">recarray</span> <span class="o">=</span> <span class="n">new_recarray</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">recarray</span><span class="p">,</span> <span class="n">new_recarray</span><span class="p">))</span>
        <span class="n">recarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">recarray</span><span class="p">,</span> <span class="n">recDict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
        
    <span class="n">metadataGroup</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">recarray</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalCedarFile.writeText">
    <p>def <span class="ident">writeText</span>(</p><p>self, newFilename=None, summary=&#39;plain&#39;, showHeaders=False, selectParms=None, filterList=None, missing=None, assumed=None, knownbad=None, append=False, firstWrite=False)</p>
    </div>
    

    
  
    <div class="desc"><p>writeText writes text to new filename</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">newFilename</span> <span class="o">-</span> <span class="n">name</span> <span class="k">of</span> <span class="k">new</span> <span class="n">file</span> <span class="k">to</span> <span class="k">create</span> <span class="k">and</span> <span class="k">write</span> <span class="k">to</span><span class="p">.</span>  <span class="k">If</span> <span class="k">None</span><span class="p">,</span> <span class="n">the</span> <span class="k">default</span><span class="p">,</span> <span class="k">write</span> <span class="k">to</span> <span class="k">stdout</span>

<span class="n">summary</span> <span class="o">-</span> <span class="k">type</span> <span class="k">of</span> <span class="n">summary</span> <span class="n">line</span> <span class="k">to</span> <span class="n">print</span> <span class="k">at</span> <span class="n">top</span><span class="p">.</span>  <span class="n">Allowed</span> <span class="k">values</span> <span class="k">are</span><span class="p">:</span>
    <span class="s1">&#39;plain&#39;</span> <span class="o">-</span> <span class="nb">text</span> <span class="k">only</span> <span class="n">mnemonic</span> <span class="k">names</span><span class="p">,</span> <span class="n">but</span> <span class="k">only</span> <span class="k">if</span> <span class="k">not</span> <span class="n">showHeaders</span>
    <span class="s1">&#39;html&#39;</span> <span class="o">-</span> <span class="n">mnemonic</span> <span class="k">names</span> <span class="n">wrapped</span> <span class="k">in</span> <span class="n">standard</span> <span class="n">javascript</span> <span class="n">code</span> <span class="k">to</span> <span class="n">allow</span> <span class="n">descriptive</span> <span class="n">popups</span>
    <span class="s1">&#39;summary&#39;</span> <span class="o">-</span> <span class="n">print</span> <span class="n">overview</span> <span class="k">of</span> <span class="n">file</span> <span class="k">and</span> <span class="n">filters</span> <span class="n">used</span><span class="p">.</span> <span class="n">Also</span> <span class="nb">text</span> <span class="k">only</span> <span class="n">mnemonic</span> <span class="k">names</span><span class="p">,</span> 
        <span class="n">but</span> <span class="k">only</span> <span class="k">if</span> <span class="k">not</span> <span class="n">showHeaders</span>
    <span class="k">None</span> <span class="o">-</span> <span class="k">no</span> <span class="n">summary</span> <span class="n">line</span>

<span class="n">showHeaders</span> <span class="o">-</span> <span class="k">if</span> <span class="k">True</span><span class="p">,</span> <span class="n">print</span> <span class="n">header</span> <span class="k">in</span> <span class="n">format</span> <span class="k">for</span> <span class="k">each</span> <span class="n">record</span><span class="p">.</span>  <span class="k">If</span> <span class="k">False</span><span class="p">,</span> <span class="n">the</span> <span class="k">default</span><span class="p">,</span>
    <span class="k">do</span> <span class="k">not</span><span class="p">.</span>

<span class="n">selectParms</span> <span class="o">-</span> <span class="k">If</span> <span class="k">None</span><span class="p">,</span> <span class="n">simply</span> <span class="n">print</span> <span class="k">all</span> <span class="n">parms</span> <span class="n">that</span> <span class="k">are</span> <span class="k">in</span> <span class="n">the</span> <span class="n">file</span><span class="p">.</span>  <span class="k">If</span> <span class="n">a</span> <span class="n">list</span>
    <span class="k">of</span> <span class="n">parm</span> <span class="n">mnemonics</span><span class="p">,</span> <span class="n">print</span> <span class="k">only</span> <span class="n">those</span> <span class="n">parms</span> <span class="k">in</span> <span class="n">the</span> <span class="k">order</span> <span class="n">specified</span><span class="p">.</span>

<span class="n">filterList</span> <span class="o">-</span> <span class="n">a</span> <span class="n">list</span> <span class="k">of</span> <span class="n">madrigal</span><span class="p">.</span><span class="n">derivation</span><span class="p">.</span><span class="n">MadrigalFilter</span> <span class="n">objects</span> <span class="k">to</span> <span class="n">be</span> <span class="n">described</span> <span class="k">in</span> <span class="n">the</span> 
    <span class="n">summary</span><span class="p">.</span>  <span class="k">Default</span> <span class="k">is</span> <span class="k">None</span><span class="p">,</span> <span class="k">in</span> <span class="n">which</span> <span class="k">case</span> <span class="k">not</span> <span class="n">described</span> <span class="k">in</span> <span class="n">summary</span><span class="p">.</span>  <span class="n">Ignored</span> <span class="k">if</span> <span class="n">summary</span>
    <span class="k">is</span> <span class="k">not</span> <span class="s1">&#39;summary&#39;</span>

<span class="n">missing</span><span class="p">,</span> <span class="n">assumed</span><span class="p">,</span> <span class="n">knownbad</span> <span class="o">-</span> <span class="n">how</span> <span class="k">to</span> <span class="n">print</span> <span class="n">Cedar</span> <span class="n">special</span> <span class="k">values</span><span class="p">.</span>  <span class="k">Default</span> <span class="k">is</span> <span class="k">None</span> <span class="k">for</span>
    <span class="k">all</span><span class="p">,</span> <span class="n">so</span> <span class="n">that</span> <span class="n">value</span> <span class="n">printed</span> <span class="k">in</span> <span class="n">value</span> <span class="k">in</span> <span class="n">numpy</span> <span class="k">table</span> <span class="k">as</span> <span class="n">per</span> <span class="n">spec</span><span class="p">.</span>

<span class="n">append</span> <span class="o">-</span> <span class="k">if</span> <span class="k">True</span><span class="p">,</span> <span class="k">open</span> <span class="n">newFilename</span> <span class="k">in</span> <span class="n">append</span> <span class="k">mode</span><span class="p">,</span> <span class="k">and</span> <span class="n">dump</span> <span class="n">records</span> <span class="k">after</span> <span class="n">writing</span><span class="p">.</span>  <span class="k">If</span> <span class="k">False</span><span class="p">,</span> 
    <span class="k">open</span> <span class="k">in</span> <span class="k">write</span> <span class="k">mode</span><span class="p">.</span> <span class="n">Used</span> <span class="k">to</span> <span class="n">allow</span> <span class="n">writing</span> <span class="k">in</span> <span class="n">conjuction</span> <span class="k">with</span> <span class="n">loadNextRecords</span><span class="p">.</span>

<span class="n">firstWrite</span> <span class="o">-</span> <span class="k">True</span> <span class="k">if</span> <span class="n">this</span> <span class="k">is</span> <span class="n">the</span> <span class="k">first</span> <span class="k">group</span> <span class="k">of</span> <span class="n">records</span> <span class="n">added</span><span class="p">,</span> <span class="k">and</span> <span class="n">append</span> <span class="k">mode</span> <span class="k">is</span> <span class="k">True</span><span class="p">.</span>
    <span class="n">Used</span> <span class="k">to</span> <span class="n">know</span> <span class="n">whether</span> <span class="k">to</span> <span class="k">write</span> <span class="n">summary</span> <span class="n">lines</span><span class="p">.</span>  <span class="k">If</span> <span class="k">False</span> <span class="k">and</span> <span class="n">append</span> <span class="k">is</span> <span class="k">True</span><span class="p">,</span> <span class="k">no</span> <span class="n">summary</span>
    <span class="n">lines</span> <span class="k">are</span> <span class="n">added</span><span class="p">;</span> <span class="k">if</span> <span class="k">True</span> <span class="k">and</span> <span class="n">append</span> <span class="k">is</span> <span class="k">True</span><span class="p">,</span> <span class="n">summary</span> <span class="n">lines</span> <span class="k">are</span> <span class="n">added</span><span class="p">.</span>  <span class="k">If</span> <span class="n">append</span> <span class="k">is</span> <span class="k">not</span> 
    <span class="k">True</span><span class="p">,</span> <span class="n">this</span> <span class="n">argument</span> <span class="n">ignored</span><span class="p">.</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalCedarFile.writeText', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalCedarFile.writeText" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">writeText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newFilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="n">showHeaders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">selectParms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">filterList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">assumed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">knownbad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">firstWrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;writeText writes text to new filename</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">        newFilename - name of new file to create and write to.  If None, the default, write to stdout</span>
<span class="sd">        </span>
<span class="sd">        summary - type of summary line to print at top.  Allowed values are:</span>
<span class="sd">            &#39;plain&#39; - text only mnemonic names, but only if not showHeaders</span>
<span class="sd">            &#39;html&#39; - mnemonic names wrapped in standard javascript code to allow descriptive popups</span>
<span class="sd">            &#39;summary&#39; - print overview of file and filters used. Also text only mnemonic names, </span>
<span class="sd">                but only if not showHeaders</span>
<span class="sd">            None - no summary line</span>
<span class="sd">            </span>
<span class="sd">        showHeaders - if True, print header in format for each record.  If False, the default,</span>
<span class="sd">            do not.</span>
<span class="sd">            </span>
<span class="sd">        selectParms - If None, simply print all parms that are in the file.  If a list</span>
<span class="sd">            of parm mnemonics, print only those parms in the order specified.</span>
<span class="sd">            </span>
<span class="sd">        filterList - a list of madrigal.derivation.MadrigalFilter objects to be described in the </span>
<span class="sd">            summary.  Default is None, in which case not described in summary.  Ignored if summary</span>
<span class="sd">            is not &#39;summary&#39;</span>
<span class="sd">            </span>
<span class="sd">        missing, assumed, knownbad - how to print Cedar special values.  Default is None for</span>
<span class="sd">            all, so that value printed in value in numpy table as per spec.</span>
<span class="sd">            </span>
<span class="sd">        append - if True, open newFilename in append mode, and dump records after writing.  If False, </span>
<span class="sd">            open in write mode. Used to allow writing in conjuction with loadNextRecords.</span>
<span class="sd">            </span>
<span class="sd">        firstWrite - True if this is the first group of records added, and append mode is True.</span>
<span class="sd">            Used to know whether to write summary lines.  If False and append is True, no summary</span>
<span class="sd">            lines are added; if True and append is True, summary lines are added.  If append is not </span>
<span class="sd">            True, this argument ignored.</span>
<span class="sd">            </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># constants </span>
    <span class="n">_underscore</span> <span class="o">=</span> <span class="mi">95</span> <span class="c1"># used to indicate missing character</span>
    
    <span class="k">if</span> <span class="n">newFilename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">newFilename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        
    <span class="k">if</span> <span class="n">summary</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal summary value &lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">summary</span><span class="p">)))</span>
    
    <span class="c1"># cache information needed to replace special values if needed</span>
    <span class="c1"># helps performance when replacing</span>
    <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
        <span class="n">missing_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span>
        <span class="n">missing_search</span> <span class="o">=</span> <span class="s1">&#39;\ &#39;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">missing_len</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;nan&#39;</span>
        <span class="k">if</span> <span class="n">missing_len</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">missing_len</span><span class="p">)</span> <span class="o">+</span> <span class="n">missing</span>
    <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">assumed</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">assumed</span><span class="p">)</span>
        <span class="n">assumed_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">assumed</span><span class="p">)</span>
        <span class="n">assumed_search</span> <span class="o">=</span> <span class="s1">&#39;\ &#39;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">assumed_len</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;inf&#39;</span>
        <span class="k">if</span> <span class="n">assumed_len</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">assumed</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">assumed_len</span><span class="p">)</span> <span class="o">+</span> <span class="n">assumed</span>
    <span class="k">if</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">knownbad</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">knownbad</span><span class="p">)</span>
        <span class="n">knownbad_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">knownbad</span><span class="p">)</span>
        <span class="n">knownbad_search</span> <span class="o">=</span> <span class="s1">&#39;\ &#39;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">knownbad_len</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-inf&#39;</span>
        <span class="k">if</span> <span class="n">knownbad_len</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">knownbad</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="n">knownbad_len</span><span class="p">)</span> <span class="o">+</span> <span class="n">knownbad</span>
        
    <span class="c1"># create format string and header strings</span>
    <span class="n">formatStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">parmStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">selectParms</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tableDType</span><span class="o">.</span><span class="n">names</span>
    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmFormat</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># first handle float formats</span>
            <span class="n">dataWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">format</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)])</span>
            <span class="c1"># make sure width is big enough for special values</span>
            <span class="n">newDataWidth</span> <span class="o">=</span> <span class="n">dataWidth</span>
            <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">newDataWidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">newDataWidth</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">newDataWidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">newDataWidth</span><span class="p">,</span> <span class="n">dataWidth</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">assumed</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">newDataWidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">newDataWidth</span><span class="p">,</span> <span class="n">dataWidth</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">knownbad</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newDataWidth</span> <span class="o">&gt;</span> <span class="n">dataWidth</span><span class="p">:</span>
                <span class="c1"># we need to expand format</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%%%i%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newDataWidth</span><span class="p">,</span> <span class="nb">format</span><span class="p">[</span><span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):])</span>
                <span class="n">dataWidth</span> <span class="o">=</span> <span class="n">newDataWidth</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># now handle integer or string formats - assumed to never be error values</span>
            <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># we need to insert a length</span>
                    <span class="nb">format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%%%i</span><span class="s1">i&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmWidth</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dataWidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmWidth</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dataWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">format</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="nb">format</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">dataWidth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">format</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmWidth</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span> <span class="n">dataWidth</span><span class="p">)</span>
        <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">format</span><span class="p">)</span>
        <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">-</span><span class="n">dataWidth</span><span class="p">))</span> <span class="c1"># sets spacing between numbers</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># need to truncate name</span>
            <span class="k">if</span> <span class="n">summary</span> <span class="o">!=</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                <span class="n">parmStr</span> <span class="o">+=</span> <span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parmStr</span> <span class="o">+=</span> <span class="s2">&quot;&lt;a href=JavaScript:popup(&#39;</span><span class="si">%s</span><span class="s2">&#39;) title=&#39;</span><span class="si">%s</span><span class="s2">, units=</span><span class="si">%s</span><span class="s2">&#39;&gt;</span><span class="si">%s</span><span class="s2">&lt;/a&gt;&amp;nbsp;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                                                                                 <span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># pad evenly on both sides</span>
            <span class="n">firstHalfSpace</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">width</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">secHalfSpace</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">width</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span> <span class="o">-</span> <span class="n">firstHalfSpace</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">summary</span> <span class="o">!=</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                <span class="n">parmStr</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">firstHalfSpace</span> <span class="o">+</span> <span class="n">parm</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">secHalfSpace</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parmStr</span> <span class="o">+=</span> <span class="s1">&#39;&amp;nbsp;&#39;</span> <span class="o">*</span> <span class="n">firstHalfSpace</span> 
                <span class="n">parmStr</span> <span class="o">+=</span> <span class="s2">&quot;&lt;a href=JavaScript:popup(&#39;</span><span class="si">%s</span><span class="s2">&#39;) title=&#39;</span><span class="si">%s</span><span class="s2">, units=</span><span class="si">%s</span><span class="s2">&#39;&gt;</span><span class="si">%s</span><span class="s2">&lt;/a&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                                                                                           <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                                                                           <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                                                                           <span class="n">parm</span><span class="p">[:</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                <span class="n">parmStr</span> <span class="o">+=</span> <span class="s1">&#39;&amp;nbsp;&#39;</span> <span class="o">*</span> <span class="n">secHalfSpace</span>
                
    <span class="n">formatStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">firstHeaderPrinted</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># state variable for adding extra space between lines</span>
    
    <span class="k">if</span> <span class="n">summary</span> <span class="o">==</span> <span class="s1">&#39;summary&#39;</span><span class="p">:</span> 
        <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span> <span class="ow">or</span> <span class="p">(</span><span class="n">append</span> <span class="ow">and</span> <span class="n">firstWrite</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_printSummary</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">filterList</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">summary</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">showHeaders</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">append</span> <span class="ow">or</span> <span class="p">(</span><span class="n">append</span> <span class="ow">and</span> <span class="n">firstWrite</span><span class="p">):</span>
            <span class="c1"># print single header at top</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parmStr</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">summary</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;br&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># nothing more to write</span>
        <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span>
    
    <span class="c1"># see if only 1D parms are selected, which implies printing only a single line per record</span>
    <span class="n">is1D</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#make sure its a lowercase list</span>
        <span class="n">selectParms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">selectParms</span><span class="p">)</span>
        <span class="n">selectParms</span> <span class="o">=</span> <span class="n">getLowerCaseList</span><span class="p">(</span><span class="n">selectParms</span><span class="p">)</span>
        <span class="c1"># see if only 1D parameters are being printed, so that we should only print the first row</span>
        <span class="n">is1D</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">recordset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRecordset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">selectParms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">recordset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">is1D</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
            
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        
        <span class="k">if</span> <span class="n">showHeaders</span><span class="p">:</span>
            <span class="n">kinst</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
            <span class="n">instDesc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentName</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
            <span class="n">sDTStr</span> <span class="o">=</span> <span class="n">sDT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H%M:%S&#39;</span><span class="p">)</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
            <span class="n">eDTStr</span> <span class="o">=</span> <span class="n">eDT</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M:%S&#39;</span><span class="p">)</span>
            <span class="n">headerStr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">instDesc</span><span class="p">,</span> <span class="n">sDTStr</span><span class="p">,</span> <span class="n">eDTStr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">firstHeaderPrinted</span> <span class="ow">or</span> <span class="n">summary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">headerStr</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">headerStr</span><span class="p">))</span>
                <span class="n">firstHeaderPrinted</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parmStr</span><span class="p">))</span>
            
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">getDataset</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">recnoSet</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># used to see if we are at a new record</span>
            <span class="n">dataset_view</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">selectParms</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset_view</span> <span class="o">=</span> <span class="n">dataset</span>
            
        <span class="c1"># modify special values if required</span>
        <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dataset_view</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># set all -1 values to inf</span>
                        <span class="n">assumedIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dataset_view</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assumedIndices</span><span class="p">):</span>
                            <span class="n">dataset_view</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">assumedIndices</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">Inf</span>
                    <span class="k">if</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># set all -2 values to ninf</span>
                        <span class="n">knownbadIndices</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dataset_view</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">knownbadIndices</span><span class="p">):</span>
                            <span class="n">dataset_view</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">knownbadIndices</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">NINF</span>
                        
        <span class="n">lastRecno</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_view</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">thisRecno</span> <span class="o">=</span> <span class="n">recnoSet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">is1D</span> <span class="ow">and</span> <span class="p">(</span><span class="n">thisRecno</span> <span class="o">==</span> <span class="n">lastRecno</span><span class="p">):</span>
                    <span class="k">continue</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dataset_view</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">formatStr</span> <span class="o">%</span> <span class="n">data</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># something bad happened - give up and just convert data to a string</span>
                <span class="n">textList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
                <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textList</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="c1"># modify special values if required</span>
            <span class="k">if</span> <span class="n">missing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">missing_search</span><span class="p">,</span> <span class="n">missing</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">knownbad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">knownbad_search</span><span class="p">,</span> <span class="n">knownbad</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">assumed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">assumed_search</span><span class="p">,</span> <span class="n">assumed</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">summary</span> <span class="o">!=</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;nbsp;&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">summary</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;br&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">selectParms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lastRecno</span> <span class="o">=</span> <span class="n">thisRecno</span>
                
    <span class="k">if</span> <span class="n">f</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
    <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
        <span class="c1"># remove all records</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_privList</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="madrigal.cedar.MadrigalDataRecord" class="name">class <span class="ident">MadrigalDataRecord</span></p>
      
  
    <div class="desc"><p>MadrigalDataRecord holds all the information in a Cedar data record.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MadrigalDataRecord</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;MadrigalDataRecord holds all the information in a Cedar data record.&quot;&quot;&quot;</span>

    <span class="c1"># cedar special values</span>
    <span class="n">missing</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">assumed</span>  <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
    <span class="n">knownbad</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span>
    <span class="n">missing_int</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>
    <span class="n">assumed_int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">knownbad_int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
    
    <span class="c1"># standard parms</span>
    <span class="n">_stdParms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;sec&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;recno&#39;</span><span class="p">,</span> <span class="s1">&#39;kindat&#39;</span><span class="p">,</span> <span class="s1">&#39;kinst&#39;</span><span class="p">,</span> <span class="s1">&#39;ut1_unix&#39;</span><span class="p">,</span> <span class="s1">&#39;ut2_unix&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kinst</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">kindat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sYear</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sMonth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sDay</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sHour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sMin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sSec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sCentisec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">eYear</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eMonth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eDay</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eHour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eMin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eSec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eCentisec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">oneDList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">twoDList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">nrow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">madInstObj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">madParmObj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">ind2DList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">recordSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">parmObjList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">madDB</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__init__ creates a MadrigalDataRecord with all missing data.</span>
<span class="sd">        </span>
<span class="sd">        Note: all inputs have default values because there are two ways to populate this structure:</span>
<span class="sd">        1) with all inputs from kinst to nrow when new data is being created, or </span>
<span class="sd">        2) with numpy arrays dataset and recordSet from existing Hdf5 file.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            kinst - the kind of instrument code.  A warning will be raised if not in instTab.txt.</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            kindat - kind of data code. Must be a non-negative integer.</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - record start time. sCentisec must be 0-99</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - record end time. eCentisec must be 0-99</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            oneDList - list of one-dimensional parameters in record. Parameters can be defined as codes</span>
<span class="sd">                       (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                       Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            twoDList - list of two-dimensional parameters in record. Parameters can be defined as codes</span>
<span class="sd">                       (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                       Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            nrow - number of rows of 2D data to create. Until set, all values default to missing.</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            madInstObj - a madrigal.metadata.MadrigalInstrument object.  If None, one will be created.</span>
<span class="sd">                              Used to verify kinst.</span>

<span class="sd">            madParmObj - a madrigal.data.MadrigalParameter object.  If None, one will be created.</span>
<span class="sd">                              Used to verify convert parameters to codes.</span>
<span class="sd">                              </span>
<span class="sd">            ind2DList -  list of indepedent spatial two-dimensional parameters in record. </span>
<span class="sd">                       Parameters can be defined as codes. Each must also be listed in twoDList.</span>
<span class="sd">                       (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                       Default is None, in which case dataset, and recordSet must be given.</span>
<span class="sd">                </span>
<span class="sd">            dataset - an h5py dataset, as found in the Hdf5 group &quot;Data&quot;, dataset &quot;Table Layout&quot;.</span>
<span class="sd">                Set to None if this is a new record.</span>
<span class="sd">                </span>
<span class="sd">            recordSet - an h5py dataset, as found in the Hdf5 group &quot;Metadata&quot;, dataset &quot;_record_layout&quot;.</span>
<span class="sd">                Set to None if this is a new record.</span>
<span class="sd">                </span>
<span class="sd">            verbose - if True (the default), print all warnings.  If False, surpress warnings</span>
<span class="sd">            </span>
<span class="sd">            parmObjList - a list or tuple of three lists: self._oneDList, self._twoDList, and</span>
<span class="sd">                self._ind2DList described below.  Used only to speed performance.  Default is</span>
<span class="sd">                None, in which case new copies are created.</span>
<span class="sd">                </span>
<span class="sd">            madDB - madrigal.metadata.MadrigalDB object. If None, one will be created.</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Returns: None</span>
<span class="sd">        </span>
<span class="sd">        Affects:</span>
<span class="sd">            Creates attributes:</span>
<span class="sd">                self._madInstObj - madrigal.metadata.MadrigalInstrument object</span>
<span class="sd">                self._madParmObj - madrigal.data.MadrigalParameters object</span>
<span class="sd">                self._dataset - h5py dataset in from of Table Layout numpy recarray</span>
<span class="sd">                self._recordSet - h5py dataset in form of _record_layout numpy recarray</span>
<span class="sd">                self._verbose - bool indicating verbose or not</span>
<span class="sd">                self._oneDList - a list of 1D CedarParameter objects in this MadrigalDataRecord</span>
<span class="sd">                self._twoDList - a list of 2D CedarParameter objects in this MadrigalDataRecord</span>
<span class="sd">                self._ind2DList - a list of independent spatial parameters in self._twoDList</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">madDB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalDB</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span> <span class="o">=</span> <span class="n">madDB</span>
        <span class="c1"># create any needed Madrigal objects, if not passed in</span>
        <span class="k">if</span> <span class="n">madInstObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalInstrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madInstObj</span>

        <span class="k">if</span> <span class="n">madParmObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span> <span class="o">=</span> <span class="n">madParmObj</span>


        <span class="k">if</span> <span class="n">twoDList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">twoDList</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="k">if</span> <span class="n">ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ind2DList</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="k">if</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">recordSet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># get it from cachedFiles.ini</span>
                <span class="n">extraParms</span><span class="p">,</span> <span class="n">ind2DList</span><span class="p">,</span> <span class="n">splitParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span><span class="o">.</span><span class="n">getKinstKindatConfig</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span> <span class="n">kindat</span><span class="p">)</span>
            <span class="c1"># verify there are independent spatial parms if there are 2D parms</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind2DList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot have 2D parms without an independent spatial parm set&#39;</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_createArraysFromArgs</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span><span class="n">kindat</span><span class="p">,</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                                       <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">,</span>
                                       <span class="n">oneDList</span><span class="p">,</span><span class="n">twoDList</span><span class="p">,</span><span class="n">nrow</span><span class="p">,</span><span class="n">ind2DList</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># verify there are independent spatial parms if there are 2D parms</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind2DList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot have 2D parms without an independent spatial parm set&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">dataset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">recordSet</span>
            
        <span class="k">if</span> <span class="n">parmObjList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parmObjList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parmObjList</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parmObjList</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># populate self._oneDList, self._twoDList, and self._ind2DList</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stdParms</span><span class="p">):]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">isInt</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">isInt</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">newCedarParm</span> <span class="o">=</span> <span class="n">CedarParameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCodeFromMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                              <span class="n">parm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                              <span class="n">isInt</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
        
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
        
    
    
    <span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the type &#39;data&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;data&#39;</span>
    
    
    <span class="k">def</span> <span class="nf">getDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getDType returns the dtype of the table array with this data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getRecDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRecDType returns the dtype of _record_array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getDataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getDataset returns the dataset table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">getRecordset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRecordset returns the recordSet table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">parmIsInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parmIsInt returns True if this parm (mnemonic) is integer type, False if float or string</span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError if parm not in record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">typeStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">typeStr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">parmIsString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;parmIsString returns True if this parm (mnemonic) is String type, False if float or int</span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError is parm not in record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">typeStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">typeStr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">getStrLen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStrLen returns True if this parm (mnemonic) is integer type, False if float or string</span>
<span class="sd">        </span>
<span class="sd">        Raises ValueError is parm not in record, or is not String</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not string type&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">itemsize</span><span class="p">)</span>
    


    <span class="k">def</span> <span class="nf">add1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oneDParm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;add1D adds a new one-dim parameter to a MadrigalDataRecord</span>

<span class="sd">        Input: oneDParm - Parameter can be defined as codes (integer) or case-insensitive</span>
<span class="sd">               mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">        Affects: 1) adds new column to self._dataset with all values Nan, and 2) adds </span>
<span class="sd">        value to end of self._recordSet with value = 1 since 1D parm</span>
<span class="sd">        </span>
<span class="sd">        If these addition makes self._dataset.dtype differ from that in MadrigalCedarFile, appending this</span>
<span class="sd">        MadrigalDataRecord to MadrigalCedarFile will raise an IOError. Also raises error if parm already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addParm</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">add2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">twoDParm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;add2D adds a new two-dim parameter to a MadrigalDataRecord</span>

<span class="sd">        Input: twoDParm - Parameter can be defined as codes (integer) or case-insensitive</span>
<span class="sd">               mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">        Affects: 1) adds new column to self._dataset with all values Nan, and 2) adds </span>
<span class="sd">        value to end of self._recordSet with value = 2 since 2D parm</span>
<span class="sd">        </span>
<span class="sd">        If these addition makes self._dataset.dtype differ from that in MadrigalCedarFile, appending this</span>
<span class="sd">        MadrigalDataRecord to MadrigalCedarFile will raise an IOError. Also raises error if parm already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addParm</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        
        

    <span class="k">def</span> <span class="nf">addParm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newParm</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;addParm adds a new one or two-dim parameter to a MadrigalDataRecord</span>

<span class="sd">        Input: newParm - Parameter can be defined as codes (integer) or case-insensitive</span>
<span class="sd">               mnemonic string (eg, &quot;Gdalt&quot;)</span>
<span class="sd">               </span>
<span class="sd">               dim - either 1 for scalar, or 2 for vector parm</span>

<span class="sd">        Affects: 1) adds new column to self._dataset with all values Nan, and 2) adds </span>
<span class="sd">        value to end of self._recordSet with value = dim</span>
<span class="sd">        </span>
<span class="sd">        If these addition makes self._dataset.dtype differ from that in MadrigalCedarFile, appending this</span>
<span class="sd">        MadrigalDataRecord to MadrigalCedarFile will raise an IOError. Also raises error if parm already exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dim must be 1 or 2, not </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">)))</span>
        
        <span class="c1"># see if its an integer</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">newParm</span><span class="p">)</span>
            <span class="n">isInt</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">isInt</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">isInt</span><span class="p">:</span>
            <span class="c1"># try to look up mnemonic</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newParm</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">mnem</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">newParm</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Cannot use unknown parm </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newParm</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># this must succeed or an exception raised</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCodeFromMnemonic</span><span class="p">(</span><span class="n">newParm</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Mnem </span><span class="si">%s</span><span class="s1"> not found&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newParm</span><span class="p">))</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="n">newParm</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># issue warning if an unneeded time parameter being added</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">timeParms</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;WARNING: Parameter </span><span class="si">%s</span><span class="s1"> is a time parameter that potentially conflicts with prolog times</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># figure out dtype</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmFormat</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">format</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span>
            
        <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">),),</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">append_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dim</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">append_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">usemask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">newCedarParm</span> <span class="o">=</span> <span class="n">CedarParameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCodeFromMnemonic</span><span class="p">(</span><span class="n">mnem</span><span class="p">),</span>
                                      <span class="n">mnem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmDescription</span><span class="p">(</span><span class="n">mnem</span><span class="p">),</span>
                                      <span class="n">isInt</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">,</span> <span class="n">valueIn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set1D sets a 1D value for a given 1D parameter</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>


<span class="sd">            valueIn - double (or string convertable to double) value to set 1D parameter to.  To set special Cedar values, the global values</span>
<span class="sd">                    missing, assumed, or knownbad may be used, or the strings &quot;missing&quot;, &quot;assumed&quot;, or &quot;knownbad&quot;</span>
<span class="sd">                    May also be int or string if that type</span>

<span class="sd">        Outputs: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># avoid numpy / python disagreement when comparing strings/arrays</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">valueIn</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">str_</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">valueIn</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">valueIn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">valueIn</span>
            
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;missing&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_int</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStrLen</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;assumed&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed_int</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;knownbad&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad_int</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;assumed&#39;</span><span class="p">,</span> <span class="s1">&#39;knownbad&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;It is illegal to set the non-error parm </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="c1"># make sure this is a one-d parm</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 2D, not 1D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        
        <span class="c1"># set it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        


    <span class="k">def</span> <span class="nf">set2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">valueIn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set2D sets a 2D value for a given 2D parameter and row</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">            row - row number to set data.  Starts at 0.</span>

<span class="sd">            valueIn - double (or string convertable to double) value to set 2D parameter to. To set special Cedar values, the global values</span>
<span class="sd">                    missing, assumed, or knownbad may be used, or the strings &quot;missing&quot;, &quot;assumed&quot;, or &quot;knownbad&quot;</span>
<span class="sd">                    May also be int or string if that type</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span> <span class="ow">or</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal value of row </span><span class="si">%i</span><span class="s1"> with nrow = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)))</span>
        
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">isString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        
        <span class="c1"># avoid numpy / python disagreement when comparing strings</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">valueIn</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">str_</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">valueIn</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">valueIn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">valueIn</span>
        
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;missing&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_int</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStrLen</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;assumed&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed_int</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;knownbad&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad_int</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;assumed&#39;</span><span class="p">,</span> <span class="s1">&#39;knownbad&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;It is illegal to set the non-error parm </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="c1"># make sure this is a two-d parm</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 1D, not 2D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        
        <span class="c1"># if its ind parm, make sure its not nan</span>
        <span class="k">if</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set ind parm </span><span class="si">%s</span><span class="s1"> to nan at row </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
        
        
        <span class="c1"># set it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        
        
    <span class="k">def</span> <span class="nf">set2DParmValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set2DParmValues sets all 2D value in all rows for a given 2D parameter</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">            value - list, tuple, or numpy array of int64 or float64 type.  Must match len of nrows.  User is responsible</span>
<span class="sd">                for having set all special values to missing, assumed and knownbad as defined at top</span>
<span class="sd">                of this class for either ints or floats</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># make sure this is a two-d parm</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">isString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 1D, not 2D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        
        <span class="k">if</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set any ind parm </span><span class="si">%s</span><span class="s1"> value to nan: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">)))</span>
        
        <span class="c1"># set it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>



    <span class="k">def</span> <span class="nf">get1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get1D returns the 1D value for a given 1D parameter</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">        Outputs: value</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        <span class="c1"># make sure this is a one-d parm</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">isString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 2D, not 1D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
                
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># check for special values</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="s1">&#39;missing&#39;</span><span class="p">)</span>

        <span class="c1"># if its an error parameter, allow assumed or knownbad</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed_int</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="s1">&#39;assumed&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad_int</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="s1">&#39;knownbad&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>


    <span class="k">def</span> <span class="nf">get2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get2D returns the 2D value for a given 2D parameter</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">            row - row number to get data.  Starts at 0.</span>

<span class="sd">        Outputs: double value, or the strings &quot;missing&quot;, &quot;assumed&quot;, or &quot;knownbad&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>    
        <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span> <span class="ow">or</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal value of row </span><span class="si">%i</span><span class="s1"> with nrow = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)))</span>
        
        <span class="c1"># make sure this is a two-d parm</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">isString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 1D, not 2D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
                
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">row</span><span class="p">]</span>

        <span class="c1"># check for special values</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="s1">&#39;missing&#39;</span><span class="p">)</span>

        <span class="c1"># if its an error parameter, allow assumed or knownbad</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed_int</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="s1">&#39;assumed&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad_int</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="s1">&#39;knownbad&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>
    
    
    <span class="k">def</span> <span class="nf">getRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRow returns the row of data in order defined in self._dataset.dtype</span>
<span class="sd">        </span>
<span class="sd">        Input: row number</span>
<span class="sd">        </span>
<span class="sd">        IndexError raised if not a valid row index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
    
    
    <span class="k">def</span> <span class="nf">setRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setRow sets an entire row of data at once</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">        </span>
<span class="sd">            row - row number to set</span>
<span class="sd">            </span>
<span class="sd">            values - a tuple of values in the right format to match self._dataset.dtype</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>


    <span class="k">def</span> <span class="nf">delete1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;delete1D removes the given 1D parameter from the record</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Raise exception if 1D parm does not exist. If this deletion makes self._dataset.dtype differ from that in </span>
<span class="sd">        MadrigalCedarFile, appending this MadrigalDataRecord to MadrigalCedarFile will raise an IOError. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># make sure this is a one-d parm</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 2D, not 1D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span>
        
        <span class="c1"># find index to delete from self._oneDList</span>
        <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parmObj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">parmObj</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="n">parm</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Did not find parm </span><span class="si">%s</span><span class="s1"> in self._oneDList&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        

    <span class="k">def</span> <span class="nf">delete2DParm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;delete2DParm removes the given 2D parameter from every row in the record</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Raise exception if 2D parm does not exist. If this deletion makes self._dataset.dtype differ from that in </span>
<span class="sd">        MadrigalCedarFile, appending this MadrigalDataRecord to MadrigalCedarFile will raise an IOError. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># make sure this is a two-d parm</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 1D, not 2D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span>

        <span class="c1"># find index to delete from self._twoDList</span>
        <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parmObj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">parmObj</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="n">parm</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Did not find parm </span><span class="si">%s</span><span class="s1"> in self._twoDList&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        
        

    <span class="k">def</span> <span class="nf">delete2DRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;delete2DRows removes the given 2D row or rows in the record (first is row 0)</span>

<span class="sd">        Inputs:</span>

<span class="sd">            row number (integer) or list of row numbers to delete (first is row 0)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Raise exception if row does not exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># make sure row is a list</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">rows</span><span class="p">]</span>
            
        <span class="n">keepIndices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># make sure all rows actually exist</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">keepIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Some row in </span><span class="si">%s</span><span class="s1"> out of range, total number of rows is </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">keepIndices</span><span class="p">]</span>
        
        

    <span class="k">def</span> <span class="nf">getKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKinst returns the kind of instrument code (int) for a given data record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the kind of instrument code (int) for a given data record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">setKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newKinst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setKinst sets the kind of instrument code (int) for a given data record.</span>

<span class="sd">        Inputs: newKinst - new instrument code (integer)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets self._dataset[&#39;kinst&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newKinst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">newKinst</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newKinst</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Kinst must not be less than 0, not </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newKinst</span><span class="p">))</span>
        <span class="c1"># verify  and set kinst</span>
        <span class="n">instList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentList</span><span class="p">()</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">newKinst</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="s1">&#39;Unknown instrument&#39;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: kinst </span><span class="si">%i</span><span class="s1"> not found in instTab.txt</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newKinst</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newKinst</span>


    <span class="k">def</span> <span class="nf">getKindat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKindat returns the kind of data code (int) for a given data record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the kind of data code (int) for a given data record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">setKindat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newKindat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setKindat sets the kind of data code (int) for a given data record.</span>

<span class="sd">        Inputs: newKindat (integer)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets self._dataset[&#39;kindat&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">newKindat</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kindat cannot be negative: </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newKindat</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">newKindat</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">getRecno</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getRecno returns the recno (int) for a given data record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the recno (int) for a given data record. May be 0 if not yet in a file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">setRecno</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newRecno</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setRecno sets the recno (int) for a given data record.</span>

<span class="sd">        Inputs: newRecno (integer)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets self._dataset[&#39;recno&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">newRecno</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;recno cannot be negative: </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newRecno</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">newRecno</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getNrow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getNrow returns the number of 2D data rows (int) for a given data record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the number of 2D data rows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">getStartTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStartTimeList returns a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">startDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
        <span class="k">return</span><span class="p">((</span><span class="n">startDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">startDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">startDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> 
                <span class="n">startDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">startDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">startDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">startDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mf">1.0E4</span><span class="p">)))</span>
        
        
    <span class="k">def</span> <span class="nf">getStartDatetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStartDatetime returns a start record datetime</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a datetime.datetime object representing the start time of the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>


    <span class="k">def</span> <span class="nf">setStartTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="n">sCentisec</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setStartTimeList changes the data record start time</span>

<span class="sd">        Inputs: integers sYear, sMonth, sDay, sHour, sMin, sSec. sCentisec defaults to 0</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: changes self._dataset fields ut1_unix, year, month, day, hour, min,sec</span>

<span class="sd">        Prints warning if new start time after present end time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check validity of input time</span>
        <span class="n">sCentisec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sCentisec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sCentisec</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">sCentisec</span> <span class="o">&gt;</span> <span class="mi">99</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal sCentisec </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sCentisec</span><span class="p">))</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sCentisec</span><span class="o">*</span><span class="mf">1E4</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal datetime </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="n">sCentisec</span><span class="p">))))</span>

        <span class="k">if</span> <span class="n">sDT</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: New starting time </span><span class="si">%s</span><span class="s1"> after present ending time </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sDT</span><span class="p">),</span> 
                                                                                               <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">())))</span>
            
        <span class="n">ut1_unix</span> <span class="o">=</span> <span class="p">(</span><span class="n">sDT</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut1_unix</span>
        
        <span class="c1"># need to reset average time</span>
        <span class="n">aveDT</span> <span class="o">=</span> <span class="n">sDT</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span> <span class="o">-</span> <span class="n">sDT</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">hour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">minute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;sec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">second</span>



    <span class="k">def</span> <span class="nf">getEndTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getEndTimeList returns a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
        <span class="k">return</span><span class="p">((</span><span class="n">endDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">endDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">endDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> 
                <span class="n">endDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">endDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">endDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">endDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mf">1.0E4</span><span class="p">)))</span>
        
        
    <span class="k">def</span> <span class="nf">getEndDatetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getEndDatetime returns a end record datetime</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a datetime.datetime object representing the end time of the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    
    
    <span class="k">def</span> <span class="nf">setEndTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="n">eCentisec</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setEndTimeList changes the data record end time</span>

<span class="sd">        Inputs: integers eYear, eMonth, eDay, eHour, eMin, eSec. eCentisec defaults to 0</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: changes self._dataset fields ut2_unix, year, month, day, hour, min,sec</span>

<span class="sd">        Prints warning if new start time after present end time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check validity of input time</span>
        <span class="n">eCentisec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">eCentisec</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eCentisec</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">eCentisec</span> <span class="o">&gt;</span> <span class="mi">99</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal eCentisec </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">eCentisec</span><span class="p">))</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">eCentisec</span><span class="o">*</span><span class="mf">1E4</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal datetime </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="n">eCentisec</span><span class="p">))))</span>

        <span class="k">if</span> <span class="n">eDT</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">():</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: New ending time </span><span class="si">%s</span><span class="s1"> before present starting time </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">eDT</span><span class="p">),</span> 
                                                                                                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">())))</span>
            
        <span class="n">ut2_unix</span> <span class="o">=</span> <span class="p">(</span><span class="n">eDT</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut2_unix</span>
        
        <span class="c1"># need to reset average time</span>
        <span class="n">aveDT</span> <span class="o">=</span> <span class="n">eDT</span> <span class="o">-</span> <span class="p">(</span><span class="n">eDT</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">())</span><span class="o">/</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">hour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">minute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;sec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">second</span>


    


    <span class="k">def</span> <span class="nf">get1DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get1DParms returns a list of 1D parameters in the MadrigalDataRecord.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a list of 1D CedarParameter objects in the MadrigalDataRecord.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get2DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;get2DParms returns a list of 2D parameters in the MadrigalDataRecord.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a list of 2D CedarParameter objects in the MadrigalDataRecord. Includes</span>
<span class="sd">            both independent and dependent parms.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getInd2DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getInd2DParms returns a list of the subset 2D parameters ithat are independent parmeters.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a list of independent 2D CedarParameter objects in the MadrigalDataRecord. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getParmDim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getParmDim returns the dimension (1, 2, or 3 for independent spatial parm) of a given parm mnemonic</span>
<span class="sd">        </span>
<span class="sd">        Raise KeyError if that parameter not found in file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># do ind 2D next since they are in both lists</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">return</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in data&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    

    <span class="k">def</span> <span class="nf">getHeaderKodLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getHeaderKodLines creates the lines in the Madrigal header record that start KOD and describe parms</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Returns: a string of length 80*num parms.  Each 80 characters contains a description</span>
<span class="sd">                 of a single parm accodring to the Cedar Standard</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create a list of oneDCedar codes for the data record.</span>
        <span class="c1">#  Each item has three elements: (code, parameter description, units)</span>
        <span class="n">oneDCedarCodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
            <span class="n">oneDCedarCodes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">)))</span>
        
        <span class="n">oneDCedarCodes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">compareParms</span><span class="p">)</span>

        <span class="c1"># create a list of twoDCedar codes for the data record.</span>
        <span class="c1"># Each item has three elements: (code, parameter description, units)</span>
        <span class="n">twoDCedarCodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
            <span class="n">twoDCedarCodes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">)))</span>
            
        <span class="n">twoDCedarCodes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">compareParms</span><span class="p">)</span>
        

        <span class="c1"># write out lines - one D</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oneDCedarCodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;C 1D Parameters:&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;C 1D Parameters:&#39;</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oneDCedarCodes</span><span class="p">)):</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">oneDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="n">oneDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">oneDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;KODS(</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
            <span class="n">codeNum</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="n">codeNum</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">codeNum</span><span class="p">))</span><span class="o">*</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">codeNum</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">codeNum</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">48</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">desc</span><span class="p">[:</span><span class="mi">48</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">desc</span> <span class="o">+</span> <span class="p">(</span><span class="mi">49</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">))</span><span class="o">*</span> <span class="s1">&#39; &#39;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">desc</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">units</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">line</span>

        <span class="c1"># two D</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDCedarCodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;C 2D Parameters:&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;C 2D Parameters:&#39;</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">twoDCedarCodes</span><span class="p">)):</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">twoDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="n">twoDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">twoDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;KODM(</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
            <span class="n">codeNum</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="n">codeNum</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">codeNum</span><span class="p">))</span><span class="o">*</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">codeNum</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">codeNum</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">48</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">desc</span><span class="p">[:</span><span class="mi">48</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">desc</span> <span class="o">+</span> <span class="p">(</span><span class="mi">49</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">))</span><span class="o">*</span> <span class="s1">&#39; &#39;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">desc</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="n">units</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">line</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>

                    

    
        
        
    <span class="k">def</span> <span class="nf">_createArraysFromArgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kinst</span><span class="p">,</span><span class="n">kindat</span><span class="p">,</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                                       <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">,</span>
                                       <span class="n">oneDList</span><span class="p">,</span><span class="n">twoDList</span><span class="p">,</span><span class="n">nrow</span><span class="p">,</span><span class="n">ind2DList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_createArraysFromArgs creates a table layout array and record array numpy array based in input arguments.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>

<span class="sd">            kinst - the kind of instrument code.  A warning will be raised if not in instTab.txt.</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            kindat - kind of data code. Must be a non-negative integer.</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - record start time. sCentisec must be 0-99</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - record end time. eCentisec must be 0-99</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            oneDList - list of one-dimensional parameters in record. Parameters can be defined as codes</span>
<span class="sd">                       (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                       Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            twoDList - list of two-dimensional parameters in record. Parameters can be defined as codes</span>
<span class="sd">                       (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                       Default is None, in which case recno, dataset, and recordSet must be given.</span>

<span class="sd">            nrow - number of rows of 2D data to create. Until set, all values default to missing.</span>
<span class="sd">                Default is None, in which case recno, dataset, and recordSet must be given.</span>
<span class="sd">                </span>
<span class="sd">            ind2DList -  list of indepedent spatial two-dimensional parameters in record. </span>
<span class="sd">                       Parameters can be defined as codes. Each must also be listed in twoDList.</span>
<span class="sd">                       (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                       Default is None, in which case dataset, and recordSet must be given.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaultParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stdParms</span>
        <span class="n">dataDtype</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># data type for the Table Layout recarray</span>
        <span class="n">recDType</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># data type for _record_layout recarray</span>
        <span class="n">recDims</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># dimension of each parameter (1 for 1D, 2 for dependent 2D, 3 for independent 2D)</span>
        <span class="n">parmsAddedSoFar</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># mnemonics added so far</span>
        
        <span class="c1"># the following is simply to ensure that independent 2D parms are also listed in twoDList</span>
        <span class="n">twoDParms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">twoDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">CedarParameter</span><span class="p">):</span>
                <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="n">twoDParms</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Duplicate parmeter </span><span class="si">%s</span><span class="s1"> in twoDList&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mnem</span><span class="p">))</span>
            <span class="n">twoDParms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
        
        <span class="c1"># default parms</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">defaultParms</span><span class="p">:</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># default parms cannot be strings</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">float</span><span class="p">))</span>
            <span class="n">recDType</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="n">recDims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">parmsAddedSoFar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
            
        <span class="c1"># one D parms</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">oneDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">CedarParameter</span><span class="p">):</span>
                <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="n">parmsAddedSoFar</span><span class="p">:</span>
                <span class="k">continue</span> <span class="c1"># legal because it may be a default parm</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">,</span> <span class="n">strLen</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">float</span><span class="p">))</span>
            <span class="n">recDType</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="n">recDims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">parmsAddedSoFar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">ind2DList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">CedarParameter</span><span class="p">):</span>
                <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="n">parmsAddedSoFar</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Duplicate parmeter </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mnem</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">mnem</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">twoDParms</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Independent 2D parm </span><span class="si">%s</span><span class="s1"> not found in twoDList&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mnem</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">,</span> <span class="n">strLen</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">float</span><span class="p">))</span>
            <span class="n">recDType</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="n">recDims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">parmsAddedSoFar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">twoDList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">CedarParameter</span><span class="p">):</span>
                <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">mnemonic</span>
            <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mnem</span> <span class="ow">in</span> <span class="n">parmsAddedSoFar</span><span class="p">:</span>
                <span class="k">continue</span> <span class="c1"># legal because may be independent parm</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">mnem</span><span class="p">):</span>
                <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">,</span> <span class="n">strLen</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">dataDtype</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">mnem</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">float</span><span class="p">))</span>
            <span class="n">recDType</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">int</span><span class="p">))</span>
            <span class="n">recDims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            
        <span class="c1"># create two recarrays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span> <span class="mi">1</span><span class="p">),),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">dataDtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="n">recDims</span><span class="p">),],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">recDType</span><span class="p">)</span>
        
        <span class="c1"># set prolog values</span>
        <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sYear</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sMonth</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sDay</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sHour</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sMin</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sSec</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">sCentisec</span><span class="p">)</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">eYear</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">eMonth</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">eDay</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">eHour</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">eMin</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">eSec</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">eCentisec</span><span class="p">)</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">midDT</span> <span class="o">=</span> <span class="n">sDT</span> <span class="o">+</span> <span class="p">((</span><span class="n">eDT</span><span class="o">-</span><span class="n">sDT</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midDT</span><span class="o">.</span><span class="n">year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midDT</span><span class="o">.</span><span class="n">month</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midDT</span><span class="o">.</span><span class="n">day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midDT</span><span class="o">.</span><span class="n">hour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midDT</span><span class="o">.</span><span class="n">minute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;sec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">midDT</span><span class="o">.</span><span class="n">second</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kindat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getUnixUTFromDT</span><span class="p">(</span><span class="n">sDT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getUnixUTFromDT</span><span class="p">(</span><span class="n">eDT</span><span class="p">)</span>
        <span class="c1"># set all other values to default</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">defaultParms</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataDtype</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">dataDtype</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">dataDtype</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing</span>
            <span class="k">elif</span> <span class="n">dataDtype</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">dataDtype</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_int</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># string type only one left</span>
                <span class="n">strLen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getStringLen</span><span class="p">(</span><span class="n">dataDtype</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">dataDtype</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">strLen</span>
                
                    
            

    <span class="k">def</span> <span class="nf">__get2DValueList__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__get2DValueList__ returns a list containing all the 2D values of a given parameter.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>


<span class="sd">        Outputs: a list containing all the 2D values of a given parameter.  Special values will</span>
<span class="sd">                 be given the values &#39;missing&#39;, &#39;assumed&#39;, or &#39;knownbad&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">):</span>
            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get2D</span><span class="p">(</span><span class="n">parm</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__get2DMainValueList__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">scaleFactor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__get2DMainValueList__ returns a list containing all the 2D values of a given main parameter.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            code - parameter code (integer).  Must</span>
<span class="sd">                   be a parameter with an additional increment parameter.</span>


<span class="sd">        Outputs: a list containing all the 2D values of a given main parameter that has an</span>
<span class="sd">                 additional increment parameter.  Special values will be given the values &#39;missing&#39;, &#39;assumed&#39;, or &#39;knownbad&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2D</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bytes</span><span class="p">:</span>
                <span class="c1"># subtract off additional increment part</span>
                <span class="n">addIncr</span> <span class="o">=</span> <span class="n">value</span> <span class="o">%</span> <span class="n">scaleFactor</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">addIncr</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">scaleFactor</span> <span class="o">-</span> <span class="n">addIncr</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="n">addIncr</span>
            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__get2DIncrValueList__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">scaleFactor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__get2DIncrValueList__ returns a list containing all the additional increment 2D values of a given main parameter.</span>

<span class="sd">        Inputs:</span>

<span class="sd">            parm - parameter code (integer).  Must</span>
<span class="sd">                   be a parameter with an additional increment parameter.</span>


<span class="sd">        Outputs: a list containing all the additional increment 2D values of a given main parameter.</span>
<span class="sd">                 Special values will be given the values &#39;missing&#39;, &#39;assumed&#39;, or &#39;knownbad&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get2D</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bytes</span><span class="p">:</span>
                <span class="c1"># get additional increment part</span>
                <span class="n">incr</span> <span class="o">=</span> <span class="n">value</span> <span class="o">%</span> <span class="n">scaleFactor</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">incr</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">scaleFactor</span> <span class="o">-</span> <span class="n">incr</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">incr</span>
            <span class="n">retList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retList</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns a string representation of a MadrigalDataRecord &quot;&quot;&quot;</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;Data record:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;kinst = </span><span class="si">%i</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;kindat = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKindat</span><span class="p">())</span>
        <span class="n">startTimeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
        <span class="n">endTimeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;record start: </span><span class="si">%04i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">.</span><span class="si">%02i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">startTimeList</span><span class="p">))</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;record end:   </span><span class="si">%04i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">.</span><span class="si">%02i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">endTimeList</span><span class="p">))</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;one-dim parameters:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDData</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c1"># there may not be oneDData</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;two-dim parameters:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_twoDData</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c1"># there may not be twoDData</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">cmpDataRec</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;cmpDataRec returns a tuple of:</span>
<span class="sd">            1. 0 if catalog, 1 if header, 2 if data</span>
<span class="sd">            2.  start datetime</span>
<span class="sd">            3.  end datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># compare record start times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="n">typeEnum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thisType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dataType</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">thisType</span> <span class="o">==</span> <span class="n">dataType</span><span class="p">:</span>
                <span class="n">typeEnum</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
            
        <span class="c1"># compare record stop times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="k">return</span><span class="p">((</span><span class="n">typeEnum</span><span class="p">,</span> <span class="n">sDT</span><span class="p">,</span> <span class="n">eDT</span><span class="p">))</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#madrigal.cedar.MadrigalDataRecord">MadrigalDataRecord</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="madrigal.cedar.MadrigalDataRecord.assumed" class="name">var <span class="ident">assumed</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="madrigal.cedar.MadrigalDataRecord.assumed_int" class="name">var <span class="ident">assumed_int</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="madrigal.cedar.MadrigalDataRecord.knownbad" class="name">var <span class="ident">knownbad</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="madrigal.cedar.MadrigalDataRecord.knownbad_int" class="name">var <span class="ident">knownbad_int</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="madrigal.cedar.MadrigalDataRecord.missing" class="name">var <span class="ident">missing</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="madrigal.cedar.MadrigalDataRecord.missing_int" class="name">var <span class="ident">missing_int</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, kinst=None, kindat=None, sYear=None, sMonth=None, sDay=None, sHour=None, sMin=None, sSec=None, sCentisec=None, eYear=None, eMonth=None, eDay=None, eHour=None, eMin=None, eSec=None, eCentisec=None, oneDList=None, twoDList=None, nrow=None, madInstObj=None, madParmObj=None, ind2DList=None, dataset=None, recordSet=None, verbose=True, parmObjList=None, madDB=None)</p>
    </div>
    

    
  
    <div class="desc"><p><strong>init</strong> creates a MadrigalDataRecord with all missing data.</p>
<p>Note: all inputs have default values because there are two ways to populate this structure:
1) with all inputs from kinst to nrow when new data is being created, or 
2) with numpy arrays dataset and recordSet from existing Hdf5 file.</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">kinst</span> <span class="o">-</span> <span class="n">the</span> <span class="n">kind</span> <span class="k">of</span> <span class="n">instrument</span> <span class="n">code</span><span class="p">.</span>  <span class="n">A</span> <span class="n">warning</span> <span class="n">will</span> <span class="n">be</span> <span class="n">raised</span> <span class="k">if</span> <span class="k">not</span> <span class="k">in</span> <span class="n">instTab</span><span class="p">.</span><span class="n">txt</span><span class="p">.</span>
    <span class="k">Default</span> <span class="k">is</span> <span class="k">None</span><span class="p">,</span> <span class="k">in</span> <span class="n">which</span> <span class="k">case</span> <span class="n">recno</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="k">and</span> <span class="n">recordSet</span> <span class="n">must</span> <span class="n">be</span> <span class="n">given</span><span class="p">.</span>

<span class="n">kindat</span> <span class="o">-</span> <span class="n">kind</span> <span class="k">of</span> <span class="k">data</span> <span class="n">code</span><span class="p">.</span> <span class="n">Must</span> <span class="n">be</span> <span class="n">a</span> <span class="n">non</span><span class="o">-</span><span class="n">negative</span> <span class="nb">integer</span><span class="p">.</span>
    <span class="k">Default</span> <span class="k">is</span> <span class="k">None</span><span class="p">,</span> <span class="k">in</span> <span class="n">which</span> <span class="k">case</span> <span class="n">recno</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="k">and</span> <span class="n">recordSet</span> <span class="n">must</span> <span class="n">be</span> <span class="n">given</span><span class="p">.</span>

<span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span> <span class="o">-</span> <span class="n">record</span> <span class="k">start</span> <span class="n">time</span><span class="p">.</span> <span class="n">sCentisec</span> <span class="n">must</span> <span class="n">be</span> <span class="mi">0</span><span class="o">-</span><span class="mi">99</span>
    <span class="k">Default</span> <span class="k">is</span> <span class="k">None</span><span class="p">,</span> <span class="k">in</span> <span class="n">which</span> <span class="k">case</span> <span class="n">recno</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="k">and</span> <span class="n">recordSet</span> <span class="n">must</span> <span class="n">be</span> <span class="n">given</span><span class="p">.</span>

<span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span> <span class="o">-</span> <span class="n">record</span> <span class="k">end</span> <span class="n">time</span><span class="p">.</span> <span class="n">eCentisec</span> <span class="n">must</span> <span class="n">be</span> <span class="mi">0</span><span class="o">-</span><span class="mi">99</span>
    <span class="k">Default</span> <span class="k">is</span> <span class="k">None</span><span class="p">,</span> <span class="k">in</span> <span class="n">which</span> <span class="k">case</span> <span class="n">recno</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="k">and</span> <span class="n">recordSet</span> <span class="n">must</span> <span class="n">be</span> <span class="n">given</span><span class="p">.</span>

<span class="n">oneDList</span> <span class="o">-</span> <span class="n">list</span> <span class="k">of</span> <span class="n">one</span><span class="o">-</span><span class="n">dimensional</span> <span class="k">parameters</span> <span class="k">in</span> <span class="n">record</span><span class="p">.</span> <span class="k">Parameters</span> <span class="n">can</span> <span class="n">be</span> <span class="k">defined</span> <span class="k">as</span> <span class="n">codes</span>
           <span class="p">(</span><span class="n">integers</span><span class="p">)</span> <span class="k">or</span> <span class="k">case</span><span class="o">-</span><span class="k">insensitive</span> <span class="n">mnemonic</span> <span class="n">strings</span> <span class="p">(</span><span class="n">eg</span><span class="p">,</span> <span class="ss">&quot;Gdalt&quot;</span><span class="p">),</span> <span class="k">or</span> <span class="n">CedarParameter</span> <span class="n">objects</span><span class="p">.</span>
           <span class="k">Default</span> <span class="k">is</span> <span class="k">None</span><span class="p">,</span> <span class="k">in</span> <span class="n">which</span> <span class="k">case</span> <span class="n">recno</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="k">and</span> <span class="n">recordSet</span> <span class="n">must</span> <span class="n">be</span> <span class="n">given</span><span class="p">.</span>

<span class="n">twoDList</span> <span class="o">-</span> <span class="n">list</span> <span class="k">of</span> <span class="n">two</span><span class="o">-</span><span class="n">dimensional</span> <span class="k">parameters</span> <span class="k">in</span> <span class="n">record</span><span class="p">.</span> <span class="k">Parameters</span> <span class="n">can</span> <span class="n">be</span> <span class="k">defined</span> <span class="k">as</span> <span class="n">codes</span>
           <span class="p">(</span><span class="n">integers</span><span class="p">)</span> <span class="k">or</span> <span class="k">case</span><span class="o">-</span><span class="k">insensitive</span> <span class="n">mnemonic</span> <span class="n">strings</span> <span class="p">(</span><span class="n">eg</span><span class="p">,</span> <span class="ss">&quot;Gdalt&quot;</span><span class="p">),</span> <span class="k">or</span> <span class="n">CedarParameter</span> <span class="n">objects</span><span class="p">.</span>
           <span class="k">Default</span> <span class="k">is</span> <span class="k">None</span><span class="p">,</span> <span class="k">in</span> <span class="n">which</span> <span class="k">case</span> <span class="n">recno</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="k">and</span> <span class="n">recordSet</span> <span class="n">must</span> <span class="n">be</span> <span class="n">given</span><span class="p">.</span>

<span class="n">nrow</span> <span class="o">-</span> <span class="nb">number</span> <span class="k">of</span> <span class="k">rows</span> <span class="k">of</span> <span class="mi">2</span><span class="n">D</span> <span class="k">data</span> <span class="k">to</span> <span class="k">create</span><span class="p">.</span> <span class="k">Until</span> <span class="k">set</span><span class="p">,</span> <span class="k">all</span> <span class="k">values</span> <span class="k">default</span> <span class="k">to</span> <span class="n">missing</span><span class="p">.</span>
    <span class="k">Default</span> <span class="k">is</span> <span class="k">None</span><span class="p">,</span> <span class="k">in</span> <span class="n">which</span> <span class="k">case</span> <span class="n">recno</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="k">and</span> <span class="n">recordSet</span> <span class="n">must</span> <span class="n">be</span> <span class="n">given</span><span class="p">.</span>

<span class="n">madInstObj</span> <span class="o">-</span> <span class="n">a</span> <span class="n">madrigal</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">MadrigalInstrument</span> <span class="k">object</span><span class="p">.</span>  <span class="k">If</span> <span class="k">None</span><span class="p">,</span> <span class="n">one</span> <span class="n">will</span> <span class="n">be</span> <span class="n">created</span><span class="p">.</span>
                  <span class="n">Used</span> <span class="k">to</span> <span class="n">verify</span> <span class="n">kinst</span><span class="p">.</span>

<span class="n">madParmObj</span> <span class="o">-</span> <span class="n">a</span> <span class="n">madrigal</span><span class="p">.</span><span class="k">data</span><span class="p">.</span><span class="n">MadrigalParameter</span> <span class="k">object</span><span class="p">.</span>  <span class="k">If</span> <span class="k">None</span><span class="p">,</span> <span class="n">one</span> <span class="n">will</span> <span class="n">be</span> <span class="n">created</span><span class="p">.</span>
                  <span class="n">Used</span> <span class="k">to</span> <span class="n">verify</span> <span class="k">convert</span> <span class="k">parameters</span> <span class="k">to</span> <span class="n">codes</span><span class="p">.</span>

<span class="n">ind2DList</span> <span class="o">-</span>  <span class="n">list</span> <span class="k">of</span> <span class="n">indepedent</span> <span class="n">spatial</span> <span class="n">two</span><span class="o">-</span><span class="n">dimensional</span> <span class="k">parameters</span> <span class="k">in</span> <span class="n">record</span><span class="p">.</span> 
           <span class="k">Parameters</span> <span class="n">can</span> <span class="n">be</span> <span class="k">defined</span> <span class="k">as</span> <span class="n">codes</span><span class="p">.</span> <span class="k">Each</span> <span class="n">must</span> <span class="n">also</span> <span class="n">be</span> <span class="n">listed</span> <span class="k">in</span> <span class="n">twoDList</span><span class="p">.</span>
           <span class="p">(</span><span class="n">integers</span><span class="p">)</span> <span class="k">or</span> <span class="k">case</span><span class="o">-</span><span class="k">insensitive</span> <span class="n">mnemonic</span> <span class="n">strings</span> <span class="p">(</span><span class="n">eg</span><span class="p">,</span> <span class="ss">&quot;Gdalt&quot;</span><span class="p">),</span> <span class="k">or</span> <span class="n">CedarParameter</span> <span class="n">objects</span><span class="p">.</span>
           <span class="k">Default</span> <span class="k">is</span> <span class="k">None</span><span class="p">,</span> <span class="k">in</span> <span class="n">which</span> <span class="k">case</span> <span class="n">dataset</span><span class="p">,</span> <span class="k">and</span> <span class="n">recordSet</span> <span class="n">must</span> <span class="n">be</span> <span class="n">given</span><span class="p">.</span>

<span class="n">dataset</span> <span class="o">-</span> <span class="n">an</span> <span class="n">h5py</span> <span class="n">dataset</span><span class="p">,</span> <span class="k">as</span> <span class="k">found</span> <span class="k">in</span> <span class="n">the</span> <span class="n">Hdf5</span> <span class="k">group</span> <span class="ss">&quot;Data&quot;</span><span class="p">,</span> <span class="n">dataset</span> <span class="ss">&quot;Table Layout&quot;</span><span class="p">.</span>
    <span class="k">Set</span> <span class="k">to</span> <span class="k">None</span> <span class="k">if</span> <span class="n">this</span> <span class="k">is</span> <span class="n">a</span> <span class="k">new</span> <span class="n">record</span><span class="p">.</span>

<span class="n">recordSet</span> <span class="o">-</span> <span class="n">an</span> <span class="n">h5py</span> <span class="n">dataset</span><span class="p">,</span> <span class="k">as</span> <span class="k">found</span> <span class="k">in</span> <span class="n">the</span> <span class="n">Hdf5</span> <span class="k">group</span> <span class="ss">&quot;Metadata&quot;</span><span class="p">,</span> <span class="n">dataset</span> <span class="ss">&quot;_record_layout&quot;</span><span class="p">.</span>
    <span class="k">Set</span> <span class="k">to</span> <span class="k">None</span> <span class="k">if</span> <span class="n">this</span> <span class="k">is</span> <span class="n">a</span> <span class="k">new</span> <span class="n">record</span><span class="p">.</span>

<span class="k">verbose</span> <span class="o">-</span> <span class="k">if</span> <span class="k">True</span> <span class="p">(</span><span class="n">the</span> <span class="k">default</span><span class="p">),</span> <span class="n">print</span> <span class="k">all</span> <span class="n">warnings</span><span class="p">.</span>  <span class="k">If</span> <span class="k">False</span><span class="p">,</span> <span class="n">surpress</span> <span class="n">warnings</span>

<span class="n">parmObjList</span> <span class="o">-</span> <span class="n">a</span> <span class="n">list</span> <span class="k">or</span> <span class="n">tuple</span> <span class="k">of</span> <span class="n">three</span> <span class="n">lists</span><span class="p">:</span> <span class="k">self</span><span class="p">.</span><span class="n">_oneDList</span><span class="p">,</span> <span class="k">self</span><span class="p">.</span><span class="n">_twoDList</span><span class="p">,</span> <span class="k">and</span>
    <span class="k">self</span><span class="p">.</span><span class="n">_ind2DList</span> <span class="n">described</span> <span class="n">below</span><span class="p">.</span>  <span class="n">Used</span> <span class="k">only</span> <span class="k">to</span> <span class="n">speed</span> <span class="n">performance</span><span class="p">.</span>  <span class="k">Default</span> <span class="k">is</span>
    <span class="k">None</span><span class="p">,</span> <span class="k">in</span> <span class="n">which</span> <span class="k">case</span> <span class="k">new</span> <span class="n">copies</span> <span class="k">are</span> <span class="n">created</span><span class="p">.</span>

<span class="n">madDB</span> <span class="o">-</span> <span class="n">madrigal</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">MadrigalDB</span> <span class="k">object</span><span class="p">.</span> <span class="k">If</span> <span class="k">None</span><span class="p">,</span> <span class="n">one</span> <span class="n">will</span> <span class="n">be</span> <span class="n">created</span><span class="p">.</span>
</pre></div>


<p>Outputs: None</p>
<p>Returns: None</p>
<p>Affects:
    Creates attributes:
        self._madInstObj - madrigal.metadata.MadrigalInstrument object
        self._madParmObj - madrigal.data.MadrigalParameters object
        self._dataset - h5py dataset in from of Table Layout numpy recarray
        self._recordSet - h5py dataset in form of _record_layout numpy recarray
        self._verbose - bool indicating verbose or not
        self._oneDList - a list of 1D CedarParameter objects in this MadrigalDataRecord
        self._twoDList - a list of 2D CedarParameter objects in this MadrigalDataRecord
        self._ind2DList - a list of independent spatial parameters in self._twoDList</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.__init__', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kinst</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">kindat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">sYear</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sMonth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sDay</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sHour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sMin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sSec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sCentisec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">eYear</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eMonth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eDay</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eHour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eMin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eSec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">eCentisec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">oneDList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">twoDList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">nrow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">madInstObj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">madParmObj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
             <span class="n">ind2DList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">recordSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">parmObjList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">madDB</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;__init__ creates a MadrigalDataRecord with all missing data.</span>
<span class="sd">    </span>
<span class="sd">    Note: all inputs have default values because there are two ways to populate this structure:</span>
<span class="sd">    1) with all inputs from kinst to nrow when new data is being created, or </span>
<span class="sd">    2) with numpy arrays dataset and recordSet from existing Hdf5 file.</span>
<span class="sd">    Inputs:</span>
<span class="sd">        kinst - the kind of instrument code.  A warning will be raised if not in instTab.txt.</span>
<span class="sd">            Default is None, in which case recno, dataset, and recordSet must be given.</span>
<span class="sd">        kindat - kind of data code. Must be a non-negative integer.</span>
<span class="sd">            Default is None, in which case recno, dataset, and recordSet must be given.</span>
<span class="sd">        sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - record start time. sCentisec must be 0-99</span>
<span class="sd">            Default is None, in which case recno, dataset, and recordSet must be given.</span>
<span class="sd">        eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - record end time. eCentisec must be 0-99</span>
<span class="sd">            Default is None, in which case recno, dataset, and recordSet must be given.</span>
<span class="sd">        oneDList - list of one-dimensional parameters in record. Parameters can be defined as codes</span>
<span class="sd">                   (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                   Default is None, in which case recno, dataset, and recordSet must be given.</span>
<span class="sd">        twoDList - list of two-dimensional parameters in record. Parameters can be defined as codes</span>
<span class="sd">                   (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                   Default is None, in which case recno, dataset, and recordSet must be given.</span>
<span class="sd">        nrow - number of rows of 2D data to create. Until set, all values default to missing.</span>
<span class="sd">            Default is None, in which case recno, dataset, and recordSet must be given.</span>
<span class="sd">        madInstObj - a madrigal.metadata.MadrigalInstrument object.  If None, one will be created.</span>
<span class="sd">                          Used to verify kinst.</span>
<span class="sd">        madParmObj - a madrigal.data.MadrigalParameter object.  If None, one will be created.</span>
<span class="sd">                          Used to verify convert parameters to codes.</span>
<span class="sd">                          </span>
<span class="sd">        ind2DList -  list of indepedent spatial two-dimensional parameters in record. </span>
<span class="sd">                   Parameters can be defined as codes. Each must also be listed in twoDList.</span>
<span class="sd">                   (integers) or case-insensitive mnemonic strings (eg, &quot;Gdalt&quot;), or CedarParameter objects.</span>
<span class="sd">                   Default is None, in which case dataset, and recordSet must be given.</span>
<span class="sd">            </span>
<span class="sd">        dataset - an h5py dataset, as found in the Hdf5 group &quot;Data&quot;, dataset &quot;Table Layout&quot;.</span>
<span class="sd">            Set to None if this is a new record.</span>
<span class="sd">            </span>
<span class="sd">        recordSet - an h5py dataset, as found in the Hdf5 group &quot;Metadata&quot;, dataset &quot;_record_layout&quot;.</span>
<span class="sd">            Set to None if this is a new record.</span>
<span class="sd">            </span>
<span class="sd">        verbose - if True (the default), print all warnings.  If False, surpress warnings</span>
<span class="sd">        </span>
<span class="sd">        parmObjList - a list or tuple of three lists: self._oneDList, self._twoDList, and</span>
<span class="sd">            self._ind2DList described below.  Used only to speed performance.  Default is</span>
<span class="sd">            None, in which case new copies are created.</span>
<span class="sd">            </span>
<span class="sd">        madDB - madrigal.metadata.MadrigalDB object. If None, one will be created.</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Returns: None</span>
<span class="sd">    </span>
<span class="sd">    Affects:</span>
<span class="sd">        Creates attributes:</span>
<span class="sd">            self._madInstObj - madrigal.metadata.MadrigalInstrument object</span>
<span class="sd">            self._madParmObj - madrigal.data.MadrigalParameters object</span>
<span class="sd">            self._dataset - h5py dataset in from of Table Layout numpy recarray</span>
<span class="sd">            self._recordSet - h5py dataset in form of _record_layout numpy recarray</span>
<span class="sd">            self._verbose - bool indicating verbose or not</span>
<span class="sd">            self._oneDList - a list of 1D CedarParameter objects in this MadrigalDataRecord</span>
<span class="sd">            self._twoDList - a list of 2D CedarParameter objects in this MadrigalDataRecord</span>
<span class="sd">            self._ind2DList - a list of independent spatial parameters in self._twoDList</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">madDB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalDB</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span> <span class="o">=</span> <span class="n">madDB</span>
    <span class="c1"># create any needed Madrigal objects, if not passed in</span>
    <span class="k">if</span> <span class="n">madInstObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalInstrument</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madInstObj</span>
    <span class="k">if</span> <span class="n">madParmObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span> <span class="o">=</span> <span class="n">madParmObj</span>
    <span class="k">if</span> <span class="n">twoDList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">twoDList</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="k">if</span> <span class="n">ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ind2DList</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="k">if</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">recordSet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ind2DList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get it from cachedFiles.ini</span>
            <span class="n">extraParms</span><span class="p">,</span> <span class="n">ind2DList</span><span class="p">,</span> <span class="n">splitParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madDB</span><span class="o">.</span><span class="n">getKinstKindatConfig</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span> <span class="n">kindat</span><span class="p">)</span>
        <span class="c1"># verify there are independent spatial parms if there are 2D parms</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind2DList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot have 2D parms without an independent spatial parm set&#39;</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_createArraysFromArgs</span><span class="p">(</span><span class="n">kinst</span><span class="p">,</span><span class="n">kindat</span><span class="p">,</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                                   <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">,</span>
                                   <span class="n">oneDList</span><span class="p">,</span><span class="n">twoDList</span><span class="p">,</span><span class="n">nrow</span><span class="p">,</span><span class="n">ind2DList</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># verify there are independent spatial parms if there are 2D parms</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind2DList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot have 2D parms without an independent spatial parm set&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">recordSet</span>
        
    <span class="k">if</span> <span class="n">parmObjList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parmObjList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parmObjList</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">parmObjList</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># populate self._oneDList, self._twoDList, and self._ind2DList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stdParms</span><span class="p">):]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">isInt</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">isInt</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">newCedarParm</span> <span class="o">=</span> <span class="n">CedarParameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCodeFromMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                          <span class="n">parm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span>
                                          <span class="n">isInt</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
    
        
    <span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.add1D">
    <p>def <span class="ident">add1D</span>(</p><p>self, oneDParm)</p>
    </div>
    

    
  
    <div class="desc"><p>add1D adds a new one-dim parameter to a MadrigalDataRecord</p>
<p>Input: oneDParm - Parameter can be defined as codes (integer) or case-insensitive
       mnemonic string (eg, "Gdalt")</p>
<p>Affects: 1) adds new column to self._dataset with all values Nan, and 2) adds 
value to end of self._recordSet with value = 1 since 1D parm</p>
<p>If these addition makes self._dataset.dtype differ from that in MadrigalCedarFile, appending this
MadrigalDataRecord to MadrigalCedarFile will raise an IOError. Also raises error if parm already exists.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.add1D', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.add1D" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oneDParm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;add1D adds a new one-dim parameter to a MadrigalDataRecord</span>
<span class="sd">    Input: oneDParm - Parameter can be defined as codes (integer) or case-insensitive</span>
<span class="sd">           mnemonic string (eg, &quot;Gdalt&quot;)</span>
<span class="sd">    Affects: 1) adds new column to self._dataset with all values Nan, and 2) adds </span>
<span class="sd">    value to end of self._recordSet with value = 1 since 1D parm</span>
<span class="sd">    </span>
<span class="sd">    If these addition makes self._dataset.dtype differ from that in MadrigalCedarFile, appending this</span>
<span class="sd">    MadrigalDataRecord to MadrigalCedarFile will raise an IOError. Also raises error if parm already exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">addParm</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.add2D">
    <p>def <span class="ident">add2D</span>(</p><p>self, twoDParm)</p>
    </div>
    

    
  
    <div class="desc"><p>add2D adds a new two-dim parameter to a MadrigalDataRecord</p>
<p>Input: twoDParm - Parameter can be defined as codes (integer) or case-insensitive
       mnemonic string (eg, "Gdalt")</p>
<p>Affects: 1) adds new column to self._dataset with all values Nan, and 2) adds 
value to end of self._recordSet with value = 2 since 2D parm</p>
<p>If these addition makes self._dataset.dtype differ from that in MadrigalCedarFile, appending this
MadrigalDataRecord to MadrigalCedarFile will raise an IOError. Also raises error if parm already exists.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.add2D', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.add2D" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">twoDParm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;add2D adds a new two-dim parameter to a MadrigalDataRecord</span>
<span class="sd">    Input: twoDParm - Parameter can be defined as codes (integer) or case-insensitive</span>
<span class="sd">           mnemonic string (eg, &quot;Gdalt&quot;)</span>
<span class="sd">    Affects: 1) adds new column to self._dataset with all values Nan, and 2) adds </span>
<span class="sd">    value to end of self._recordSet with value = 2 since 2D parm</span>
<span class="sd">    </span>
<span class="sd">    If these addition makes self._dataset.dtype differ from that in MadrigalCedarFile, appending this</span>
<span class="sd">    MadrigalDataRecord to MadrigalCedarFile will raise an IOError. Also raises error if parm already exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">addParm</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.addParm">
    <p>def <span class="ident">addParm</span>(</p><p>self, newParm, dim)</p>
    </div>
    

    
  
    <div class="desc"><p>addParm adds a new one or two-dim parameter to a MadrigalDataRecord</p>
<p>Input: newParm - Parameter can be defined as codes (integer) or case-insensitive
       mnemonic string (eg, "Gdalt")</p>
<div class="codehilite"><pre><span></span><span class="err">   dim - either 1 for scalar, or 2 for vector parm</span>
</pre></div>


<p>Affects: 1) adds new column to self._dataset with all values Nan, and 2) adds 
value to end of self._recordSet with value = dim</p>
<p>If these addition makes self._dataset.dtype differ from that in MadrigalCedarFile, appending this
MadrigalDataRecord to MadrigalCedarFile will raise an IOError. Also raises error if parm already exists.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.addParm', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.addParm" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">addParm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newParm</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;addParm adds a new one or two-dim parameter to a MadrigalDataRecord</span>
<span class="sd">    Input: newParm - Parameter can be defined as codes (integer) or case-insensitive</span>
<span class="sd">           mnemonic string (eg, &quot;Gdalt&quot;)</span>
<span class="sd">           </span>
<span class="sd">           dim - either 1 for scalar, or 2 for vector parm</span>
<span class="sd">    Affects: 1) adds new column to self._dataset with all values Nan, and 2) adds </span>
<span class="sd">    value to end of self._recordSet with value = dim</span>
<span class="sd">    </span>
<span class="sd">    If these addition makes self._dataset.dtype differ from that in MadrigalCedarFile, appending this</span>
<span class="sd">    MadrigalDataRecord to MadrigalCedarFile will raise an IOError. Also raises error if parm already exists.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;dim must be 1 or 2, not </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">)))</span>
    
    <span class="c1"># see if its an integer</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">newParm</span><span class="p">)</span>
        <span class="n">isInt</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">isInt</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">isInt</span><span class="p">:</span>
        <span class="c1"># try to look up mnemonic</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newParm</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mnem</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">newParm</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Cannot use unknown parm </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newParm</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># this must succeed or an exception raised</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCodeFromMnemonic</span><span class="p">(</span><span class="n">newParm</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Mnem </span><span class="si">%s</span><span class="s1"> not found&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newParm</span><span class="p">))</span>
        <span class="n">mnem</span> <span class="o">=</span> <span class="n">newParm</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c1"># issue warning if an unneeded time parameter being added</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verbose</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">timeParms</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;WARNING: Parameter </span><span class="si">%s</span><span class="s1"> is a time parameter that potentially conflicts with prolog times</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1"># figure out dtype</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmFormat</span><span class="p">(</span><span class="n">mnem</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">format</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span>
        
    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">),),</span> <span class="n">dtype</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">append_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dim</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">append_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">,</span> <span class="n">mnem</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">usemask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">newCedarParm</span> <span class="o">=</span> <span class="n">CedarParameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmCodeFromMnemonic</span><span class="p">(</span><span class="n">mnem</span><span class="p">),</span>
                                  <span class="n">mnem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmDescription</span><span class="p">(</span><span class="n">mnem</span><span class="p">),</span>
                                  <span class="n">isInt</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newCedarParm</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.cmpDataRec">
    <p>def <span class="ident">cmpDataRec</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>cmpDataRec returns a tuple of:
1. 0 if catalog, 1 if header, 2 if data
2.  start datetime
3.  end datetime</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.cmpDataRec', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.cmpDataRec" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">cmpDataRec</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;cmpDataRec returns a tuple of:</span>
<span class="sd">        1. 0 if catalog, 1 if header, 2 if data</span>
<span class="sd">        2.  start datetime</span>
<span class="sd">        3.  end datetime</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># compare record start times</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
        <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">sDT</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="n">typeEnum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">thisType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dataType</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">thisType</span> <span class="o">==</span> <span class="n">dataType</span><span class="p">:</span>
            <span class="n">typeEnum</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">break</span>
        
    <span class="c1"># compare record stop times</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
        <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">eDT</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">return</span><span class="p">((</span><span class="n">typeEnum</span><span class="p">,</span> <span class="n">sDT</span><span class="p">,</span> <span class="n">eDT</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.delete1D">
    <p>def <span class="ident">delete1D</span>(</p><p>self, parm)</p>
    </div>
    

    
  
    <div class="desc"><p>delete1D removes the given 1D parameter from the record</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="err">parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>
</pre></div>


<p>Outputs: None</p>
<p>Raise exception if 1D parm does not exist. If this deletion makes self._dataset.dtype differ from that in 
MadrigalCedarFile, appending this MadrigalDataRecord to MadrigalCedarFile will raise an IOError.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.delete1D', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.delete1D" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">delete1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;delete1D removes the given 1D parameter from the record</span>
<span class="sd">    Inputs:</span>
<span class="sd">        parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Raise exception if 1D parm does not exist. If this deletion makes self._dataset.dtype differ from that in </span>
<span class="sd">    MadrigalCedarFile, appending this MadrigalDataRecord to MadrigalCedarFile will raise an IOError. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make sure this is a one-d parm</span>
    <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 2D, not 1D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span>
    
    <span class="c1"># find index to delete from self._oneDList</span>
    <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parmObj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parmObj</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="n">parm</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Did not find parm </span><span class="si">%s</span><span class="s1"> in self._oneDList&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.delete2DParm">
    <p>def <span class="ident">delete2DParm</span>(</p><p>self, parm)</p>
    </div>
    

    
  
    <div class="desc"><p>delete2DParm removes the given 2D parameter from every row in the record</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="err">parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>
</pre></div>


<p>Outputs: None</p>
<p>Raise exception if 2D parm does not exist. If this deletion makes self._dataset.dtype differ from that in 
MadrigalCedarFile, appending this MadrigalDataRecord to MadrigalCedarFile will raise an IOError.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.delete2DParm', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.delete2DParm" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">delete2DParm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;delete2DParm removes the given 2D parameter from every row in the record</span>
<span class="sd">    Inputs:</span>
<span class="sd">        parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Raise exception if 2D parm does not exist. If this deletion makes self._dataset.dtype differ from that in </span>
<span class="sd">    MadrigalCedarFile, appending this MadrigalDataRecord to MadrigalCedarFile will raise an IOError. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># make sure this is a two-d parm</span>
    <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 1D, not 2D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">recfunctions</span><span class="o">.</span><span class="n">drop_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">,</span> <span class="n">parm</span><span class="p">)</span>
    <span class="c1"># find index to delete from self._twoDList</span>
    <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">parmObj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">parmObj</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="n">parm</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Did not find parm </span><span class="si">%s</span><span class="s1"> in self._twoDList&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.delete2DRows">
    <p>def <span class="ident">delete2DRows</span>(</p><p>self, rows)</p>
    </div>
    

    
  
    <div class="desc"><p>delete2DRows removes the given 2D row or rows in the record (first is row 0)</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="err">row number (integer) or list of row numbers to delete (first is row 0)</span>
</pre></div>


<p>Outputs: None</p>
<p>Raise exception if row does not exist</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.delete2DRows', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.delete2DRows" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">delete2DRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;delete2DRows removes the given 2D row or rows in the record (first is row 0)</span>
<span class="sd">    Inputs:</span>
<span class="sd">        row number (integer) or list of row numbers to delete (first is row 0)</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Raise exception if row does not exist</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make sure row is a list</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">rows</span><span class="p">]</span>
        
    <span class="n">keepIndices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># make sure all rows actually exist</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">keepIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Some row in </span><span class="si">%s</span><span class="s1"> out of range, total number of rows is </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNrow</span><span class="p">()))</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">keepIndices</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.get1D">
    <p>def <span class="ident">get1D</span>(</p><p>self, parm)</p>
    </div>
    

    
  
    <div class="desc"><p>get1D returns the 1D value for a given 1D parameter</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="err">parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>
</pre></div>


<p>Outputs: value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.get1D', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.get1D" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get1D returns the 1D value for a given 1D parameter</span>
<span class="sd">    Inputs:</span>
<span class="sd">        parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>
<span class="sd">    Outputs: value</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1"># make sure this is a one-d parm</span>
    <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">isString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 2D, not 1D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
            
    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># check for special values</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="s1">&#39;missing&#39;</span><span class="p">)</span>
    <span class="c1"># if its an error parameter, allow assumed or knownbad</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed_int</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="s1">&#39;assumed&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad_int</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="s1">&#39;knownbad&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.get1DParms">
    <p>def <span class="ident">get1DParms</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>get1DParms returns a list of 1D parameters in the MadrigalDataRecord.</p>
<p>Inputs: None</p>
<p>Outputs: a list of 1D CedarParameter objects in the MadrigalDataRecord.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.get1DParms', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.get1DParms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get1DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get1DParms returns a list of 1D parameters in the MadrigalDataRecord.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: a list of 1D CedarParameter objects in the MadrigalDataRecord.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.get2D">
    <p>def <span class="ident">get2D</span>(</p><p>self, parm, row)</p>
    </div>
    

    
  
    <div class="desc"><p>get2D returns the 2D value for a given 2D parameter</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">parm</span> <span class="o">-</span> <span class="n">can</span> <span class="n">be</span> <span class="k">defined</span> <span class="k">as</span> <span class="n">code</span> <span class="p">(</span><span class="nb">integer</span><span class="p">)</span> <span class="k">or</span> <span class="k">case</span><span class="o">-</span><span class="k">insensitive</span> <span class="n">mnemonic</span> <span class="n">string</span> <span class="p">(</span><span class="n">eg</span><span class="p">,</span> <span class="ss">&quot;Gdalt&quot;</span><span class="p">)</span>

<span class="k">row</span> <span class="o">-</span> <span class="k">row</span> <span class="nb">number</span> <span class="k">to</span> <span class="k">get</span> <span class="k">data</span><span class="p">.</span>  <span class="n">Starts</span> <span class="k">at</span> <span class="mi">0</span><span class="p">.</span>
</pre></div>


<p>Outputs: double value, or the strings "missing", "assumed", or "knownbad"</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.get2D', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.get2D" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get2D returns the 2D value for a given 2D parameter</span>
<span class="sd">    Inputs:</span>
<span class="sd">        parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>
<span class="sd">        row - row number to get data.  Starts at 0.</span>
<span class="sd">    Outputs: double value, or the strings &quot;missing&quot;, &quot;assumed&quot;, or &quot;knownbad&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span> <span class="ow">or</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal value of row </span><span class="si">%i</span><span class="s1"> with nrow = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)))</span>
    
    <span class="c1"># make sure this is a two-d parm</span>
    <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">isString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 1D, not 2D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
            
    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">row</span><span class="p">]</span>
    <span class="c1"># check for special values</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="s1">&#39;missing&#39;</span><span class="p">)</span>
    <span class="c1"># if its an error parameter, allow assumed or knownbad</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed_int</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="s1">&#39;assumed&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad_int</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="s1">&#39;knownbad&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.get2DParms">
    <p>def <span class="ident">get2DParms</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>get2DParms returns a list of 2D parameters in the MadrigalDataRecord.</p>
<p>Inputs: None</p>
<p>Outputs: a list of 2D CedarParameter objects in the MadrigalDataRecord. Includes
    both independent and dependent parms.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.get2DParms', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.get2DParms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get2DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;get2DParms returns a list of 2D parameters in the MadrigalDataRecord.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: a list of 2D CedarParameter objects in the MadrigalDataRecord. Includes</span>
<span class="sd">        both independent and dependent parms.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getDType">
    <p>def <span class="ident">getDType</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getDType returns the dtype of the table array with this data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getDType', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getDType" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getDType returns the dtype of the table array with this data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getDataset">
    <p>def <span class="ident">getDataset</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getDataset returns the dataset table</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getDataset', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getDataset" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getDataset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getDataset returns the dataset table</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getEndDatetime">
    <p>def <span class="ident">getEndDatetime</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getEndDatetime returns a end record datetime</p>
<p>Inputs: None</p>
<p>Outputs: a datetime.datetime object representing the end time of the record</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getEndDatetime', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getEndDatetime" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getEndDatetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getEndDatetime returns a end record datetime</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: a datetime.datetime object representing the end time of the record</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getEndTimeList">
    <p>def <span class="ident">getEndTimeList</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getEndTimeList returns a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec</p>
<p>Inputs: None</p>
<p>Outputs: a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getEndTimeList', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getEndTimeList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getEndTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getEndTimeList returns a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">endDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
    <span class="k">return</span><span class="p">((</span><span class="n">endDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">endDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">endDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> 
            <span class="n">endDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">endDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">endDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">endDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mf">1.0E4</span><span class="p">)))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getHeaderKodLines">
    <p>def <span class="ident">getHeaderKodLines</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getHeaderKodLines creates the lines in the Madrigal header record that start KOD and describe parms</p>
<p>Inputs: None</p>
<p>Returns: a string of length 80*num parms.  Each 80 characters contains a description
         of a single parm accodring to the Cedar Standard</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getHeaderKodLines', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getHeaderKodLines" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getHeaderKodLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getHeaderKodLines creates the lines in the Madrigal header record that start KOD and describe parms</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Returns: a string of length 80*num parms.  Each 80 characters contains a description</span>
<span class="sd">             of a single parm accodring to the Cedar Standard</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create a list of oneDCedar codes for the data record.</span>
    <span class="c1">#  Each item has three elements: (code, parameter description, units)</span>
    <span class="n">oneDCedarCodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
        <span class="n">oneDCedarCodes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">)))</span>
    
    <span class="n">oneDCedarCodes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">compareParms</span><span class="p">)</span>
    <span class="c1"># create a list of twoDCedar codes for the data record.</span>
    <span class="c1"># Each item has three elements: (code, parameter description, units)</span>
    <span class="n">twoDCedarCodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
        <span class="n">twoDCedarCodes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">parm</span><span class="o">.</span><span class="n">code</span><span class="p">)))</span>
        
    <span class="n">twoDCedarCodes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">compareParms</span><span class="p">)</span>
    
    <span class="c1"># write out lines - one D</span>
    <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oneDCedarCodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;C 1D Parameters:&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;C 1D Parameters:&#39;</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oneDCedarCodes</span><span class="p">)):</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">oneDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">oneDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">oneDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;KODS(</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">codeNum</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="n">codeNum</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">codeNum</span><span class="p">))</span><span class="o">*</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">codeNum</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">codeNum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">48</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">desc</span><span class="p">[:</span><span class="mi">48</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">desc</span> <span class="o">+</span> <span class="p">(</span><span class="mi">49</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">))</span><span class="o">*</span> <span class="s1">&#39; &#39;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">desc</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">units</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">line</span>
    <span class="c1"># two D</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">twoDCedarCodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;C 2D Parameters:&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;C 2D Parameters:&#39;</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">twoDCedarCodes</span><span class="p">)):</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">twoDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="n">twoDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">twoDCedarCodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;KODM(</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">codeNum</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="n">codeNum</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">codeNum</span><span class="p">))</span><span class="o">*</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">codeNum</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">codeNum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">48</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">desc</span><span class="p">[:</span><span class="mi">48</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">desc</span> <span class="o">+</span> <span class="p">(</span><span class="mi">49</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">desc</span><span class="p">))</span><span class="o">*</span> <span class="s1">&#39; &#39;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">desc</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">[:</span><span class="mi">10</span><span class="p">]))</span><span class="o">*</span><span class="s1">&#39; &#39;</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="n">units</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="n">line</span>
    <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getInd2DParms">
    <p>def <span class="ident">getInd2DParms</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getInd2DParms returns a list of the subset 2D parameters ithat are independent parmeters.</p>
<p>Inputs: None</p>
<p>Outputs: a list of independent 2D CedarParameter objects in the MadrigalDataRecord.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getInd2DParms', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getInd2DParms" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getInd2DParms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getInd2DParms returns a list of the subset 2D parameters ithat are independent parmeters.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: a list of independent 2D CedarParameter objects in the MadrigalDataRecord. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getKindat">
    <p>def <span class="ident">getKindat</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getKindat returns the kind of data code (int) for a given data record.</p>
<p>Inputs: None</p>
<p>Outputs: the kind of data code (int) for a given data record.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getKindat', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getKindat" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getKindat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getKindat returns the kind of data code (int) for a given data record.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: the kind of data code (int) for a given data record.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getKinst">
    <p>def <span class="ident">getKinst</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getKinst returns the kind of instrument code (int) for a given data record.</p>
<p>Inputs: None</p>
<p>Outputs: the kind of instrument code (int) for a given data record.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getKinst', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getKinst" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getKinst returns the kind of instrument code (int) for a given data record.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: the kind of instrument code (int) for a given data record.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getNrow">
    <p>def <span class="ident">getNrow</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getNrow returns the number of 2D data rows (int) for a given data record.</p>
<p>Inputs: None</p>
<p>Outputs: the number of 2D data rows.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getNrow', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getNrow" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getNrow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getNrow returns the number of 2D data rows (int) for a given data record.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: the number of 2D data rows.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getParmDim">
    <p>def <span class="ident">getParmDim</span>(</p><p>self, parm)</p>
    </div>
    

    
  
    <div class="desc"><p>getParmDim returns the dimension (1, 2, or 3 for independent spatial parm) of a given parm mnemonic</p>
<p>Raise KeyError if that parameter not found in file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getParmDim', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getParmDim" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getParmDim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getParmDim returns the dimension (1, 2, or 3 for independent spatial parm) of a given parm mnemonic</span>
<span class="sd">    </span>
<span class="sd">    Raise KeyError if that parameter not found in file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oneDList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># do ind 2D next since they are in both lists</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twoDList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">mnemonic</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in data&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getRecDType">
    <p>def <span class="ident">getRecDType</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getRecDType returns the dtype of _record_array</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getRecDType', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getRecDType" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getRecDType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getRecDType returns the dtype of _record_array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getRecno">
    <p>def <span class="ident">getRecno</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getRecno returns the recno (int) for a given data record.</p>
<p>Inputs: None</p>
<p>Outputs: the recno (int) for a given data record. May be 0 if not yet in a file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getRecno', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getRecno" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getRecno</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getRecno returns the recno (int) for a given data record.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: the recno (int) for a given data record. May be 0 if not yet in a file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getRecordset">
    <p>def <span class="ident">getRecordset</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getRecordset returns the recordSet table</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getRecordset', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getRecordset" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getRecordset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getRecordset returns the recordSet table</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getRow">
    <p>def <span class="ident">getRow</span>(</p><p>self, row)</p>
    </div>
    

    
  
    <div class="desc"><p>getRow returns the row of data in order defined in self._dataset.dtype</p>
<p>Input: row number</p>
<p>IndexError raised if not a valid row index</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getRow', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getRow" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getRow returns the row of data in order defined in self._dataset.dtype</span>
<span class="sd">    </span>
<span class="sd">    Input: row number</span>
<span class="sd">    </span>
<span class="sd">    IndexError raised if not a valid row index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getStartDatetime">
    <p>def <span class="ident">getStartDatetime</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getStartDatetime returns a start record datetime</p>
<p>Inputs: None</p>
<p>Outputs: a datetime.datetime object representing the start time of the record</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getStartDatetime', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getStartDatetime" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getStartDatetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getStartDatetime returns a start record datetime</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: a datetime.datetime object representing the start time of the record</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getStartTimeList">
    <p>def <span class="ident">getStartTimeList</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getStartTimeList returns a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec</p>
<p>Inputs: None</p>
<p>Outputs: a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getStartTimeList', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getStartTimeList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getStartTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getStartTimeList returns a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">startDT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
    <span class="k">return</span><span class="p">((</span><span class="n">startDT</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">startDT</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">startDT</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> 
            <span class="n">startDT</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">startDT</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="n">startDT</span><span class="o">.</span><span class="n">second</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">startDT</span><span class="o">.</span><span class="n">microsecond</span><span class="o">/</span><span class="mf">1.0E4</span><span class="p">)))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getStrLen">
    <p>def <span class="ident">getStrLen</span>(</p><p>self, parm)</p>
    </div>
    

    
  
    <div class="desc"><p>getStrLen returns True if this parm (mnemonic) is integer type, False if float or string</p>
<p>Raises ValueError is parm not in record, or is not String</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getStrLen', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getStrLen" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getStrLen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getStrLen returns True if this parm (mnemonic) is integer type, False if float or string</span>
<span class="sd">    </span>
<span class="sd">    Raises ValueError is parm not in record, or is not String</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not string type&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">itemsize</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.getType">
    <p>def <span class="ident">getType</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>returns the type 'data'</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.getType', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.getType" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns the type &#39;data&#39;&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;data&#39;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.parmIsInt">
    <p>def <span class="ident">parmIsInt</span>(</p><p>self, parm)</p>
    </div>
    

    
  
    <div class="desc"><p>parmIsInt returns True if this parm (mnemonic) is integer type, False if float or string</p>
<p>Raises ValueError if parm not in record</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.parmIsInt', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.parmIsInt" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parmIsInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;parmIsInt returns True if this parm (mnemonic) is integer type, False if float or string</span>
<span class="sd">    </span>
<span class="sd">    Raises ValueError if parm not in record</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">typeStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">typeStr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.parmIsString">
    <p>def <span class="ident">parmIsString</span>(</p><p>self, parm)</p>
    </div>
    

    
  
    <div class="desc"><p>parmIsString returns True if this parm (mnemonic) is String type, False if float or int</p>
<p>Raises ValueError is parm not in record</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.parmIsString', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.parmIsString" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">parmIsString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;parmIsString returns True if this parm (mnemonic) is String type, False if float or int</span>
<span class="sd">    </span>
<span class="sd">    Raises ValueError is parm not in record</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">typeStr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">parm</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">kind</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parm &lt;</span><span class="si">%s</span><span class="s1">&gt; not found in file&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">typeStr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.set1D">
    <p>def <span class="ident">set1D</span>(</p><p>self, parm, valueIn)</p>
    </div>
    

    
  
    <div class="desc"><p>set1D sets a 1D value for a given 1D parameter</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">parm</span> <span class="o">-</span> <span class="n">can</span> <span class="n">be</span> <span class="k">defined</span> <span class="k">as</span> <span class="n">code</span> <span class="p">(</span><span class="nb">integer</span><span class="p">)</span> <span class="k">or</span> <span class="k">case</span><span class="o">-</span><span class="k">insensitive</span> <span class="n">mnemonic</span> <span class="n">string</span> <span class="p">(</span><span class="n">eg</span><span class="p">,</span> <span class="ss">&quot;Gdalt&quot;</span><span class="p">)</span>


<span class="n">valueIn</span> <span class="o">-</span> <span class="n">double</span> <span class="p">(</span><span class="k">or</span> <span class="n">string</span> <span class="n">convertable</span> <span class="k">to</span> <span class="n">double</span><span class="p">)</span> <span class="n">value</span> <span class="k">to</span> <span class="k">set</span> <span class="mi">1</span><span class="n">D</span> <span class="k">parameter</span> <span class="k">to</span><span class="p">.</span>  <span class="k">To</span> <span class="k">set</span> <span class="n">special</span> <span class="n">Cedar</span> <span class="k">values</span><span class="p">,</span> <span class="n">the</span> <span class="k">global</span> <span class="k">values</span>
        <span class="n">missing</span><span class="p">,</span> <span class="n">assumed</span><span class="p">,</span> <span class="k">or</span> <span class="n">knownbad</span> <span class="n">may</span> <span class="n">be</span> <span class="n">used</span><span class="p">,</span> <span class="k">or</span> <span class="n">the</span> <span class="n">strings</span> <span class="ss">&quot;missing&quot;</span><span class="p">,</span> <span class="ss">&quot;assumed&quot;</span><span class="p">,</span> <span class="k">or</span> <span class="ss">&quot;knownbad&quot;</span>
        <span class="n">May</span> <span class="n">also</span> <span class="n">be</span> <span class="nb">int</span> <span class="k">or</span> <span class="n">string</span> <span class="k">if</span> <span class="n">that</span> <span class="k">type</span>
</pre></div>


<p>Outputs: None</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.set1D', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.set1D" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">,</span> <span class="n">valueIn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;set1D sets a 1D value for a given 1D parameter</span>
<span class="sd">    Inputs:</span>
<span class="sd">        parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>
<span class="sd">        valueIn - double (or string convertable to double) value to set 1D parameter to.  To set special Cedar values, the global values</span>
<span class="sd">                missing, assumed, or knownbad may be used, or the strings &quot;missing&quot;, &quot;assumed&quot;, or &quot;knownbad&quot;</span>
<span class="sd">                May also be int or string if that type</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c1"># avoid numpy / python disagreement when comparing strings/arrays</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">valueIn</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">str_</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">valueIn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">valueIn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">valueIn</span>
        
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;missing&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_int</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStrLen</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing</span>
        
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;assumed&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed_int</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;knownbad&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad_int</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad</span>
    <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;assumed&#39;</span><span class="p">,</span> <span class="s1">&#39;knownbad&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;It is illegal to set the non-error parm </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
    <span class="c1"># make sure this is a one-d parm</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 2D, not 1D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    
    <span class="c1"># set it</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.set2D">
    <p>def <span class="ident">set2D</span>(</p><p>self, parm, row, valueIn)</p>
    </div>
    

    
  
    <div class="desc"><p>set2D sets a 2D value for a given 2D parameter and row</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">parm</span> <span class="o">-</span> <span class="n">can</span> <span class="n">be</span> <span class="k">defined</span> <span class="k">as</span> <span class="n">code</span> <span class="p">(</span><span class="nb">integer</span><span class="p">)</span> <span class="k">or</span> <span class="k">case</span><span class="o">-</span><span class="k">insensitive</span> <span class="n">mnemonic</span> <span class="n">string</span> <span class="p">(</span><span class="n">eg</span><span class="p">,</span> <span class="ss">&quot;Gdalt&quot;</span><span class="p">)</span>

<span class="k">row</span> <span class="o">-</span> <span class="k">row</span> <span class="nb">number</span> <span class="k">to</span> <span class="k">set</span> <span class="k">data</span><span class="p">.</span>  <span class="n">Starts</span> <span class="k">at</span> <span class="mi">0</span><span class="p">.</span>

<span class="n">valueIn</span> <span class="o">-</span> <span class="n">double</span> <span class="p">(</span><span class="k">or</span> <span class="n">string</span> <span class="n">convertable</span> <span class="k">to</span> <span class="n">double</span><span class="p">)</span> <span class="n">value</span> <span class="k">to</span> <span class="k">set</span> <span class="mi">2</span><span class="n">D</span> <span class="k">parameter</span> <span class="k">to</span><span class="p">.</span> <span class="k">To</span> <span class="k">set</span> <span class="n">special</span> <span class="n">Cedar</span> <span class="k">values</span><span class="p">,</span> <span class="n">the</span> <span class="k">global</span> <span class="k">values</span>
        <span class="n">missing</span><span class="p">,</span> <span class="n">assumed</span><span class="p">,</span> <span class="k">or</span> <span class="n">knownbad</span> <span class="n">may</span> <span class="n">be</span> <span class="n">used</span><span class="p">,</span> <span class="k">or</span> <span class="n">the</span> <span class="n">strings</span> <span class="ss">&quot;missing&quot;</span><span class="p">,</span> <span class="ss">&quot;assumed&quot;</span><span class="p">,</span> <span class="k">or</span> <span class="ss">&quot;knownbad&quot;</span>
        <span class="n">May</span> <span class="n">also</span> <span class="n">be</span> <span class="nb">int</span> <span class="k">or</span> <span class="n">string</span> <span class="k">if</span> <span class="n">that</span> <span class="k">type</span>
</pre></div>


<p>Outputs: None</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.set2D', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.set2D" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">valueIn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;set2D sets a 2D value for a given 2D parameter and row</span>
<span class="sd">    Inputs:</span>
<span class="sd">        parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>
<span class="sd">        row - row number to set data.  Starts at 0.</span>
<span class="sd">        valueIn - double (or string convertable to double) value to set 2D parameter to. To set special Cedar values, the global values</span>
<span class="sd">                missing, assumed, or knownbad may be used, or the strings &quot;missing&quot;, &quot;assumed&quot;, or &quot;knownbad&quot;</span>
<span class="sd">                May also be int or string if that type</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)</span> <span class="ow">or</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal value of row </span><span class="si">%i</span><span class="s1"> with nrow = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">)))</span>
    
    <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">isString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
    
    <span class="c1"># avoid numpy / python disagreement when comparing strings</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">valueIn</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">str_</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">valueIn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">valueIn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">valueIn</span>
    
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;missing&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_int</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsString</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStrLen</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing</span>
        
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isError</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;assumed&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed_int</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assumed</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;knownbad&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parmIsInt</span><span class="p">(</span><span class="n">parm</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad_int</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knownbad</span>
    <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;assumed&#39;</span><span class="p">,</span> <span class="s1">&#39;knownbad&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;It is illegal to set the non-error parm </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
    <span class="c1"># make sure this is a two-d parm</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 1D, not 2D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    
    <span class="c1"># if its ind parm, make sure its not nan</span>
    <span class="k">if</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set ind parm </span><span class="si">%s</span><span class="s1"> to nan at row </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
    
    
    <span class="c1"># set it</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.set2DParmValues">
    <p>def <span class="ident">set2DParmValues</span>(</p><p>self, parm, values)</p>
    </div>
    

    
  
    <div class="desc"><p>set2DParmValues sets all 2D value in all rows for a given 2D parameter</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">parm</span> <span class="o">-</span> <span class="n">can</span> <span class="n">be</span> <span class="k">defined</span> <span class="k">as</span> <span class="n">code</span> <span class="p">(</span><span class="nb">integer</span><span class="p">)</span> <span class="k">or</span> <span class="k">case</span><span class="o">-</span><span class="k">insensitive</span> <span class="n">mnemonic</span> <span class="n">string</span> <span class="p">(</span><span class="n">eg</span><span class="p">,</span> <span class="ss">&quot;Gdalt&quot;</span><span class="p">)</span>

<span class="n">value</span> <span class="o">-</span> <span class="n">list</span><span class="p">,</span> <span class="n">tuple</span><span class="p">,</span> <span class="k">or</span> <span class="n">numpy</span> <span class="nb">array</span> <span class="k">of</span> <span class="n">int64</span> <span class="k">or</span> <span class="n">float64</span> <span class="k">type</span><span class="p">.</span>  <span class="n">Must</span> <span class="k">match</span> <span class="n">len</span> <span class="k">of</span> <span class="n">nrows</span><span class="p">.</span>  <span class="k">User</span> <span class="k">is</span> <span class="n">responsible</span>
    <span class="k">for</span> <span class="k">having</span> <span class="k">set</span> <span class="k">all</span> <span class="n">special</span> <span class="k">values</span> <span class="k">to</span> <span class="n">missing</span><span class="p">,</span> <span class="n">assumed</span> <span class="k">and</span> <span class="n">knownbad</span> <span class="k">as</span> <span class="k">defined</span> <span class="k">at</span> <span class="n">top</span>
    <span class="k">of</span> <span class="n">this</span> <span class="k">class</span> <span class="k">for</span> <span class="n">either</span> <span class="n">ints</span> <span class="k">or</span> <span class="n">floats</span>
</pre></div>


<p>Outputs: None</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.set2DParmValues', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.set2DParmValues" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set2DParmValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;set2DParmValues sets all 2D value in all rows for a given 2D parameter</span>
<span class="sd">    Inputs:</span>
<span class="sd">        parm - can be defined as code (integer) or case-insensitive mnemonic string (eg, &quot;Gdalt&quot;)</span>
<span class="sd">        value - list, tuple, or numpy array of int64 or float64 type.  Must match len of nrows.  User is responsible</span>
<span class="sd">            for having set all special values to missing, assumed and knownbad as defined at top</span>
<span class="sd">            of this class for either ints or floats</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make sure this is a two-d parm</span>
    <span class="n">parm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">getParmMnemonic</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">isString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recordSet</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;parm </span><span class="si">%s</span><span class="s1"> is 1D, not 2D&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parm</span><span class="p">)))</span>
    
    <span class="k">if</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind2DList</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isString</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set any ind parm </span><span class="si">%s</span><span class="s1"> value to nan: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parm</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">)))</span>
    
    <span class="c1"># set it</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.setEndTimeList">
    <p>def <span class="ident">setEndTimeList</span>(</p><p>self, eYear, eMonth, eDay, eHour, eMin, eSec, eCentisec=0)</p>
    </div>
    

    
  
    <div class="desc"><p>setEndTimeList changes the data record end time</p>
<p>Inputs: integers eYear, eMonth, eDay, eHour, eMin, eSec. eCentisec defaults to 0</p>
<p>Outputs: None</p>
<p>Affects: changes self._dataset fields ut2_unix, year, month, day, hour, min,sec</p>
<p>Prints warning if new start time after present end time</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.setEndTimeList', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.setEndTimeList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setEndTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="n">eCentisec</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setEndTimeList changes the data record end time</span>
<span class="sd">    Inputs: integers eYear, eMonth, eDay, eHour, eMin, eSec. eCentisec defaults to 0</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: changes self._dataset fields ut2_unix, year, month, day, hour, min,sec</span>
<span class="sd">    Prints warning if new start time after present end time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check validity of input time</span>
    <span class="n">eCentisec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">eCentisec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">eCentisec</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">eCentisec</span> <span class="o">&gt;</span> <span class="mi">99</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal eCentisec </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">eCentisec</span><span class="p">))</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">eCentisec</span><span class="o">*</span><span class="mf">1E4</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal datetime </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="n">eCentisec</span><span class="p">))))</span>
    <span class="k">if</span> <span class="n">eDT</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">():</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: New ending time </span><span class="si">%s</span><span class="s1"> before present starting time </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">eDT</span><span class="p">),</span> 
                                                                                            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">())))</span>
        
    <span class="n">ut2_unix</span> <span class="o">=</span> <span class="p">(</span><span class="n">eDT</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut2_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut2_unix</span>
    
    <span class="c1"># need to reset average time</span>
    <span class="n">aveDT</span> <span class="o">=</span> <span class="n">eDT</span> <span class="o">-</span> <span class="p">(</span><span class="n">eDT</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">())</span><span class="o">/</span><span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">year</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">month</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">day</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">hour</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">minute</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;sec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">second</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.setKindat">
    <p>def <span class="ident">setKindat</span>(</p><p>self, newKindat)</p>
    </div>
    

    
  
    <div class="desc"><p>setKindat sets the kind of data code (int) for a given data record.</p>
<p>Inputs: newKindat (integer)</p>
<p>Outputs: None</p>
<p>Affects: sets self._dataset['kindat']</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.setKindat', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.setKindat" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setKindat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newKindat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setKindat sets the kind of data code (int) for a given data record.</span>
<span class="sd">    Inputs: newKindat (integer)</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: sets self._dataset[&#39;kindat&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">newKindat</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kindat cannot be negative: </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newKindat</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kindat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">newKindat</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.setKinst">
    <p>def <span class="ident">setKinst</span>(</p><p>self, newKinst)</p>
    </div>
    

    
  
    <div class="desc"><p>setKinst sets the kind of instrument code (int) for a given data record.</p>
<p>Inputs: newKinst - new instrument code (integer)</p>
<p>Outputs: None</p>
<p>Affects: sets self._dataset['kinst']</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.setKinst', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.setKinst" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newKinst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setKinst sets the kind of instrument code (int) for a given data record.</span>
<span class="sd">    Inputs: newKinst - new instrument code (integer)</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: sets self._dataset[&#39;kinst&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newKinst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">newKinst</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">newKinst</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Kinst must not be less than 0, not </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newKinst</span><span class="p">))</span>
    <span class="c1"># verify  and set kinst</span>
    <span class="n">instList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentList</span><span class="p">()</span>
    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">inst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">newKinst</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="s1">&#39;Unknown instrument&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: kinst </span><span class="si">%i</span><span class="s1"> not found in instTab.txt</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newKinst</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;kinst&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newKinst</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.setRecno">
    <p>def <span class="ident">setRecno</span>(</p><p>self, newRecno)</p>
    </div>
    

    
  
    <div class="desc"><p>setRecno sets the recno (int) for a given data record.</p>
<p>Inputs: newRecno (integer)</p>
<p>Outputs: None</p>
<p>Affects: sets self._dataset['recno']</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.setRecno', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.setRecno" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setRecno</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newRecno</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setRecno sets the recno (int) for a given data record.</span>
<span class="sd">    Inputs: newRecno (integer)</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: sets self._dataset[&#39;recno&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">newRecno</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;recno cannot be negative: </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">newRecno</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;recno&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">newRecno</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.setRow">
    <p>def <span class="ident">setRow</span>(</p><p>self, row, values)</p>
    </div>
    

    
  
    <div class="desc"><p>setRow sets an entire row of data at once</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="k">row</span> <span class="o">-</span> <span class="k">row</span> <span class="nb">number</span> <span class="k">to</span> <span class="k">set</span>

<span class="k">values</span> <span class="o">-</span> <span class="n">a</span> <span class="n">tuple</span> <span class="k">of</span> <span class="k">values</span> <span class="k">in</span> <span class="n">the</span> <span class="k">right</span> <span class="n">format</span> <span class="k">to</span> <span class="k">match</span> <span class="k">self</span><span class="p">.</span><span class="n">_dataset</span><span class="p">.</span><span class="n">dtype</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.setRow', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.setRow" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setRow sets an entire row of data at once</span>
<span class="sd">    </span>
<span class="sd">    Inputs:</span>
<span class="sd">    </span>
<span class="sd">        row - row number to set</span>
<span class="sd">        </span>
<span class="sd">        values - a tuple of values in the right format to match self._dataset.dtype</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalDataRecord.setStartTimeList">
    <p>def <span class="ident">setStartTimeList</span>(</p><p>self, sYear, sMonth, sDay, sHour, sMin, sSec, sCentisec=0)</p>
    </div>
    

    
  
    <div class="desc"><p>setStartTimeList changes the data record start time</p>
<p>Inputs: integers sYear, sMonth, sDay, sHour, sMin, sSec. sCentisec defaults to 0</p>
<p>Outputs: None</p>
<p>Affects: changes self._dataset fields ut1_unix, year, month, day, hour, min,sec</p>
<p>Prints warning if new start time after present end time</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalDataRecord.setStartTimeList', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalDataRecord.setStartTimeList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setStartTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="n">sCentisec</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setStartTimeList changes the data record start time</span>
<span class="sd">    Inputs: integers sYear, sMonth, sDay, sHour, sMin, sSec. sCentisec defaults to 0</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: changes self._dataset fields ut1_unix, year, month, day, hour, min,sec</span>
<span class="sd">    Prints warning if new start time after present end time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check validity of input time</span>
    <span class="n">sCentisec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sCentisec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sCentisec</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">sCentisec</span> <span class="o">&gt;</span> <span class="mi">99</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal sCentisec </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sCentisec</span><span class="p">))</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sCentisec</span><span class="o">*</span><span class="mf">1E4</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal datetime </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="n">sCentisec</span><span class="p">))))</span>
    <span class="k">if</span> <span class="n">sDT</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">():</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: New starting time </span><span class="si">%s</span><span class="s1"> after present ending time </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sDT</span><span class="p">),</span> 
                                                                                           <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">())))</span>
        
    <span class="n">ut1_unix</span> <span class="o">=</span> <span class="p">(</span><span class="n">sDT</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut1_unix</span>
    
    <span class="c1"># need to reset average time</span>
    <span class="n">aveDT</span> <span class="o">=</span> <span class="n">sDT</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span> <span class="o">-</span> <span class="n">sDT</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">year</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">month</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">day</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">hour</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">minute</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s1">&#39;sec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aveDT</span><span class="o">.</span><span class="n">second</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="madrigal.cedar.MadrigalHeaderRecord" class="name">class <span class="ident">MadrigalHeaderRecord</span></p>
      
  
    <div class="desc"><p>MadrigalHeaderRecord holds all the information in a Cedar header record.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MadrigalHeaderRecord</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;MadrigalHeaderRecord holds all the information in a Cedar header record.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kinst</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">kindat</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sYear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sMonth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sDay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">sHour</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sSec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sCentisec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">eYear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eMonth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eDay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">eHour</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eSec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eCentisec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">jpar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mpar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">text</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">madInstObj</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">madKindatObj</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">expNotesLines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;__init__ creates a MadrigalCatalogRecord.</span>
<span class="sd">        </span>
<span class="sd">        Note: all inputs have default values because there are two ways to populate this structure:</span>
<span class="sd">        1) with all inputs from kinst to text when new data is being created, or </span>
<span class="sd">        2) with catalog line list from existing Hdf5 file Experiment Notes metadata, plus non-default inputs</span>

<span class="sd">        Inputs:</span>

<span class="sd">            kinst - the kind of instrument code.  A warning will be raised if not in instTab.txt.</span>

<span class="sd">            kindat - kind of data code. Must be a non-negative integer.</span>

<span class="sd">            sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - experiment start time. sCentisec must be 0-99</span>

<span class="sd">            eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - experiment end time. eCentisec must be 0-99</span>

<span class="sd">            jpar - the number of 1d parameters in the following data records</span>

<span class="sd">            mpar - the number of 2d parameters in the following data records</span>

<span class="sd">            text - string containing text in catalog record.  Length must be divisible by 80.  No linefeeds</span>
<span class="sd">                   allowed.</span>

<span class="sd">            madInstObj - a madrigal.metadata.MadrigalInstrument object.  If None, one will be created.</span>
<span class="sd">                              Used to verify kinst.</span>
<span class="sd">                              </span>
<span class="sd">            madKindatObj - a madrigal.metadata.MadrigalKindat onject. If none, one will be created.</span>
<span class="sd">                            Used to verify kindat.</span>
<span class="sd">                              </span>
<span class="sd">            expNotesList - a list of all lines in an existing header section in &quot;Experiment Notes&quot; </span>
<span class="sd">                metadata table.  All the above attributes are parsed from these lines.</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create any needed Madrigal objects, if not passed in</span>
        <span class="k">if</span> <span class="n">madInstObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalInstrument</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madInstObj</span>
        <span class="k">if</span> <span class="n">madKindatObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalKindat</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span> <span class="o">=</span> <span class="n">madKindatObj</span>
            
        <span class="k">if</span> <span class="n">expNotesLines</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get all information from this dataset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parseExpNotesLines</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kinst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># kinst set via header record overrides kinst argument</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
        <span class="c1"># verify kinst set, or raise error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kinst not set when MadrigalHeaderRecord created - required&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kindat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># kindat set via header record overrides kindat argument</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getKindat</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setKindat</span><span class="p">(</span><span class="n">kindat</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                              <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">jpar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setJpar</span><span class="p">(</span><span class="n">jpar</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mpar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMpar</span><span class="p">(</span><span class="n">mpar</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        
    <span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the type &#39;header&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;header&#39;</span>


    

    <span class="k">def</span> <span class="nf">getKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKinst returns the kind of instrument code (int) for a given header record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the kind of instrument code (int) for a given header record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">setKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kinst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setKinst sets the kind of instrument code (int) for a given header record.</span>

<span class="sd">        Inputs: kind of instrument code (integer)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets the kind of instrument code (int) (self._kinst) for a given header record.</span>
<span class="sd">        Prints warning if kinst not found in instTab.txt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kinst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
        <span class="c1"># verify  and set kinst</span>
        <span class="n">instList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentList</span><span class="p">()</span>
        <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">kinst</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="s1">&#39;Unknown instrument&#39;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: kinst </span><span class="si">%i</span><span class="s1"> not found in instTab.txt</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kinst</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span> <span class="o">=</span> <span class="n">kinst</span>


    <span class="k">def</span> <span class="nf">getKindat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getKindat returns the kind of data code (int) for a given header record.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the kind of data code (int) for a given header record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">setKindat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kindat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setKindat sets the mode of kind of data code (int) for a given header record.</span>

<span class="sd">        Inputs: the kind of data code (int)</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets the kind of data code (int) (self._kindat)</span>

<span class="sd">        Exceptions: Raises ValueError if kindat less than 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kindat</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kindat must not be less than 0, not </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getText returns the header text.</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: the header text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getTextLineCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getTextLineCount returns the number of 80 character lines in self._text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)))</span>
    

    <span class="k">def</span> <span class="nf">setText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setText sets the header text.</span>

<span class="sd">        Inputs: text: text to be set.  Must be length divisible by 80, and not contain line feeds.</span>
<span class="sd">        For now, must not exceed 2^16 - 80 bytes to be able to be handled by Cedar format.</span>

<span class="sd">        Outputs: None.</span>

<span class="sd">        Affects: sets self._text</span>

<span class="sd">        Raises TypeError if problem with text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">textTypes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">textTypes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text must be of type string&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text length must be divisible by 80: len is </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text must not contain linefeed character&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">65536</span> <span class="o">-</span> <span class="mi">80</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text exceeds ability of Cedar format to store&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">text</span>


    <span class="k">def</span> <span class="nf">getJpar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns the number of one-dimensional parameters in the associated data records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jpar</span>


    <span class="k">def</span> <span class="nf">setJpar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jpar</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set the number of one-dimensional parameters in the associated data records.</span>

<span class="sd">        Must not be negative.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_jpar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">jpar</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jpar</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;jpar must not be less than 0&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getMpar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns the number of two-dimensional parameters in the associated data records.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpar</span>
        

    <span class="k">def</span> <span class="nf">setMpar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mpar</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set the number of two-dimensional parameters in the associated data records.</span>

<span class="sd">        Must not be negative.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mpar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mpar</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpar</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;mpar must not be less than 0&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">getStartTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getStartTimeList returns a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">getEndTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getEndTimeList returns a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec</span>

<span class="sd">        Inputs: None</span>

<span class="sd">        Outputs: a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span><span class="p">))</span>
        
        
    <span class="k">def</span> <span class="nf">getLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getLines returns a numpy recarray of the format expected by the &quot;Experiment Notes&quot; dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># templates</span>
        <span class="n">krechStr</span> <span class="o">=</span> <span class="s1">&#39;KRECH               3002 Header Record, Version 3&#39;</span>
        <span class="n">kinstTempStr</span> <span class="o">=</span> <span class="s1">&#39;KINST     </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="n">kindatTempStr</span> <span class="o">=</span> <span class="s1">&#39;KINDAT    </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="n">byearTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBYRT               </span><span class="si">%04i</span><span class="s1"> Beginning year&#39;</span>
        <span class="n">bmdTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBDTT               </span><span class="si">%04i</span><span class="s1"> Beginning month and day&#39;</span>
        <span class="n">bhmTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBHMT               </span><span class="si">%04i</span><span class="s1"> Beginning UT hour and minute&#39;</span>
        <span class="n">bcsTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBCST               </span><span class="si">%04i</span><span class="s1"> Beginning centisecond&#39;</span>
        <span class="n">eyearTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEYRT               </span><span class="si">%04i</span><span class="s1"> Ending year&#39;</span>
        <span class="n">emdTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEDTT               </span><span class="si">%04i</span><span class="s1"> Ending month and day&#39;</span>
        <span class="n">ehmTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEHMT               </span><span class="si">%04i</span><span class="s1"> Ending UT hour and minute&#39;</span>
        <span class="n">ecsTempStr</span> <span class="o">=</span> <span class="s1">&#39;IECST               </span><span class="si">%04i</span><span class="s1"> Ending centisecond&#39;</span>
        
        <span class="n">numLines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTextLineCount</span><span class="p">()</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="c1"># 8 times lines, KRECH, KINST, KINDAT, and final blank</span>
        <span class="n">textArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="n">numLines</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;File Notes&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">))])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numLines</span><span class="o">-</span><span class="mi">9</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">krechStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">krechStr</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">kinstName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">())</span>
                <span class="n">kinstStr</span> <span class="o">=</span> <span class="n">kinstTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">(),</span> <span class="n">kinstName</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="n">kinstStr</span> <span class="o">=</span> <span class="n">kinstStr</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinstStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstStr</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">kindatStr</span> <span class="o">=</span> <span class="n">kindatTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKindat</span><span class="p">(),</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="o">.</span><span class="n">getKindatDescription</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKindat</span><span class="p">(),</span>
                                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                    <span class="n">kindatStr</span> <span class="o">=</span> <span class="n">kindatStr</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kindatStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatStr</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()[(</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">:(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">]</span>
                
        <span class="c1"># finally add time lines</span>
        <span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="n">sCentisec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
        <span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="n">eCentisec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
        <span class="n">ibdtt</span> <span class="o">=</span> <span class="n">sMonth</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sDay</span>
        <span class="n">ibhmt</span> <span class="o">=</span> <span class="n">sHour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sMin</span>
        <span class="n">ibcst</span> <span class="o">=</span> <span class="n">sSec</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sCentisec</span>
        <span class="n">iedtt</span> <span class="o">=</span> <span class="n">eMonth</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eDay</span>
        <span class="n">iehmt</span> <span class="o">=</span> <span class="n">eHour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eMin</span>
        <span class="n">iecst</span> <span class="o">=</span> <span class="n">eSec</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eCentisec</span>
        
        <span class="n">sYearStr</span> <span class="o">=</span> <span class="n">byearTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">sYear</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sYearStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sYearStr</span><span class="p">))</span>
        <span class="n">sMDStr</span> <span class="o">=</span> <span class="n">bmdTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibdtt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sMDStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sMDStr</span><span class="p">))</span>
        <span class="n">sHMStr</span> <span class="o">=</span> <span class="n">bhmTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibhmt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sHMStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sHMStr</span><span class="p">))</span>
        <span class="n">sCSStr</span> <span class="o">=</span> <span class="n">bcsTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibcst</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sCSStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sCSStr</span><span class="p">))</span>
        
        <span class="n">eYearStr</span> <span class="o">=</span> <span class="n">eyearTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">eYear</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eYearStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eYearStr</span><span class="p">))</span>
        <span class="n">eMDStr</span> <span class="o">=</span> <span class="n">emdTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iedtt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eMDStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eMDStr</span><span class="p">))</span>
        <span class="n">eHMStr</span> <span class="o">=</span> <span class="n">ehmTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iehmt</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eHMStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eHMStr</span><span class="p">))</span>
        <span class="n">eCSStr</span> <span class="o">=</span> <span class="n">ecsTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iecst</span><span class="p">)</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eCSStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eCSStr</span><span class="p">))</span>
        <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">9</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">80</span>
        
        <span class="k">return</span><span class="p">(</span><span class="n">textArr</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="nf">setTimeLists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                     <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;setTimeList resets start and end times</span>

<span class="sd">        Inputs:</span>

<span class="sd">            sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - experiment start time. sCentisec must be 0-99</span>

<span class="sd">            eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - experiment end time. eCentisec must be 0-99</span>

<span class="sd">        Outputs: None</span>

<span class="sd">        Affects: sets all time attributes (see code).</span>

<span class="sd">        Exceptions: Raises ValueError if startTime &gt; endTime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># verify times</span>
        <span class="n">sTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">eTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">eTime</span> <span class="o">&lt;</span> <span class="n">sTime</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Starting time cannot be after ending time&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_sTime</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMadrigalUTFromDT</span><span class="p">(</span><span class="n">sTime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eTime</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMadrigalUTFromDT</span><span class="p">(</span><span class="n">eTime</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span> <span class="o">=</span> <span class="n">sYear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span> <span class="o">=</span> <span class="n">sMonth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span> <span class="o">=</span> <span class="n">sDay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span> <span class="o">=</span> <span class="n">sHour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span> <span class="o">=</span> <span class="n">sMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span> <span class="o">=</span> <span class="n">sSec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span> <span class="o">=</span> <span class="n">sCentisec</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span> <span class="o">=</span> <span class="n">eYear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span> <span class="o">=</span> <span class="n">eMonth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span> <span class="o">=</span> <span class="n">eDay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span> <span class="o">=</span> <span class="n">eHour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span> <span class="o">=</span> <span class="n">eMin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span> <span class="o">=</span> <span class="n">eSec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span> <span class="o">=</span> <span class="n">eCentisec</span>
        
        
    <span class="k">def</span> <span class="nf">_parseExpNotesLines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expNotesLines</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_parseExpNotesLines populates all attributes in MadrigalHeaderRecord</span>
<span class="sd">        from text from metadata table &quot;Experiment Notes&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Len of expNotesLines must be divisible by 80, len </span><span class="si">%i</span><span class="s1"> is not&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># init to empty</span>
        
        <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="c1"># default times</span>
        <span class="n">byear</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># to verify lines found</span>
        <span class="n">addItem</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># check for the case where there is a addition item in front of date field</span>
        <span class="n">bsec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bcsec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">esec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ecsec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">expNotesLines</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">80</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">]</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># blank line</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;KRECH&#39;</span><span class="p">:</span>
                <span class="c1"># ignore</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;KINST&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;KINDAT&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setKindat</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setKindat</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setKindat</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    
            <span class="c1"># start time</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBYRT&#39;</span><span class="p">:</span>
                <span class="n">byear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">byear</span> <span class="o">&lt;</span> <span class="mi">1950</span><span class="p">:</span>
                    <span class="c1"># wrong column parsed</span>
                    <span class="n">addItem</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">byear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
                
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;IBDTT&#39;</span><span class="p">,</span> <span class="s1">&#39;IBDT&#39;</span><span class="p">):</span>
                <span class="n">ibdte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
                <span class="n">bmonth</span> <span class="o">=</span> <span class="n">ibdte</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">bday</span> <span class="o">=</span> <span class="n">ibdte</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBHMT&#39;</span><span class="p">:</span>
                <span class="n">ibhme</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
                <span class="n">bhour</span> <span class="o">=</span> <span class="n">ibhme</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">bmin</span> <span class="o">=</span> <span class="n">ibhme</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IBCST&#39;</span><span class="p">:</span>
                <span class="n">ibcse</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">]))</span>
                <span class="n">bsec</span> <span class="o">=</span> <span class="n">ibcse</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">bcsec</span> <span class="o">=</span> <span class="n">ibcse</span> <span class="o">%</span> <span class="mi">100</span>
                
            <span class="c1"># end time</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IEYRT&#39;</span><span class="p">:</span>
                <span class="n">eyear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;IEDTT&#39;</span><span class="p">,</span> <span class="s1">&#39;IEDT&#39;</span><span class="p">):</span>
                <span class="n">iedte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
                <span class="n">emonth</span> <span class="o">=</span> <span class="n">iedte</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">eday</span> <span class="o">=</span> <span class="n">iedte</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IEHMT&#39;</span><span class="p">:</span>
                <span class="n">iehme</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">])</span>
                <span class="n">ehour</span> <span class="o">=</span> <span class="n">iehme</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">emin</span> <span class="o">=</span> <span class="n">iehme</span> <span class="o">%</span> <span class="mi">100</span>
            <span class="k">elif</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;IECST&#39;</span><span class="p">:</span>
                <span class="n">iecse</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">addItem</span><span class="p">]))</span>
                <span class="n">esec</span> <span class="o">=</span> <span class="n">iecse</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">ecsec</span> <span class="o">=</span> <span class="n">iecse</span> <span class="o">%</span> <span class="mi">100</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
                    
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># set times</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">byear</span><span class="p">,</span> <span class="n">bmonth</span><span class="p">,</span> <span class="n">bday</span><span class="p">,</span> <span class="n">bhour</span><span class="p">,</span> <span class="n">bmin</span><span class="p">,</span> <span class="n">bsec</span><span class="p">,</span> <span class="n">bcsec</span><span class="p">,</span> 
                              <span class="n">eyear</span><span class="p">,</span> <span class="n">emonth</span><span class="p">,</span> <span class="n">eday</span><span class="p">,</span> <span class="n">ehour</span><span class="p">,</span> <span class="n">emin</span><span class="p">,</span> <span class="n">esec</span><span class="p">,</span> <span class="n">ecsec</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
    
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns a string representation of a MadrigalHeaderRecord &quot;&quot;&quot;</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;Header Record:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;kinst = </span><span class="si">%i</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;kindat = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;record start: </span><span class="si">%04i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">.</span><span class="si">%02i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span><span class="p">)</span>
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;record end:   </span><span class="si">%04i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1">-</span><span class="si">%02i</span><span class="s1"> </span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">:</span><span class="si">%02i</span><span class="s1">.</span><span class="si">%02i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span><span class="p">,</span>
                                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span><span class="p">)</span>
        
        <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;jpar = </span><span class="si">%i</span><span class="s1">, mpar = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jpar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpar</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">):</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">80</span><span class="p">])</span>

        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">cmpDataRec</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;cmpDataRec returns a tuple of:</span>
<span class="sd">            1. 0 if catalog, 1 if header, 2 if data</span>
<span class="sd">            2.  start datetime</span>
<span class="sd">            3.  end datetime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># compare record start times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">sDT</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="n">typeEnum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">thisType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dataType</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">thisType</span> <span class="o">==</span> <span class="n">dataType</span><span class="p">:</span>
                <span class="n">typeEnum</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
            
        <span class="c1"># compare record stop times</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">eDT</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="k">return</span><span class="p">((</span><span class="n">typeEnum</span><span class="p">,</span> <span class="n">sDT</span><span class="p">,</span> <span class="n">eDT</span><span class="p">))</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#madrigal.cedar.MadrigalHeaderRecord">MadrigalHeaderRecord</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, kinst=None, kindat=None, sYear=None, sMonth=None, sDay=None, sHour=None, sMin=None, sSec=None, sCentisec=None, eYear=None, eMonth=None, eDay=None, eHour=None, eMin=None, eSec=None, eCentisec=None, jpar=None, mpar=None, text=None, madInstObj=None, madKindatObj=None, expNotesLines=None)</p>
    </div>
    

    
  
    <div class="desc"><p><strong>init</strong> creates a MadrigalCatalogRecord.</p>
<p>Note: all inputs have default values because there are two ways to populate this structure:
1) with all inputs from kinst to text when new data is being created, or 
2) with catalog line list from existing Hdf5 file Experiment Notes metadata, plus non-default inputs</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">kinst</span> <span class="o">-</span> <span class="n">the</span> <span class="n">kind</span> <span class="k">of</span> <span class="n">instrument</span> <span class="n">code</span><span class="p">.</span>  <span class="n">A</span> <span class="n">warning</span> <span class="n">will</span> <span class="n">be</span> <span class="n">raised</span> <span class="k">if</span> <span class="k">not</span> <span class="k">in</span> <span class="n">instTab</span><span class="p">.</span><span class="n">txt</span><span class="p">.</span>

<span class="n">kindat</span> <span class="o">-</span> <span class="n">kind</span> <span class="k">of</span> <span class="k">data</span> <span class="n">code</span><span class="p">.</span> <span class="n">Must</span> <span class="n">be</span> <span class="n">a</span> <span class="n">non</span><span class="o">-</span><span class="n">negative</span> <span class="nb">integer</span><span class="p">.</span>

<span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span> <span class="o">-</span> <span class="n">experiment</span> <span class="k">start</span> <span class="n">time</span><span class="p">.</span> <span class="n">sCentisec</span> <span class="n">must</span> <span class="n">be</span> <span class="mi">0</span><span class="o">-</span><span class="mi">99</span>

<span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span> <span class="o">-</span> <span class="n">experiment</span> <span class="k">end</span> <span class="n">time</span><span class="p">.</span> <span class="n">eCentisec</span> <span class="n">must</span> <span class="n">be</span> <span class="mi">0</span><span class="o">-</span><span class="mi">99</span>

<span class="n">jpar</span> <span class="o">-</span> <span class="n">the</span> <span class="nb">number</span> <span class="k">of</span> <span class="mi">1</span><span class="n">d</span> <span class="k">parameters</span> <span class="k">in</span> <span class="n">the</span> <span class="n">following</span> <span class="k">data</span> <span class="n">records</span>

<span class="n">mpar</span> <span class="o">-</span> <span class="n">the</span> <span class="nb">number</span> <span class="k">of</span> <span class="mi">2</span><span class="n">d</span> <span class="k">parameters</span> <span class="k">in</span> <span class="n">the</span> <span class="n">following</span> <span class="k">data</span> <span class="n">records</span>

<span class="nb">text</span> <span class="o">-</span> <span class="n">string</span> <span class="n">containing</span> <span class="nb">text</span> <span class="k">in</span> <span class="k">catalog</span> <span class="n">record</span><span class="p">.</span>  <span class="k">Length</span> <span class="n">must</span> <span class="n">be</span> <span class="n">divisible</span> <span class="k">by</span> <span class="mi">80</span><span class="p">.</span>  <span class="k">No</span> <span class="n">linefeeds</span>
       <span class="n">allowed</span><span class="p">.</span>

<span class="n">madInstObj</span> <span class="o">-</span> <span class="n">a</span> <span class="n">madrigal</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">MadrigalInstrument</span> <span class="k">object</span><span class="p">.</span>  <span class="k">If</span> <span class="k">None</span><span class="p">,</span> <span class="n">one</span> <span class="n">will</span> <span class="n">be</span> <span class="n">created</span><span class="p">.</span>
                  <span class="n">Used</span> <span class="k">to</span> <span class="n">verify</span> <span class="n">kinst</span><span class="p">.</span>

<span class="n">madKindatObj</span> <span class="o">-</span> <span class="n">a</span> <span class="n">madrigal</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">MadrigalKindat</span> <span class="n">onject</span><span class="p">.</span> <span class="k">If</span> <span class="k">none</span><span class="p">,</span> <span class="n">one</span> <span class="n">will</span> <span class="n">be</span> <span class="n">created</span><span class="p">.</span>
                <span class="n">Used</span> <span class="k">to</span> <span class="n">verify</span> <span class="n">kindat</span><span class="p">.</span>

<span class="n">expNotesList</span> <span class="o">-</span> <span class="n">a</span> <span class="n">list</span> <span class="k">of</span> <span class="k">all</span> <span class="n">lines</span> <span class="k">in</span> <span class="n">an</span> <span class="k">existing</span> <span class="n">header</span> <span class="n">section</span> <span class="k">in</span> <span class="ss">&quot;Experiment Notes&quot;</span> 
    <span class="n">metadata</span> <span class="k">table</span><span class="p">.</span>  <span class="k">All</span> <span class="n">the</span> <span class="n">above</span> <span class="n">attributes</span> <span class="k">are</span> <span class="n">parsed</span> <span class="k">from</span> <span class="n">these</span> <span class="n">lines</span><span class="p">.</span>
</pre></div>


<p>Outputs: None</p>
<p>Returns: None</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.__init__', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kinst</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">kindat</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">sYear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sMonth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sDay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">sHour</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sSec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sCentisec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">eYear</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eMonth</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eDay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">eHour</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eMin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eSec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">eCentisec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">jpar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mpar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">text</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">madInstObj</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">madKindatObj</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">expNotesLines</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;__init__ creates a MadrigalCatalogRecord.</span>
<span class="sd">    </span>
<span class="sd">    Note: all inputs have default values because there are two ways to populate this structure:</span>
<span class="sd">    1) with all inputs from kinst to text when new data is being created, or </span>
<span class="sd">    2) with catalog line list from existing Hdf5 file Experiment Notes metadata, plus non-default inputs</span>
<span class="sd">    Inputs:</span>
<span class="sd">        kinst - the kind of instrument code.  A warning will be raised if not in instTab.txt.</span>
<span class="sd">        kindat - kind of data code. Must be a non-negative integer.</span>
<span class="sd">        sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - experiment start time. sCentisec must be 0-99</span>
<span class="sd">        eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - experiment end time. eCentisec must be 0-99</span>
<span class="sd">        jpar - the number of 1d parameters in the following data records</span>
<span class="sd">        mpar - the number of 2d parameters in the following data records</span>
<span class="sd">        text - string containing text in catalog record.  Length must be divisible by 80.  No linefeeds</span>
<span class="sd">               allowed.</span>
<span class="sd">        madInstObj - a madrigal.metadata.MadrigalInstrument object.  If None, one will be created.</span>
<span class="sd">                          Used to verify kinst.</span>
<span class="sd">                          </span>
<span class="sd">        madKindatObj - a madrigal.metadata.MadrigalKindat onject. If none, one will be created.</span>
<span class="sd">                        Used to verify kindat.</span>
<span class="sd">                          </span>
<span class="sd">        expNotesList - a list of all lines in an existing header section in &quot;Experiment Notes&quot; </span>
<span class="sd">            metadata table.  All the above attributes are parsed from these lines.</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create any needed Madrigal objects, if not passed in</span>
    <span class="k">if</span> <span class="n">madInstObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalInstrument</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span> <span class="o">=</span> <span class="n">madInstObj</span>
    <span class="k">if</span> <span class="n">madKindatObj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">MadrigalKindat</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span> <span class="o">=</span> <span class="n">madKindatObj</span>
        
    <span class="k">if</span> <span class="n">expNotesLines</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># get all information from this dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parseExpNotesLines</span><span class="p">(</span><span class="n">expNotesLines</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">kinst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># kinst set via header record overrides kinst argument</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setKinst</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
    <span class="c1"># verify kinst set, or raise error</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kinst not set when MadrigalHeaderRecord created - required&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">kindat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># kindat set via header record overrides kindat argument</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getKindat</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setKindat</span><span class="p">(</span><span class="n">kindat</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTimeLists</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                          <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">jpar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setJpar</span><span class="p">(</span><span class="n">jpar</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mpar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMpar</span><span class="p">(</span><span class="n">mpar</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.cmpDataRec">
    <p>def <span class="ident">cmpDataRec</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>cmpDataRec returns a tuple of:
1. 0 if catalog, 1 if header, 2 if data
2.  start datetime
3.  end datetime</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.cmpDataRec', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.cmpDataRec" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">cmpDataRec</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;cmpDataRec returns a tuple of:</span>
<span class="sd">        1. 0 if catalog, 1 if header, 2 if data</span>
<span class="sd">        2.  start datetime</span>
<span class="sd">        3.  end datetime</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># compare record start times</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
        <span class="n">sDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">sDT</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="n">typeEnum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">thisType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dataType</span> <span class="ow">in</span>  <span class="nb">enumerate</span><span class="p">((</span><span class="s1">&#39;catalog&#39;</span><span class="p">,</span> <span class="s1">&#39;header&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">thisType</span> <span class="o">==</span> <span class="n">dataType</span><span class="p">:</span>
            <span class="n">typeEnum</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">break</span>
        
    <span class="c1"># compare record stop times</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
        <span class="n">eDT</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">fList</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">eDT</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">return</span><span class="p">((</span><span class="n">typeEnum</span><span class="p">,</span> <span class="n">sDT</span><span class="p">,</span> <span class="n">eDT</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.getEndTimeList">
    <p>def <span class="ident">getEndTimeList</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getEndTimeList returns a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec</p>
<p>Inputs: None</p>
<p>Outputs: a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.getEndTimeList', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.getEndTimeList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getEndTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getEndTimeList returns a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: a tuple containing eYear, eMonth, eDay, eHour, eMin, eSec, and eCentisec.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.getJpar">
    <p>def <span class="ident">getJpar</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>returns the number of one-dimensional parameters in the associated data records.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.getJpar', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.getJpar" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getJpar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns the number of one-dimensional parameters in the associated data records.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jpar</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.getKindat">
    <p>def <span class="ident">getKindat</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getKindat returns the kind of data code (int) for a given header record.</p>
<p>Inputs: None</p>
<p>Outputs: the kind of data code (int) for a given header record.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.getKindat', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.getKindat" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getKindat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getKindat returns the kind of data code (int) for a given header record.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: the kind of data code (int) for a given header record.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.getKinst">
    <p>def <span class="ident">getKinst</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getKinst returns the kind of instrument code (int) for a given header record.</p>
<p>Inputs: None</p>
<p>Outputs: the kind of instrument code (int) for a given header record.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.getKinst', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.getKinst" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getKinst returns the kind of instrument code (int) for a given header record.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: the kind of instrument code (int) for a given header record.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.getLines">
    <p>def <span class="ident">getLines</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getLines returns a numpy recarray of the format expected by the "Experiment Notes" dataset</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.getLines', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.getLines" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getLines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getLines returns a numpy recarray of the format expected by the &quot;Experiment Notes&quot; dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># templates</span>
    <span class="n">krechStr</span> <span class="o">=</span> <span class="s1">&#39;KRECH               3002 Header Record, Version 3&#39;</span>
    <span class="n">kinstTempStr</span> <span class="o">=</span> <span class="s1">&#39;KINST     </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span>
    <span class="n">kindatTempStr</span> <span class="o">=</span> <span class="s1">&#39;KINDAT    </span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span>
    <span class="n">byearTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBYRT               </span><span class="si">%04i</span><span class="s1"> Beginning year&#39;</span>
    <span class="n">bmdTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBDTT               </span><span class="si">%04i</span><span class="s1"> Beginning month and day&#39;</span>
    <span class="n">bhmTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBHMT               </span><span class="si">%04i</span><span class="s1"> Beginning UT hour and minute&#39;</span>
    <span class="n">bcsTempStr</span> <span class="o">=</span> <span class="s1">&#39;IBCST               </span><span class="si">%04i</span><span class="s1"> Beginning centisecond&#39;</span>
    <span class="n">eyearTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEYRT               </span><span class="si">%04i</span><span class="s1"> Ending year&#39;</span>
    <span class="n">emdTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEDTT               </span><span class="si">%04i</span><span class="s1"> Ending month and day&#39;</span>
    <span class="n">ehmTempStr</span> <span class="o">=</span> <span class="s1">&#39;IEHMT               </span><span class="si">%04i</span><span class="s1"> Ending UT hour and minute&#39;</span>
    <span class="n">ecsTempStr</span> <span class="o">=</span> <span class="s1">&#39;IECST               </span><span class="si">%04i</span><span class="s1"> Ending centisecond&#39;</span>
    
    <span class="n">numLines</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTextLineCount</span><span class="p">()</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="c1"># 8 times lines, KRECH, KINST, KINDAT, and final blank</span>
    <span class="n">textArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">recarray</span><span class="p">((</span><span class="n">numLines</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;File Notes&#39;</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">special_dtype</span><span class="p">(</span><span class="n">vlen</span><span class="o">=</span><span class="nb">str</span><span class="p">))])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numLines</span><span class="o">-</span><span class="mi">9</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">krechStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">krechStr</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">kinstName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">())</span>
            <span class="n">kinstStr</span> <span class="o">=</span> <span class="n">kinstTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">(),</span> <span class="n">kinstName</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">kinstStr</span> <span class="o">=</span> <span class="n">kinstStr</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
            <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinstStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kinstStr</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">kindatStr</span> <span class="o">=</span> <span class="n">kindatTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKindat</span><span class="p">(),</span> 
                                         <span class="bp">self</span><span class="o">.</span><span class="n">_madKindatObj</span><span class="o">.</span><span class="n">getKindatDescription</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getKindat</span><span class="p">(),</span>
                                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">getKinst</span><span class="p">()))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">80</span><span class="p">:</span>
                <span class="n">kindatStr</span> <span class="o">=</span> <span class="n">kindatStr</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
            <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kindatStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">kindatStr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getText</span><span class="p">()[(</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">:(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">80</span><span class="p">]</span>
            
    <span class="c1"># finally add time lines</span>
    <span class="n">sYear</span><span class="p">,</span> <span class="n">sMonth</span><span class="p">,</span> <span class="n">sDay</span><span class="p">,</span> <span class="n">sHour</span><span class="p">,</span> <span class="n">sMin</span><span class="p">,</span> <span class="n">sSec</span><span class="p">,</span> <span class="n">sCentisec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getStartTimeList</span><span class="p">()</span>
    <span class="n">eYear</span><span class="p">,</span> <span class="n">eMonth</span><span class="p">,</span> <span class="n">eDay</span><span class="p">,</span> <span class="n">eHour</span><span class="p">,</span> <span class="n">eMin</span><span class="p">,</span> <span class="n">eSec</span><span class="p">,</span> <span class="n">eCentisec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEndTimeList</span><span class="p">()</span>
    <span class="n">ibdtt</span> <span class="o">=</span> <span class="n">sMonth</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sDay</span>
    <span class="n">ibhmt</span> <span class="o">=</span> <span class="n">sHour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sMin</span>
    <span class="n">ibcst</span> <span class="o">=</span> <span class="n">sSec</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">sCentisec</span>
    <span class="n">iedtt</span> <span class="o">=</span> <span class="n">eMonth</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eDay</span>
    <span class="n">iehmt</span> <span class="o">=</span> <span class="n">eHour</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eMin</span>
    <span class="n">iecst</span> <span class="o">=</span> <span class="n">eSec</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">eCentisec</span>
    
    <span class="n">sYearStr</span> <span class="o">=</span> <span class="n">byearTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">sYear</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sYearStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sYearStr</span><span class="p">))</span>
    <span class="n">sMDStr</span> <span class="o">=</span> <span class="n">bmdTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibdtt</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sMDStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sMDStr</span><span class="p">))</span>
    <span class="n">sHMStr</span> <span class="o">=</span> <span class="n">bhmTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibhmt</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sHMStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sHMStr</span><span class="p">))</span>
    <span class="n">sCSStr</span> <span class="o">=</span> <span class="n">bcsTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">ibcst</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sCSStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">sCSStr</span><span class="p">))</span>
    
    <span class="n">eYearStr</span> <span class="o">=</span> <span class="n">eyearTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">eYear</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eYearStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eYearStr</span><span class="p">))</span>
    <span class="n">eMDStr</span> <span class="o">=</span> <span class="n">emdTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iedtt</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eMDStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eMDStr</span><span class="p">))</span>
    <span class="n">eHMStr</span> <span class="o">=</span> <span class="n">ehmTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iehmt</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eHMStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eHMStr</span><span class="p">))</span>
    <span class="n">eCSStr</span> <span class="o">=</span> <span class="n">ecsTempStr</span> <span class="o">%</span> <span class="p">(</span><span class="n">iecst</span><span class="p">)</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eCSStr</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">eCSStr</span><span class="p">))</span>
    <span class="n">textArr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">9</span><span class="p">][</span><span class="s1">&#39;File Notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">80</span>
    
    <span class="k">return</span><span class="p">(</span><span class="n">textArr</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.getMpar">
    <p>def <span class="ident">getMpar</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>returns the number of two-dimensional parameters in the associated data records.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.getMpar', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.getMpar" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getMpar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns the number of two-dimensional parameters in the associated data records.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpar</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.getStartTimeList">
    <p>def <span class="ident">getStartTimeList</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getStartTimeList returns a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec</p>
<p>Inputs: None</p>
<p>Outputs: a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.getStartTimeList', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.getStartTimeList" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getStartTimeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getStartTimeList returns a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: a tuple containing sYear, sMonth, sDay, sHour, sMin, sSec, and sCentisec.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.getText">
    <p>def <span class="ident">getText</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getText returns the header text.</p>
<p>Inputs: None</p>
<p>Outputs: the header text.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.getText', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.getText" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getText returns the header text.</span>
<span class="sd">    Inputs: None</span>
<span class="sd">    Outputs: the header text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.getTextLineCount">
    <p>def <span class="ident">getTextLineCount</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getTextLineCount returns the number of 80 character lines in self._text</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.getTextLineCount', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.getTextLineCount" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getTextLineCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getTextLineCount returns the number of 80 character lines in self._text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.getType">
    <p>def <span class="ident">getType</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>returns the type 'header'</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.getType', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.getType" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; returns the type &#39;header&#39;&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;header&#39;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.setJpar">
    <p>def <span class="ident">setJpar</span>(</p><p>self, jpar)</p>
    </div>
    

    
  
    <div class="desc"><p>set the number of one-dimensional parameters in the associated data records.</p>
<p>Must not be negative.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.setJpar', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.setJpar" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setJpar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jpar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; set the number of one-dimensional parameters in the associated data records.</span>
<span class="sd">    Must not be negative.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_jpar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">jpar</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jpar</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;jpar must not be less than 0&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.setKindat">
    <p>def <span class="ident">setKindat</span>(</p><p>self, kindat)</p>
    </div>
    

    
  
    <div class="desc"><p>setKindat sets the mode of kind of data code (int) for a given header record.</p>
<p>Inputs: the kind of data code (int)</p>
<p>Outputs: None</p>
<p>Affects: sets the kind of data code (int) (self._kindat)</p>
<p>Exceptions: Raises ValueError if kindat less than 0</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.setKindat', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.setKindat" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setKindat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kindat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setKindat sets the mode of kind of data code (int) for a given header record.</span>
<span class="sd">    Inputs: the kind of data code (int)</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: sets the kind of data code (int) (self._kindat)</span>
<span class="sd">    Exceptions: Raises ValueError if kindat less than 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kindat</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;kindat must not be less than 0, not </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kindat</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.setKinst">
    <p>def <span class="ident">setKinst</span>(</p><p>self, kinst)</p>
    </div>
    

    
  
    <div class="desc"><p>setKinst sets the kind of instrument code (int) for a given header record.</p>
<p>Inputs: kind of instrument code (integer)</p>
<p>Outputs: None</p>
<p>Affects: sets the kind of instrument code (int) (self._kinst) for a given header record.
Prints warning if kinst not found in instTab.txt</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.setKinst', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.setKinst" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setKinst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kinst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setKinst sets the kind of instrument code (int) for a given header record.</span>
<span class="sd">    Inputs: kind of instrument code (integer)</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: sets the kind of instrument code (int) (self._kinst) for a given header record.</span>
<span class="sd">    Prints warning if kinst not found in instTab.txt</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kinst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kinst</span><span class="p">)</span>
    <span class="c1"># verify  and set kinst</span>
    <span class="n">instList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_madInstObj</span><span class="o">.</span><span class="n">getInstrumentList</span><span class="p">()</span>
    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">inst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">kinst</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instrumentName</span> <span class="o">=</span> <span class="s1">&#39;Unknown instrument&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Warning: kinst </span><span class="si">%i</span><span class="s1"> not found in instTab.txt</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kinst</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_kinst</span> <span class="o">=</span> <span class="n">kinst</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.setMpar">
    <p>def <span class="ident">setMpar</span>(</p><p>self, mpar)</p>
    </div>
    

    
  
    <div class="desc"><p>set the number of two-dimensional parameters in the associated data records.</p>
<p>Must not be negative.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.setMpar', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.setMpar" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setMpar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mpar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; set the number of two-dimensional parameters in the associated data records.</span>
<span class="sd">    Must not be negative.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mpar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mpar</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpar</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;mpar must not be less than 0&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.setText">
    <p>def <span class="ident">setText</span>(</p><p>self, text)</p>
    </div>
    

    
  
    <div class="desc"><p>setText sets the header text.</p>
<p>Inputs: text: text to be set.  Must be length divisible by 80, and not contain line feeds.
For now, must not exceed 2^16 - 80 bytes to be able to be handled by Cedar format.</p>
<p>Outputs: None.</p>
<p>Affects: sets self._text</p>
<p>Raises TypeError if problem with text</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.setText', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.setText" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setText sets the header text.</span>
<span class="sd">    Inputs: text: text to be set.  Must be length divisible by 80, and not contain line feeds.</span>
<span class="sd">    For now, must not exceed 2^16 - 80 bytes to be able to be handled by Cedar format.</span>
<span class="sd">    Outputs: None.</span>
<span class="sd">    Affects: sets self._text</span>
<span class="sd">    Raises TypeError if problem with text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">textTypes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">textTypes</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text must be of type string&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">%</span> <span class="mi">80</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text length must be divisible by 80: len is </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text must not contain linefeed character&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">65536</span> <span class="o">-</span> <span class="mi">80</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;text exceeds ability of Cedar format to store&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">text</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.MadrigalHeaderRecord.setTimeLists">
    <p>def <span class="ident">setTimeLists</span>(</p><p>self, sYear, sMonth, sDay, sHour, sMin, sSec, sCentisec, eYear, eMonth, eDay, eHour, eMin, eSec, eCentisec)</p>
    </div>
    

    
  
    <div class="desc"><p>setTimeList resets start and end times</p>
<p>Inputs:</p>
<div class="codehilite"><pre><span></span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span> <span class="o">-</span> <span class="n">experiment</span> <span class="k">start</span> <span class="n">time</span><span class="p">.</span> <span class="n">sCentisec</span> <span class="n">must</span> <span class="n">be</span> <span class="mi">0</span><span class="o">-</span><span class="mi">99</span>

<span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span> <span class="o">-</span> <span class="n">experiment</span> <span class="k">end</span> <span class="n">time</span><span class="p">.</span> <span class="n">eCentisec</span> <span class="n">must</span> <span class="n">be</span> <span class="mi">0</span><span class="o">-</span><span class="mi">99</span>
</pre></div>


<p>Outputs: None</p>
<p>Affects: sets all time attributes (see code).</p>
<p>Exceptions: Raises ValueError if startTime &gt; endTime</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.MadrigalHeaderRecord.setTimeLists', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.MadrigalHeaderRecord.setTimeLists" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">setTimeLists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="p">,</span>
                 <span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;setTimeList resets start and end times</span>
<span class="sd">    Inputs:</span>
<span class="sd">        sYear,sMonth,sDay,sHour,sMin,sSec,sCentisec - experiment start time. sCentisec must be 0-99</span>
<span class="sd">        eYear,eMonth,eDay,eHour,eMin,eSec,eCentisec - experiment end time. eCentisec must be 0-99</span>
<span class="sd">    Outputs: None</span>
<span class="sd">    Affects: sets all time attributes (see code).</span>
<span class="sd">    Exceptions: Raises ValueError if startTime &gt; endTime</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># verify times</span>
    <span class="n">sTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">sYear</span><span class="p">,</span><span class="n">sMonth</span><span class="p">,</span><span class="n">sDay</span><span class="p">,</span><span class="n">sHour</span><span class="p">,</span><span class="n">sMin</span><span class="p">,</span><span class="n">sSec</span><span class="p">,</span><span class="n">sCentisec</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">eTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">eYear</span><span class="p">,</span><span class="n">eMonth</span><span class="p">,</span><span class="n">eDay</span><span class="p">,</span><span class="n">eHour</span><span class="p">,</span><span class="n">eMin</span><span class="p">,</span><span class="n">eSec</span><span class="p">,</span><span class="n">eCentisec</span><span class="o">*</span><span class="mi">10000</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">eTime</span> <span class="o">&lt;</span> <span class="n">sTime</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Starting time cannot be after ending time&#39;</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_sTime</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMadrigalUTFromDT</span><span class="p">(</span><span class="n">sTime</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eTime</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">getMadrigalUTFromDT</span><span class="p">(</span><span class="n">eTime</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_sYear</span> <span class="o">=</span> <span class="n">sYear</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sMonth</span> <span class="o">=</span> <span class="n">sMonth</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sDay</span> <span class="o">=</span> <span class="n">sDay</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sHour</span> <span class="o">=</span> <span class="n">sHour</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sMin</span> <span class="o">=</span> <span class="n">sMin</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sSec</span> <span class="o">=</span> <span class="n">sSec</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sCentisec</span> <span class="o">=</span> <span class="n">sCentisec</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_eYear</span> <span class="o">=</span> <span class="n">eYear</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eMonth</span> <span class="o">=</span> <span class="n">eMonth</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eDay</span> <span class="o">=</span> <span class="n">eDay</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eHour</span> <span class="o">=</span> <span class="n">eHour</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eMin</span> <span class="o">=</span> <span class="n">eMin</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eSec</span> <span class="o">=</span> <span class="n">eSec</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eCentisec</span> <span class="o">=</span> <span class="n">eCentisec</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="madrigal.cedar.convertToNetCDF4" class="name">class <span class="ident">convertToNetCDF4</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.convertToNetCDF4', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.convertToNetCDF4" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">convertToNetCDF4</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputHdf5</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;convertToNetCDF4 converts a Madrigal HDF5 file to netCDF4 using Array Layout</span>
<span class="sd">            rather than using Table Layout as cedar module does.  Can handle large Hdf5 file</span>
<span class="sd">            without large memory footprint, and is much faster than reading in using </span>
<span class="sd">            madrigal.cedar.MadrigalCedarFile</span>
<span class="sd">            </span>
<span class="sd">            Inputs:</span>
<span class="sd">                inputHdf5 - filename of input Madrigal Hdf5 file</span>
<span class="sd">                outputNC - output netCDF4 file</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">madParmObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalParameters</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;Array Layout&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50000000</span><span class="p">:</span>
                <span class="c1"># for smaller files we simply go through the slower full cedar conversion</span>
                <span class="n">cedarObj</span> <span class="o">=</span> <span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">)</span>
                <span class="n">cedarObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;netCDF4&#39;</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># file is to big to load into memory at once, read only 10 records at once at write to file</span>
                <span class="c1"># parm IndexDict is a dictionary with key = timestamps and ind spatial parm names,</span>
                <span class="c1"># value = dictionary of keys = unique values, value = index</span>
                <span class="c1"># temp only</span>
                <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">parmIndexDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getParmIndexDict</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">madCedarObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">madCedarObj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;netCDF4&#39;</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">)</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="mi">10</span>
                <span class="k">while</span> <span class="p">(</span><span class="kc">True</span><span class="p">):</span>
                    <span class="c1"># temp only</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> done so far in </span><span class="si">%f</span><span class="s1"> secs&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t</span><span class="p">))</span>
                    <span class="n">newRecs</span><span class="p">,</span> <span class="n">isComplete</span> <span class="o">=</span> <span class="n">madCedarObj</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">isComplete</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">madCedarObj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;netCDF4&#39;</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">newRecs</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">total</span> <span class="o">+=</span> <span class="n">newRecs</span>
                    
                <span class="c1"># compress</span>
                <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">outputNC</span><span class="p">)</span>
                <span class="c1"># tmp file name to use to run h5repack</span>
                <span class="n">tmpFile</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;_tmp&#39;</span> <span class="o">+</span> <span class="n">file_extension</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;h5repack -i </span><span class="si">%s</span><span class="s1"> -o </span><span class="si">%s</span><span class="s1"> --filter=GZIP=4&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">outputNC</span><span class="p">,</span> <span class="n">tmpFile</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                    <span class="k">return</span>
                
                <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">)</span>
                    
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">outputNC</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">catalog_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCatalogText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">header_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHeaderText</span><span class="p">()</span>
        
        <span class="c1"># write Experiment Parameters</span>
        <span class="n">experimentParameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Experiment Parameters&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">experimentParameters</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">experimentParameters</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
            <span class="c1"># make text acceptable attribute names</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(s)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">experimentParameters</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            
        <span class="n">indParmListOrg</span> <span class="o">=</span> <span class="p">[</span><span class="n">parm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Independent Spatial Parameters&#39;</span><span class="p">]]</span>
        <span class="n">indParmList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmListOrg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">indParmList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">indParmList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            
            
        <span class="c1"># split parms - if any</span>
        <span class="n">has_split</span> <span class="o">=</span> <span class="s1">&#39;Parameters Used to Split Array Data&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">arraySplittingMnemonics</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">has_split</span><span class="p">:</span>
            <span class="n">arraySplittingParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Parameters Used to Split Array Data&#39;</span><span class="p">]</span>
            <span class="n">arrSplitParmDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">)):</span>
                <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="n">arraySplittingMnemonic</span> <span class="o">=</span> <span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">arraySplittingMnemonic</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="n">arraySplittingMnemonic</span> <span class="o">=</span> <span class="n">arraySplittingMnemonic</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
                <span class="n">arraySplittingMnemonics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arraySplittingMnemonic</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">arraySplittingParms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39; -- &#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">parameters_used_to_split_data</span> <span class="o">=</span> <span class="n">arrSplitParmDesc</span>
            
        <span class="k">if</span> <span class="n">has_split</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">]]</span>
            
            
        <span class="c1"># loop through each split array (or just top level, if none</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nc_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">createGroup</span><span class="p">(</span><span class="n">nc_name</span><span class="p">)</span>
                <span class="n">hdf5Group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisGroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span>
                <span class="n">hdf5Group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">]</span>
                
            <span class="n">times</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">]</span>
                
            <span class="c1"># next step - create dimensions</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="c1"># first time dim</span>
            <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">))</span>
            <span class="n">timeVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,),</span>
                                               <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">timeVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Unix seconds&#39;</span>
            <span class="n">timeVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Number of seconds since UT midnight 1970-01-01&#39;</span>
            <span class="n">timeVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">times</span>
            <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">)</span>
            
            <span class="c1"># next ind parms, because works well with ncview that way</span>
            <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">arraySplittingMnemonics</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                    <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">thisVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                    <span class="n">slen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">slen</span><span class="p">)</span>
                    <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">])):</span>
                        <span class="n">thisVar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">thisVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
                <span class="n">thisVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                <span class="n">thisVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
                
            
                
            <span class="c1"># get all one d data</span>
            <span class="n">oneDParms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">oneDParm</span> <span class="ow">in</span> <span class="n">oneDParms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="n">oneDParm</span> <span class="o">=</span> <span class="n">oneDParm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">oneDParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">oneDParm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arraySplittingMnemonics</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">oneDParm</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Data Parameters&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">):</span>
                    <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">):</span>
                    <span class="n">slen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">oneDParm</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">slen</span><span class="p">)</span>
                    <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">oneDVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">)</span>
                <span class="n">oneDVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">oneDVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">oneDParm</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">oneDVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">oneDParm</span><span class="p">][()]</span>
                
                
            <span class="c1"># get all two d data</span>
            <span class="n">twoDParms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">twoDParm</span> <span class="ow">in</span> <span class="n">twoDParms</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="n">twoDParm</span> <span class="o">=</span> <span class="n">twoDParm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">twoDParm</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Data Parameters&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">twoDParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">twoDParm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arraySplittingMnemonics</span><span class="p">:</span>
                        <span class="k">continue</span>
                <span class="k">if</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">):</span>
                    <span class="n">twoDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">):</span>
                    <span class="n">slen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">][</span><span class="n">twoDParm</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">slen</span><span class="p">)</span>
                    <span class="n">twoDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">twoDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span>
                                                       <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">twoDVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span>
                <span class="n">twoDVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span>
                <span class="c1"># move the last dim in Hdf5 (time) to be the first now</span>
                <span class="n">reshape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)))</span>
                <span class="n">newShape</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">reshape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">][</span><span class="n">twoDParm</span><span class="p">],</span> <span class="n">newShape</span><span class="p">)</span>
                <span class="n">twoDVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
            
                
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        
    <span class="k">def</span> <span class="nf">getCatalogText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getCatalogText returns the catalog record text as a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Experiment Notes&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">return</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">]</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">substr</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Header information&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Header information&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">retStr</span> <span class="o">+=</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">retStr</span> <span class="o">+=</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">getHeaderText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;getHeaderText returns the header record text as a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Experiment Notes&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">return</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">]</span>
        <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">headerFound</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">substr</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Header information&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">headerFound</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Header information&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">headerFound</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">headerFound</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">retStr</span> <span class="o">+=</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">_getParmIndexDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_getParmIndexDict returns a dictionary with key = timestamps and ind spatial parm names,</span>
<span class="sd">            value = dictionary of keys = unique values, value = index of that value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">parmList</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ut1_unix&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">parm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Independent Spatial Parameters&#39;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">parmList</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">parm</span> <span class="o">=</span> <span class="n">parm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Table Layout&#39;</span><span class="p">][</span><span class="n">parm</span><span class="p">]</span>
            <span class="n">unique_values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">sorted_values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_values</span><span class="p">)</span>
            <span class="n">retDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">sorted_values</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">retDict</span><span class="p">[</span><span class="n">parm</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">retDict</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#madrigal.cedar.convertToNetCDF4">convertToNetCDF4</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.convertToNetCDF4.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, inputHdf5, outputNC)</p>
    </div>
    

    
  
    <div class="desc"><p>convertToNetCDF4 converts a Madrigal HDF5 file to netCDF4 using Array Layout
rather than using Table Layout as cedar module does.  Can handle large Hdf5 file
without large memory footprint, and is much faster than reading in using 
madrigal.cedar.MadrigalCedarFile</p>
<p>Inputs:
    inputHdf5 - filename of input Madrigal Hdf5 file
    outputNC - output netCDF4 file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.convertToNetCDF4.__init__', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.convertToNetCDF4.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputHdf5</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;convertToNetCDF4 converts a Madrigal HDF5 file to netCDF4 using Array Layout</span>
<span class="sd">        rather than using Table Layout as cedar module does.  Can handle large Hdf5 file</span>
<span class="sd">        without large memory footprint, and is much faster than reading in using </span>
<span class="sd">        madrigal.cedar.MadrigalCedarFile</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            inputHdf5 - filename of input Madrigal Hdf5 file</span>
<span class="sd">            outputNC - output netCDF4 file</span>
<span class="sd">            </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">madParmObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">MadrigalParameters</span><span class="p">()</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;Array Layout&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50000000</span><span class="p">:</span>
            <span class="c1"># for smaller files we simply go through the slower full cedar conversion</span>
            <span class="n">cedarObj</span> <span class="o">=</span> <span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">)</span>
            <span class="n">cedarObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;netCDF4&#39;</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># file is to big to load into memory at once, read only 10 records at once at write to file</span>
            <span class="c1"># parm IndexDict is a dictionary with key = timestamps and ind spatial parm names,</span>
            <span class="c1"># value = dictionary of keys = unique values, value = index</span>
            <span class="c1"># temp only</span>
            <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">parmIndexDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getParmIndexDict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">madCedarObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">madCedarObj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;netCDF4&#39;</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">)</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="mi">10</span>
            <span class="k">while</span> <span class="p">(</span><span class="kc">True</span><span class="p">):</span>
                <span class="c1"># temp only</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> done so far in </span><span class="si">%f</span><span class="s1"> secs&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t</span><span class="p">))</span>
                <span class="n">newRecs</span><span class="p">,</span> <span class="n">isComplete</span> <span class="o">=</span> <span class="n">madCedarObj</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">isComplete</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">madCedarObj</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;netCDF4&#39;</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">,</span> <span class="n">parmIndexDict</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">newRecs</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="n">newRecs</span>
                
            <span class="c1"># compress</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">outputNC</span><span class="p">)</span>
            <span class="c1"># tmp file name to use to run h5repack</span>
            <span class="n">tmpFile</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;_tmp&#39;</span> <span class="o">+</span> <span class="n">file_extension</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;h5repack -i </span><span class="si">%s</span><span class="s1"> -o </span><span class="si">%s</span><span class="s1"> --filter=GZIP=4&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">outputNC</span><span class="p">,</span> <span class="n">tmpFile</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                <span class="k">return</span>
            
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">,</span> <span class="n">outputNC</span><span class="p">)</span>
                
            <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">outputNC</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">catalog_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCatalogText</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">header_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHeaderText</span><span class="p">()</span>
    
    <span class="c1"># write Experiment Parameters</span>
    <span class="n">experimentParameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Experiment Parameters&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">experimentParameters</span><span class="p">)):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">experimentParameters</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
        <span class="c1"># make text acceptable attribute names</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(s)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">setncattr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">experimentParameters</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        
    <span class="n">indParmListOrg</span> <span class="o">=</span> <span class="p">[</span><span class="n">parm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Independent Spatial Parameters&#39;</span><span class="p">]]</span>
    <span class="n">indParmList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmListOrg</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">indParmList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indParmList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
        
        
    <span class="c1"># split parms - if any</span>
    <span class="n">has_split</span> <span class="o">=</span> <span class="s1">&#39;Parameters Used to Split Array Data&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">arraySplittingMnemonics</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">has_split</span><span class="p">:</span>
        <span class="n">arraySplittingParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Parameters Used to Split Array Data&#39;</span><span class="p">]</span>
        <span class="n">arrSplitParmDesc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">)):</span>
            <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">arraySplittingMnemonic</span> <span class="o">=</span> <span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;mnemonic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">arraySplittingMnemonic</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">arraySplittingMnemonic</span> <span class="o">=</span> <span class="n">arraySplittingMnemonic</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="n">arraySplittingMnemonics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arraySplittingMnemonic</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">arraySplittingParms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">arraySplittingParms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">arrSplitParmDesc</span> <span class="o">+=</span> <span class="s1">&#39; -- &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">parameters_used_to_split_data</span> <span class="o">=</span> <span class="n">arrSplitParmDesc</span>
        
    <span class="k">if</span> <span class="n">has_split</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">]]</span>
        
        
    <span class="c1"># loop through each split array (or just top level, if none</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nc_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">thisGroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">createGroup</span><span class="p">(</span><span class="n">nc_name</span><span class="p">)</span>
            <span class="n">hdf5Group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thisGroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span>
            <span class="n">hdf5Group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">][</span><span class="s1">&#39;Array Layout&#39;</span><span class="p">]</span>
            
        <span class="n">times</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;timestamps&#39;</span><span class="p">]</span>
            
        <span class="c1"># next step - create dimensions</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># first time dim</span>
        <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">))</span>
        <span class="n">timeVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">,),</span>
                                           <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">timeVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Unix seconds&#39;</span>
        <span class="n">timeVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Number of seconds since UT midnight 1970-01-01&#39;</span>
        <span class="n">timeVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">times</span>
        <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;timestamps&quot;</span><span class="p">)</span>
        
        <span class="c1"># next ind parms, because works well with ncview that way</span>
        <span class="k">for</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">indParm</span> <span class="ow">in</span> <span class="n">arraySplittingMnemonics</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">thisGroup</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span>
                                                   <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">thisVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">indParm</span><span class="p">):</span>
                <span class="n">slen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">slen</span><span class="p">)</span>
                <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span>
                                                   <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">])):</span>
                    <span class="n">thisVar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thisVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">indParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">indParm</span><span class="p">,),</span>
                                                   <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">thisVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="n">indParm</span><span class="p">]</span>
            <span class="n">thisVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            <span class="n">thisVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            <span class="n">dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indParm</span><span class="p">)</span>
            
        
            
        <span class="c1"># get all one d data</span>
        <span class="n">oneDParms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">oneDParm</span> <span class="ow">in</span> <span class="n">oneDParms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">oneDParm</span> <span class="o">=</span> <span class="n">oneDParm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">oneDParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">oneDParm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arraySplittingMnemonics</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="n">oneDParm</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Data Parameters&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">):</span>
                <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                   <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">):</span>
                <span class="n">slen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">oneDParm</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">slen</span><span class="p">)</span>
                <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                   <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">oneDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span>
                                                   <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">oneDVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">)</span>
            <span class="n">oneDVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">oneDParm</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">oneDVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">oneDParm</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">oneDVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;1D Parameters&#39;</span><span class="p">][</span><span class="n">oneDParm</span><span class="p">][()]</span>
            
            
        <span class="c1"># get all two d data</span>
        <span class="n">twoDParms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">twoDParm</span> <span class="ow">in</span> <span class="n">twoDParms</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">twoDParm</span> <span class="o">=</span> <span class="n">twoDParm</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">twoDParm</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Data Parameters&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">twoDParm</span> <span class="ow">in</span> <span class="n">indParmList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">twoDParm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arraySplittingMnemonics</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isInteger</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">):</span>
                <span class="n">twoDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span>
                                                   <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">isString</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">):</span>
                <span class="n">slen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">][</span><span class="n">twoDParm</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">slen</span><span class="p">)</span>
                <span class="n">twoDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span>
                                                   <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">twoDVar</span> <span class="o">=</span> <span class="n">thisGroup</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">,</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span>
                                                   <span class="n">zlib</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">twoDVar</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getParmUnits</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span>
            <span class="n">twoDVar</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">madParmObj</span><span class="o">.</span><span class="n">getSimpleParmDescription</span><span class="p">(</span><span class="n">twoDParm</span><span class="p">)</span>
            <span class="c1"># move the last dim in Hdf5 (time) to be the first now</span>
            <span class="n">reshape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)))</span>
            <span class="n">newShape</span> <span class="o">=</span> <span class="n">reshape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">reshape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">hdf5Group</span><span class="p">[</span><span class="s1">&#39;2D Parameters&#39;</span><span class="p">][</span><span class="n">twoDParm</span><span class="p">],</span> <span class="n">newShape</span><span class="p">)</span>
            <span class="n">twoDVar</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        
            
    
    <span class="bp">self</span><span class="o">.</span><span class="n">_fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.convertToNetCDF4.getCatalogText">
    <p>def <span class="ident">getCatalogText</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getCatalogText returns the catalog record text as a string</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.convertToNetCDF4.getCatalogText', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.convertToNetCDF4.getCatalogText" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getCatalogText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getCatalogText returns the catalog record text as a string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Experiment Notes&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">return</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">]</span>
    <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">substr</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Header information&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Header information&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">retStr</span> <span class="o">+=</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.convertToNetCDF4.getHeaderText">
    <p>def <span class="ident">getHeaderText</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>getHeaderText returns the header record text as a string</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.convertToNetCDF4.getHeaderText', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.convertToNetCDF4.getHeaderText" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">getHeaderText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getHeaderText returns the header record text as a string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Experiment Notes&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">return</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fi</span><span class="p">[</span><span class="s1">&#39;Metadata&#39;</span><span class="p">][</span><span class="s1">&#39;Experiment Notes&#39;</span><span class="p">]</span>
    <span class="n">retStr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">headerFound</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">substr</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Header information&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">headerFound</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Header information&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">headerFound</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">headerFound</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">bytes_</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">retStr</span> <span class="o">+=</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">retStr</span> <span class="o">+=</span> <span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span><span class="p">(</span><span class="n">retStr</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="madrigal.cedar.convertToText" class="name">class <span class="ident">convertToText</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.convertToText', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.convertToText" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">convertToText</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputHdf5</span><span class="p">,</span> <span class="n">outputTxt</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="n">showHeaders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">filterList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">assumed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">knownbad</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;convertToText converts a Madrigal HDF5 file to a text file. Designed to be able</span>
<span class="sd">        to handle large files without a large memory footprint</span>
<span class="sd">            </span>
<span class="sd">            Inputs:</span>
<span class="sd">                inputHdf5 - filename of input Madrigal Hdf5 file</span>
<span class="sd">                outputTxt - output text file</span>
<span class="sd">                summary - type of summary line to print at top.  Allowed values are:</span>
<span class="sd">                    &#39;plain&#39; - text only mnemonic names, but only if not showHeaders</span>
<span class="sd">                    &#39;html&#39; - mnemonic names wrapped in standard javascript code to allow descriptive popups</span>
<span class="sd">                    &#39;summary&#39; - print overview of file and filters used. Also text only mnemonic names, </span>
<span class="sd">                        but only if not showHeaders</span>
<span class="sd">                    None - no summary line</span>
<span class="sd">                    </span>
<span class="sd">                showHeaders - if True, print header in format for each record.  If False, the default,</span>
<span class="sd">                    do not.</span>
<span class="sd">                    </span>
<span class="sd">                filterList - a list of madrigal.derivation.MadrigalFilter objects to be described in the </span>
<span class="sd">                    summary.  Default is None, in which case not described in summary.  Ignored if summary</span>
<span class="sd">                    is not &#39;summary&#39;</span>
<span class="sd">                    </span>
<span class="sd">                missing, assumed, knownbad - how to print Cedar special values.  Default is None for</span>
<span class="sd">                    all, so that value printed in value in numpy table as per spec.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">madCedarObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">madCedarObj</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="n">outputTxt</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span> <span class="n">showHeaders</span><span class="o">=</span><span class="n">showHeaders</span><span class="p">,</span> <span class="n">filterList</span><span class="o">=</span><span class="n">filterList</span><span class="p">,</span>
                              <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span> <span class="n">assumed</span><span class="o">=</span><span class="n">assumed</span><span class="p">,</span> <span class="n">knownbad</span><span class="o">=</span><span class="n">knownbad</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                              <span class="n">firstWrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">while</span> <span class="p">(</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">newRecs</span><span class="p">,</span> <span class="n">isComplete</span> <span class="o">=</span> <span class="n">madCedarObj</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newRecs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">madCedarObj</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="n">outputTxt</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span> <span class="n">showHeaders</span><span class="o">=</span><span class="n">showHeaders</span><span class="p">,</span>
                                  <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span> <span class="n">assumed</span><span class="o">=</span><span class="n">assumed</span><span class="p">,</span> <span class="n">knownbad</span><span class="o">=</span><span class="n">knownbad</span><span class="p">,</span> 
                                  <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">firstWrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">isComplete</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">newRecs</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">break</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#madrigal.cedar.convertToText">convertToText</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.convertToText.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, inputHdf5, outputTxt, summary=&#39;plain&#39;, showHeaders=False, filterList=None, missing=None, assumed=None, knownbad=None)</p>
    </div>
    

    
  
    <div class="desc"><p>convertToText converts a Madrigal HDF5 file to a text file. Designed to be able
to handle large files without a large memory footprint</p>
<div class="codehilite"><pre><span></span><span class="n">Inputs</span><span class="o">:</span>
    <span class="n">inputHdf5</span> <span class="o">-</span> <span class="n">filename</span> <span class="n">of</span> <span class="n">input</span> <span class="n">Madrigal</span> <span class="n">Hdf5</span> <span class="n">file</span>
    <span class="n">outputTxt</span> <span class="o">-</span> <span class="n">output</span> <span class="n">text</span> <span class="n">file</span>
    <span class="n">summary</span> <span class="o">-</span> <span class="n">type</span> <span class="n">of</span> <span class="n">summary</span> <span class="n">line</span> <span class="n">to</span> <span class="n">print</span> <span class="n">at</span> <span class="n">top</span><span class="o">.</span>  <span class="n">Allowed</span> <span class="n">values</span> <span class="n">are</span><span class="o">:</span>
        <span class="s1">&#39;plain&#39;</span> <span class="o">-</span> <span class="n">text</span> <span class="n">only</span> <span class="n">mnemonic</span> <span class="n">names</span><span class="o">,</span> <span class="n">but</span> <span class="n">only</span> <span class="k">if</span> <span class="n">not</span> <span class="n">showHeaders</span>
        <span class="s1">&#39;html&#39;</span> <span class="o">-</span> <span class="n">mnemonic</span> <span class="n">names</span> <span class="n">wrapped</span> <span class="k">in</span> <span class="n">standard</span> <span class="n">javascript</span> <span class="n">code</span> <span class="n">to</span> <span class="n">allow</span> <span class="n">descriptive</span> <span class="n">popups</span>
        <span class="s1">&#39;summary&#39;</span> <span class="o">-</span> <span class="n">print</span> <span class="n">overview</span> <span class="n">of</span> <span class="n">file</span> <span class="n">and</span> <span class="n">filters</span> <span class="n">used</span><span class="o">.</span> <span class="n">Also</span> <span class="n">text</span> <span class="n">only</span> <span class="n">mnemonic</span> <span class="n">names</span><span class="o">,</span> 
            <span class="n">but</span> <span class="n">only</span> <span class="k">if</span> <span class="n">not</span> <span class="n">showHeaders</span>
        <span class="n">None</span> <span class="o">-</span> <span class="n">no</span> <span class="n">summary</span> <span class="n">line</span>

    <span class="n">showHeaders</span> <span class="o">-</span> <span class="k">if</span> <span class="n">True</span><span class="o">,</span> <span class="n">print</span> <span class="n">header</span> <span class="k">in</span> <span class="n">format</span> <span class="k">for</span> <span class="k">each</span> <span class="n">record</span><span class="o">.</span>  <span class="n">If</span> <span class="n">False</span><span class="o">,</span> <span class="n">the</span> <span class="k">default</span><span class="o">,</span>
        <span class="k">do</span> <span class="n">not</span><span class="o">.</span>

    <span class="n">filterList</span> <span class="o">-</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">madrigal</span><span class="o">.</span><span class="na">derivation</span><span class="o">.</span><span class="na">MadrigalFilter</span> <span class="n">objects</span> <span class="n">to</span> <span class="n">be</span> <span class="n">described</span> <span class="k">in</span> <span class="n">the</span> 
        <span class="n">summary</span><span class="o">.</span>  <span class="n">Default</span> <span class="k">is</span> <span class="n">None</span><span class="o">,</span> <span class="k">in</span> <span class="n">which</span> <span class="k">case</span> <span class="n">not</span> <span class="n">described</span> <span class="k">in</span> <span class="n">summary</span><span class="o">.</span>  <span class="n">Ignored</span> <span class="k">if</span> <span class="n">summary</span>
        <span class="k">is</span> <span class="n">not</span> <span class="s1">&#39;summary&#39;</span>

    <span class="n">missing</span><span class="o">,</span> <span class="n">assumed</span><span class="o">,</span> <span class="n">knownbad</span> <span class="o">-</span> <span class="n">how</span> <span class="n">to</span> <span class="n">print</span> <span class="n">Cedar</span> <span class="n">special</span> <span class="n">values</span><span class="o">.</span>  <span class="n">Default</span> <span class="k">is</span> <span class="n">None</span> <span class="k">for</span>
        <span class="n">all</span><span class="o">,</span> <span class="n">so</span> <span class="n">that</span> <span class="n">value</span> <span class="n">printed</span> <span class="k">in</span> <span class="n">value</span> <span class="k">in</span> <span class="n">numpy</span> <span class="n">table</span> <span class="k">as</span> <span class="n">per</span> <span class="n">spec</span><span class="o">.</span>
</pre></div></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.convertToText.__init__', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.convertToText.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputHdf5</span><span class="p">,</span> <span class="n">outputTxt</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="n">showHeaders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">filterList</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">missing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">assumed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">knownbad</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;convertToText converts a Madrigal HDF5 file to a text file. Designed to be able</span>
<span class="sd">    to handle large files without a large memory footprint</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            inputHdf5 - filename of input Madrigal Hdf5 file</span>
<span class="sd">            outputTxt - output text file</span>
<span class="sd">            summary - type of summary line to print at top.  Allowed values are:</span>
<span class="sd">                &#39;plain&#39; - text only mnemonic names, but only if not showHeaders</span>
<span class="sd">                &#39;html&#39; - mnemonic names wrapped in standard javascript code to allow descriptive popups</span>
<span class="sd">                &#39;summary&#39; - print overview of file and filters used. Also text only mnemonic names, </span>
<span class="sd">                    but only if not showHeaders</span>
<span class="sd">                None - no summary line</span>
<span class="sd">                </span>
<span class="sd">            showHeaders - if True, print header in format for each record.  If False, the default,</span>
<span class="sd">                do not.</span>
<span class="sd">                </span>
<span class="sd">            filterList - a list of madrigal.derivation.MadrigalFilter objects to be described in the </span>
<span class="sd">                summary.  Default is None, in which case not described in summary.  Ignored if summary</span>
<span class="sd">                is not &#39;summary&#39;</span>
<span class="sd">                </span>
<span class="sd">            missing, assumed, knownbad - how to print Cedar special values.  Default is None for</span>
<span class="sd">                all, so that value printed in value in numpy table as per spec.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">madCedarObj</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">inputHdf5</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">madCedarObj</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="n">outputTxt</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span> <span class="n">showHeaders</span><span class="o">=</span><span class="n">showHeaders</span><span class="p">,</span> <span class="n">filterList</span><span class="o">=</span><span class="n">filterList</span><span class="p">,</span>
                          <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span> <span class="n">assumed</span><span class="o">=</span><span class="n">assumed</span><span class="p">,</span> <span class="n">knownbad</span><span class="o">=</span><span class="n">knownbad</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                          <span class="n">firstWrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">while</span> <span class="p">(</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">newRecs</span><span class="p">,</span> <span class="n">isComplete</span> <span class="o">=</span> <span class="n">madCedarObj</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newRecs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">madCedarObj</span><span class="o">.</span><span class="n">writeText</span><span class="p">(</span><span class="n">outputTxt</span><span class="p">,</span> <span class="n">summary</span><span class="o">=</span><span class="n">summary</span><span class="p">,</span> <span class="n">showHeaders</span><span class="o">=</span><span class="n">showHeaders</span><span class="p">,</span>
                              <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span> <span class="n">assumed</span><span class="o">=</span><span class="n">assumed</span><span class="p">,</span> <span class="n">knownbad</span><span class="o">=</span><span class="n">knownbad</span><span class="p">,</span> 
                              <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">firstWrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isComplete</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">newRecs</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">break</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="madrigal.cedar.mergeCedarFiles" class="name">class <span class="ident">mergeCedarFiles</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.mergeCedarFiles', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.mergeCedarFiles" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">mergeCedarFiles</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input1Hdf5</span><span class="p">,</span> <span class="n">input2Hdf5</span><span class="p">,</span> <span class="n">outputHdf5</span><span class="p">,</span> <span class="n">includeDuplicate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skipArray</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;mergeCedarFiles creates a new CEDAR Madrigal File by combining two CEDAR Madrigal input files.</span>
<span class="sd">        Records are merged in time.  Both files must have the same parameters.  Header and Catalog text from the</span>
<span class="sd">        first of the two files.</span>
<span class="sd">            </span>
<span class="sd">            Inputs:</span>
<span class="sd">                input1Hdf5 - filename of first input Madrigal Hdf5 file (header and catalog used for output file)</span>
<span class="sd">                input2Hdf5 - filename of second input Madrigal Hdf5 file (header and catalog ignored)</span>
<span class="sd">                outputHdf5 - output combined Hdf5 file, records sorted in time</span>
<span class="sd">                includeDuplicate - if False (the default), print message when two records have duplicate start and end</span>
<span class="sd">                    times and ignore one in input2Hdf5.  If True, include both (first input1Hdf5, then input2Hdf5)</span>
<span class="sd">                skipArray - if False and any 2D parms, create array layout (the default).  If True, skip array</span>
<span class="sd">                    layout (typically used when there are too many ind parm value combinations).</span>
<span class="sd">                    </span>
<span class="sd">        Reduces memory footprint using dump</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">input1</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">input1Hdf5</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">arraySplitParms</span> <span class="o">=</span> <span class="n">input1</span><span class="o">.</span><span class="n">getArraySplitParms</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">arraySplitParms</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">arraySplitParms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">input2</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">input2Hdf5</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">outputHdf5</span><span class="p">,</span> <span class="n">createFlag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">arraySplitParms</span><span class="o">=</span><span class="n">arraySplitParms</span><span class="p">,</span>
                                                  <span class="n">skipArray</span><span class="o">=</span><span class="n">skipArray</span><span class="p">)</span>
        
        <span class="n">rec1</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># index into input1</span>
        <span class="n">rec2</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># index into input2</span>
        <span class="n">complete1</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">complete2</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">outputCount</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># used for</span>
        
        <span class="k">while</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
            <span class="c1"># see if we need to dump output</span>
            <span class="k">if</span> <span class="n">outputCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">outputCount</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
                
            <span class="c1"># see if we need to load any more data</span>
            
            <span class="k">if</span> <span class="n">rec1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input1</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">complete1</span><span class="p">:</span>
                <span class="c1"># try to load more</span>
                <span class="n">loaded</span><span class="p">,</span> <span class="n">complete1</span> <span class="o">=</span> <span class="n">input1</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">rec1</span> <span class="o">=</span> <span class="mi">0</span>
                    
            <span class="k">if</span> <span class="n">rec2</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input2</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">complete2</span><span class="p">:</span>
                <span class="c1"># try to load more</span>
                <span class="n">loaded</span><span class="p">,</span> <span class="n">complete2</span> <span class="o">=</span> <span class="n">input2</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">rec2</span> <span class="o">=</span> <span class="mi">0</span>
                    
            <span class="k">if</span> <span class="n">complete1</span> <span class="ow">and</span> <span class="n">complete2</span><span class="p">:</span>
                <span class="c1"># no more data</span>
                <span class="k">break</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">complete1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">]</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                    <span class="c1"># add catalog or header record</span>
                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                    <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">complete2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">]</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                    <span class="c1"># ignore catalog or header record</span>
                    <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
            
            <span class="c1"># add from remaining file if only one file left</span>
            <span class="k">if</span> <span class="n">complete1</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            
            <span class="k">if</span> <span class="n">complete2</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            
            <span class="c1"># now we know we have two data records - add earlier</span>
            <span class="n">sDT1</span> <span class="o">=</span> <span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">]</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
            <span class="n">sDT2</span> <span class="o">=</span> <span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">]</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
            <span class="n">eDT1</span> <span class="o">=</span> <span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">]</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
            <span class="n">eDT2</span> <span class="o">=</span> <span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">]</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">sDT1</span> <span class="o">&lt;</span> <span class="n">sDT2</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            
            <span class="k">elif</span> <span class="n">sDT1</span> <span class="o">&gt;</span> <span class="n">sDT2</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            
            <span class="k">elif</span> <span class="n">eDT1</span> <span class="o">&lt;</span> <span class="n">eDT2</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            
            <span class="k">elif</span> <span class="n">eDT1</span> <span class="o">&gt;</span> <span class="n">eDT2</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            
            <span class="c1"># times match - handle depending on includeDuplicate</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">includeDuplicate</span><span class="p">:</span>
                <span class="c1"># only take from first, throw away second</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ignoring record from </span><span class="si">%s</span><span class="s1"> with duplicate times </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">input2Hdf5</span><span class="p">,</span>
                                                                                <span class="nb">str</span><span class="p">(</span><span class="n">sDT2</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">eDT2</span><span class="p">)))</span>
                <span class="k">continue</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># add both</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">])</span>
                <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># not technically correct, but makes sure dump is not missed</span>
                
        <span class="k">if</span> <span class="n">outputCount</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
            
        <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#madrigal.cedar.mergeCedarFiles">mergeCedarFiles</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="madrigal.cedar.mergeCedarFiles.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, input1Hdf5, input2Hdf5, outputHdf5, includeDuplicate=False, skipArray=False)</p>
    </div>
    

    
  
    <div class="desc"><p>mergeCedarFiles creates a new CEDAR Madrigal File by combining two CEDAR Madrigal input files.
Records are merged in time.  Both files must have the same parameters.  Header and Catalog text from the
first of the two files.</p>
<div class="codehilite"><pre><span></span><span class="n">Inputs</span><span class="o">:</span>
    <span class="n">input1Hdf5</span> <span class="o">-</span> <span class="n">filename</span> <span class="n">of</span> <span class="n">first</span> <span class="n">input</span> <span class="n">Madrigal</span> <span class="n">Hdf5</span> <span class="n">file</span> <span class="o">(</span><span class="n">header</span> <span class="n">and</span> <span class="n">catalog</span> <span class="n">used</span> <span class="k">for</span> <span class="n">output</span> <span class="n">file</span><span class="o">)</span>
    <span class="n">input2Hdf5</span> <span class="o">-</span> <span class="n">filename</span> <span class="n">of</span> <span class="n">second</span> <span class="n">input</span> <span class="n">Madrigal</span> <span class="n">Hdf5</span> <span class="n">file</span> <span class="o">(</span><span class="n">header</span> <span class="n">and</span> <span class="n">catalog</span> <span class="n">ignored</span><span class="o">)</span>
    <span class="n">outputHdf5</span> <span class="o">-</span> <span class="n">output</span> <span class="n">combined</span> <span class="n">Hdf5</span> <span class="n">file</span><span class="o">,</span> <span class="n">records</span> <span class="n">sorted</span> <span class="k">in</span> <span class="n">time</span>
    <span class="n">includeDuplicate</span> <span class="o">-</span> <span class="k">if</span> <span class="n">False</span> <span class="o">(</span><span class="n">the</span> <span class="k">default</span><span class="o">),</span> <span class="n">print</span> <span class="n">message</span> <span class="n">when</span> <span class="n">two</span> <span class="n">records</span> <span class="n">have</span> <span class="n">duplicate</span> <span class="n">start</span> <span class="n">and</span> <span class="n">end</span>
        <span class="n">times</span> <span class="n">and</span> <span class="n">ignore</span> <span class="n">one</span> <span class="k">in</span> <span class="n">input2Hdf5</span><span class="o">.</span>  <span class="n">If</span> <span class="n">True</span><span class="o">,</span> <span class="k">include</span> <span class="n">both</span> <span class="o">(</span><span class="n">first</span> <span class="n">input1Hdf5</span><span class="o">,</span> <span class="n">then</span> <span class="n">input2Hdf5</span><span class="o">)</span>
    <span class="n">skipArray</span> <span class="o">-</span> <span class="k">if</span> <span class="n">False</span> <span class="n">and</span> <span class="n">any</span> <span class="mi">2</span><span class="n">D</span> <span class="n">parms</span><span class="o">,</span> <span class="n">create</span> <span class="n">array</span> <span class="n">layout</span> <span class="o">(</span><span class="n">the</span> <span class="k">default</span><span class="o">).</span>  <span class="n">If</span> <span class="n">True</span><span class="o">,</span> <span class="n">skip</span> <span class="n">array</span>
        <span class="n">layout</span> <span class="o">(</span><span class="n">typically</span> <span class="n">used</span> <span class="n">when</span> <span class="n">there</span> <span class="n">are</span> <span class="n">too</span> <span class="n">many</span> <span class="n">ind</span> <span class="n">parm</span> <span class="n">value</span> <span class="n">combinations</span><span class="o">).</span>
</pre></div>


<p>Reduces memory footprint using dump</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-madrigal.cedar.mergeCedarFiles.__init__', this);">Show source &equiv;</a></p>
  <div id="source-madrigal.cedar.mergeCedarFiles.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input1Hdf5</span><span class="p">,</span> <span class="n">input2Hdf5</span><span class="p">,</span> <span class="n">outputHdf5</span><span class="p">,</span> <span class="n">includeDuplicate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skipArray</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;mergeCedarFiles creates a new CEDAR Madrigal File by combining two CEDAR Madrigal input files.</span>
<span class="sd">    Records are merged in time.  Both files must have the same parameters.  Header and Catalog text from the</span>
<span class="sd">    first of the two files.</span>
<span class="sd">        </span>
<span class="sd">        Inputs:</span>
<span class="sd">            input1Hdf5 - filename of first input Madrigal Hdf5 file (header and catalog used for output file)</span>
<span class="sd">            input2Hdf5 - filename of second input Madrigal Hdf5 file (header and catalog ignored)</span>
<span class="sd">            outputHdf5 - output combined Hdf5 file, records sorted in time</span>
<span class="sd">            includeDuplicate - if False (the default), print message when two records have duplicate start and end</span>
<span class="sd">                times and ignore one in input2Hdf5.  If True, include both (first input1Hdf5, then input2Hdf5)</span>
<span class="sd">            skipArray - if False and any 2D parms, create array layout (the default).  If True, skip array</span>
<span class="sd">                layout (typically used when there are too many ind parm value combinations).</span>
<span class="sd">                </span>
<span class="sd">    Reduces memory footprint using dump</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">input1</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">input1Hdf5</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">arraySplitParms</span> <span class="o">=</span> <span class="n">input1</span><span class="o">.</span><span class="n">getArraySplitParms</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">arraySplitParms</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">arraySplitParms</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">input2</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">input2Hdf5</span><span class="p">,</span> <span class="n">maxRecords</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">madrigal</span><span class="o">.</span><span class="n">cedar</span><span class="o">.</span><span class="n">MadrigalCedarFile</span><span class="p">(</span><span class="n">outputHdf5</span><span class="p">,</span> <span class="n">createFlag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">arraySplitParms</span><span class="o">=</span><span class="n">arraySplitParms</span><span class="p">,</span>
                                              <span class="n">skipArray</span><span class="o">=</span><span class="n">skipArray</span><span class="p">)</span>
    
    <span class="n">rec1</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># index into input1</span>
    <span class="n">rec2</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># index into input2</span>
    <span class="n">complete1</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">complete2</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">outputCount</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># used for</span>
    
    <span class="k">while</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># see if we need to dump output</span>
        <span class="k">if</span> <span class="n">outputCount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">outputCount</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
            
        <span class="c1"># see if we need to load any more data</span>
        
        <span class="k">if</span> <span class="n">rec1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input1</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">complete1</span><span class="p">:</span>
            <span class="c1"># try to load more</span>
            <span class="n">loaded</span><span class="p">,</span> <span class="n">complete1</span> <span class="o">=</span> <span class="n">input1</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">rec1</span> <span class="o">=</span> <span class="mi">0</span>
                
        <span class="k">if</span> <span class="n">rec2</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input2</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">complete2</span><span class="p">:</span>
            <span class="c1"># try to load more</span>
            <span class="n">loaded</span><span class="p">,</span> <span class="n">complete2</span> <span class="o">=</span> <span class="n">input2</span><span class="o">.</span><span class="n">loadNextRecords</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">rec2</span> <span class="o">=</span> <span class="mi">0</span>
                
        <span class="k">if</span> <span class="n">complete1</span> <span class="ow">and</span> <span class="n">complete2</span><span class="p">:</span>
            <span class="c1"># no more data</span>
            <span class="k">break</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">complete1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">]</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="c1"># add catalog or header record</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
                <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">complete2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">]</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                <span class="c1"># ignore catalog or header record</span>
                <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
        
        <span class="c1"># add from remaining file if only one file left</span>
        <span class="k">if</span> <span class="n">complete1</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">])</span>
            <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        
        <span class="k">if</span> <span class="n">complete2</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
            <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        
        <span class="c1"># now we know we have two data records - add earlier</span>
        <span class="n">sDT1</span> <span class="o">=</span> <span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">]</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
        <span class="n">sDT2</span> <span class="o">=</span> <span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">]</span><span class="o">.</span><span class="n">getStartDatetime</span><span class="p">()</span>
        <span class="n">eDT1</span> <span class="o">=</span> <span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">]</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
        <span class="n">eDT2</span> <span class="o">=</span> <span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">]</span><span class="o">.</span><span class="n">getEndDatetime</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">sDT1</span> <span class="o">&lt;</span> <span class="n">sDT2</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
            <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        
        <span class="k">elif</span> <span class="n">sDT1</span> <span class="o">&gt;</span> <span class="n">sDT2</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">])</span>
            <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        
        <span class="k">elif</span> <span class="n">eDT1</span> <span class="o">&lt;</span> <span class="n">eDT2</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
            <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        
        <span class="k">elif</span> <span class="n">eDT1</span> <span class="o">&gt;</span> <span class="n">eDT2</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">])</span>
            <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        
        <span class="c1"># times match - handle depending on includeDuplicate</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">includeDuplicate</span><span class="p">:</span>
            <span class="c1"># only take from first, throw away second</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
            <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ignoring record from </span><span class="si">%s</span><span class="s1"> with duplicate times </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">input2Hdf5</span><span class="p">,</span>
                                                                            <span class="nb">str</span><span class="p">(</span><span class="n">sDT2</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">eDT2</span><span class="p">)))</span>
            <span class="k">continue</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># add both</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input1</span><span class="p">[</span><span class="n">rec1</span><span class="p">])</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input2</span><span class="p">[</span><span class="n">rec2</span><span class="p">])</span>
            <span class="n">rec1</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">rec2</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">outputCount</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># not technically correct, but makes sure dump is not missed</span>
            
    <span class="k">if</span> <span class="n">outputCount</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">output</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
        
    <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
<table width="100%" border="1" cellpadding="0" cellspacing="2" class="navigation">
  <tr>
    <td width="5%"><a href="admin.m.html"><img src="/static/previous.png" alt="previous" width="32" height="32" /></a></td>
    <td width="5%"><a href="index.html"><img src="/static/up.png" alt="up" width="32" height="32" /></a></td>
    <td width="5%"><a href="data.m.html"><img src="/static/next.png" alt="next" width="32" height="32" /></a></td>
    <td width="54%">madrigal.cedar</td>
    <td width="13%"><a href="../madContents.html">Doc home </a></td>
    <td width="18%"><a href="/">Madrigal home</a></td>
  </tr>
</table>
<div class='online-navigation'>
<b class="navlabel">Previous:</b>
<a class="sectref" href="admin.m.html">madrigal.admin </A>
<b class="navlabel">&nbsp;&nbsp;Up:</b>
<a class="sectref" href="index.html">Internal Madrigal Python API</A>
<b class="navlabel">&nbsp;&nbsp;Next:</b>
<a class="sectref" href="data.m.html">madrigal.data </A></div>
<hr/>
<p>&nbsp;</p>
</body>
</html>
